# v0.3.1b: Database Entities - Detailed Changelog

## Overview

Implements database entities and EF Core configurations for persisting workspace state and file context history.

## New Files

### Entities (`AIntern.Core/Entities/`)

| File | Lines | Purpose |
|------|-------|---------|
| `RecentWorkspaceEntity.cs` | 170 | Workspace persistence with JSON |
| `FileContextEntity.cs` | 230 | File context + FileContextStub |

### Configurations (`AIntern.Data/Configurations/`)

| File | Lines | Purpose |
|------|-------|---------|
| `RecentWorkspaceConfiguration.cs` | 65 | Table schema, unique RootPath |
| `FileContextConfiguration.cs` | 70 | FK cascade, indexes |

### Unit Tests

| File | Tests |
|------|-------|
| `RecentWorkspaceEntityTests.cs` | 9 |
| `FileContextEntityTests.cs` | 7 |

## Database Schema

```
RecentWorkspaces
├── Id (GUID, PK)
├── Name (TEXT, nullable)
├── RootPath (TEXT, UNIQUE)
├── LastAccessedAt (TEXT, INDEX DESC)
├── OpenFilesJson (TEXT)
├── ActiveFilePath (TEXT)
├── ExpandedFoldersJson (TEXT)
└── IsPinned (INTEGER)

FileContextHistory
├── Id (GUID, PK)
├── ConversationId (GUID, FK → Conversations)
├── MessageId (GUID, FK → Messages)
├── FilePath, FileName, Language
├── ContentHash, LineCount, EstimatedTokens
├── StartLine, EndLine (nullable)
└── AttachedAt (TEXT, INDEX)
```

## Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| JSON for OpenFiles/ExpandedFolders | Flexible array storage without join tables |
| No Content in FileContextEntity | Avoid blob storage; re-read from disk |
| FileContextStub | Lightweight for history queries |
| Cascade delete | Clean up when conversation/message deleted |

## Modified Files

| File | Changes |
|------|---------|
| `AInternDbContext.cs` | +2 DbSets, updated OnModelCreating logging |

## Test Results

```
Test summary: total: 355, failed: 0, succeeded: 355
Build succeeded in 5.1s
```

## Dependencies

| Part | Dependency |
|------|------------|
| v0.3.1a | Workspace, FileContext models |
| v0.2.1 | ConversationEntity, MessageEntity (FK targets) |
