# Changelog: v0.5.2d - ViewModels

**Date**: 2026-01-18
**Parent**: v0.5.2 Terminal UI
**Focus**: MVVM ViewModel layer for terminal panel session management

---

## Summary

Created the ViewModel layer for the terminal panel, enabling session management, tab navigation, and panel state control through MVVM pattern.

---

## Added

### TerminalSessionViewModel
`src/AIntern.Desktop/ViewModels/TerminalSessionViewModel.cs`

ViewModel for a single terminal session (tab):
- **Observable Properties**: `Name`, `IsActive`, `State`, `WorkingDirectory`
- **Computed Properties**: `Id`, `ShellType`, `HasExited`, `ExitCode`, `Session`
- **Methods**: `UpdateFromSession()`, `GetShellType(path)` (internal)
- **Shell Type Detection**: Cross-platform support for bash, zsh, fish, powershell, cmd, nushell

### TerminalPanelViewModel
`src/AIntern.Desktop/ViewModels/TerminalPanelViewModel.cs`

ViewModel for the terminal panel:
- **Collections**: `Sessions: ObservableCollection<TerminalSessionViewModel>`
- **Session State**: `ActiveSession`, `HasActiveSession`
- **Panel State**: `IsVisible`, `IsMaximized`, `PanelHeight` (default 300)
- **Terminal Settings**: `FontFamily`, `FontSize`, `Theme`
- **Events**: `ActiveSessionChanged`

Commands:
| Command | Purpose |
|---------|---------|
| `NewSessionCommand` | Create new terminal |
| `CloseSessionCommand` | Close specific session |
| `CloseActiveSessionCommand` | Close active session |
| `ActivateSessionCommand` | Switch tabs |
| `TogglePanelCommand` | Toggle visibility |
| `ShowPanelCommand` | Show panel |
| `HidePanelCommand` | Hide panel |
| `ToggleMaximizeCommand` | Toggle maximize |
| `ClearTerminalCommand` | Clear screen |
| `NextTabCommand` | Navigate to next tab (circular) |
| `PreviousTabCommand` | Navigate to previous tab (circular) |

Event Handlers:
- `OnSessionCreated` - Create VM, add to collection, auto-activate
- `OnSessionClosed` - Remove session, activate adjacent
- `OnSessionStateChanged` - Update session state
- `OnTitleChanged` - Update tab name

### Unit Tests

| Test File | Tests | Pass Rate |
|-----------|-------|-----------|
| `TerminalSessionViewModelTests.cs` | 32 | 100% |
| `TerminalPanelViewModelTests.cs` | 28 | 100% |
| **Total** | **60** | **100%** |

---

## Dependencies

- v0.5.1c: `ITerminalService`, `TerminalSession`, `TerminalSessionState`
- v0.5.2a: `TerminalTheme`
- Desktop Framework: `ViewModelBase`
- CommunityToolkit.Mvvm: `[ObservableProperty]`, `[RelayCommand]`

---

## Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `TerminalSessionViewModel.cs` | 292 | Session/tab ViewModel |
| `TerminalPanelViewModel.cs` | 507 | Panel ViewModel with commands |
| `TerminalSessionViewModelTests.cs` | 270 | Session VM tests |
| `TerminalPanelViewModelTests.cs` | 293 | Panel VM tests |

---

## Technical Notes

### Cross-Platform Shell Detection
Path normalization replaces Windows backslashes before filename extraction, ensuring correct shell type detection on all platforms.

### Thread Safety
All `ITerminalService` event handlers dispatch to UI thread via `Dispatcher.UIThread.Post()`.

### Tab Navigation
Circular navigation: NextTab wraps from last to first, PreviousTab wraps from first to last.
