# v0.3.1a: Core Models - Detailed Changelog

## Overview

This release introduces the core domain models for the Workspace Awareness system (v0.3.0). These models establish the foundation for workspace management, file system representation, and file context attachment for LLM conversations.

## New Files

### Utilities

| File | Lines | Purpose |
|------|-------|---------|
| `AIntern.Core/Utilities/LanguageDetector.cs` | 186 | File extension to language mapping |
| `AIntern.Core/Utilities/TokenEstimator.cs` | 117 | LLM token count estimation |

### Models

| File | Lines | Purpose |
|------|-------|---------|
| `AIntern.Core/Models/Workspace.cs` | 128 | Project folder representation |
| `AIntern.Core/Models/FileSystemItem.cs` | 195 | File/directory model |
| `AIntern.Core/Models/FileContext.cs` | 178 | Attached file content for chat |

### Unit Tests

| File | Tests | Coverage |
|------|-------|----------|
| `AIntern.Core.Tests/Models/WorkspaceTests.cs` | 10 | DisplayName, paths, Touch, defaults |
| `AIntern.Core.Tests/Models/FileSystemItemTests.cs` | 12 | Factory methods, formatting, language |
| `AIntern.Core.Tests/Models/FileContextTests.cs` | 14 | Factory methods, hash, LLM formatting |
| `AIntern.Core.Tests/Utilities/TokenEstimatorTests.cs` | 15 | Estimation, multipliers, budget |

## Model Details

### Workspace

Represents an open project folder with UI state persistence:

```csharp
public sealed class Workspace
{
    public Guid Id { get; init; }
    public string Name { get; set; }
    public required string RootPath { get; init; }
    public IReadOnlyList<string> OpenFiles { get; set; }
    public string? ActiveFilePath { get; set; }
    public IReadOnlyList<string> ExpandedFolders { get; set; }
    public bool IsPinned { get; set; }
    
    // Computed
    public string DisplayName => ...;
    public bool Exists => Directory.Exists(RootPath);
    
    // Path utilities
    public string GetAbsolutePath(string relativePath);
    public string GetRelativePath(string absolutePath);
    public bool ContainsPath(string absolutePath);
    public void Touch();
}
```

### FileSystemItem

Unified model for files and directories with factory methods:

```csharp
public sealed class FileSystemItem
{
    public required string Path { get; init; }
    public required string Name { get; init; }
    public required FileSystemItemType Type { get; init; }
    
    // Factory methods
    public static FileSystemItem FromFileInfo(FileInfo info);
    public static FileSystemItem FromDirectoryInfo(DirectoryInfo info, bool hasChildren);
    
    // Computed
    public string Extension => ...;
    public string? Language => LanguageDetector.DetectByExtension(Extension);
    public string FormattedSize => ...; // "1.5 KB"
}

public enum FileSystemItemType { File, Directory, SymbolicLink }
```

### FileContext

File content attached to chat messages with LLM formatting:

```csharp
public sealed class FileContext
{
    public required string FilePath { get; init; }
    public required string Content { get; init; }
    public int EstimatedTokens { get; init; }
    public string ContentHash { get; init; }
    
    // Factory methods
    public static FileContext FromFile(string filePath, string content);
    public static FileContext FromSelection(string filePath, string content, int startLine, int endLine);
    
    // LLM formatting
    public string FormatForLlmContext();
    // Returns: "// File: example.cs [csharp]\n{content}"
}
```

## Token Estimation

Language-specific multipliers for accurate context budgeting:

| Language | Multiplier | Rationale |
|----------|------------|-----------|
| C#, Java, C | 1.2 | Symbol-heavy |
| C++ | 1.25 | More operators |
| Python, Ruby | 1.0 | Readable |
| JSON | 1.3 | Verbose |
| XML, HTML | 1.3-1.35 | Tag overhead |
| Markdown | 0.9 | Prose-heavy |
| Plain text | 0.85 | Most readable |

## Language Detection

Supports 50+ file extensions including:

- **.NET**: `.cs`, `.csx`, `.vb`, `.fs`, `.fsx`, `.csproj`, `.axaml`
- **Web**: `.js`, `.jsx`, `.ts`, `.tsx`, `.html`, `.css`, `.vue`, `.svelte`
- **Systems**: `.c`, `.cpp`, `.rs`, `.go`, `.swift`
- **Data**: `.json`, `.xml`, `.yaml`, `.toml`
- **Shell**: `.sh`, `.bash`, `.ps1`, `.bat`
- **Special files**: `Dockerfile`, `Makefile`, `Gemfile`, `Jenkinsfile`

## Test Results

```
Test summary: total: 339, failed: 0, succeeded: 339, skipped: 0
Build succeeded in 8.4s
```

## Dependencies on Future Parts

| Part | Dependency |
|------|------------|
| v0.3.1b | RecentWorkspaceEntity uses Workspace model |
| v0.3.1c | (Completed in this release) LanguageDetector |
| v0.3.1d | FileSystemService uses FileSystemItem factory methods |
| v0.3.1e | WorkspaceService uses Workspace model |
