# v0.5.2c - Terminal Control

**Released:** 2026-01-18

Complete terminal control with input handling, text selection, clipboard integration, and cursor animation.

---

## Overview

This version creates the main `TerminalControl` UserControl that wraps the `TerminalRenderer` (v0.5.2b) and provides comprehensive user interaction capabilities. The control handles all keyboard and mouse input, translating user actions into VT100/xterm escape sequences for the terminal session.

## New Files

### Controls/Terminal/TerminalControl.axaml

XAML layout defining the visual structure of the terminal control.

**Features:**
- Grid layout with TerminalRenderer and vertical ScrollBar
- Font property binding to parent control
- Focusable for keyboard input capture
- TerminalScrollBar theme integration

### Controls/Terminal/TerminalControl.axaml.cs

Code-behind implementing all input handling and session management.

**Styled Properties:**
- `FontFamily` (string, default: "Cascadia Mono")
- `FontSize` (double, default: 14.0)
- `Theme` (TerminalTheme, default: TerminalTheme.Dark)

**Keyboard Input:**
- Special keys: Enter, Escape, Tab, Backspace, Delete, Insert
- Arrow keys: Up/Down/Left/Right → CSI A/B/C/D
- Navigation: Home, End, PageUp, PageDown (with Ctrl modifiers)
- Function keys: F1-F12 → VT100 sequences
- Ctrl+key: A-Z → Control characters (SIGINT, SIGTSTP, EOF, etc.)

**Mouse Selection:**
- Single click: Start character selection
- Double click: Word selection (letters, digits, underscore, hyphen)
- Triple click: Line selection
- Drag: Update selection dynamically
- Right click: Paste when no selection
- Mouse wheel: Scroll buffer (3 lines per tick)

**Clipboard:**
- Ctrl+Shift+C: Copy selection
- Ctrl+Shift+V: Paste with line ending normalization
- Right-click: Paste when no selection
- SelectAll(): Select entire buffer

**Cursor Blink:**
- DispatcherTimer with theme-configurable interval
- Resets on keystroke and output
- Stops when control loses focus

**Session Management:**
- `AttachSessionAsync()`: Subscribe to events, sync size
- `DetachSession()`: Unsubscribe and cleanup
- `TerminalSizeChanged` event for size notifications

### Controls/Terminal/TerminalSizeChangedEventArgs.cs

Event arguments for terminal size change notifications.

**Properties:**
- `Columns`: Number of terminal columns
- `Rows`: Number of terminal rows

### Tests/Controls/Terminal/TerminalControlTests.cs

42 unit tests covering all input handling logic.

**Test Categories:**
| Category | Tests | Description |
|----------|-------|-------------|
| Special Keys | 7 | Enter, Escape, Tab, Backspace, Delete, Insert |
| Arrow Keys | 4 | Up, Down, Left, Right |
| Navigation Keys | 6 | Home, End, PageUp, PageDown (with Ctrl) |
| Function Keys | 12 | F1-F12 sequences |
| Ctrl+Key | 12 | SIGINT, SIGTSTP, EOF, shell editing |
| Word Characters | 8 | Letters, digits, underscore, hyphen, punctuation |
| Constants | 3 | Click timing, position tolerance, scroll lines |

## Key Sequence Reference

| Key | Sequence | Description |
|-----|----------|-------------|
| Enter | `\r` | Carriage return |
| Escape | `\x1B` | ESC character |
| Tab | `\t` | Horizontal tab |
| Shift+Tab | `\x1B[Z` | Back tab |
| Backspace | `\x7F` | DEL character |
| Delete | `\x1B[3~` | CSI 3 ~ |
| Arrow Up | `\x1B[A` | CSI A |
| Arrow Down | `\x1B[B` | CSI B |
| Arrow Right | `\x1B[C` | CSI C |
| Arrow Left | `\x1B[D` | CSI D |
| Home | `\x1B[H` | CSI H |
| Ctrl+Home | `\x1B[1;5H` | CSI 1;5 H |
| End | `\x1B[F` | CSI F |
| Ctrl+End | `\x1B[1;5F` | CSI 1;5 F |
| PageUp | `\x1B[5~` | CSI 5 ~ |
| PageDown | `\x1B[6~` | CSI 6 ~ |
| F1-F4 | `\x1BOP`-`\x1BOS` | SS3 sequences |
| F5-F12 | `\x1B[15~`-`\x1B[24~` | CSI sequences |
| Ctrl+C | `\x03` | SIGINT |
| Ctrl+Z | `\x1A` | SIGTSTP |
| Ctrl+D | `\x04` | EOF |

## Statistics

- **New Files:** 4
- **New Lines of Code:** ~850
- **New Unit Tests:** 42
- **Test Pass Rate:** 100%

## Dependencies

- TerminalRenderer (v0.5.2b)
- TerminalFontMetrics (v0.5.2b)
- TerminalTheme (v0.5.2a)
- TerminalSelection (v0.5.1b)
- ITerminalService (v0.5.1c)

## Related Versions

- **v0.5.2b:** Terminal Renderer (provides rendering infrastructure)
- **v0.5.2a:** Theme & Styles (provides TerminalTheme and cursor settings)
- **v0.5.1c:** Terminal Service (provides ITerminalService for session management)
- **v0.5.2d:** ViewModels (will create TerminalSessionViewModel using this control)
