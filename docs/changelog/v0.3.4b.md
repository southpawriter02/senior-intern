# v0.3.4b: Context Formatter

**Released:** 2026-01-15

## Summary

This version implements the Context Formatter, providing methods to format attached
file contexts for LLM prompts, UI display, and storage.

## New Files

| File | Description |
|------|-------------|
| `IContextFormatter.cs` | Interface for formatting |
| `ContextPromptTemplates.cs` | Template strings |
| `ContextFormatter.cs` | Implementation |
| `ContextFormatterTests.cs` | 21 unit tests |

---

## Key Methods

| Method | Purpose |
|--------|---------|
| `FormatForPrompt` | Structured LLM prompt with all contexts |
| `FormatSingleContext` | Single context with header and code block |
| `FormatForDisplay` | UI markdown with preview/expanded modes |
| `FormatCodeBlock` | Markdown code block with syntax hint |
| `FormatContextHeader` | File header with metadata |
| `FormatForStorage` | JSON metadata (excludes full content) |

---

## Usage Examples

### LLM Prompt

```csharp
var prompt = formatter.FormatForPrompt(contexts);
// Includes intro, code blocks, and instructions
```

### UI Display

```csharp
// Collapsed with preview
var preview = formatter.FormatForDisplay(contexts, expanded: false);

// Expanded full content
var full = formatter.FormatForDisplay(contexts, expanded: true);
```

### Storage

```csharp
var json = formatter.FormatForStorage(contexts);
// Metadata only - no full content, uses ContentHash
```

---

## Test Results

- **Tests:** 21 passed
- **Build:** 0 errors (1 pre-existing warning)

## Related Versions

- v0.3.4a: Token Estimation Service
- v0.3.4c: Context Attachment ViewModel (next)
