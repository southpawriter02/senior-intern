# Design Specification: The Senior Intern v0.3.5g "Keyboard Shortcuts Manager"

## Executive Summary

This document provides a detailed implementation specification for v0.3.5g, which creates a centralized keyboard shortcuts manager for handling global and context-specific shortcuts. The service registers all application shortcuts, handles key press events, maps them to command IDs, and provides a query interface for displaying shortcuts to users.

### v0.3.5g Scope

- Create `IKeyboardShortcutService` interface
- Implement `KeyboardShortcutService` with default shortcuts
- Create `ShortcutInfo` model with display formatting
- Register 18+ default shortcuts across 7 categories
- Wire up service to MainWindow key handling
- Handle CommandRequested events in MainWindowViewModel
- Provide GetAllShortcuts() for UI display
- Detect and report shortcut conflicts

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| IKeyboardShortcutService | Interface for shortcut management |
| KeyboardShortcutService | Implementation with defaults |
| ShortcutInfo | Shortcut metadata model |
| Default shortcuts | 18+ shortcuts across 7 categories |
| Key press handling | MainWindow integration |
| Command routing | ViewModel command execution |

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.3.5g Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  IKeyboardShortcutService                                         │
│  ├── Register(gesture, commandId, description)                   │
│  │   └── Adds shortcut to dictionary                            │
│  │                                                                │
│  ├── HandleKeyPress(KeyEventArgs) → bool                         │
│  │   ├── Looks up (Key, KeyModifiers) in dictionary             │
│  │   ├── If found: fires CommandRequested, returns true         │
│  │   └── If not found: returns false                            │
│  │                                                                │
│  ├── GetAllShortcuts() → IReadOnlyList<ShortcutInfo>            │
│  │   └── Returns all shortcuts sorted by Category, Description  │
│  │                                                                │
│  ├── GetConflicts(gesture) → IReadOnlyList<ShortcutInfo>        │
│  │   └── Returns existing shortcuts with same gesture           │
│  │                                                                │
│  └── CommandRequested: EventHandler<string>                      │
│      └── Raised when valid shortcut pressed                     │
│                                                                   │
│  KeyboardShortcutService                                          │
│  ├── Private state                                               │
│  │   └── _shortcuts: Dictionary<(Key, KeyModifiers), ShortcutInfo>│
│  │                                                                │
│  ├── Constructor                                                 │
│  │   └── RegisterDefaultShortcuts()                             │
│  │                                                                │
│  ├── RegisterDefaultShortcuts()                                  │
│  │   ├── Workspace shortcuts                                    │
│  │   ├── File shortcuts                                         │
│  │   ├── Editor shortcuts                                       │
│  │   ├── Chat shortcuts                                         │
│  │   ├── Context shortcuts                                      │
│  │   ├── Explorer shortcuts                                     │
│  │   └── Settings shortcuts                                     │
│  │                                                                │
│  └── GetCategory(commandId) → string                            │
│      └── Maps command prefix to category name                   │
│                                                                   │
│  ShortcutInfo                                                     │
│  ├── Gesture: KeyGesture                                        │
│  ├── CommandId: string                                          │
│  ├── Description: string                                        │
│  ├── Category: string                                           │
│  └── DisplayGesture (computed)                                  │
│      └── FormatGesture() → "Ctrl+Shift+S"                       │
│                                                                   │
│  MainWindow Integration                                           │
│  ├── OnKeyDown override                                          │
│  │   └── if (_shortcutService.HandleKeyPress(e)) e.Handled = true│
│  │                                                                │
│  └── CommandRequested handler                                    │
│      └── MainWindowViewModel.ExecuteCommandAsync(commandId)     │
│                                                                   │
│  MainWindowViewModel                                              │
│  └── ExecuteCommandAsync(string commandId)                       │
│      └── switch (commandId)                                     │
│          ├── "workspace.open" → OpenWorkspaceCommand.Execute()  │
│          ├── "file.save" → EditorPanel.SaveCommand.Execute()    │
│          ├── "quickOpen" → ShowQuickOpenAsync()                 │
│          └── ... (all command mappings)                         │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Architecture Diagrams

### Shortcut Registration

```
┌─────────────────────────────────────────────────────────────────┐
│                    Shortcut Registration                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  KeyboardShortcutService Constructor                             │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ RegisterDefaultShortcuts()                                 │  │
│  │                                                             │  │
│  │ // Workspace                                               │  │
│  │ Register(Ctrl+O, "workspace.open", "Open Folder");         │  │
│  │ Register(Ctrl+Shift+O, "file.open", "Open File");          │  │
│  │                                                             │  │
│  │ // Editor                                                   │  │
│  │ Register(Ctrl+S, "file.save", "Save");                     │  │
│  │ Register(Ctrl+Shift+S, "file.saveAll", "Save All");        │  │
│  │ Register(Ctrl+W, "editor.closeTab", "Close Tab");          │  │
│  │ Register(Ctrl+Tab, "editor.nextTab", "Next Tab");          │  │
│  │ Register(Ctrl+Shift+Tab, "editor.previousTab", "Prev Tab");│  │
│  │ Register(Ctrl+G, "editor.goToLine", "Go to Line");         │  │
│  │ Register(Ctrl+F, "editor.find", "Find");                   │  │
│  │ Register(Ctrl+H, "editor.replace", "Find and Replace");    │  │
│  │ Register(Ctrl+P, "quickOpen", "Quick Open File");          │  │
│  │ Register(Ctrl+N, "file.new", "New File");                  │  │
│  │                                                             │  │
│  │ // Chat                                                     │  │
│  │ Register(Ctrl+Enter, "chat.send", "Send Message");         │  │
│  │ Register(Ctrl+Shift+A, "context.attachSelection", "...");  │  │
│  │ Register(Ctrl+Shift+E, "context.attachFile", "...");       │  │
│  │                                                             │  │
│  │ // Explorer                                                 │  │
│  │ Register(F2, "explorer.rename", "Rename");                 │  │
│  │ Register(Delete, "explorer.delete", "Delete");             │  │
│  │                                                             │  │
│  │ // Settings                                                 │  │
│  │ Register(Ctrl+,, "settings.open", "Open Settings");        │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ Dictionary<(Key, KeyModifiers), ShortcutInfo>              │  │
│  │                                                             │  │
│  │ (Key.O, Ctrl) → { workspace.open, "Open Folder", ... }     │  │
│  │ (Key.S, Ctrl) → { file.save, "Save", ... }                 │  │
│  │ (Key.P, Ctrl) → { quickOpen, "Quick Open File", ... }      │  │
│  │ ...                                                         │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Key Press Handling Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Key Press Handling Flow                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  User presses Ctrl+P                                             │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ MainWindow.OnKeyDown(KeyEventArgs e)                       │  │
│  │                                                             │  │
│  │ // e.Key = Key.P                                           │  │
│  │ // e.KeyModifiers = KeyModifiers.Control                   │  │
│  │                                                             │  │
│  │ if (_shortcutService.HandleKeyPress(e))                    │  │
│  │ {                                                           │  │
│  │     e.Handled = true;                                      │  │
│  │ }                                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ KeyboardShortcutService.HandleKeyPress(e)                  │  │
│  │                                                             │  │
│  │ var key = (e.Key, e.KeyModifiers);                         │  │
│  │ // key = (Key.P, KeyModifiers.Control)                     │  │
│  │                                                             │  │
│  │ if (_shortcuts.TryGetValue(key, out var shortcut))         │  │
│  │ {                                                           │  │
│  │     // Found: quickOpen                                    │  │
│  │     CommandRequested?.Invoke(this, shortcut.CommandId);    │  │
│  │     return true;                                           │  │
│  │ }                                                           │  │
│  │ return false;                                              │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼ CommandRequested("quickOpen")                         │
│         │                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ MainWindowViewModel.ExecuteCommandAsync("quickOpen")       │  │
│  │                                                             │  │
│  │ switch (commandId)                                         │  │
│  │ {                                                           │  │
│  │     case "quickOpen":                                      │  │
│  │         await ShowQuickOpenDialogAsync();                  │  │
│  │         break;                                             │  │
│  │     // ... other cases                                     │  │
│  │ }                                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  Quick Open dialog appears                                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Gesture Formatting

```
┌─────────────────────────────────────────────────────────────────┐
│                    Gesture Formatting                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ShortcutInfo.DisplayGesture property                            │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ FormatGesture(KeyGesture gesture)                          │  │
│  │                                                             │  │
│  │ var parts = new List<string>();                            │  │
│  │                                                             │  │
│  │ if (gesture.KeyModifiers.HasFlag(KeyModifiers.Control))    │  │
│  │     parts.Add("Ctrl");                                     │  │
│  │                                                             │  │
│  │ if (gesture.KeyModifiers.HasFlag(KeyModifiers.Shift))      │  │
│  │     parts.Add("Shift");                                    │  │
│  │                                                             │  │
│  │ if (gesture.KeyModifiers.HasFlag(KeyModifiers.Alt))        │  │
│  │     parts.Add("Alt");                                      │  │
│  │                                                             │  │
│  │ parts.Add(gesture.Key.ToString());                         │  │
│  │                                                             │  │
│  │ return string.Join("+", parts);                            │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Examples:                                                   │ │
│  │                                                              │ │
│  │ KeyGesture(Key.S, Control)         → "Ctrl+S"              │ │
│  │ KeyGesture(Key.S, Control|Shift)   → "Ctrl+Shift+S"        │ │
│  │ KeyGesture(Key.F2, None)           → "F2"                  │ │
│  │ KeyGesture(Key.Tab, Control)       → "Ctrl+Tab"            │ │
│  │ KeyGesture(Key.OemComma, Control)  → "Ctrl+OemComma"       │ │
│  │                                     (display as "Ctrl+,")  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Directory Structure

```
src/SeniorIntern.Core/
├── Interfaces/
│   └── IKeyboardShortcutService.cs                   (NEW)
└── Models/
    └── ShortcutInfo.cs                               (NEW)

src/SeniorIntern.Services/
└── KeyboardShortcutService.cs                        (NEW)

src/SeniorIntern.Desktop/
├── Views/
│   └── MainWindow.axaml.cs                           (MODIFY)
└── ViewModels/
    └── MainWindowViewModel.cs                        (MODIFY)
```

---

## Implementation Details

### Task 1: Create IKeyboardShortcutService Interface

**File:** `src/SeniorIntern.Core/Interfaces/IKeyboardShortcutService.cs`

```csharp
namespace SeniorIntern.Core.Interfaces;

using Avalonia.Input;

/// <summary>
/// Service for managing keyboard shortcuts.
/// </summary>
public interface IKeyboardShortcutService
{
    /// <summary>
    /// Registers a global keyboard shortcut.
    /// </summary>
    /// <param name="gesture">The key gesture (key + modifiers).</param>
    /// <param name="commandId">Unique command identifier.</param>
    /// <param name="description">Human-readable description.</param>
    void Register(KeyGesture gesture, string commandId, string description);

    /// <summary>
    /// Handles a key press and executes matching command.
    /// </summary>
    /// <param name="e">Key event arguments.</param>
    /// <returns>True if a command was executed.</returns>
    bool HandleKeyPress(KeyEventArgs e);

    /// <summary>
    /// Gets all registered shortcuts.
    /// </summary>
    /// <returns>List of shortcuts sorted by category and description.</returns>
    IReadOnlyList<ShortcutInfo> GetAllShortcuts();

    /// <summary>
    /// Gets conflicting shortcuts for a gesture.
    /// </summary>
    /// <param name="gesture">Gesture to check.</param>
    /// <returns>Existing shortcuts with the same gesture.</returns>
    IReadOnlyList<ShortcutInfo> GetConflicts(KeyGesture gesture);

    /// <summary>
    /// Event raised when a command should be executed.
    /// </summary>
    event EventHandler<string>? CommandRequested;
}
```

### Task 2: Create ShortcutInfo Model

**File:** `src/SeniorIntern.Core/Models/ShortcutInfo.cs`

```csharp
namespace SeniorIntern.Core.Models;

using Avalonia.Input;

/// <summary>
/// Information about a registered keyboard shortcut.
/// </summary>
public sealed class ShortcutInfo
{
    /// <summary>
    /// The key gesture (key + modifiers).
    /// </summary>
    public KeyGesture Gesture { get; init; } = null!;

    /// <summary>
    /// Unique command identifier.
    /// </summary>
    public string CommandId { get; init; } = string.Empty;

    /// <summary>
    /// Human-readable description.
    /// </summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// Category for grouping (e.g., "Editor", "File").
    /// </summary>
    public string Category { get; init; } = "General";

    /// <summary>
    /// Formatted gesture for display (e.g., "Ctrl+S").
    /// </summary>
    public string DisplayGesture => FormatGesture(Gesture);

    private static string FormatGesture(KeyGesture gesture)
    {
        var parts = new List<string>();

        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Control))
            parts.Add("Ctrl");
        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Shift))
            parts.Add("Shift");
        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Alt))
            parts.Add("Alt");

        // Format special keys more nicely
        var keyName = gesture.Key switch
        {
            Key.OemComma => ",",
            Key.OemPeriod => ".",
            Key.OemPlus => "+",
            Key.OemMinus => "-",
            _ => gesture.Key.ToString()
        };

        parts.Add(keyName);

        return string.Join("+", parts);
    }
}
```

### Task 3: Implement KeyboardShortcutService

**File:** `src/SeniorIntern.Services/KeyboardShortcutService.cs`

```csharp
namespace SeniorIntern.Services;

using Avalonia.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;

public sealed class KeyboardShortcutService : IKeyboardShortcutService
{
    private readonly Dictionary<(Key, KeyModifiers), ShortcutInfo> _shortcuts = new();

    public event EventHandler<string>? CommandRequested;

    public KeyboardShortcutService()
    {
        RegisterDefaultShortcuts();
    }

    private void RegisterDefaultShortcuts()
    {
        // === Workspace ===
        Register(new KeyGesture(Key.O, KeyModifiers.Control), 
            "workspace.open", "Open Folder");
        Register(new KeyGesture(Key.O, KeyModifiers.Control | KeyModifiers.Shift), 
            "file.open", "Open File");

        // === File ===
        Register(new KeyGesture(Key.N, KeyModifiers.Control), 
            "file.new", "New File");
        Register(new KeyGesture(Key.S, KeyModifiers.Control), 
            "file.save", "Save");
        Register(new KeyGesture(Key.S, KeyModifiers.Control | KeyModifiers.Shift), 
            "file.saveAll", "Save All");

        // === Editor ===
        Register(new KeyGesture(Key.W, KeyModifiers.Control), 
            "editor.closeTab", "Close Tab");
        Register(new KeyGesture(Key.Tab, KeyModifiers.Control), 
            "editor.nextTab", "Next Tab");
        Register(new KeyGesture(Key.Tab, KeyModifiers.Control | KeyModifiers.Shift), 
            "editor.previousTab", "Previous Tab");
        Register(new KeyGesture(Key.G, KeyModifiers.Control), 
            "editor.goToLine", "Go to Line");
        Register(new KeyGesture(Key.F, KeyModifiers.Control), 
            "editor.find", "Find");
        Register(new KeyGesture(Key.H, KeyModifiers.Control), 
            "editor.replace", "Find and Replace");
        Register(new KeyGesture(Key.P, KeyModifiers.Control), 
            "quickOpen", "Quick Open File");

        // === Chat ===
        Register(new KeyGesture(Key.Enter, KeyModifiers.Control), 
            "chat.send", "Send Message");

        // === Context ===
        Register(new KeyGesture(Key.A, KeyModifiers.Control | KeyModifiers.Shift), 
            "context.attachSelection", "Attach Selection");
        Register(new KeyGesture(Key.E, KeyModifiers.Control | KeyModifiers.Shift), 
            "context.attachFile", "Attach Current File");

        // === Explorer ===
        Register(new KeyGesture(Key.F2, KeyModifiers.None), 
            "explorer.rename", "Rename");
        Register(new KeyGesture(Key.Delete, KeyModifiers.None), 
            "explorer.delete", "Delete");

        // === Settings ===
        Register(new KeyGesture(Key.OemComma, KeyModifiers.Control), 
            "settings.open", "Open Settings");
    }

    public void Register(KeyGesture gesture, string commandId, string description)
    {
        var key = (gesture.Key, gesture.KeyModifiers);
        _shortcuts[key] = new ShortcutInfo
        {
            Gesture = gesture,
            CommandId = commandId,
            Description = description,
            Category = GetCategory(commandId)
        };
    }

    public bool HandleKeyPress(KeyEventArgs e)
    {
        var key = (e.Key, e.KeyModifiers);

        if (_shortcuts.TryGetValue(key, out var shortcut))
        {
            CommandRequested?.Invoke(this, shortcut.CommandId);
            return true;
        }

        return false;
    }

    public IReadOnlyList<ShortcutInfo> GetAllShortcuts()
    {
        return _shortcuts.Values
            .OrderBy(s => s.Category)
            .ThenBy(s => s.Description)
            .ToList();
    }

    public IReadOnlyList<ShortcutInfo> GetConflicts(KeyGesture gesture)
    {
        var key = (gesture.Key, gesture.KeyModifiers);
        return _shortcuts.TryGetValue(key, out var existing)
            ? new[] { existing }
            : Array.Empty<ShortcutInfo>();
    }

    private static string GetCategory(string commandId)
    {
        var prefix = commandId.Split('.')[0];
        return prefix switch
        {
            "workspace" => "Workspace",
            "file" => "File",
            "editor" => "Editor",
            "chat" => "Chat",
            "context" => "Context",
            "explorer" => "Explorer",
            "settings" => "Settings",
            "quickOpen" => "Navigation",
            _ => "General"
        };
    }
}
```

### Task 4: Wire Up in MainWindow.axaml.cs

**File:** `src/SeniorIntern.Desktop/Views/MainWindow.axaml.cs` (additions)

```csharp
private readonly IKeyboardShortcutService _shortcutService;

public MainWindow(IKeyboardShortcutService shortcutService)
{
    InitializeComponent();
    
    _shortcutService = shortcutService;
    _shortcutService.CommandRequested += OnCommandRequested;
}

protected override void OnKeyDown(KeyEventArgs e)
{
    // Skip if focus is in a text input
    if (FocusManager?.GetFocusedElement() is TextBox)
    {
        // Allow certain shortcuts even in text input
        if (!IsGlobalShortcut(e))
        {
            base.OnKeyDown(e);
            return;
        }
    }

    if (_shortcutService.HandleKeyPress(e))
    {
        e.Handled = true;
    }
    else
    {
        base.OnKeyDown(e);
    }
}

private bool IsGlobalShortcut(KeyEventArgs e)
{
    // Shortcuts that work even when typing in text boxes
    return e.KeyModifiers.HasFlag(KeyModifiers.Control) &&
           e.Key is Key.S or Key.O or Key.P or Key.N;
}

private void OnCommandRequested(object? sender, string commandId)
{
    var viewModel = DataContext as MainWindowViewModel;
    viewModel?.ExecuteCommandAsync(commandId);
}
```

### Task 5: Add Command Handler in MainWindowViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` (additions)

```csharp
public async Task ExecuteCommandAsync(string commandId)
{
    switch (commandId)
    {
        // Workspace
        case "workspace.open":
            await OpenWorkspaceCommand.ExecuteAsync(null);
            break;

        // File
        case "file.open":
            await OpenFileCommand.ExecuteAsync(null);
            break;
        case "file.new":
            await NewFileCommand.ExecuteAsync(null);
            break;
        case "file.save":
            EditorPanel.SaveCurrentCommand.Execute(null);
            break;
        case "file.saveAll":
            EditorPanel.SaveAllCommand.Execute(null);
            break;

        // Editor
        case "editor.closeTab":
            EditorPanel.CloseCurrentTabCommand.Execute(null);
            break;
        case "editor.nextTab":
            EditorPanel.NextTabCommand.Execute(null);
            break;
        case "editor.previousTab":
            EditorPanel.PreviousTabCommand.Execute(null);
            break;
        case "editor.goToLine":
            await ShowGoToLineDialogAsync();
            break;
        case "editor.find":
            EditorPanel.ShowFindCommand.Execute(null);
            break;
        case "editor.replace":
            EditorPanel.ShowReplaceCommand.Execute(null);
            break;

        // Navigation
        case "quickOpen":
            await ShowQuickOpenDialogAsync();
            break;

        // Chat
        case "chat.send":
            ChatViewModel.SendCommand.Execute(null);
            break;

        // Context
        case "context.attachSelection":
            await AttachCurrentSelectionAsync();
            break;
        case "context.attachFile":
            await AttachCurrentFileAsync();
            break;

        // Explorer
        case "explorer.rename":
            FileExplorer.RenameSelectedCommand.Execute(null);
            break;
        case "explorer.delete":
            FileExplorer.DeleteSelectedCommand.Execute(null);
            break;

        // Settings
        case "settings.open":
            await ShowSettingsDialogAsync();
            break;
    }
}
```

---

## Default Shortcuts Table

### Workspace Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+O | workspace.open | Open Folder |
| Ctrl+Shift+O | file.open | Open File |

### File Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+N | file.new | New File |
| Ctrl+S | file.save | Save |
| Ctrl+Shift+S | file.saveAll | Save All |

### Editor Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+W | editor.closeTab | Close Tab |
| Ctrl+Tab | editor.nextTab | Next Tab |
| Ctrl+Shift+Tab | editor.previousTab | Previous Tab |
| Ctrl+G | editor.goToLine | Go to Line |
| Ctrl+F | editor.find | Find |
| Ctrl+H | editor.replace | Find and Replace |

### Navigation Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+P | quickOpen | Quick Open File |

### Chat Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+Enter | chat.send | Send Message |

### Context Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+Shift+A | context.attachSelection | Attach Selection |
| Ctrl+Shift+E | context.attachFile | Attach Current File |

### Explorer Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| F2 | explorer.rename | Rename |
| Delete | explorer.delete | Delete |

### Settings Category

| Gesture | Command ID | Description |
|---------|------------|-------------|
| Ctrl+, | settings.open | Open Settings |

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| Register | 2 | Adds shortcut, overwrites existing |
| HandleKeyPress (match) | 2 | Returns true, fires event |
| HandleKeyPress (no match) | 1 | Returns false, no event |
| GetAllShortcuts | 2 | Returns all, sorted correctly |
| GetConflicts | 2 | Found conflict, no conflict |
| FormatGesture | 4 | Various modifier combinations |
| GetCategory | 3 | Known prefixes, unknown |
| Default shortcuts | 2 | Count, no duplicates |
| MainWindow integration | 2 | Handled, not handled |
| **Total** | **20** | |

---

## Files Summary

### Files to Create (3)

| File | Lines |
|------|-------|
| `Core/Interfaces/IKeyboardShortcutService.cs` | 45 |
| `Core/Models/ShortcutInfo.cs` | 55 |
| `Services/KeyboardShortcutService.cs` | 120 |

### Files to Modify (2)

| File | Changes |
|------|---------|
| `Views/MainWindow.axaml.cs` | Add OnKeyDown, CommandRequested handler |
| `ViewModels/MainWindowViewModel.cs` | Add ExecuteCommandAsync method |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | All 18+ default shortcuts registered |
| AC-2 | Shortcuts execute correct commands |
| AC-3 | GetAllShortcuts returns sorted list |
| AC-4 | Shortcuts organized by 7 categories |
| AC-5 | No conflicts in default shortcuts |
| AC-6 | DisplayGesture formats correctly |
| AC-7 | Global shortcuts work even in text inputs |
| AC-8 | CommandRequested event fires on match |
| AC-9 | Unregistered keys pass through |
| AC-10 | Service is injectable (DI-ready) |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| Avalonia.Input | KeyGesture, KeyEventArgs, Key, KeyModifiers |
| MainWindowViewModel | Commands for all actions |
| DI Container | Service registration |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.5g | 0.75 day |
