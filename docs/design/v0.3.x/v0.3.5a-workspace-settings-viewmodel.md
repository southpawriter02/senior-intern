# Design Specification: The Senior Intern v0.3.5a "Workspace Settings ViewModel"

## Executive Summary

This document provides a detailed implementation specification for v0.3.5a, which creates the ViewModel for workspace settings. This component manages all configurable options for the File Explorer, Code Editor, and Context Attachment features with proper validation, change tracking, and persistence to the settings file.

### v0.3.5a Scope

- Create `WorkspaceSettingsViewModel` with all setting properties
- Add File Explorer settings (restore workspace, hidden files, gitignore, etc.)
- Add Editor settings (font, size, tabs, line numbers, etc.)
- Add Context Attachment settings (limits, token display, warnings)
- Implement validation logic with error messages
- Implement change tracking with `HasChanges` property
- Implement Save, Cancel, and Reset to Defaults commands
- Update `AppSettings` model with new properties

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| WorkspaceSettingsViewModel | Main ViewModel with all settings |
| File Explorer settings | 6 properties |
| Editor settings | 9 properties |
| Context settings | 6 properties |
| Validation logic | Cross-field validation |
| Change tracking | HasChanges property |
| Commands | Save, Cancel, ResetToDefaults |

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.3.5a Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  WorkspaceSettingsViewModel                                       │
│  ├── Dependencies                                                │
│  │   ├── ISettingsService                                       │
│  │   └── _originalSettings: AppSettings (backup for cancel)     │
│  │                                                                │
│  ├── File Explorer Settings                                      │
│  │   ├── RestoreLastWorkspace: bool (default: true)             │
│  │   ├── ShowHiddenFiles: bool (default: false)                 │
│  │   ├── UseGitIgnore: bool (default: true)                     │
│  │   ├── MaxRecentWorkspaces: int [1-50] (default: 10)          │
│  │   ├── CustomIgnorePatterns: string (newline-separated)       │
│  │   └── AutoRefreshOnExternalChanges: bool (default: true)     │
│  │                                                                │
│  ├── Editor Settings                                             │
│  │   ├── EditorFontFamily: string (default: "Cascadia Code...")│
│  │   ├── EditorFontSize: int [8-72] (default: 14)               │
│  │   ├── TabSize: int [1-16] (default: 4)                       │
│  │   ├── ConvertTabsToSpaces: bool (default: true)              │
│  │   ├── ShowLineNumbers: bool (default: true)                  │
│  │   ├── HighlightCurrentLine: bool (default: true)             │
│  │   ├── WordWrap: bool (default: false)                        │
│  │   ├── RulerColumn: int [0-200] (default: 0 = disabled)       │
│  │   └── EditorTheme: string (default: "DarkPlus")              │
│  │                                                                │
│  ├── Context Attachment Settings                                 │
│  │   ├── MaxFilesAttached: int [1-50] (default: 10)             │
│  │   ├── MaxTokensPerFile: int [100-32000] (default: 4000)      │
│  │   ├── MaxTotalContextTokens: int [100-64000] (default: 8000) │
│  │   ├── MaxFileSizeKb: int [1-10000] (default: 500)            │
│  │   ├── ShowTokenCount: bool (default: true)                   │
│  │   └── WarnOnTokenLimit: bool (default: true)                 │
│  │                                                                │
│  ├── Selection Options (read-only collections)                   │
│  │   ├── AvailableFonts: ObservableCollection<string>           │
│  │   ├── AvailableThemes: ObservableCollection<string>          │
│  │   ├── TabSizeOptions: int[] { 2, 4, 8 }                      │
│  │   ├── FontSizeOptions: int[] { 10, 11, ..., 24 }             │
│  │   └── RulerColumnOptions: int[] { 0, 80, 100, 120 }          │
│  │                                                                │
│  ├── Computed Properties                                         │
│  │   ├── HasChanges: bool                                       │
│  │   └── ValidationError: string?                               │
│  │                                                                │
│  ├── Commands                                                    │
│  │   ├── SaveAsync() → validates, saves, raises SaveCompleted   │
│  │   ├── ResetToDefaults() → loads defaults, sets HasChanges    │
│  │   └── Cancel() → reverts, raises CancelRequested             │
│  │                                                                │
│  ├── Events                                                      │
│  │   ├── SaveCompleted: EventHandler                            │
│  │   └── CancelRequested: EventHandler                          │
│  │                                                                │
│  └── Private Methods                                             │
│      ├── LoadFromSettings(AppSettings)                          │
│      ├── ToSettings() → AppSettings                             │
│      └── Validate() → bool                                      │
│                                                                   │
│  AppSettings (Updated)                                            │
│  ├── File Explorer properties (6)                                │
│  ├── Editor properties (9)                                       │
│  └── Context properties (6+)                                     │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Architecture Diagrams

### Settings Data Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Settings Data Flow                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Application Startup                                             │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ ISettingsService.LoadSettingsAsync()                       │  │
│  │                                                             │  │
│  │ Reads from: ~/.seniorintern/settings.json                  │  │
│  │ Returns: AppSettings (or defaults if file missing)         │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ AppSettings applied to:                                    │  │
│  │ • FileExplorerViewModel (filtering, refresh)               │  │
│  │ • EditorPanelViewModel (font, tabs, line numbers)          │  │
│  │ • ChatViewModel (context limits)                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ═══════════════════════════════════════════════════════════════ │
│                                                                  │
│  User Opens Settings Dialog                                      │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ WorkspaceSettingsViewModel created                         │  │
│  │                                                             │  │
│  │ • Injects ISettingsService                                 │  │
│  │ • Stores _originalSettings (copy for cancel)               │  │
│  │ • Calls LoadFromSettings() to populate properties          │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ User modifies settings                                     │  │
│  │                                                             │  │
│  │ OnPropertyChanged() → HasChanges = true                    │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│    ┌────┴────┐                                                  │
│    ▼         ▼                                                  │
│ [Save]    [Cancel]                                              │
│    │         │                                                   │
│    ▼         ▼                                                   │
│ ┌──────────────────┐  ┌──────────────────┐                      │
│ │ Validate()       │  │ LoadFromSettings │                      │
│ │ ToSettings()     │  │ (_originalSettings)                    │
│ │ SaveSettingsAsync│  │ CancelRequested  │                      │
│ │ SaveCompleted    │  └──────────────────┘                      │
│ └──────────────────┘                                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Validation Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Validation Flow                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  SaveAsync() called                                              │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ Validate()                                                 │  │
│  │                                                             │  │
│  │ Check 1: MaxTokensPerFile <= MaxTotalContextTokens         │  │
│  │   └─ Error: "Max tokens per file cannot exceed..."         │  │
│  │                                                             │  │
│  │ Check 2: EditorFontSize in [8, 72]                         │  │
│  │   └─ Error: "Font size must be between 8 and 72."          │  │
│  │                                                             │  │
│  │ Check 3: MaxRecentWorkspaces in [1, 50]                    │  │
│  │   └─ Error: "Recent workspaces must be between 1 and 50."  │  │
│  │                                                             │  │
│  │ Check 4: TabSize in [1, 16]                                │  │
│  │   └─ Error: "Tab size must be between 1 and 16."           │  │
│  │                                                             │  │
│  │ Check 5: MaxFileSizeKb in [1, 10000]                       │  │
│  │   └─ Error: "Max file size must be between 1 and 10000 KB."│  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│    ┌────┴────┐                                                  │
│    ▼         ▼                                                  │
│ [Valid]  [Invalid]                                              │
│    │         │                                                   │
│    ▼         ▼                                                   │
│ Continue   Set ValidationError                                  │
│ to save    Return early                                         │
│            (Save button shows error)                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Change Tracking

```
┌─────────────────────────────────────────────────────────────────┐
│                    Change Tracking                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Property modified (e.g., TabSize = 2)                           │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ CommunityToolkit.Mvvm raises PropertyChanged              │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ OnPropertyChanged(PropertyChangedEventArgs e)              │  │
│  │                                                             │  │
│  │ // Ignore meta properties                                  │  │
│  │ if (e.PropertyName != "HasChanges" &&                      │  │
│  │     e.PropertyName != "ValidationError")                   │  │
│  │ {                                                           │  │
│  │     HasChanges = true;                                     │  │
│  │ }                                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ UI Updates:                                                │  │
│  │ • Save button enabled (when HasChanges && !ValidationError)│  │
│  │ • Dialog title shows "*" indicator                        │  │
│  │ • Close confirmation if HasChanges                        │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Directory Structure

```
src/SeniorIntern.Core/
└── Models/
    └── AppSettings.cs                                (MODIFY)

src/SeniorIntern.Desktop/
└── ViewModels/
    └── WorkspaceSettingsViewModel.cs                 (NEW)
```

---

## Implementation Details

### Task 1: Create WorkspaceSettingsViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/WorkspaceSettingsViewModel.cs`

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System;
using System.Collections.ObjectModel;
using System.ComponentModel.DataAnnotations;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;

/// <summary>
/// ViewModel for workspace settings panel.
/// </summary>
public partial class WorkspaceSettingsViewModel : ViewModelBase
{
    private readonly ISettingsService _settingsService;
    private readonly AppSettings _originalSettings;
    private bool _hasChanges;

    #region File Explorer Settings

    /// <summary>
    /// Whether to restore the last workspace on startup.
    /// </summary>
    [ObservableProperty]
    private bool _restoreLastWorkspace = true;

    /// <summary>
    /// Whether to show hidden files and folders.
    /// </summary>
    [ObservableProperty]
    private bool _showHiddenFiles;

    /// <summary>
    /// Whether to respect .gitignore patterns.
    /// </summary>
    [ObservableProperty]
    private bool _useGitIgnore = true;

    /// <summary>
    /// Maximum number of recent workspaces to remember.
    /// </summary>
    [ObservableProperty]
    [Range(1, 50)]
    private int _maxRecentWorkspaces = 10;

    /// <summary>
    /// Custom ignore patterns (one per line).
    /// </summary>
    [ObservableProperty]
    private string _customIgnorePatterns = string.Empty;

    /// <summary>
    /// Whether to auto-refresh on external file changes.
    /// </summary>
    [ObservableProperty]
    private bool _autoRefreshOnExternalChanges = true;

    #endregion

    #region Editor Settings

    /// <summary>
    /// Editor font family.
    /// </summary>
    [ObservableProperty]
    private string _editorFontFamily = "Cascadia Code, Consolas, monospace";

    /// <summary>
    /// Editor font size.
    /// </summary>
    [ObservableProperty]
    [Range(8, 72)]
    private int _editorFontSize = 14;

    /// <summary>
    /// Tab size in spaces.
    /// </summary>
    [ObservableProperty]
    [Range(1, 16)]
    private int _tabSize = 4;

    /// <summary>
    /// Whether to convert tabs to spaces.
    /// </summary>
    [ObservableProperty]
    private bool _convertTabsToSpaces = true;

    /// <summary>
    /// Whether to show line numbers.
    /// </summary>
    [ObservableProperty]
    private bool _showLineNumbers = true;

    /// <summary>
    /// Whether to highlight the current line.
    /// </summary>
    [ObservableProperty]
    private bool _highlightCurrentLine = true;

    /// <summary>
    /// Whether to enable word wrap.
    /// </summary>
    [ObservableProperty]
    private bool _wordWrap;

    /// <summary>
    /// Column ruler position (0 = disabled).
    /// </summary>
    [ObservableProperty]
    [Range(0, 200)]
    private int _rulerColumn;

    /// <summary>
    /// Editor theme (for syntax highlighting).
    /// </summary>
    [ObservableProperty]
    private string _editorTheme = "DarkPlus";

    #endregion

    #region Context Attachment Settings

    /// <summary>
    /// Maximum files that can be attached at once.
    /// </summary>
    [ObservableProperty]
    [Range(1, 50)]
    private int _maxFilesAttached = 10;

    /// <summary>
    /// Maximum tokens per individual file.
    /// </summary>
    [ObservableProperty]
    [Range(100, 32000)]
    private int _maxTokensPerFile = 4000;

    /// <summary>
    /// Maximum total tokens across all attached files.
    /// </summary>
    [ObservableProperty]
    [Range(100, 64000)]
    private int _maxTotalContextTokens = 8000;

    /// <summary>
    /// Maximum file size in KB.
    /// </summary>
    [ObservableProperty]
    [Range(1, 10000)]
    private int _maxFileSizeKb = 500;

    /// <summary>
    /// Whether to show token count in context bar.
    /// </summary>
    [ObservableProperty]
    private bool _showTokenCount = true;

    /// <summary>
    /// Whether to warn when approaching token limit.
    /// </summary>
    [ObservableProperty]
    private bool _warnOnTokenLimit = true;

    #endregion

    #region Selection Options

    /// <summary>
    /// Available font families for selection.
    /// </summary>
    public ObservableCollection<string> AvailableFonts { get; } = new()
    {
        "Cascadia Code",
        "Cascadia Mono",
        "Consolas",
        "Fira Code",
        "JetBrains Mono",
        "Source Code Pro",
        "Monaco",
        "Menlo",
        "Ubuntu Mono",
        "monospace"
    };

    /// <summary>
    /// Available editor themes.
    /// </summary>
    public ObservableCollection<string> AvailableThemes { get; } = new()
    {
        "DarkPlus",
        "LightPlus",
        "Monokai",
        "SolarizedDark",
        "SolarizedLight",
        "HighContrastDark"
    };

    /// <summary>
    /// Predefined tab size options.
    /// </summary>
    public int[] TabSizeOptions { get; } = { 2, 4, 8 };

    /// <summary>
    /// Predefined font size options.
    /// </summary>
    public int[] FontSizeOptions { get; } = { 10, 11, 12, 13, 14, 15, 16, 18, 20, 24 };

    /// <summary>
    /// Predefined ruler column options.
    /// </summary>
    public int[] RulerColumnOptions { get; } = { 0, 80, 100, 120 };

    #endregion

    #region Computed Properties

    /// <summary>
    /// Whether there are unsaved changes.
    /// </summary>
    public bool HasChanges
    {
        get => _hasChanges;
        private set => SetProperty(ref _hasChanges, value);
    }

    /// <summary>
    /// Validation errors for display.
    /// </summary>
    [ObservableProperty]
    private string? _validationError;

    /// <summary>
    /// Whether save is possible (has changes and no errors).
    /// </summary>
    public bool CanSave => HasChanges && string.IsNullOrEmpty(ValidationError);

    #endregion

    #region Constructor

    public WorkspaceSettingsViewModel(ISettingsService settingsService)
    {
        _settingsService = settingsService;
        _originalSettings = settingsService.CurrentSettings;

        LoadFromSettings(_originalSettings);
    }

    #endregion

    #region Private Methods

    /// <summary>
    /// Loads values from AppSettings.
    /// </summary>
    private void LoadFromSettings(AppSettings settings)
    {
        // File Explorer
        RestoreLastWorkspace = settings.RestoreLastWorkspace;
        ShowHiddenFiles = settings.ShowHiddenFiles;
        UseGitIgnore = settings.UseGitIgnore;
        MaxRecentWorkspaces = settings.MaxRecentWorkspaces;
        CustomIgnorePatterns = string.Join("\n", settings.CustomIgnorePatterns);
        AutoRefreshOnExternalChanges = settings.AutoRefreshOnExternalChanges;

        // Editor
        EditorFontFamily = settings.EditorFontFamily;
        EditorFontSize = settings.EditorFontSize;
        TabSize = settings.TabSize;
        ConvertTabsToSpaces = settings.ConvertTabsToSpaces;
        ShowLineNumbers = settings.ShowLineNumbers;
        HighlightCurrentLine = settings.HighlightCurrentLine;
        WordWrap = settings.WordWrap;
        RulerColumn = settings.RulerColumn;
        EditorTheme = settings.EditorTheme;

        // Context
        MaxFilesAttached = settings.ContextLimits.MaxFilesAttached;
        MaxTokensPerFile = settings.ContextLimits.MaxTokensPerFile;
        MaxTotalContextTokens = settings.ContextLimits.MaxTotalContextTokens;
        MaxFileSizeKb = settings.ContextLimits.MaxFileSizeBytes / 1024;
        ShowTokenCount = settings.ShowTokenCount;
        WarnOnTokenLimit = settings.WarnOnTokenLimit;

        HasChanges = false;
        ValidationError = null;
    }

    /// <summary>
    /// Creates AppSettings from current values.
    /// </summary>
    private AppSettings ToSettings()
    {
        return _originalSettings with
        {
            // File Explorer
            RestoreLastWorkspace = RestoreLastWorkspace,
            ShowHiddenFiles = ShowHiddenFiles,
            UseGitIgnore = UseGitIgnore,
            MaxRecentWorkspaces = MaxRecentWorkspaces,
            CustomIgnorePatterns = CustomIgnorePatterns
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(p => p.Trim())
                .Where(p => !string.IsNullOrEmpty(p))
                .ToList(),
            AutoRefreshOnExternalChanges = AutoRefreshOnExternalChanges,

            // Editor
            EditorFontFamily = EditorFontFamily,
            EditorFontSize = EditorFontSize,
            TabSize = TabSize,
            ConvertTabsToSpaces = ConvertTabsToSpaces,
            ShowLineNumbers = ShowLineNumbers,
            HighlightCurrentLine = HighlightCurrentLine,
            WordWrap = WordWrap,
            RulerColumn = RulerColumn,
            EditorTheme = EditorTheme,

            // Context
            ContextLimits = new ContextLimitsConfig
            {
                MaxFilesAttached = MaxFilesAttached,
                MaxTokensPerFile = MaxTokensPerFile,
                MaxTotalContextTokens = MaxTotalContextTokens,
                MaxFileSizeBytes = MaxFileSizeKb * 1024
            },
            ShowTokenCount = ShowTokenCount,
            WarnOnTokenLimit = WarnOnTokenLimit
        };
    }

    /// <summary>
    /// Validates current settings.
    /// </summary>
    private bool Validate()
    {
        ValidationError = null;

        // Cross-field validation
        if (MaxTokensPerFile > MaxTotalContextTokens)
        {
            ValidationError = "Max tokens per file cannot exceed max total tokens.";
            return false;
        }

        // Range validation
        if (EditorFontSize < 8 || EditorFontSize > 72)
        {
            ValidationError = "Font size must be between 8 and 72.";
            return false;
        }

        if (MaxRecentWorkspaces < 1 || MaxRecentWorkspaces > 50)
        {
            ValidationError = "Recent workspaces must be between 1 and 50.";
            return false;
        }

        if (TabSize < 1 || TabSize > 16)
        {
            ValidationError = "Tab size must be between 1 and 16.";
            return false;
        }

        if (MaxFileSizeKb < 1 || MaxFileSizeKb > 10000)
        {
            ValidationError = "Max file size must be between 1 and 10000 KB.";
            return false;
        }

        return true;
    }

    #endregion

    #region Commands

    /// <summary>
    /// Saves settings and closes dialog.
    /// </summary>
    [RelayCommand]
    public async Task SaveAsync()
    {
        if (!Validate()) return;

        var settings = ToSettings();
        await _settingsService.SaveSettingsAsync(settings);
        HasChanges = false;

        SaveCompleted?.Invoke(this, EventArgs.Empty);
    }

    /// <summary>
    /// Resets to default values.
    /// </summary>
    [RelayCommand]
    public void ResetToDefaults()
    {
        LoadFromSettings(new AppSettings());
        HasChanges = true;
    }

    /// <summary>
    /// Cancels changes and closes dialog.
    /// </summary>
    [RelayCommand]
    public void Cancel()
    {
        LoadFromSettings(_originalSettings);
        CancelRequested?.Invoke(this, EventArgs.Empty);
    }

    #endregion

    #region Property Changed Tracking

    protected override void OnPropertyChanged(System.ComponentModel.PropertyChangedEventArgs e)
    {
        base.OnPropertyChanged(e);

        // Track changes on any property except meta properties
        if (e.PropertyName != nameof(HasChanges) &&
            e.PropertyName != nameof(ValidationError) &&
            e.PropertyName != nameof(CanSave))
        {
            HasChanges = true;
            OnPropertyChanged(nameof(CanSave));
        }
    }

    #endregion

    #region Events

    /// <summary>
    /// Event raised when save is complete.
    /// </summary>
    public event EventHandler? SaveCompleted;

    /// <summary>
    /// Event raised when cancel is requested.
    /// </summary>
    public event EventHandler? CancelRequested;

    #endregion
}
```

### Task 2: Update AppSettings Model

**File:** `src/SeniorIntern.Core/Models/AppSettings.cs` (additions)

```csharp
public sealed record AppSettings
{
    // Existing properties...

    #region File Explorer Settings (v0.3.5)

    /// <summary>
    /// Whether to restore the last workspace on startup.
    /// </summary>
    public bool RestoreLastWorkspace { get; init; } = true;

    /// <summary>
    /// Whether to show hidden files and folders (starting with .).
    /// </summary>
    public bool ShowHiddenFiles { get; init; } = false;

    /// <summary>
    /// Whether to respect .gitignore patterns.
    /// </summary>
    public bool UseGitIgnore { get; init; } = true;

    /// <summary>
    /// Maximum number of recent workspaces to remember.
    /// </summary>
    public int MaxRecentWorkspaces { get; init; } = 10;

    /// <summary>
    /// Custom ignore patterns (glob format).
    /// </summary>
    public IReadOnlyList<string> CustomIgnorePatterns { get; init; } = new[]
    {
        "node_modules/",
        "bin/",
        "obj/",
        ".vs/",
        ".idea/",
        "__pycache__/"
    };

    /// <summary>
    /// Whether to auto-refresh on external file changes.
    /// </summary>
    public bool AutoRefreshOnExternalChanges { get; init; } = true;

    #endregion

    #region Editor Settings (v0.3.3+)

    /// <summary>
    /// Editor font family.
    /// </summary>
    public string EditorFontFamily { get; init; } = "Cascadia Code, Consolas, monospace";

    /// <summary>
    /// Editor font size in points.
    /// </summary>
    public int EditorFontSize { get; init; } = 14;

    /// <summary>
    /// Tab size in spaces.
    /// </summary>
    public int TabSize { get; init; } = 4;

    /// <summary>
    /// Whether to convert tabs to spaces.
    /// </summary>
    public bool ConvertTabsToSpaces { get; init; } = true;

    /// <summary>
    /// Whether to show line numbers.
    /// </summary>
    public bool ShowLineNumbers { get; init; } = true;

    /// <summary>
    /// Whether to highlight the current line.
    /// </summary>
    public bool HighlightCurrentLine { get; init; } = true;

    /// <summary>
    /// Whether to enable word wrap.
    /// </summary>
    public bool WordWrap { get; init; } = false;

    /// <summary>
    /// Column ruler position (0 = disabled).
    /// </summary>
    public int RulerColumn { get; init; } = 0;

    /// <summary>
    /// Editor theme for syntax highlighting.
    /// </summary>
    public string EditorTheme { get; init; } = "DarkPlus";

    #endregion

    #region Context Attachment Settings (v0.3.4+)

    /// <summary>
    /// Context limit configuration.
    /// </summary>
    public ContextLimitsConfig ContextLimits { get; init; } = new();

    /// <summary>
    /// Whether to show token count in context bar.
    /// </summary>
    public bool ShowTokenCount { get; init; } = true;

    /// <summary>
    /// Whether to warn when approaching token limit.
    /// </summary>
    public bool WarnOnTokenLimit { get; init; } = true;

    #endregion
}
```

---

## Settings Summary Table

### File Explorer Settings

| Property | Type | Default | Range | Description |
|----------|------|---------|-------|-------------|
| RestoreLastWorkspace | bool | true | - | Restore workspace on startup |
| ShowHiddenFiles | bool | false | - | Show files starting with . |
| UseGitIgnore | bool | true | - | Respect .gitignore patterns |
| MaxRecentWorkspaces | int | 10 | 1-50 | Recent workspaces count |
| CustomIgnorePatterns | string | preset | - | Newline-separated patterns |
| AutoRefreshOnExternalChanges | bool | true | - | Auto-refresh on changes |

### Editor Settings

| Property | Type | Default | Range | Description |
|----------|------|---------|-------|-------------|
| EditorFontFamily | string | Cascadia Code | enum | Font family |
| EditorFontSize | int | 14 | 8-72 | Font size in points |
| TabSize | int | 4 | 1-16 | Tab width in spaces |
| ConvertTabsToSpaces | bool | true | - | Tabs to spaces |
| ShowLineNumbers | bool | true | - | Line number gutter |
| HighlightCurrentLine | bool | true | - | Current line highlight |
| WordWrap | bool | false | - | Word wrapping |
| RulerColumn | int | 0 | 0-200 | Column ruler (0=off) |
| EditorTheme | string | DarkPlus | enum | Syntax theme |

### Context Attachment Settings

| Property | Type | Default | Range | Description |
|----------|------|---------|-------|-------------|
| MaxFilesAttached | int | 10 | 1-50 | Max attached files |
| MaxTokensPerFile | int | 4000 | 100-32000 | Max tokens per file |
| MaxTotalContextTokens | int | 8000 | 100-64000 | Total token limit |
| MaxFileSizeKb | int | 500 | 1-10000 | Max file size in KB |
| ShowTokenCount | bool | true | - | Show token counts |
| WarnOnTokenLimit | bool | true | - | Token limit warnings |

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| LoadFromSettings | 3 | All sections load correctly |
| ToSettings | 3 | All sections convert correctly |
| Validate | 5 | Each validation rule |
| HasChanges | 3 | Tracks changes, excludes meta props |
| SaveAsync | 2 | Validates, saves, raises event |
| ResetToDefaults | 2 | Loads defaults, sets HasChanges |
| Cancel | 2 | Reverts changes, raises event |
| Selection options | 1 | Collections populated |
| **Total** | **21** | |

---

## Files Summary

### Files to Create (1)

| File | Lines |
|------|-------|
| `ViewModels/WorkspaceSettingsViewModel.cs` | 300 |

### Files to Modify (1)

| File | Changes |
|------|---------|
| `Core/Models/AppSettings.cs` | Add 21 new properties |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | All settings load from AppSettings correctly |
| AC-2 | Changes tracked via HasChanges property |
| AC-3 | Validation prevents MaxTokensPerFile > MaxTotalContextTokens |
| AC-4 | Validation prevents out-of-range values |
| AC-5 | Save persists to settings file |
| AC-6 | Reset to defaults loads default AppSettings |
| AC-7 | Cancel reverts to original settings |
| AC-8 | SaveCompleted event raised on successful save |
| AC-9 | CancelRequested event raised on cancel |
| AC-10 | CanSave computed correctly |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.4a | ContextLimitsConfig model |
| ISettingsService | For loading/saving settings |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.5a | 0.5 day |
