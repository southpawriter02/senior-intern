# Design Specification: The Senior Intern v0.3.4g "File Explorer Integration"

## Executive Summary

This document provides a detailed implementation specification for v0.3.4g, which integrates context attachment functionality into the File Explorer. Users can attach files to chat context via right-click context menu or by dragging files directly onto the chat area. This enables seamless workflow between browsing files and attaching them for LLM context.

### v0.3.4g Scope

- Add "Attach to Chat" context menu item in File Explorer
- Implement `AttachToContext` command in FileExplorerViewModel
- Implement `AttachFileRequested` event for communication with ChatViewModel
- Add drag-drop support from File Explorer to Chat area
- Add visual drop zone indicator during drag operations
- Support attaching multiple files at once
- Disable attachment for directories

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| Context menu item | "Attach to Chat" in File Explorer |
| AttachToContext command | Handles single file attachment |
| AttachSelectedToContext command | Handles multiple selection |
| AttachFileRequested event | Communication to ChatViewModel |
| Drag-drop handlers | Drop files onto chat area |
| Drop zone indicator | Visual feedback during drag |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.3.4g Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  FileExplorerView                                                 â”‚
â”‚  â”œâ”€â”€ Context Menu                                                â”‚
â”‚  â”‚   â””â”€â”€ "Attach to Chat" menu item                             â”‚
â”‚  â”‚       â”œâ”€â”€ Command: AttachToContextCommand                    â”‚
â”‚  â”‚       â”œâ”€â”€ CommandParameter: SelectedItem                     â”‚
â”‚  â”‚       â”œâ”€â”€ Icon: AttachIcon                                   â”‚
â”‚  â”‚       â””â”€â”€ IsEnabled: !item.IsDirectory                       â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ TreeView                                                    â”‚
â”‚      â””â”€â”€ Enable DragDrop.AllowDrop (for internal use)           â”‚
â”‚                                                                   â”‚
â”‚  FileExplorerViewModel                                            â”‚
â”‚  â”œâ”€â”€ Events                                                      â”‚
â”‚  â”‚   â””â”€â”€ AttachFileRequested: EventHandler<string>              â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Commands                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ AttachToContextCommand(FileTreeItemViewModel?)         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Validates item is not null                         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Validates item is not directory                    â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Raises AttachFileRequested(item.Path)              â”‚
â”‚  â”‚   â”‚                                                           â”‚
â”‚  â”‚   â””â”€â”€ AttachSelectedToContextCommand()                       â”‚
â”‚  â”‚       â”œâ”€â”€ Gets all selected files (not directories)          â”‚
â”‚  â”‚       â””â”€â”€ Raises AttachFileRequested for each                â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Helper Methods                                              â”‚
â”‚      â””â”€â”€ GetSelectedFiles() â†’ IEnumerable<string>               â”‚
â”‚                                                                   â”‚
â”‚  ChatView (Drag-Drop)                                             â”‚
â”‚  â”œâ”€â”€ InitializeDragDrop()                                        â”‚
â”‚  â”‚   â”œâ”€â”€ AddHandler(DragDrop.DropEvent, OnDrop)                 â”‚
â”‚  â”‚   â””â”€â”€ AddHandler(DragDrop.DragOverEvent, OnDragOver)         â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ OnDragOver(sender, e)                                       â”‚
â”‚  â”‚   â”œâ”€â”€ Check e.Data.Contains(DataFormats.FileNames)           â”‚
â”‚  â”‚   â”œâ”€â”€ Set e.DragEffects = Link (if files)                    â”‚
â”‚  â”‚   â”œâ”€â”€ Show DropZoneIndicator                                 â”‚
â”‚  â”‚   â””â”€â”€ Set e.DragEffects = None (if not files)                â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ OnDrop(sender, e)                                           â”‚
â”‚  â”‚   â”œâ”€â”€ Get file names from e.Data                             â”‚
â”‚  â”‚   â”œâ”€â”€ Filter to files only (not directories)                 â”‚
â”‚  â”‚   â””â”€â”€ Call ChatViewModel.AttachFileAsync(file) for each      â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ OnDragLeave(sender, e)                                      â”‚
â”‚  â”‚   â””â”€â”€ Hide DropZoneIndicator                                 â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ DropZoneIndicator                                           â”‚
â”‚      â”œâ”€â”€ Border with blue highlight                             â”‚
â”‚      â”œâ”€â”€ "Drop files to attach" text                            â”‚
â”‚      â””â”€â”€ IsVisible during drag operation                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Context Menu Attachment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Menu Attachment Flow                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User right-clicks file in File Explorer                         â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Context Menu appears:                                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚ â”‚ Open                                                â”‚    â”‚  â”‚
â”‚  â”‚ â”‚ Open With...                                        â”‚    â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â”‚
â”‚  â”‚ â”‚ Copy                                                â”‚    â”‚  â”‚
â”‚  â”‚ â”‚ Cut                                                 â”‚    â”‚  â”‚
â”‚  â”‚ â”‚ Delete                                              â”‚    â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ“ Attach to Chat                                  â”‚ â† NEWâ”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼ User clicks "Attach to Chat"                          â”‚
â”‚         â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FileExplorerViewModel.AttachToContext(item)                â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (item == null || item.IsDirectory) return;              â”‚  â”‚
â”‚  â”‚ AttachFileRequested?.Invoke(this, item.Path);              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MainWindowViewModel.OnAttachFileRequested()                â”‚  â”‚
â”‚  â”‚ â†’ ChatViewModel.AttachFileAsync(filePath)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  Context pill appears in ChatContextBar                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Drag-Drop Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drag-Drop Flow                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User starts dragging file(s) from File Explorer                 â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ChatView.OnDragOver(sender, e)                             â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (e.Data.Contains(DataFormats.FileNames))                â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     e.DragEffects = DragDropEffects.Link;                  â”‚  â”‚
â”‚  â”‚     ShowDropZone();                                         â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â”‚ else                                                        â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     e.DragEffects = DragDropEffects.None;                  â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼ User sees visual feedback                             â”‚
â”‚         â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚           ğŸ”—                                           â”‚ â”‚  â”‚
â”‚  â”‚ â”‚     Drop files to attach                               â”‚ â”‚  â”‚
â”‚  â”‚ â”‚                                                         â”‚ â”‚  â”‚
â”‚  â”‚ â”‚  (Blue border, semi-transparent background)            â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼ User drops files                                      â”‚
â”‚         â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ChatView.OnDrop(sender, e)                                 â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var files = e.Data.GetFileNames();                         â”‚  â”‚
â”‚  â”‚ foreach (var file in files)                                â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     if (File.Exists(file))  // Only files, not directories â”‚  â”‚
â”‚  â”‚     {                                                       â”‚  â”‚
â”‚  â”‚         await viewModel.AttachFileAsync(file);             â”‚  â”‚
â”‚  â”‚     }                                                       â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â”‚ HideDropZone();                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  Context pills appear for each attached file                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Drop Zone Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Drop Zone Visual States                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  NORMAL STATE (no drag in progress)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Chat Messages                                              â”‚  â”‚
â”‚  â”‚ ...                                                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ [C#] UserService.cs ~156 âœ•                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Type your message...                              [Send]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                  â”‚
â”‚  DRAG STATE (files being dragged over)                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Chat Messages (dimmed)                                     â”‚  â”‚
â”‚  â”‚ ...                                                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚                       ğŸ“                              â”‚   â”‚  â”‚
â”‚  â”‚ â”‚              Drop files to attach                     â”‚   â”‚  â”‚
â”‚  â”‚ â”‚                                                        â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  Background: #402196F3 (40% opacity blue)             â”‚   â”‚  â”‚
â”‚  â”‚ â”‚  Border: #2196F3 (solid blue), 2px                    â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Type your message...                              [Send]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ FileExplorerView.axaml                        (MODIFY)
â”‚   â”œâ”€â”€ ChatView.axaml                                (MODIFY)
â”‚   â””â”€â”€ ChatView.axaml.cs                             (MODIFY)
â””â”€â”€ ViewModels/
    â””â”€â”€ FileExplorerViewModel.cs                      (MODIFY)
```

---

## Implementation Details

### Task 1: Add Context Menu Item to File Explorer

**File:** `src/SeniorIntern.Desktop/Views/FileExplorerView.axaml` (additions)

```xml
<!-- Add to TreeView.ContextMenu -->

<ContextMenu>
    <!-- ... existing items ... -->

    <Separator />

    <MenuItem Header="Attach to Chat"
              Command="{Binding AttachToContextCommand}"
              CommandParameter="{Binding SelectedItem}">
        <MenuItem.Icon>
            <PathIcon Data="{StaticResource AttachIcon}" Width="14" Height="14" />
        </MenuItem.Icon>
        <!-- Disabled for directories -->
        <MenuItem.IsEnabled>
            <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="SelectedItem" Converter="{x:Static ObjectConverters.IsNotNull}" />
                <Binding Path="SelectedItem.IsDirectory" Converter="{x:Static BoolConverters.Not}" />
            </MultiBinding>
        </MenuItem.IsEnabled>
    </MenuItem>
</ContextMenu>
```

### Task 2: Update FileExplorerViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/FileExplorerViewModel.cs` (additions)

```csharp
/// <summary>
/// Event raised when a file should be attached to chat context.
/// </summary>
public event EventHandler<string>? AttachFileRequested;

/// <summary>
/// Attaches the specified file to chat context.
/// </summary>
[RelayCommand]
private void AttachToContext(FileTreeItemViewModel? item)
{
    if (item == null) return;
    if (item.IsDirectory) return;

    AttachFileRequested?.Invoke(this, item.Path);
}

/// <summary>
/// Attaches all selected files to chat context.
/// </summary>
[RelayCommand]
private void AttachSelectedToContext()
{
    var selectedFiles = GetSelectedFiles();
    foreach (var filePath in selectedFiles)
    {
        AttachFileRequested?.Invoke(this, filePath);
    }
}

/// <summary>
/// Gets paths of all selected file items (not directories).
/// </summary>
private IEnumerable<string> GetSelectedFiles()
{
    return SelectedItems
        .Where(item => !item.IsDirectory)
        .Select(item => item.Path);
}
```

### Task 3: Add Drop Zone to ChatView

**File:** `src/SeniorIntern.Desktop/Views/ChatView.axaml` (additions)

```xml
<!-- Add inside main Grid, spanning content area -->

<!-- Drop Zone Indicator -->
<Border x:Name="DropZoneIndicator"
        Grid.Row="1"
        Background="#402196F3"
        BorderBrush="#2196F3"
        BorderThickness="2"
        CornerRadius="8"
        IsVisible="False"
        IsHitTestVisible="False"
        ZIndex="50">
    <StackPanel HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="8">
        <PathIcon Data="{StaticResource AttachIcon}"
                  Width="32" Height="32"
                  Foreground="#2196F3" />
        <TextBlock Text="Drop files to attach"
                   FontSize="14"
                   FontWeight="SemiBold"
                   Foreground="#2196F3" />
    </StackPanel>
</Border>
```

### Task 4: Implement Drag-Drop Handlers

**File:** `src/SeniorIntern.Desktop/Views/ChatView.axaml.cs` (additions)

```csharp
public partial class ChatView : UserControl
{
    public ChatView()
    {
        InitializeComponent();
        InitializeDragDrop();
    }

    private void InitializeDragDrop()
    {
        // Enable drag-drop on the chat view
        DragDrop.SetAllowDrop(this, true);

        AddHandler(DragDrop.DragEnterEvent, OnDragEnter);
        AddHandler(DragDrop.DragOverEvent, OnDragOver);
        AddHandler(DragDrop.DragLeaveEvent, OnDragLeave);
        AddHandler(DragDrop.DropEvent, OnDrop);
    }

    private void OnDragEnter(object? sender, DragEventArgs e)
    {
        if (e.Data.Contains(DataFormats.FileNames))
        {
            DropZoneIndicator.IsVisible = true;
        }
    }

    private void OnDragOver(object? sender, DragEventArgs e)
    {
        if (e.Data.Contains(DataFormats.FileNames))
        {
            e.DragEffects = DragDropEffects.Link;
            e.Handled = true;
        }
        else
        {
            e.DragEffects = DragDropEffects.None;
        }
    }

    private void OnDragLeave(object? sender, DragEventArgs e)
    {
        DropZoneIndicator.IsVisible = false;
    }

    private async void OnDrop(object? sender, DragEventArgs e)
    {
        DropZoneIndicator.IsVisible = false;

        if (!e.Data.Contains(DataFormats.FileNames)) return;

        var viewModel = DataContext as ChatViewModel;
        if (viewModel == null) return;

        var files = e.Data.GetFileNames()?.ToList();
        if (files == null || files.Count == 0) return;

        foreach (var file in files)
        {
            // Only attach files, not directories
            if (File.Exists(file))
            {
                await viewModel.AttachFileAsync(file);
            }
        }

        e.Handled = true;
    }
}
```

### Task 5: Wire Up Event in MainWindowViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` (additions)

```csharp
// In constructor or initialization
private void WireUpEvents()
{
    // ... existing event wiring ...

    // File Explorer attachment
    FileExplorerViewModel.AttachFileRequested += OnAttachFileRequested;
}

private async void OnAttachFileRequested(object? sender, string filePath)
{
    await ChatViewModel.AttachFileAsync(filePath);
}
```

---

## Drop Zone Styling

| Property | Value |
|----------|-------|
| Background | #402196F3 (40% opacity blue) |
| BorderBrush | #2196F3 (Material Blue) |
| BorderThickness | 2px |
| CornerRadius | 8px |
| Icon Size | 32Ã—32 |
| Text Size | 14pt, SemiBold |
| ZIndex | 50 (above content) |

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| AttachToContext | 3 | Valid file, directory, null item |
| AttachSelectedToContext | 2 | Multiple files, mixed files/dirs |
| GetSelectedFiles | 2 | Filters correctly |
| OnDragOver | 2 | Files accepted, non-files rejected |
| OnDrop | 3 | Single file, multiple files, directories filtered |
| DropZoneIndicator | 2 | Shows on drag, hides on leave/drop |
| Event wiring | 2 | AttachFileRequested raised correctly |
| **Total** | **16** | |

---

## Files Summary

### Files to Create (0)

None - modifications only.

### Files to Modify (4)

| File | Changes |
|------|---------|
| `Views/FileExplorerView.axaml` | Add "Attach to Chat" context menu item |
| `ViewModels/FileExplorerViewModel.cs` | Add AttachToContext command, event |
| `Views/ChatView.axaml` | Add drop zone indicator |
| `Views/ChatView.axaml.cs` | Add drag-drop event handlers |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Right-click file shows "Attach to Chat" option |
| AC-2 | "Attach to Chat" command attaches file to context |
| AC-3 | "Attach to Chat" is disabled for directories |
| AC-4 | Dragging files over chat shows drop zone indicator |
| AC-5 | Dropping files attaches them to context |
| AC-6 | Directories are filtered out during drop |
| AC-7 | Drop zone visual uses blue highlight (#2196F3) |
| AC-8 | Multiple files can be dropped at once |
| AC-9 | Drop zone hides when drag leaves area |
| AC-10 | AttachFileRequested event raised with correct path |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.2 | FileExplorerView, FileExplorerViewModel |
| v0.3.4c | FileContextViewModel.FromFile() |
| v0.3.4d | ChatContextBar for displaying pills |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.4g | 0.5 day |
