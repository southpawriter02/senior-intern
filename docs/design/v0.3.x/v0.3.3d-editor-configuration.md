# Design Specification: The Senior Intern v0.3.3d "Editor Configuration"

## Executive Summary

This document provides a detailed implementation specification for v0.3.3d, which implements the `EditorConfiguration` static utility class that applies user settings to AvaloniaEdit TextEditor instances. It manages font settings, display options, editing behavior, and provides live binding to settings changes.

### v0.3.3d Scope

- Create `EditorConfiguration` static class with settings application methods
- Define editor constants (default font, size, tab size)
- Implement `ApplySettings()` with font, display, editing, and behavior settings
- Implement `ApplyDefaults()` for new editors
- Implement `BindToSettings()` for live settings updates
- Update `AppSettings` with new editor properties

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| EditorConfiguration | Static configuration utility |
| ApplySettings | Apply all settings to editor |
| ApplyDefaults | Apply sensible defaults |
| BindToSettings | Live settings subscription |
| AppSettings updates | 8 new editor properties |

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.3.3d Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  EditorConfiguration (static class)                               │
│  ├── Constants                                                   │
│  │   ├── DefaultFontFamily: "Cascadia Code, Consolas, Monaco"   │
│  │   ├── DefaultFontSize: 14                                    │
│  │   └── DefaultTabSize: 4                                      │
│  │                                                                │
│  ├── ApplySettings(editor, settings)                             │
│  │   ├── Calls ApplyFontSettings()                              │
│  │   ├── Calls ApplyDisplaySettings()                           │
│  │   ├── Calls ApplyEditingSettings()                           │
│  │   └── Calls ApplyBehaviorSettings()                          │
│  │                                                                │
│  ├── ApplyFontSettings(editor, settings)                         │
│  │   ├── FontFamily → EditorFontFamily or default               │
│  │   └── FontSize → EditorFontSize or default                   │
│  │                                                                │
│  ├── ApplyDisplaySettings(editor, settings)                      │
│  │   ├── ShowLineNumbers → settings.ShowLineNumbers             │
│  │   ├── WordWrap → settings.WordWrap                           │
│  │   ├── HighlightCurrentLine → settings.HighlightCurrentLine   │
│  │   ├── ShowEndOfLine → false                                  │
│  │   ├── ShowSpaces → false                                     │
│  │   ├── ShowTabs → false                                       │
│  │   ├── EnableHyperlinks → true                                │
│  │   └── RequireControlModifierForHyperlinkClick → true         │
│  │                                                                │
│  ├── ApplyEditingSettings(editor, settings)                      │
│  │   ├── ConvertTabsToSpaces → settings.ConvertTabsToSpaces     │
│  │   ├── IndentationSize → settings.TabSize or default          │
│  │   ├── EnableTextDragDrop → true                              │
│  │   └── CutCopyWholeLine → true                                │
│  │                                                                │
│  ├── ApplyBehaviorSettings(editor, settings)                     │
│  │   ├── EnableVirtualSpace → false                             │
│  │   ├── EnableRectangularSelection → true                      │
│  │   ├── AllowScrollBelowDocument → true                        │
│  │   ├── ShowColumnRuler → (RulerColumn > 0)                    │
│  │   └── ColumnRulerPosition → settings.RulerColumn             │
│  │                                                                │
│  ├── ApplyDefaults(editor)                                       │
│  │   └── Apply sensible defaults without AppSettings             │
│  │                                                                │
│  └── BindToSettings(editor, settings) → IDisposable             │
│      └── SettingsBindingSubscription                            │
│          ├── Subscribe to INotifyPropertyChanged                │
│          ├── Update on EditorFontFamily/Size change             │
│          ├── Update on display settings change                  │
│          ├── Update on editing settings change                  │
│          └── Unsubscribe on Dispose                             │
│                                                                   │
│  AppSettings Updates                                              │
│  └── New Properties                                              │
│      ├── EditorFontFamily: string                               │
│      ├── EditorFontSize: int                                    │
│      ├── TabSize: int                                           │
│      ├── ConvertTabsToSpaces: bool                              │
│      ├── ShowLineNumbers: bool                                  │
│      ├── HighlightCurrentLine: bool                             │
│      ├── WordWrap: bool                                         │
│      └── RulerColumn: int                                       │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Architecture Diagrams

### Settings Application Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Settings Application Flow                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  EditorConfiguration.ApplySettings(editor, settings)             │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ 1. ApplyFontSettings(editor, settings)                     │  │
│  │                                                             │  │
│  │    editor.FontFamily = new FontFamily(                     │  │
│  │        settings.EditorFontFamily ?? DefaultFontFamily);    │  │
│  │    editor.FontSize = settings.EditorFontSize > 0           │  │
│  │        ? settings.EditorFontSize                           │  │
│  │        : DefaultFontSize;                                  │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ 2. ApplyDisplaySettings(editor, settings)                  │  │
│  │                                                             │  │
│  │    editor.ShowLineNumbers = settings.ShowLineNumbers;      │  │
│  │    editor.WordWrap = settings.WordWrap;                    │  │
│  │    editor.Options.HighlightCurrentLine =                   │  │
│  │        settings.HighlightCurrentLine;                      │  │
│  │    // plus hardcoded display options                       │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ 3. ApplyEditingSettings(editor, settings)                  │  │
│  │                                                             │  │
│  │    editor.Options.ConvertTabsToSpaces =                    │  │
│  │        settings.ConvertTabsToSpaces;                       │  │
│  │    editor.Options.IndentationSize = settings.TabSize > 0   │  │
│  │        ? settings.TabSize                                  │  │
│  │        : DefaultTabSize;                                   │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ 4. ApplyBehaviorSettings(editor, settings)                 │  │
│  │                                                             │  │
│  │    if (settings.RulerColumn > 0)                           │  │
│  │    {                                                        │  │
│  │        editor.Options.ShowColumnRuler = true;              │  │
│  │        editor.Options.ColumnRulerPosition =                │  │
│  │            settings.RulerColumn;                           │  │
│  │    }                                                        │  │
│  │    else                                                     │  │
│  │    {                                                        │  │
│  │        editor.Options.ShowColumnRuler = false;             │  │
│  │    }                                                        │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         ▼                                                        │
│  Editor fully configured with user preferences                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Live Settings Binding

```
┌─────────────────────────────────────────────────────────────────┐
│                    Live Settings Binding                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  var subscription = EditorConfiguration.BindToSettings(ed, set); │
│         │                                                        │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ new SettingsBindingSubscription(editor, settings)          │  │
│  │                                                             │  │
│  │ if (settings is INotifyPropertyChanged notifySettings)     │  │
│  │ {                                                           │  │
│  │     notifySettings.PropertyChanged +=                      │  │
│  │         OnSettingsPropertyChanged;                         │  │
│  │ }                                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         │  User changes setting in Settings UI                   │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ OnSettingsPropertyChanged(sender, e)                       │  │
│  │                                                             │  │
│  │ switch (e.PropertyName)                                    │  │
│  │ {                                                           │  │
│  │     case "EditorFontFamily":                               │  │
│  │     case "EditorFontSize":                                 │  │
│  │         ApplyFontSettings(editor, settings);               │  │
│  │         break;                                              │  │
│  │                                                             │  │
│  │     case "ShowLineNumbers":                                │  │
│  │     case "WordWrap":                                       │  │
│  │     case "HighlightCurrentLine":                           │  │
│  │         ApplyDisplaySettings(editor, settings);            │  │
│  │         break;                                              │  │
│  │                                                             │  │
│  │     case "TabSize":                                        │  │
│  │     case "ConvertTabsToSpaces":                            │  │
│  │         ApplyEditingSettings(editor, settings);            │  │
│  │         break;                                              │  │
│  │                                                             │  │
│  │     case "RulerColumn":                                    │  │
│  │         ApplyBehaviorSettings(editor, settings);           │  │
│  │         break;                                              │  │
│  │ }                                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│         │                                                        │
│         │  Editor closes                                         │
│         ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ subscription.Dispose()                                     │  │
│  │                                                             │  │
│  │ notifySettings.PropertyChanged -=                          │  │
│  │     OnSettingsPropertyChanged;                             │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
└── Services/
    └── EditorConfiguration.cs                        (NEW)

src/SeniorIntern.Core/
└── Models/
    └── AppSettings.cs                                (MODIFY)
```

---

## Implementation Details

### Task 1: Create EditorConfiguration

**File:** `src/SeniorIntern.Desktop/Services/EditorConfiguration.cs`

```csharp
namespace SeniorIntern.Desktop.Services;

using System;
using System.ComponentModel;
using Avalonia.Media;
using AvaloniaEdit;
using SeniorIntern.Core.Models;

/// <summary>
/// Configures TextEditor instances based on application settings.
/// </summary>
public static class EditorConfiguration
{
    #region Constants

    /// <summary>Default editor font family.</summary>
    public const string DefaultFontFamily = "Cascadia Code, Consolas, Monaco, monospace";

    /// <summary>Default editor font size.</summary>
    public const int DefaultFontSize = 14;

    /// <summary>Default tab size.</summary>
    public const int DefaultTabSize = 4;

    #endregion

    #region Apply Methods

    /// <summary>
    /// Applies all settings to an editor instance.
    /// </summary>
    /// <param name="editor">The TextEditor to configure.</param>
    /// <param name="settings">Application settings.</param>
    public static void ApplySettings(TextEditor editor, AppSettings settings)
    {
        if (editor == null) throw new ArgumentNullException(nameof(editor));
        if (settings == null) throw new ArgumentNullException(nameof(settings));

        ApplyFontSettings(editor, settings);
        ApplyDisplaySettings(editor, settings);
        ApplyEditingSettings(editor, settings);
        ApplyBehaviorSettings(editor, settings);
    }

    /// <summary>
    /// Applies font-related settings.
    /// </summary>
    public static void ApplyFontSettings(TextEditor editor, AppSettings settings)
    {
        editor.FontFamily = new FontFamily(
            string.IsNullOrEmpty(settings.EditorFontFamily)
                ? DefaultFontFamily
                : settings.EditorFontFamily);

        editor.FontSize = settings.EditorFontSize > 0
            ? settings.EditorFontSize
            : DefaultFontSize;
    }

    /// <summary>
    /// Applies display settings (line numbers, highlighting, etc.).
    /// </summary>
    public static void ApplyDisplaySettings(TextEditor editor, AppSettings settings)
    {
        editor.ShowLineNumbers = settings.ShowLineNumbers;
        editor.WordWrap = settings.WordWrap;
        editor.Options.HighlightCurrentLine = settings.HighlightCurrentLine;

        // Hardcoded display options
        editor.Options.ShowEndOfLine = false;
        editor.Options.ShowSpaces = false;
        editor.Options.ShowTabs = false;
        editor.Options.EnableHyperlinks = true;
        editor.Options.RequireControlModifierForHyperlinkClick = true;
    }

    /// <summary>
    /// Applies editing settings (tabs, indentation).
    /// </summary>
    public static void ApplyEditingSettings(TextEditor editor, AppSettings settings)
    {
        editor.Options.ConvertTabsToSpaces = settings.ConvertTabsToSpaces;
        editor.Options.IndentationSize = settings.TabSize > 0
            ? settings.TabSize
            : DefaultTabSize;

        // Smart editing options
        editor.Options.EnableTextDragDrop = true;
        editor.Options.CutCopyWholeLine = true;
    }

    /// <summary>
    /// Applies behavior settings.
    /// </summary>
    public static void ApplyBehaviorSettings(TextEditor editor, AppSettings settings)
    {
        // Selection and scrolling
        editor.Options.EnableVirtualSpace = false;
        editor.Options.EnableRectangularSelection = true;
        editor.Options.AllowScrollBelowDocument = true;

        // Column ruler (if position > 0)
        if (settings.RulerColumn > 0)
        {
            editor.Options.ShowColumnRuler = true;
            editor.Options.ColumnRulerPosition = settings.RulerColumn;
        }
        else
        {
            editor.Options.ShowColumnRuler = false;
        }
    }

    #endregion

    #region Defaults

    /// <summary>
    /// Gets default options for a new editor (without AppSettings).
    /// </summary>
    public static void ApplyDefaults(TextEditor editor)
    {
        if (editor == null) throw new ArgumentNullException(nameof(editor));

        // Font
        editor.FontFamily = new FontFamily(DefaultFontFamily);
        editor.FontSize = DefaultFontSize;

        // Display
        editor.ShowLineNumbers = true;
        editor.WordWrap = false;
        editor.Options.HighlightCurrentLine = true;

        // Editing
        editor.Options.ConvertTabsToSpaces = true;
        editor.Options.IndentationSize = DefaultTabSize;

        // Behavior
        editor.Options.EnableTextDragDrop = true;
        editor.Options.CutCopyWholeLine = true;
        editor.Options.EnableRectangularSelection = true;
        editor.Options.AllowScrollBelowDocument = true;

        // Visual
        editor.Options.ShowEndOfLine = false;
        editor.Options.ShowSpaces = false;
        editor.Options.ShowTabs = false;
        editor.Options.EnableHyperlinks = true;
        editor.Options.ShowColumnRuler = false;
    }

    #endregion

    #region Live Binding

    /// <summary>
    /// Creates bindings between editor and settings for live updates.
    /// </summary>
    /// <param name="editor">The TextEditor to bind.</param>
    /// <param name="settings">Application settings.</param>
    /// <returns>Disposable subscription (dispose to unbind).</returns>
    public static IDisposable BindToSettings(TextEditor editor, AppSettings settings)
    {
        if (editor == null) throw new ArgumentNullException(nameof(editor));
        if (settings == null) throw new ArgumentNullException(nameof(settings));

        return new SettingsBindingSubscription(editor, settings);
    }

    private sealed class SettingsBindingSubscription : IDisposable
    {
        private readonly TextEditor _editor;
        private readonly AppSettings _settings;
        private bool _disposed;

        public SettingsBindingSubscription(TextEditor editor, AppSettings settings)
        {
            _editor = editor;
            _settings = settings;

            // Subscribe to settings property changes
            if (_settings is INotifyPropertyChanged notifySettings)
            {
                notifySettings.PropertyChanged += OnSettingsPropertyChanged;
            }
        }

        private void OnSettingsPropertyChanged(object? sender, PropertyChangedEventArgs e)
        {
            if (_disposed) return;

            switch (e.PropertyName)
            {
                case nameof(AppSettings.EditorFontFamily):
                case nameof(AppSettings.EditorFontSize):
                    ApplyFontSettings(_editor, _settings);
                    break;

                case nameof(AppSettings.ShowLineNumbers):
                case nameof(AppSettings.WordWrap):
                case nameof(AppSettings.HighlightCurrentLine):
                    ApplyDisplaySettings(_editor, _settings);
                    break;

                case nameof(AppSettings.TabSize):
                case nameof(AppSettings.ConvertTabsToSpaces):
                    ApplyEditingSettings(_editor, _settings);
                    break;

                case nameof(AppSettings.RulerColumn):
                    ApplyBehaviorSettings(_editor, _settings);
                    break;
            }
        }

        public void Dispose()
        {
            if (_disposed) return;
            _disposed = true;

            if (_settings is INotifyPropertyChanged notifySettings)
            {
                notifySettings.PropertyChanged -= OnSettingsPropertyChanged;
            }
        }
    }

    #endregion
}
```

### Task 2: Update AppSettings

**File:** `src/SeniorIntern.Core/Models/AppSettings.cs`

Add new properties:

```csharp
public sealed partial class AppSettings
{
    // ... existing properties ...

    #region Editor Settings (v0.3.3)

    /// <summary>Editor font family.</summary>
    public string EditorFontFamily { get; set; } = "Cascadia Code, Consolas, monospace";

    /// <summary>Editor font size in pixels.</summary>
    public int EditorFontSize { get; set; } = 14;

    /// <summary>Number of spaces per tab.</summary>
    public int TabSize { get; set; } = 4;

    /// <summary>Convert tabs to spaces when typing.</summary>
    public bool ConvertTabsToSpaces { get; set; } = true;

    /// <summary>Show line numbers in gutter.</summary>
    public bool ShowLineNumbers { get; set; } = true;

    /// <summary>Highlight the current line.</summary>
    public bool HighlightCurrentLine { get; set; } = true;

    /// <summary>Enable word wrap.</summary>
    public bool WordWrap { get; set; } = false;

    /// <summary>Column position for ruler (0 = disabled).</summary>
    public int RulerColumn { get; set; } = 0;

    #endregion
}
```

---

## Settings Reference

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| EditorFontFamily | string | "Cascadia Code, Consolas, monospace" | Font family |
| EditorFontSize | int | 14 | Font size in pixels |
| TabSize | int | 4 | Spaces per tab |
| ConvertTabsToSpaces | bool | true | Tabs → spaces |
| ShowLineNumbers | bool | true | Line number gutter |
| HighlightCurrentLine | bool | true | Highlight current line |
| WordWrap | bool | false | Word wrap enabled |
| RulerColumn | int | 0 | Column ruler (0 = off) |

---

## Editor Options Reference

| Option | Source | Value |
|--------|--------|-------|
| FontFamily | `settings.EditorFontFamily` | Configurable |
| FontSize | `settings.EditorFontSize` | Configurable |
| ShowLineNumbers | `settings.ShowLineNumbers` | Configurable |
| WordWrap | `settings.WordWrap` | Configurable |
| HighlightCurrentLine | `settings.HighlightCurrentLine` | Configurable |
| ConvertTabsToSpaces | `settings.ConvertTabsToSpaces` | Configurable |
| IndentationSize | `settings.TabSize` | Configurable |
| ShowColumnRuler | `settings.RulerColumn > 0` | Configurable |
| ShowEndOfLine | Hardcoded | false |
| ShowSpaces | Hardcoded | false |
| ShowTabs | Hardcoded | false |
| EnableHyperlinks | Hardcoded | true |
| EnableTextDragDrop | Hardcoded | true |
| CutCopyWholeLine | Hardcoded | true |
| EnableRectangularSelection | Hardcoded | true |
| AllowScrollBelowDocument | Hardcoded | true |

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| ApplySettings | 2 | All settings applied, null checks |
| ApplyFontSettings | 3 | Custom font, default font, font size |
| ApplyDisplaySettings | 3 | Line numbers, word wrap, highlight |
| ApplyEditingSettings | 2 | Tab size, convert tabs |
| ApplyBehaviorSettings | 2 | Ruler on, ruler off |
| ApplyDefaults | 1 | All defaults applied |
| BindToSettings | 3 | Subscribe, property change, dispose |
| SettingsBindingSubscription | 3 | Font change, display change, dispose |
| **Total** | **19** | |

---

## Files Summary

### Files to Create (1)

| File | Lines |
|------|-------|
| `Services/EditorConfiguration.cs` | 180 |

### Files to Modify (1)

| File | Changes |
|------|---------|
| `Core/Models/AppSettings.cs` | Add 8 editor properties |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | ApplySettings correctly configures all editor options |
| AC-2 | Font family and size applied correctly |
| AC-3 | Line numbers toggle works |
| AC-4 | Word wrap toggle works |
| AC-5 | Current line highlight toggle works |
| AC-6 | Tab size and convert-to-spaces work |
| AC-7 | Column ruler shows at configured position |
| AC-8 | ApplyDefaults sets sensible defaults |
| AC-9 | BindToSettings updates editor on settings change |
| AC-10 | Dispose unsubscribes from settings changes |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| AvaloniaEdit | TextEditor, TextEditorOptions |
| AppSettings | Must implement INotifyPropertyChanged |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.3d | 0.5 day |
