# Design Specification: The Senior Intern v0.3.5 "Polish & Integration"

## Executive Summary

This document provides a comprehensive design specification for v0.3.5, which serves as the final phase of the v0.3.0 "Workspace Awareness" milestone. This version focuses on polishing all workspace features, implementing workspace settings, adding quick file navigation, comprehensive status bar, and ensuring all components work together seamlessly.

### v0.3.5 Scope (from v0.3.0 Design Document)
- Multi-file context support with enforced limits
- Workspace settings panel (explorer, editor, context settings)
- Enhanced status bar with all workspace information
- Quick Open dialog for fast file navigation (Ctrl+P)
- Recent workspaces menu and management
- Drag-and-drop support for files and folders
- Comprehensive keyboard shortcuts
- Workspace state restoration on startup
- End-to-end integration testing

### Dependencies
- **v0.3.1** must be complete (Workspace Service)
- **v0.3.2** must be complete (File Explorer)
- **v0.3.3** must be complete (Code Editor)
- **v0.3.4** must be complete (Context Attachment)

---

## Sub-Part Breakdown

| Part | Name | Focus |
|------|------|-------|
| v0.3.5a | Workspace Settings ViewModel | Settings model, validation, persistence |
| v0.3.5b | Workspace Settings Panel UI | Settings dialog with all sections |
| v0.3.5c | Quick Open Dialog | Fuzzy file search, keyboard navigation |
| v0.3.5d | Enhanced Status Bar | All segments, clickable actions, tooltips |
| v0.3.5e | Recent Workspaces | Menu, pinning, clear history |
| v0.3.5f | Global Drag-Drop | Drop zones, visual feedback, file/folder handling |
| v0.3.5g | Keyboard Shortcuts Manager | Global shortcuts, conflict detection, customization prep |
| v0.3.5h | Startup & Integration | Workspace restoration, welcome screen, final wiring |

---

## Architecture Overview

### Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              MainWindow                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         MainWindowViewModel                             │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │ Workspace State                                                   │  │  │
│  │  │ • CurrentWorkspace, RecentWorkspaces                             │  │  │
│  │  │ • IsWorkspaceOpen, WorkspaceName                                 │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  │                                │                                        │  │
│  │    ┌───────────────────────────┼───────────────────────────┐           │  │
│  │    ▼                           ▼                           ▼           │  │
│  │  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐      │  │
│  │  │FileExplorerVM   │   │ EditorPanelVM   │   │  ChatViewModel  │      │  │
│  │  └─────────────────┘   └─────────────────┘   └─────────────────┘      │  │
│  │                                │                                        │  │
│  │    ┌───────────────────────────┼───────────────────────────┐           │  │
│  │    ▼                           ▼                           ▼           │  │
│  │  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐      │  │
│  │  │ StatusBarVM     │   │QuickOpenVM      │   │WorkspaceSettings│      │  │
│  │  │ (v0.3.5)        │   │ (v0.3.5)        │   │   VM (v0.3.5)   │      │  │
│  │  └─────────────────┘   └─────────────────┘   └─────────────────┘      │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Service Layer                                      │
│  ┌─────────────────────────┐        ┌─────────────────────────────────┐     │
│  │   IWorkspaceService     │        │      ISettingsService           │     │
│  │ • RestoreLastWorkspace  │        │ • LoadSettings                  │     │
│  │ • SaveWorkspaceState    │        │ • SaveSettings                  │     │
│  │ • GetRecentWorkspaces   │        │ • ValidateSettings              │     │
│  └─────────────────────────┘        └─────────────────────────────────┘     │
│                                                                              │
│  ┌─────────────────────────┐        ┌─────────────────────────────────┐     │
│  │  IKeyboardShortcutService│       │   IFileIndexService             │     │
│  │ • RegisterShortcut      │        │ • IndexWorkspace                │     │
│  │ • HandleKeyPress        │        │ • SearchFiles                   │     │
│  │ • GetConflicts          │        │ • GetRecentFiles                │     │
│  └─────────────────────────┘        └─────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Data Flow: Application Startup

```
Application Launch
        │
        ▼
┌──────────────────────────────┐
│ App.axaml.cs OnStartup       │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Load AppSettings             │
│ from settings.json           │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Initialize Services          │
│ (DI Container)               │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Check RestoreLastWorkspace   │
│ setting                      │
└──────────────────────────────┘
        │
    ┌───┴───┐
    ▼       ▼
 [True]  [False]
    │       │
    ▼       │
┌───────────────────┐
│ IWorkspaceService │
│ .RestoreLastAsync │
└───────────────────┘
    │       │
    ▼       │
┌───────────────────┐
│ Restore:          │
│ • Open workspace  │
│ • Open files      │
│ • Restore layout  │
│ • Expand folders  │
└───────────────────┘
    │       │
    └───┬───┘
        ▼
┌──────────────────────────────┐
│ Show MainWindow              │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ If no workspace:             │
│ Show Welcome/Start screen    │
└──────────────────────────────┘
```

### Data Flow: Quick Open (Ctrl+P)

```
User presses Ctrl+P
        │
        ▼
┌──────────────────────────────┐
│ QuickOpenCommand executed    │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Check if workspace open      │
└──────────────────────────────┘
        │
    ┌───┴───┐
    ▼       ▼
 [Open]  [No Workspace]
    │       │
    ▼       ▼
┌───────────────────┐  Show "Open a folder
│ Show QuickOpen    │  first" message
│ Dialog            │
└───────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ IFileIndexService            │
│ .GetIndexedFiles()           │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Display recent files at top  │
│ Full index below             │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ User types search query      │
│ (debounced 100ms)            │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Fuzzy match against:         │
│ • File name                  │
│ • Relative path              │
│ Score and rank results       │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Display top 20 results       │
│ Highlight matched chars      │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ User navigates with ↑↓       │
│ Selects with Enter           │
└──────────────────────────────┘
        │
        ▼
┌──────────────────────────────┐
│ Close dialog                 │
│ Open selected file in editor │
└──────────────────────────────┘
```

---

## v0.3.5a: Workspace Settings ViewModel

### Objective
Create the ViewModel for workspace settings that manages all configurable options with validation and persistence.

### WorkspaceSettingsViewModel Implementation

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System;
using System.Collections.ObjectModel;
using System.ComponentModel.DataAnnotations;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;

/// <summary>
/// ViewModel for workspace settings panel.
/// </summary>
public partial class WorkspaceSettingsViewModel : ViewModelBase
{
    private readonly ISettingsService _settingsService;
    private readonly AppSettings _originalSettings;
    private bool _hasChanges;

    #region File Explorer Settings

    /// <summary>
    /// Whether to restore the last workspace on startup.
    /// </summary>
    [ObservableProperty]
    private bool _restoreLastWorkspace = true;

    /// <summary>
    /// Whether to show hidden files and folders.
    /// </summary>
    [ObservableProperty]
    private bool _showHiddenFiles;

    /// <summary>
    /// Whether to respect .gitignore patterns.
    /// </summary>
    [ObservableProperty]
    private bool _useGitIgnore = true;

    /// <summary>
    /// Maximum number of recent workspaces to remember.
    /// </summary>
    [ObservableProperty]
    [Range(1, 50)]
    private int _maxRecentWorkspaces = 10;

    /// <summary>
    /// Custom ignore patterns (one per line).
    /// </summary>
    [ObservableProperty]
    private string _customIgnorePatterns = string.Empty;

    /// <summary>
    /// Whether to auto-refresh on external file changes.
    /// </summary>
    [ObservableProperty]
    private bool _autoRefreshOnExternalChanges = true;

    #endregion

    #region Editor Settings

    /// <summary>
    /// Editor font family.
    /// </summary>
    [ObservableProperty]
    private string _editorFontFamily = "Cascadia Code, Consolas, monospace";

    /// <summary>
    /// Editor font size.
    /// </summary>
    [ObservableProperty]
    [Range(8, 72)]
    private int _editorFontSize = 14;

    /// <summary>
    /// Tab size in spaces.
    /// </summary>
    [ObservableProperty]
    [Range(1, 16)]
    private int _tabSize = 4;

    /// <summary>
    /// Whether to convert tabs to spaces.
    /// </summary>
    [ObservableProperty]
    private bool _convertTabsToSpaces = true;

    /// <summary>
    /// Whether to show line numbers.
    /// </summary>
    [ObservableProperty]
    private bool _showLineNumbers = true;

    /// <summary>
    /// Whether to highlight the current line.
    /// </summary>
    [ObservableProperty]
    private bool _highlightCurrentLine = true;

    /// <summary>
    /// Whether to enable word wrap.
    /// </summary>
    [ObservableProperty]
    private bool _wordWrap;

    /// <summary>
    /// Column ruler position (0 = disabled).
    /// </summary>
    [ObservableProperty]
    [Range(0, 200)]
    private int _rulerColumn;

    /// <summary>
    /// Editor theme (for syntax highlighting).
    /// </summary>
    [ObservableProperty]
    private string _editorTheme = "DarkPlus";

    #endregion

    #region Context Attachment Settings

    /// <summary>
    /// Maximum files that can be attached at once.
    /// </summary>
    [ObservableProperty]
    [Range(1, 50)]
    private int _maxFilesAttached = 10;

    /// <summary>
    /// Maximum tokens per individual file.
    /// </summary>
    [ObservableProperty]
    [Range(100, 32000)]
    private int _maxTokensPerFile = 4000;

    /// <summary>
    /// Maximum total tokens across all attached files.
    /// </summary>
    [ObservableProperty]
    [Range(100, 64000)]
    private int _maxTotalContextTokens = 8000;

    /// <summary>
    /// Maximum file size in KB.
    /// </summary>
    [ObservableProperty]
    [Range(1, 10000)]
    private int _maxFileSizeKb = 500;

    /// <summary>
    /// Whether to show token count in context bar.
    /// </summary>
    [ObservableProperty]
    private bool _showTokenCount = true;

    /// <summary>
    /// Whether to warn when approaching token limit.
    /// </summary>
    [ObservableProperty]
    private bool _warnOnTokenLimit = true;

    #endregion

    #region Computed Properties

    /// <summary>
    /// Available font families for selection.
    /// </summary>
    public ObservableCollection<string> AvailableFonts { get; } = new()
    {
        "Cascadia Code",
        "Cascadia Mono",
        "Consolas",
        "Fira Code",
        "JetBrains Mono",
        "Source Code Pro",
        "Monaco",
        "Menlo",
        "Ubuntu Mono",
        "monospace"
    };

    /// <summary>
    /// Available editor themes.
    /// </summary>
    public ObservableCollection<string> AvailableThemes { get; } = new()
    {
        "DarkPlus",
        "LightPlus",
        "Monokai",
        "SolarizedDark",
        "SolarizedLight",
        "HighContrastDark"
    };

    /// <summary>
    /// Predefined tab size options.
    /// </summary>
    public int[] TabSizeOptions { get; } = { 2, 4, 8 };

    /// <summary>
    /// Predefined font size options.
    /// </summary>
    public int[] FontSizeOptions { get; } = { 10, 11, 12, 13, 14, 15, 16, 18, 20, 24 };

    /// <summary>
    /// Predefined ruler column options.
    /// </summary>
    public int[] RulerColumnOptions { get; } = { 0, 80, 100, 120 };

    /// <summary>
    /// Whether there are unsaved changes.
    /// </summary>
    public bool HasChanges
    {
        get => _hasChanges;
        private set => SetProperty(ref _hasChanges, value);
    }

    /// <summary>
    /// Validation errors for display.
    /// </summary>
    [ObservableProperty]
    private string? _validationError;

    #endregion

    public WorkspaceSettingsViewModel(ISettingsService settingsService)
    {
        _settingsService = settingsService;
        _originalSettings = settingsService.CurrentSettings;

        LoadFromSettings(_originalSettings);
    }

    /// <summary>
    /// Loads values from AppSettings.
    /// </summary>
    private void LoadFromSettings(AppSettings settings)
    {
        // File Explorer
        RestoreLastWorkspace = settings.RestoreLastWorkspace;
        ShowHiddenFiles = settings.ShowHiddenFiles;
        UseGitIgnore = settings.UseGitIgnore;
        MaxRecentWorkspaces = settings.MaxRecentWorkspaces;
        CustomIgnorePatterns = string.Join("\n", settings.CustomIgnorePatterns);
        AutoRefreshOnExternalChanges = settings.AutoRefreshOnExternalChanges;

        // Editor
        EditorFontFamily = settings.EditorFontFamily;
        EditorFontSize = settings.EditorFontSize;
        TabSize = settings.TabSize;
        ConvertTabsToSpaces = settings.ConvertTabsToSpaces;
        ShowLineNumbers = settings.ShowLineNumbers;
        HighlightCurrentLine = settings.HighlightCurrentLine;
        WordWrap = settings.WordWrap;
        RulerColumn = settings.RulerColumn;
        EditorTheme = settings.EditorTheme;

        // Context
        MaxFilesAttached = settings.ContextLimits.MaxFilesAttached;
        MaxTokensPerFile = settings.ContextLimits.MaxTokensPerFile;
        MaxTotalContextTokens = settings.ContextLimits.MaxTotalContextTokens;
        MaxFileSizeKb = settings.ContextLimits.MaxFileSizeBytes / 1024;
        ShowTokenCount = settings.ShowTokenCount;
        WarnOnTokenLimit = settings.WarnOnTokenLimit;

        HasChanges = false;
    }

    /// <summary>
    /// Creates AppSettings from current values.
    /// </summary>
    private AppSettings ToSettings()
    {
        var settings = _originalSettings with { };

        // File Explorer
        settings.RestoreLastWorkspace = RestoreLastWorkspace;
        settings.ShowHiddenFiles = ShowHiddenFiles;
        settings.UseGitIgnore = UseGitIgnore;
        settings.MaxRecentWorkspaces = MaxRecentWorkspaces;
        settings.CustomIgnorePatterns = CustomIgnorePatterns
            .Split('\n', StringSplitOptions.RemoveEmptyEntries)
            .Select(p => p.Trim())
            .Where(p => !string.IsNullOrEmpty(p))
            .ToList();
        settings.AutoRefreshOnExternalChanges = AutoRefreshOnExternalChanges;

        // Editor
        settings.EditorFontFamily = EditorFontFamily;
        settings.EditorFontSize = EditorFontSize;
        settings.TabSize = TabSize;
        settings.ConvertTabsToSpaces = ConvertTabsToSpaces;
        settings.ShowLineNumbers = ShowLineNumbers;
        settings.HighlightCurrentLine = HighlightCurrentLine;
        settings.WordWrap = WordWrap;
        settings.RulerColumn = RulerColumn;
        settings.EditorTheme = EditorTheme;

        // Context
        settings.ContextLimits = new ContextLimitsConfig
        {
            MaxFilesAttached = MaxFilesAttached,
            MaxTokensPerFile = MaxTokensPerFile,
            MaxTotalContextTokens = MaxTotalContextTokens,
            MaxFileSizeBytes = MaxFileSizeKb * 1024
        };
        settings.ShowTokenCount = ShowTokenCount;
        settings.WarnOnTokenLimit = WarnOnTokenLimit;

        return settings;
    }

    /// <summary>
    /// Validates current settings.
    /// </summary>
    private bool Validate()
    {
        ValidationError = null;

        if (MaxTokensPerFile > MaxTotalContextTokens)
        {
            ValidationError = "Max tokens per file cannot exceed max total tokens.";
            return false;
        }

        if (EditorFontSize < 8 || EditorFontSize > 72)
        {
            ValidationError = "Font size must be between 8 and 72.";
            return false;
        }

        return true;
    }

    /// <summary>
    /// Saves settings and closes dialog.
    /// </summary>
    [RelayCommand]
    public async Task SaveAsync()
    {
        if (!Validate()) return;

        var settings = ToSettings();
        await _settingsService.SaveSettingsAsync(settings);
        HasChanges = false;

        // Notify that settings changed
        SaveCompleted?.Invoke(this, EventArgs.Empty);
    }

    /// <summary>
    /// Resets to default values.
    /// </summary>
    [RelayCommand]
    public void ResetToDefaults()
    {
        LoadFromSettings(new AppSettings());
        HasChanges = true;
    }

    /// <summary>
    /// Cancels changes and closes dialog.
    /// </summary>
    [RelayCommand]
    public void Cancel()
    {
        LoadFromSettings(_originalSettings);
        CancelRequested?.Invoke(this, EventArgs.Empty);
    }

    // Track changes on any property
    protected override void OnPropertyChanged(System.ComponentModel.PropertyChangedEventArgs e)
    {
        base.OnPropertyChanged(e);

        if (e.PropertyName != nameof(HasChanges) &&
            e.PropertyName != nameof(ValidationError))
        {
            HasChanges = true;
        }
    }

    /// <summary>
    /// Event raised when save is complete.
    /// </summary>
    public event EventHandler? SaveCompleted;

    /// <summary>
    /// Event raised when cancel is requested.
    /// </summary>
    public event EventHandler? CancelRequested;
}
```

### AppSettings Updates

```csharp
// Add to AppSettings.cs

public sealed record AppSettings
{
    // ... existing properties ...

    // File Explorer (v0.3.5)
    public bool RestoreLastWorkspace { get; set; } = true;
    public bool ShowHiddenFiles { get; set; } = false;
    public bool UseGitIgnore { get; set; } = true;
    public int MaxRecentWorkspaces { get; set; } = 10;
    public IReadOnlyList<string> CustomIgnorePatterns { get; set; } = new[]
    {
        "node_modules/",
        "bin/",
        "obj/",
        ".vs/",
        ".idea/",
        "__pycache__/"
    };
    public bool AutoRefreshOnExternalChanges { get; set; } = true;

    // Editor (v0.3.3+)
    public string EditorFontFamily { get; set; } = "Cascadia Code, Consolas, monospace";
    public int EditorFontSize { get; set; } = 14;
    public int TabSize { get; set; } = 4;
    public bool ConvertTabsToSpaces { get; set; } = true;
    public bool ShowLineNumbers { get; set; } = true;
    public bool HighlightCurrentLine { get; set; } = true;
    public bool WordWrap { get; set; } = false;
    public int RulerColumn { get; set; } = 0;
    public string EditorTheme { get; set; } = "DarkPlus";

    // Context (v0.3.4+)
    public ContextLimitsConfig ContextLimits { get; set; } = new();
    public bool ShowTokenCount { get; set; } = true;
    public bool WarnOnTokenLimit { get; set; } = true;
}
```

### Files to Create (v0.3.5a)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/ViewModels/WorkspaceSettingsViewModel.cs` | Settings ViewModel |

### Files to Modify (v0.3.5a)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Core/Models/AppSettings.cs` | Add all workspace settings |

### Acceptance Criteria (v0.3.5a)
- [ ] All settings load from AppSettings correctly
- [ ] Changes tracked via HasChanges property
- [ ] Validation prevents invalid combinations
- [ ] Save persists to settings file
- [ ] Reset to defaults works
- [ ] Cancel reverts changes

---

## v0.3.5b: Workspace Settings Panel UI

### Objective
Create the settings dialog UI with organized sections for all configurable options.

### WorkspaceSettingsPanel.axaml Implementation

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
        x:Class="SeniorIntern.Desktop.Views.WorkspaceSettingsPanel"
        x:DataType="vm:WorkspaceSettingsViewModel"
        Title="Settings"
        Width="600"
        Height="700"
        MinWidth="500"
        MinHeight="500"
        WindowStartupLocation="CenterOwner"
        CanResize="True">

    <Window.Styles>
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Margin" Value="0,16,0,8" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
        </Style>

        <Style Selector="TextBlock.setting-label">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style Selector="TextBlock.setting-description">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="Margin" Value="0,2,0,0" />
        </Style>

        <Style Selector="Border.section-divider">
            <Setter Property="Height" Value="1" />
            <Setter Property="Background" Value="{DynamicResource BorderBrush}" />
            <Setter Property="Margin" Value="0,16,0,0" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="*, Auto">
        <!-- Scrollable Content -->
        <ScrollViewer Grid.Row="0"
                      HorizontalScrollBarVisibility="Disabled"
                      Padding="24,16">
            <StackPanel Spacing="4">

                <!-- ═══════════════════════════════════════════════════════════ -->
                <!-- FILE EXPLORER SECTION -->
                <!-- ═══════════════════════════════════════════════════════════ -->
                <TextBlock Text="File Explorer" Classes="section-header" />

                <!-- Restore Last Workspace -->
                <CheckBox IsChecked="{Binding RestoreLastWorkspace}">
                    <StackPanel>
                        <TextBlock Text="Restore last workspace on startup" Classes="setting-label" />
                        <TextBlock Text="Automatically open the last used folder when starting the application"
                                   Classes="setting-description" />
                    </StackPanel>
                </CheckBox>

                <!-- Show Hidden Files -->
                <CheckBox IsChecked="{Binding ShowHiddenFiles}" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="Show hidden files and folders" Classes="setting-label" />
                        <TextBlock Text="Display files starting with a dot (e.g., .gitignore)"
                                   Classes="setting-description" />
                    </StackPanel>
                </CheckBox>

                <!-- Use GitIgnore -->
                <CheckBox IsChecked="{Binding UseGitIgnore}" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="Respect .gitignore patterns" Classes="setting-label" />
                        <TextBlock Text="Hide files and folders matching patterns in .gitignore"
                                   Classes="setting-description" />
                    </StackPanel>
                </CheckBox>

                <!-- Auto Refresh -->
                <CheckBox IsChecked="{Binding AutoRefreshOnExternalChanges}" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="Auto-refresh on external changes" Classes="setting-label" />
                        <TextBlock Text="Automatically update the file tree when files change outside the app"
                                   Classes="setting-description" />
                    </StackPanel>
                </CheckBox>

                <!-- Max Recent Workspaces -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,12,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Recent workspaces to remember" Classes="setting-label" />
                        <TextBlock Text="Maximum number of recent folders shown in the menu"
                                   Classes="setting-description" />
                    </StackPanel>
                    <NumericUpDown Grid.Column="1"
                                   Value="{Binding MaxRecentWorkspaces}"
                                   Minimum="1"
                                   Maximum="50"
                                   Width="80"
                                   VerticalAlignment="Center" />
                </Grid>

                <!-- Custom Ignore Patterns -->
                <StackPanel Margin="0,12,0,0">
                    <TextBlock Text="Custom ignore patterns (one per line)" Classes="setting-label" />
                    <TextBlock Text="Files and folders matching these patterns will be hidden"
                               Classes="setting-description" />
                    <TextBox Text="{Binding CustomIgnorePatterns}"
                             AcceptsReturn="True"
                             Height="100"
                             Margin="0,8,0,0"
                             FontFamily="Cascadia Code, Consolas, monospace"
                             FontSize="12" />
                </StackPanel>

                <Border Classes="section-divider" />

                <!-- ═══════════════════════════════════════════════════════════ -->
                <!-- EDITOR SECTION -->
                <!-- ═══════════════════════════════════════════════════════════ -->
                <TextBlock Text="Editor" Classes="section-header" />

                <!-- Font Family -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,0,0,0">
                    <TextBlock Grid.Column="0" Text="Font family" Classes="setting-label" />
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding AvailableFonts}"
                              SelectedItem="{Binding EditorFontFamily}"
                              Width="200" />
                </Grid>

                <!-- Font Size -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <TextBlock Grid.Column="0" Text="Font size" Classes="setting-label" />
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding FontSizeOptions}"
                              SelectedItem="{Binding EditorFontSize}"
                              Width="80" />
                </Grid>

                <!-- Tab Size -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <TextBlock Grid.Column="0" Text="Tab size" Classes="setting-label" />
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding TabSizeOptions}"
                              SelectedItem="{Binding TabSize}"
                              Width="80" />
                </Grid>

                <!-- Convert Tabs to Spaces -->
                <CheckBox IsChecked="{Binding ConvertTabsToSpaces}" Margin="0,8,0,0">
                    <TextBlock Text="Convert tabs to spaces" Classes="setting-label" />
                </CheckBox>

                <!-- Show Line Numbers -->
                <CheckBox IsChecked="{Binding ShowLineNumbers}" Margin="0,8,0,0">
                    <TextBlock Text="Show line numbers" Classes="setting-label" />
                </CheckBox>

                <!-- Highlight Current Line -->
                <CheckBox IsChecked="{Binding HighlightCurrentLine}" Margin="0,8,0,0">
                    <TextBlock Text="Highlight current line" Classes="setting-label" />
                </CheckBox>

                <!-- Word Wrap -->
                <CheckBox IsChecked="{Binding WordWrap}" Margin="0,8,0,0">
                    <TextBlock Text="Word wrap" Classes="setting-label" />
                </CheckBox>

                <!-- Ruler Column -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Column ruler" Classes="setting-label" />
                        <TextBlock Text="Show a vertical line at this column (0 = disabled)"
                                   Classes="setting-description" />
                    </StackPanel>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding RulerColumnOptions}"
                              SelectedItem="{Binding RulerColumn}"
                              Width="80" />
                </Grid>

                <!-- Editor Theme -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <TextBlock Grid.Column="0" Text="Syntax theme" Classes="setting-label" />
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding AvailableThemes}"
                              SelectedItem="{Binding EditorTheme}"
                              Width="150" />
                </Grid>

                <Border Classes="section-divider" />

                <!-- ═══════════════════════════════════════════════════════════ -->
                <!-- CONTEXT ATTACHMENT SECTION -->
                <!-- ═══════════════════════════════════════════════════════════ -->
                <TextBlock Text="Context Attachment" Classes="section-header" />

                <!-- Max Files Attached -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,0,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Maximum files" Classes="setting-label" />
                        <TextBlock Text="Maximum number of files that can be attached at once"
                                   Classes="setting-description" />
                    </StackPanel>
                    <NumericUpDown Grid.Column="1"
                                   Value="{Binding MaxFilesAttached}"
                                   Minimum="1"
                                   Maximum="50"
                                   Width="80" />
                </Grid>

                <!-- Max Tokens Per File -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Maximum tokens per file" Classes="setting-label" />
                        <TextBlock Text="Files exceeding this limit will be truncated"
                                   Classes="setting-description" />
                    </StackPanel>
                    <NumericUpDown Grid.Column="1"
                                   Value="{Binding MaxTokensPerFile}"
                                   Minimum="100"
                                   Maximum="32000"
                                   Increment="500"
                                   Width="100" />
                </Grid>

                <!-- Max Total Tokens -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Maximum total tokens" Classes="setting-label" />
                        <TextBlock Text="Combined token limit for all attached files"
                                   Classes="setting-description" />
                    </StackPanel>
                    <NumericUpDown Grid.Column="1"
                                   Value="{Binding MaxTotalContextTokens}"
                                   Minimum="100"
                                   Maximum="64000"
                                   Increment="1000"
                                   Width="100" />
                </Grid>

                <!-- Max File Size -->
                <Grid ColumnDefinitions="*, Auto" Margin="0,8,0,0">
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Maximum file size (KB)" Classes="setting-label" />
                        <TextBlock Text="Files larger than this cannot be attached"
                                   Classes="setting-description" />
                    </StackPanel>
                    <NumericUpDown Grid.Column="1"
                                   Value="{Binding MaxFileSizeKb}"
                                   Minimum="1"
                                   Maximum="10000"
                                   Increment="100"
                                   Width="100" />
                </Grid>

                <!-- Show Token Count -->
                <CheckBox IsChecked="{Binding ShowTokenCount}" Margin="0,8,0,0">
                    <TextBlock Text="Show token count in context bar" Classes="setting-label" />
                </CheckBox>

                <!-- Warn on Token Limit -->
                <CheckBox IsChecked="{Binding WarnOnTokenLimit}" Margin="0,8,0,0">
                    <TextBlock Text="Warn when approaching token limit" Classes="setting-label" />
                </CheckBox>

                <!-- Spacer -->
                <Border Height="24" />

            </StackPanel>
        </ScrollViewer>

        <!-- Footer with Buttons -->
        <Border Grid.Row="1"
                Background="{DynamicResource FooterBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <Grid ColumnDefinitions="Auto, *, Auto, Auto, Auto">
                <!-- Reset to Defaults -->
                <Button Grid.Column="0"
                        Content="Reset to Defaults"
                        Command="{Binding ResetToDefaultsCommand}" />

                <!-- Validation Error -->
                <TextBlock Grid.Column="2"
                           Text="{Binding ValidationError}"
                           Foreground="{DynamicResource ErrorBrush}"
                           VerticalAlignment="Center"
                           Margin="0,0,16,0"
                           IsVisible="{Binding ValidationError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Cancel -->
                <Button Grid.Column="3"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Margin="0,0,8,0"
                        IsCancel="True" />

                <!-- Save -->
                <Button Grid.Column="4"
                        Content="Save"
                        Command="{Binding SaveCommand}"
                        Classes="primary"
                        IsDefault="True" />
            </Grid>
        </Border>
    </Grid>
</Window>
```

### Files to Create (v0.3.5b)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/Views/WorkspaceSettingsPanel.axaml` | Settings UI |
| `src/SeniorIntern.Desktop/Views/WorkspaceSettingsPanel.axaml.cs` | Settings code-behind |

### Files to Modify (v0.3.5b)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | Add settings panel styles |

### Acceptance Criteria (v0.3.5b)
- [ ] All settings displayed in organized sections
- [ ] Changes reflect immediately in ViewModel
- [ ] Save button saves and closes
- [ ] Cancel button reverts and closes
- [ ] Reset to Defaults resets all values
- [ ] Validation errors display clearly

---

## v0.3.5c: Quick Open Dialog

### Objective
Create a fast file navigation dialog with fuzzy search, similar to VS Code's Ctrl+P functionality.

### IFileIndexService Interface

```csharp
namespace SeniorIntern.Core.Interfaces;

/// <summary>
/// Service for indexing and searching workspace files.
/// </summary>
public interface IFileIndexService
{
    /// <summary>
    /// Indexes all files in the current workspace.
    /// </summary>
    Task IndexWorkspaceAsync(string workspacePath, CancellationToken ct = default);

    /// <summary>
    /// Searches files using fuzzy matching.
    /// </summary>
    IReadOnlyList<FileSearchResult> Search(string query, int maxResults = 20);

    /// <summary>
    /// Gets recently opened files.
    /// </summary>
    IReadOnlyList<string> GetRecentFiles(int count = 10);

    /// <summary>
    /// Adds a file to the recent files list.
    /// </summary>
    void AddToRecent(string filePath);

    /// <summary>
    /// Clears the file index.
    /// </summary>
    void ClearIndex();

    /// <summary>
    /// Whether the index is ready.
    /// </summary>
    bool IsIndexed { get; }

    /// <summary>
    /// Number of indexed files.
    /// </summary>
    int IndexedFileCount { get; }
}

/// <summary>
/// Result of a file search.
/// </summary>
public sealed class FileSearchResult
{
    public string FilePath { get; init; } = string.Empty;
    public string FileName { get; init; } = string.Empty;
    public string RelativePath { get; init; } = string.Empty;
    public string? Language { get; init; }
    public double Score { get; init; }
    public IReadOnlyList<int> MatchedIndices { get; init; } = Array.Empty<int>();
}
```

### FileIndexService Implementation

```csharp
namespace SeniorIntern.Services;

using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Utilities;

public sealed class FileIndexService : IFileIndexService
{
    private readonly IFileSystemService _fileSystemService;
    private readonly ConcurrentDictionary<string, IndexedFile> _index = new();
    private readonly LinkedList<string> _recentFiles = new();
    private readonly object _recentLock = new();
    private const int MaxRecentFiles = 20;

    private string? _workspacePath;
    private bool _isIndexed;

    public bool IsIndexed => _isIndexed;
    public int IndexedFileCount => _index.Count;

    public FileIndexService(IFileSystemService fileSystemService)
    {
        _fileSystemService = fileSystemService;
    }

    public async Task IndexWorkspaceAsync(string workspacePath, CancellationToken ct = default)
    {
        _workspacePath = workspacePath;
        _index.Clear();
        _isIndexed = false;

        var ignorePatterns = await _fileSystemService.LoadGitIgnorePatternsAsync(workspacePath);

        await Task.Run(() =>
        {
            IndexDirectory(workspacePath, workspacePath, ignorePatterns, ct);
        }, ct);

        _isIndexed = true;
    }

    private void IndexDirectory(
        string directory,
        string rootPath,
        IReadOnlyList<string> ignorePatterns,
        CancellationToken ct)
    {
        if (ct.IsCancellationRequested) return;

        try
        {
            foreach (var file in Directory.EnumerateFiles(directory))
            {
                if (ct.IsCancellationRequested) return;

                var relativePath = Path.GetRelativePath(rootPath, file);

                if (_fileSystemService.ShouldIgnore(relativePath, ignorePatterns))
                    continue;

                var fileName = Path.GetFileName(file);
                var language = LanguageDetector.DetectByFileName(fileName);

                _index[file] = new IndexedFile
                {
                    FullPath = file,
                    FileName = fileName,
                    FileNameLower = fileName.ToLowerInvariant(),
                    RelativePath = relativePath,
                    RelativePathLower = relativePath.ToLowerInvariant(),
                    Language = language
                };
            }

            foreach (var subDir in Directory.EnumerateDirectories(directory))
            {
                if (ct.IsCancellationRequested) return;

                var dirName = Path.GetFileName(subDir);
                var relativePath = Path.GetRelativePath(rootPath, subDir);

                if (_fileSystemService.ShouldIgnore(relativePath + "/", ignorePatterns))
                    continue;

                IndexDirectory(subDir, rootPath, ignorePatterns, ct);
            }
        }
        catch (UnauthorizedAccessException)
        {
            // Skip directories we can't access
        }
    }

    public IReadOnlyList<FileSearchResult> Search(string query, int maxResults = 20)
    {
        if (string.IsNullOrWhiteSpace(query))
        {
            // Return recent files when no query
            return GetRecentFiles(maxResults)
                .Where(f => _index.ContainsKey(f))
                .Select(f => new FileSearchResult
                {
                    FilePath = f,
                    FileName = _index[f].FileName,
                    RelativePath = _index[f].RelativePath,
                    Language = _index[f].Language,
                    Score = 1.0
                })
                .ToList();
        }

        var queryLower = query.ToLowerInvariant();

        return _index.Values
            .Select(file => ScoreFile(file, queryLower))
            .Where(r => r.Score > 0)
            .OrderByDescending(r => r.Score)
            .ThenBy(r => r.FileName.Length)
            .Take(maxResults)
            .ToList();
    }

    private FileSearchResult ScoreFile(IndexedFile file, string query)
    {
        var matchedIndices = new List<int>();

        // Score based on file name match (weighted higher)
        var nameScore = FuzzyMatch(file.FileNameLower, query, out var nameIndices);

        // Score based on path match
        var pathScore = FuzzyMatch(file.RelativePathLower, query, out var pathIndices);

        // Combine scores with name weighted higher
        var score = nameScore * 2 + pathScore;

        // Boost exact prefix matches
        if (file.FileNameLower.StartsWith(query))
            score += 5;

        // Boost if query appears as word boundary
        if (file.FileNameLower.Contains("_" + query) || file.FileNameLower.Contains("-" + query))
            score += 2;

        return new FileSearchResult
        {
            FilePath = file.FullPath,
            FileName = file.FileName,
            RelativePath = file.RelativePath,
            Language = file.Language,
            Score = score,
            MatchedIndices = nameScore > pathScore ? nameIndices : pathIndices
        };
    }

    private static double FuzzyMatch(string text, string query, out List<int> matchedIndices)
    {
        matchedIndices = new List<int>();

        if (string.IsNullOrEmpty(query)) return 0;

        var textIndex = 0;
        var queryIndex = 0;
        var score = 0.0;
        var consecutiveBonus = 0;

        while (textIndex < text.Length && queryIndex < query.Length)
        {
            if (text[textIndex] == query[queryIndex])
            {
                matchedIndices.Add(textIndex);
                score += 1 + (consecutiveBonus * 0.5);
                consecutiveBonus++;
                queryIndex++;
            }
            else
            {
                consecutiveBonus = 0;
            }
            textIndex++;
        }

        // All query characters must match
        if (queryIndex < query.Length)
        {
            matchedIndices.Clear();
            return 0;
        }

        // Normalize by query length
        return score / query.Length;
    }

    public IReadOnlyList<string> GetRecentFiles(int count = 10)
    {
        lock (_recentLock)
        {
            return _recentFiles.Take(count).ToList();
        }
    }

    public void AddToRecent(string filePath)
    {
        lock (_recentLock)
        {
            // Remove if already exists
            var node = _recentFiles.Find(filePath);
            if (node != null)
                _recentFiles.Remove(node);

            // Add to front
            _recentFiles.AddFirst(filePath);

            // Trim if too long
            while (_recentFiles.Count > MaxRecentFiles)
                _recentFiles.RemoveLast();
        }
    }

    public void ClearIndex()
    {
        _index.Clear();
        _isIndexed = false;
    }

    private sealed class IndexedFile
    {
        public string FullPath { get; init; } = string.Empty;
        public string FileName { get; init; } = string.Empty;
        public string FileNameLower { get; init; } = string.Empty;
        public string RelativePath { get; init; } = string.Empty;
        public string RelativePathLower { get; init; } = string.Empty;
        public string? Language { get; init; }
    }
}
```

### QuickOpenViewModel Implementation

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;

public partial class QuickOpenViewModel : ViewModelBase
{
    private readonly IFileIndexService _fileIndexService;
    private CancellationTokenSource? _searchCts;

    [ObservableProperty]
    private string _searchQuery = string.Empty;

    [ObservableProperty]
    private ObservableCollection<QuickOpenItemViewModel> _results = new();

    [ObservableProperty]
    private QuickOpenItemViewModel? _selectedItem;

    [ObservableProperty]
    private int _selectedIndex;

    [ObservableProperty]
    private bool _isLoading;

    [ObservableProperty]
    private string? _statusText;

    public event EventHandler<string>? FileSelected;
    public event EventHandler? CloseRequested;

    public QuickOpenViewModel(IFileIndexService fileIndexService)
    {
        _fileIndexService = fileIndexService;
        LoadInitialResults();
    }

    private void LoadInitialResults()
    {
        var recentFiles = _fileIndexService.GetRecentFiles(10);
        Results.Clear();

        foreach (var file in recentFiles)
        {
            var result = _fileIndexService.Search(string.Empty, 1)
                .FirstOrDefault(r => r.FilePath == file);

            if (result != null)
            {
                Results.Add(new QuickOpenItemViewModel(result, isRecent: true));
            }
        }

        StatusText = _fileIndexService.IsIndexed
            ? $"{_fileIndexService.IndexedFileCount} files indexed"
            : "Indexing...";

        if (Results.Count > 0)
            SelectedIndex = 0;
    }

    partial void OnSearchQueryChanged(string value)
    {
        // Cancel previous search
        _searchCts?.Cancel();
        _searchCts = new CancellationTokenSource();

        // Debounce search
        _ = SearchAsync(value, _searchCts.Token);
    }

    private async Task SearchAsync(string query, CancellationToken ct)
    {
        // Short debounce
        await Task.Delay(50, ct);
        if (ct.IsCancellationRequested) return;

        IsLoading = true;

        try
        {
            var results = _fileIndexService.Search(query, 20);

            if (ct.IsCancellationRequested) return;

            Results.Clear();
            foreach (var result in results)
            {
                Results.Add(new QuickOpenItemViewModel(result));
            }

            if (Results.Count > 0)
                SelectedIndex = 0;

            StatusText = Results.Count > 0
                ? $"{Results.Count} results"
                : "No matching files";
        }
        finally
        {
            IsLoading = false;
        }
    }

    [RelayCommand]
    public void MoveUp()
    {
        if (Results.Count == 0) return;
        SelectedIndex = (SelectedIndex - 1 + Results.Count) % Results.Count;
    }

    [RelayCommand]
    public void MoveDown()
    {
        if (Results.Count == 0) return;
        SelectedIndex = (SelectedIndex + 1) % Results.Count;
    }

    [RelayCommand]
    public void Confirm()
    {
        var selected = SelectedIndex >= 0 && SelectedIndex < Results.Count
            ? Results[SelectedIndex]
            : null;

        if (selected != null)
        {
            _fileIndexService.AddToRecent(selected.FilePath);
            FileSelected?.Invoke(this, selected.FilePath);
        }

        CloseRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    public void Cancel()
    {
        CloseRequested?.Invoke(this, EventArgs.Empty);
    }
}

public partial class QuickOpenItemViewModel : ViewModelBase
{
    [ObservableProperty]
    private string _filePath;

    [ObservableProperty]
    private string _fileName;

    [ObservableProperty]
    private string _relativePath;

    [ObservableProperty]
    private string? _language;

    [ObservableProperty]
    private bool _isRecent;

    [ObservableProperty]
    private IReadOnlyList<int> _matchedIndices;

    public string IconKey => Language switch
    {
        "csharp" => "CSharpIcon",
        "javascript" or "typescript" => "JavaScriptIcon",
        "python" => "PythonIcon",
        "json" => "JsonIcon",
        _ => "FileCodeIcon"
    };

    public QuickOpenItemViewModel(FileSearchResult result, bool isRecent = false)
    {
        FilePath = result.FilePath;
        FileName = result.FileName;
        RelativePath = result.RelativePath;
        Language = result.Language;
        MatchedIndices = result.MatchedIndices;
        IsRecent = isRecent;
    }
}
```

### QuickOpenDialog.axaml Implementation

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
        x:Class="SeniorIntern.Desktop.Views.QuickOpenDialog"
        x:DataType="vm:QuickOpenViewModel"
        Title="Quick Open"
        Width="600"
        Height="400"
        MinWidth="400"
        MinHeight="200"
        WindowStartupLocation="CenterOwner"
        CanResize="True"
        ShowInTaskbar="False"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaTitleBarHeightHint="0"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur">

    <Border Background="{DynamicResource QuickOpenBackgroundBrush}"
            BorderBrush="{DynamicResource QuickOpenBorderBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Margin="8"
            BoxShadow="0 8 32 0 #60000000">

        <Grid RowDefinitions="Auto, *, Auto">
            <!-- Search Input -->
            <Border Grid.Row="0"
                    Background="{DynamicResource InputBackgroundBrush}"
                    CornerRadius="8,8,0,0"
                    Padding="12">
                <Grid ColumnDefinitions="Auto, *">
                    <PathIcon Grid.Column="0"
                              Data="{StaticResource SearchIcon}"
                              Width="16" Height="16"
                              Margin="0,0,8,0"
                              Foreground="{DynamicResource TextMutedBrush}" />
                    <TextBox Grid.Column="1"
                             x:Name="SearchInput"
                             Text="{Binding SearchQuery, Mode=TwoWay}"
                             Watermark="Type to search files..."
                             BorderThickness="0"
                             Background="Transparent"
                             FontSize="14" />
                </Grid>
            </Border>

            <!-- Results List -->
            <ListBox Grid.Row="1"
                     ItemsSource="{Binding Results}"
                     SelectedIndex="{Binding SelectedIndex}"
                     Background="Transparent"
                     BorderThickness="0"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListBox.ItemTemplate>
                    <DataTemplate x:DataType="vm:QuickOpenItemViewModel">
                        <Grid ColumnDefinitions="Auto, *, Auto" Margin="8,6">
                            <!-- Icon -->
                            <PathIcon Grid.Column="0"
                                      Data="{Binding IconKey, Converter={StaticResource IconKeyConverter}}"
                                      Width="16" Height="16"
                                      Margin="0,0,10,0" />

                            <!-- File Info -->
                            <StackPanel Grid.Column="1" Spacing="2">
                                <TextBlock Text="{Binding FileName}"
                                           FontWeight="SemiBold"
                                           FontSize="13" />
                                <TextBlock Text="{Binding RelativePath}"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           TextTrimming="CharacterEllipsis" />
                            </StackPanel>

                            <!-- Recent Badge -->
                            <Border Grid.Column="2"
                                    Background="{DynamicResource BadgeBackgroundBrush}"
                                    CornerRadius="4"
                                    Padding="6,2"
                                    VerticalAlignment="Center"
                                    IsVisible="{Binding IsRecent}">
                                <TextBlock Text="recent"
                                           FontSize="10"
                                           Foreground="{DynamicResource TextMutedBrush}" />
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <!-- Status Bar -->
            <Border Grid.Row="2"
                    Background="{DynamicResource FooterBackgroundBrush}"
                    CornerRadius="0,0,8,8"
                    Padding="12,8">
                <Grid ColumnDefinitions="*, Auto">
                    <TextBlock Grid.Column="0"
                               Text="{Binding StatusText}"
                               FontSize="11"
                               Foreground="{DynamicResource TextMutedBrush}" />
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                        <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                            <Run Text="↑↓" FontFamily="Segoe UI Symbol" /> navigate
                        </TextBlock>
                        <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                            <Run Text="↵" FontFamily="Segoe UI Symbol" /> open
                        </TextBlock>
                        <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                            <Run Text="esc" /> close
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
```

### Files to Create (v0.3.5c)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Core/Interfaces/IFileIndexService.cs` | File index interface |
| `src/SeniorIntern.Services/FileIndexService.cs` | File index implementation |
| `src/SeniorIntern.Desktop/ViewModels/QuickOpenViewModel.cs` | Quick open ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/QuickOpenItemViewModel.cs` | Result item ViewModel |
| `src/SeniorIntern.Desktop/Views/QuickOpenDialog.axaml` | Quick open UI |
| `src/SeniorIntern.Desktop/Views/QuickOpenDialog.axaml.cs` | Quick open code-behind |

### Files to Modify (v0.3.5c)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | Add quick open styles |

### Acceptance Criteria (v0.3.5c)
- [ ] Ctrl+P opens quick open dialog
- [ ] Empty search shows recent files
- [ ] Typing filters files with fuzzy matching
- [ ] Results update as you type (debounced)
- [ ] Arrow keys navigate results
- [ ] Enter opens selected file
- [ ] Escape closes dialog
- [ ] Matched characters highlighted in results

---

## v0.3.5d: Enhanced Status Bar

### Objective
Create a comprehensive status bar showing workspace, file, editor, and connection status.

### StatusBarViewModel Implementation

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;

public partial class StatusBarViewModel : ViewModelBase
{
    // Workspace segment
    [ObservableProperty]
    private string? _workspaceName;

    [ObservableProperty]
    private bool _hasWorkspace;

    // File segment
    [ObservableProperty]
    private string? _activeFileName;

    [ObservableProperty]
    private bool _hasActiveFile;

    // Language segment
    [ObservableProperty]
    private string? _language;

    [ObservableProperty]
    private string? _languageDisplayName;

    // Cursor position segment
    [ObservableProperty]
    private int _line = 1;

    [ObservableProperty]
    private int _column = 1;

    [ObservableProperty]
    private int _selectionLength;

    public string CursorDisplay => SelectionLength > 0
        ? $"Ln {Line}, Col {Column} ({SelectionLength} selected)"
        : $"Ln {Line}, Col {Column}";

    // Encoding segment
    [ObservableProperty]
    private string _encoding = "UTF-8";

    // Line ending segment
    [ObservableProperty]
    private string _lineEnding = "LF";

    // Sync/connection status
    [ObservableProperty]
    private bool _isFileWatcherActive;

    [ObservableProperty]
    private bool _hasUnsavedChanges;

    [ObservableProperty]
    private int _unsavedFilesCount;

    // Model status
    [ObservableProperty]
    private string? _modelName;

    [ObservableProperty]
    private bool _isModelLoaded;

    [ObservableProperty]
    private bool _isModelLoading;

    // Tooltips
    public string WorkspaceTooltip => HasWorkspace
        ? $"Workspace: {WorkspaceName}\nClick to open folder"
        : "No workspace open\nClick to open a folder";

    public string FileTooltip => HasActiveFile
        ? $"Active file: {ActiveFileName}\nClick to reveal in explorer"
        : "No file open";

    public string LanguageTooltip => $"Language: {LanguageDisplayName ?? "Plain Text"}\nClick to change";

    public string CursorTooltip => "Click to go to line";

    public string EncodingTooltip => $"Encoding: {Encoding}\nClick to change";

    public string LineEndingTooltip => $"Line ending: {LineEnding switch
    {
        "LF" => "Unix (LF)",
        "CRLF" => "Windows (CRLF)",
        "CR" => "Classic Mac (CR)",
        _ => LineEnding
    }}\nClick to change";

    public string SyncTooltip => IsFileWatcherActive
        ? "File watcher active"
        : "File watcher inactive";

    public string ModelTooltip => IsModelLoaded
        ? $"Model: {ModelName}"
        : IsModelLoading
            ? "Loading model..."
            : "No model loaded";

    // Commands
    [RelayCommand]
    private void OpenWorkspace()
    {
        OpenWorkspaceRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void RevealActiveFile()
    {
        if (HasActiveFile)
            RevealFileRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void ChangeLanguage()
    {
        ChangeLanguageRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void GoToLine()
    {
        GoToLineRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void ChangeEncoding()
    {
        ChangeEncodingRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void ChangeLineEnding()
    {
        ChangeLineEndingRequested?.Invoke(this, EventArgs.Empty);
    }

    // Events
    public event EventHandler? OpenWorkspaceRequested;
    public event EventHandler? RevealFileRequested;
    public event EventHandler? ChangeLanguageRequested;
    public event EventHandler? GoToLineRequested;
    public event EventHandler? ChangeEncodingRequested;
    public event EventHandler? ChangeLineEndingRequested;

    // Update methods
    public void UpdateFromEditor(EditorTabViewModel? tab)
    {
        if (tab == null)
        {
            HasActiveFile = false;
            ActiveFileName = null;
            Language = null;
            LanguageDisplayName = null;
            Line = 1;
            Column = 1;
            SelectionLength = 0;
            Encoding = "UTF-8";
            LineEnding = "LF";
            return;
        }

        HasActiveFile = true;
        ActiveFileName = tab.FileName;
        Language = tab.Language;
        LanguageDisplayName = GetLanguageDisplayName(tab.Language);
        Line = tab.CaretLine;
        Column = tab.CaretColumn;
        SelectionLength = tab.SelectionLength;
        Encoding = tab.Encoding;
        LineEnding = tab.LineEnding;

        OnPropertyChanged(nameof(CursorDisplay));
    }

    public void UpdateFromWorkspace(Workspace? workspace)
    {
        HasWorkspace = workspace != null;
        WorkspaceName = workspace?.DisplayName;
    }

    public void UpdateUnsavedStatus(int unsavedCount)
    {
        UnsavedFilesCount = unsavedCount;
        HasUnsavedChanges = unsavedCount > 0;
    }

    private static string? GetLanguageDisplayName(string? language)
    {
        return language?.ToLowerInvariant() switch
        {
            "csharp" => "C#",
            "javascript" => "JavaScript",
            "typescript" => "TypeScript",
            "javascriptreact" => "JavaScript React",
            "typescriptreact" => "TypeScript React",
            "python" => "Python",
            "json" => "JSON",
            "xml" => "XML",
            "html" => "HTML",
            "css" => "CSS",
            "markdown" => "Markdown",
            "yaml" => "YAML",
            "shellscript" => "Shell Script",
            "powershell" => "PowerShell",
            "sql" => "SQL",
            "rust" => "Rust",
            "go" => "Go",
            "java" => "Java",
            "cpp" => "C++",
            "c" => "C",
            null => null,
            _ => language
        };
    }
}
```

### StatusBar.axaml Implementation

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             x:Class="SeniorIntern.Desktop.Views.StatusBar"
             x:DataType="vm:StatusBarViewModel"
             Height="24">

    <Border Background="{DynamicResource StatusBarBackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="0,1,0,0">

        <Grid ColumnDefinitions="Auto, Auto, *, Auto, Auto, Auto, Auto, Auto, Auto, Auto">

            <!-- Workspace Name -->
            <Button Grid.Column="0"
                    Classes="status-item"
                    Command="{Binding OpenWorkspaceCommand}"
                    ToolTip.Tip="{Binding WorkspaceTooltip}">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <PathIcon Data="{StaticResource FolderIcon}"
                              Width="12" Height="12" />
                    <TextBlock Text="{Binding WorkspaceName, FallbackValue='No folder'}"
                               MaxWidth="150"
                               TextTrimming="CharacterEllipsis" />
                </StackPanel>
            </Button>

            <!-- Active File -->
            <Button Grid.Column="1"
                    Classes="status-item"
                    Command="{Binding RevealActiveFileCommand}"
                    IsVisible="{Binding HasActiveFile}"
                    ToolTip.Tip="{Binding FileTooltip}">
                <TextBlock Text="{Binding ActiveFileName}"
                           MaxWidth="150"
                           TextTrimming="CharacterEllipsis" />
            </Button>

            <!-- Spacer -->
            <Border Grid.Column="2" />

            <!-- Language -->
            <Button Grid.Column="3"
                    Classes="status-item"
                    Command="{Binding ChangeLanguageCommand}"
                    IsVisible="{Binding HasActiveFile}"
                    ToolTip.Tip="{Binding LanguageTooltip}">
                <TextBlock Text="{Binding LanguageDisplayName, FallbackValue='Plain Text'}" />
            </Button>

            <!-- Cursor Position -->
            <Button Grid.Column="4"
                    Classes="status-item"
                    Command="{Binding GoToLineCommand}"
                    IsVisible="{Binding HasActiveFile}"
                    ToolTip.Tip="{Binding CursorTooltip}">
                <TextBlock Text="{Binding CursorDisplay}" />
            </Button>

            <!-- Encoding -->
            <Button Grid.Column="5"
                    Classes="status-item"
                    Command="{Binding ChangeEncodingCommand}"
                    IsVisible="{Binding HasActiveFile}"
                    ToolTip.Tip="{Binding EncodingTooltip}">
                <TextBlock Text="{Binding Encoding}" />
            </Button>

            <!-- Line Ending -->
            <Button Grid.Column="6"
                    Classes="status-item"
                    Command="{Binding ChangeLineEndingCommand}"
                    IsVisible="{Binding HasActiveFile}"
                    ToolTip.Tip="{Binding LineEndingTooltip}">
                <TextBlock Text="{Binding LineEnding}" />
            </Button>

            <!-- Unsaved Indicator -->
            <Border Grid.Column="7"
                    Classes="status-item"
                    IsVisible="{Binding HasUnsavedChanges}"
                    ToolTip.Tip="Unsaved changes">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <Ellipse Width="6" Height="6"
                             Fill="{DynamicResource WarningBrush}" />
                    <TextBlock Text="{Binding UnsavedFilesCount}"
                               IsVisible="{Binding UnsavedFilesCount}" />
                </StackPanel>
            </Border>

            <!-- File Watcher Status -->
            <Border Grid.Column="8"
                    Classes="status-item"
                    ToolTip.Tip="{Binding SyncTooltip}">
                <PathIcon Data="{StaticResource SyncIcon}"
                          Width="12" Height="12"
                          Opacity="{Binding IsFileWatcherActive, Converter={StaticResource BoolToOpacityConverter}}" />
            </Border>

            <!-- Model Status -->
            <Border Grid.Column="9"
                    Classes="status-item"
                    ToolTip.Tip="{Binding ModelTooltip}">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <PathIcon Data="{StaticResource BrainIcon}"
                              Width="12" Height="12" />
                    <TextBlock Text="{Binding ModelName, FallbackValue='No model'}"
                               MaxWidth="120"
                               TextTrimming="CharacterEllipsis"
                               IsVisible="{Binding IsModelLoaded}" />
                    <ProgressBar IsIndeterminate="True"
                                 Width="40"
                                 IsVisible="{Binding IsModelLoading}" />
                </StackPanel>
            </Border>

        </Grid>
    </Border>
</UserControl>
```

### Files to Create (v0.3.5d)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/ViewModels/StatusBarViewModel.cs` | Status bar ViewModel |
| `src/SeniorIntern.Desktop/Views/StatusBar.axaml` | Status bar UI |
| `src/SeniorIntern.Desktop/Views/StatusBar.axaml.cs` | Status bar code-behind |

### Files to Modify (v0.3.5d)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add StatusBar to layout |
| `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Add StatusBarViewModel |
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | Add status bar styles |
| `src/SeniorIntern.Desktop/Assets/Icons.axaml` | Add SyncIcon, BrainIcon |

### Acceptance Criteria (v0.3.5d)
- [ ] Workspace name shows with folder icon
- [ ] Active file name shows when file open
- [ ] Language shows detected language
- [ ] Cursor position updates in real-time
- [ ] Encoding and line ending display correctly
- [ ] Unsaved indicator shows with count
- [ ] All segments have tooltips
- [ ] Clicking segments triggers appropriate actions

---

## v0.3.5e: Recent Workspaces

### Objective
Create a recent workspaces menu with pinning support and clear history option.

### RecentWorkspacesViewModel Implementation

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;

public partial class RecentWorkspacesViewModel : ViewModelBase
{
    private readonly IWorkspaceService _workspaceService;

    [ObservableProperty]
    private ObservableCollection<RecentWorkspaceItemViewModel> _workspaces = new();

    [ObservableProperty]
    private bool _hasWorkspaces;

    public event EventHandler<string>? WorkspaceSelected;

    public RecentWorkspacesViewModel(IWorkspaceService workspaceService)
    {
        _workspaceService = workspaceService;
    }

    public async Task LoadAsync()
    {
        var recent = await _workspaceService.GetRecentWorkspacesAsync(10);

        Workspaces.Clear();
        foreach (var workspace in recent.OrderByDescending(w => w.IsPinned).ThenByDescending(w => w.LastAccessedAt))
        {
            Workspaces.Add(new RecentWorkspaceItemViewModel(workspace, this));
        }

        HasWorkspaces = Workspaces.Count > 0;
    }

    [RelayCommand]
    public void OpenWorkspace(RecentWorkspaceItemViewModel item)
    {
        WorkspaceSelected?.Invoke(this, item.RootPath);
    }

    [RelayCommand]
    public async Task TogglePinAsync(RecentWorkspaceItemViewModel item)
    {
        item.IsPinned = !item.IsPinned;
        await _workspaceService.UpdateWorkspacePinnedAsync(item.Id, item.IsPinned);
        await LoadAsync(); // Refresh to reorder
    }

    [RelayCommand]
    public async Task RemoveAsync(RecentWorkspaceItemViewModel item)
    {
        await _workspaceService.RemoveFromRecentAsync(item.Id);
        Workspaces.Remove(item);
        HasWorkspaces = Workspaces.Count > 0;
    }

    [RelayCommand]
    public async Task ClearAllAsync()
    {
        await _workspaceService.ClearRecentWorkspacesAsync();
        Workspaces.Clear();
        HasWorkspaces = false;
    }
}

public partial class RecentWorkspaceItemViewModel : ViewModelBase
{
    private readonly RecentWorkspacesViewModel _parent;

    [ObservableProperty]
    private Guid _id;

    [ObservableProperty]
    private string _name = string.Empty;

    [ObservableProperty]
    private string _rootPath = string.Empty;

    [ObservableProperty]
    private DateTime _lastAccessedAt;

    [ObservableProperty]
    private bool _isPinned;

    public string DisplayPath => ShortenPath(RootPath);

    public string TimeAgo => FormatTimeAgo(LastAccessedAt);

    public RecentWorkspaceItemViewModel(Workspace workspace, RecentWorkspacesViewModel parent)
    {
        _parent = parent;
        Id = workspace.Id;
        Name = workspace.DisplayName;
        RootPath = workspace.RootPath;
        LastAccessedAt = workspace.LastAccessedAt;
        IsPinned = workspace.IsPinned;
    }

    private static string ShortenPath(string path)
    {
        var home = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
        if (path.StartsWith(home))
            return "~" + path[home.Length..];
        return path;
    }

    private static string FormatTimeAgo(DateTime dateTime)
    {
        var span = DateTime.UtcNow - dateTime;

        if (span.TotalMinutes < 1) return "Just now";
        if (span.TotalMinutes < 60) return $"{(int)span.TotalMinutes}m ago";
        if (span.TotalHours < 24) return $"{(int)span.TotalHours}h ago";
        if (span.TotalDays < 7) return $"{(int)span.TotalDays}d ago";
        if (span.TotalDays < 30) return $"{(int)(span.TotalDays / 7)}w ago";

        return dateTime.ToString("MMM d");
    }
}
```

### RecentWorkspacesMenu.axaml

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             x:Class="SeniorIntern.Desktop.Views.RecentWorkspacesMenu"
             x:DataType="vm:RecentWorkspacesViewModel">

    <Border Background="{DynamicResource MenuBackgroundBrush}"
            BorderBrush="{DynamicResource MenuBorderBrush}"
            BorderThickness="1"
            CornerRadius="4"
            MinWidth="300"
            MaxWidth="400">

        <StackPanel>
            <!-- Recent Workspaces List -->
            <ItemsControl ItemsSource="{Binding Workspaces}"
                          IsVisible="{Binding HasWorkspaces}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:RecentWorkspaceItemViewModel">
                        <Button Classes="menu-item"
                                Command="{Binding $parent[UserControl].((vm:RecentWorkspacesViewModel)DataContext).OpenWorkspaceCommand}"
                                CommandParameter="{Binding}">
                            <Grid ColumnDefinitions="Auto, *, Auto, Auto">
                                <!-- Folder Icon -->
                                <PathIcon Grid.Column="0"
                                          Data="{StaticResource FolderIcon}"
                                          Width="16" Height="16"
                                          Margin="0,0,10,0" />

                                <!-- Name and Path -->
                                <StackPanel Grid.Column="1" Spacing="2">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="SemiBold" />
                                        <PathIcon Data="{StaticResource PinIcon}"
                                                  Width="10" Height="10"
                                                  IsVisible="{Binding IsPinned}"
                                                  Foreground="{DynamicResource AccentBrush}" />
                                    </StackPanel>
                                    <TextBlock Text="{Binding DisplayPath}"
                                               FontSize="11"
                                               Foreground="{DynamicResource TextMutedBrush}"
                                               TextTrimming="CharacterEllipsis" />
                                </StackPanel>

                                <!-- Time Ago -->
                                <TextBlock Grid.Column="2"
                                           Text="{Binding TimeAgo}"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           VerticalAlignment="Center"
                                           Margin="8,0" />

                                <!-- Actions -->
                                <StackPanel Grid.Column="3"
                                            Orientation="Horizontal"
                                            Spacing="2">
                                    <Button Classes="icon-button-small"
                                            Command="{Binding $parent[UserControl].((vm:RecentWorkspacesViewModel)DataContext).TogglePinCommand}"
                                            CommandParameter="{Binding}"
                                            ToolTip.Tip="{Binding IsPinned, Converter={StaticResource PinTooltipConverter}}">
                                        <PathIcon Data="{StaticResource PinIcon}"
                                                  Width="12" Height="12" />
                                    </Button>
                                    <Button Classes="icon-button-small"
                                            Command="{Binding $parent[UserControl].((vm:RecentWorkspacesViewModel)DataContext).RemoveCommand}"
                                            CommandParameter="{Binding}"
                                            ToolTip.Tip="Remove from recent">
                                        <PathIcon Data="{StaticResource CloseIcon}"
                                                  Width="10" Height="10" />
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <TextBlock Text="No recent workspaces"
                       IsVisible="{Binding !HasWorkspaces}"
                       HorizontalAlignment="Center"
                       Padding="16"
                       Foreground="{DynamicResource TextMutedBrush}" />

            <!-- Separator -->
            <Separator IsVisible="{Binding HasWorkspaces}" />

            <!-- Clear All -->
            <Button Classes="menu-item"
                    Command="{Binding ClearAllCommand}"
                    IsVisible="{Binding HasWorkspaces}"
                    HorizontalContentAlignment="Center">
                <TextBlock Text="Clear Recent Workspaces"
                           Foreground="{DynamicResource TextMutedBrush}" />
            </Button>
        </StackPanel>
    </Border>
</UserControl>
```

### Files to Create (v0.3.5e)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/ViewModels/RecentWorkspacesViewModel.cs` | Recent workspaces ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/RecentWorkspaceItemViewModel.cs` | Workspace item ViewModel |
| `src/SeniorIntern.Desktop/Views/RecentWorkspacesMenu.axaml` | Recent workspaces UI |
| `src/SeniorIntern.Desktop/Views/RecentWorkspacesMenu.axaml.cs` | Recent workspaces code-behind |

### Files to Modify (v0.3.5e)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Core/Models/Workspace.cs` | Add IsPinned property |
| `src/SeniorIntern.Core/Interfaces/IWorkspaceService.cs` | Add pin/clear methods |
| `src/SeniorIntern.Services/WorkspaceService.cs` | Implement pin/clear |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add File menu with recent |

### Acceptance Criteria (v0.3.5e)
- [ ] Recent workspaces show in menu
- [ ] Pinned workspaces appear at top
- [ ] Pin/unpin toggle works
- [ ] Remove removes individual workspace
- [ ] Clear All removes all workspaces
- [ ] Time ago shows relative time
- [ ] Path shortened with ~ for home

---

## v0.3.5f: Global Drag-Drop

### Objective
Implement drag-and-drop support for files and folders across the application.

### MainWindow Drag-Drop Implementation

```csharp
// Add to MainWindow.axaml.cs

private void InitializeDragDrop()
{
    AddHandler(DragDrop.DragEnterEvent, OnDragEnter);
    AddHandler(DragDrop.DragLeaveEvent, OnDragLeave);
    AddHandler(DragDrop.DragOverEvent, OnDragOver);
    AddHandler(DragDrop.DropEvent, OnDrop);
}

private void OnDragEnter(object? sender, DragEventArgs e)
{
    if (e.Data.Contains(DataFormats.FileNames))
    {
        ShowDropOverlay(true);
    }
}

private void OnDragLeave(object? sender, DragEventArgs e)
{
    ShowDropOverlay(false);
}

private void OnDragOver(object? sender, DragEventArgs e)
{
    if (e.Data.Contains(DataFormats.FileNames))
    {
        var files = e.Data.GetFileNames()?.ToList();
        if (files == null || files.Count == 0)
        {
            e.DragEffects = DragDropEffects.None;
            return;
        }

        // Determine if dropping folders or files
        var hasFolder = files.Any(Directory.Exists);
        var hasFiles = files.Any(File.Exists);

        if (hasFolder)
        {
            e.DragEffects = DragDropEffects.Link;
            UpdateDropOverlay("Open as workspace");
        }
        else if (hasFiles)
        {
            e.DragEffects = DragDropEffects.Copy;
            UpdateDropOverlay($"Open {files.Count} file(s)");
        }
        else
        {
            e.DragEffects = DragDropEffects.None;
        }
    }
    else
    {
        e.DragEffects = DragDropEffects.None;
    }
}

private async void OnDrop(object? sender, DragEventArgs e)
{
    ShowDropOverlay(false);

    if (!e.Data.Contains(DataFormats.FileNames)) return;

    var files = e.Data.GetFileNames()?.ToList();
    if (files == null || files.Count == 0) return;

    var viewModel = DataContext as MainWindowViewModel;
    if (viewModel == null) return;

    // Process folders first (open as workspace)
    var folders = files.Where(Directory.Exists).ToList();
    if (folders.Count > 0)
    {
        // Open the first folder as workspace
        await viewModel.OpenWorkspaceAsync(folders[0]);

        // If multiple folders, show message
        if (folders.Count > 1)
        {
            // Could show notification about only opening first folder
        }
    }

    // Process files (open in editor)
    var fileList = files.Where(File.Exists).ToList();
    foreach (var file in fileList)
    {
        await viewModel.EditorPanel.OpenFileAsync(file);
    }
}

private void ShowDropOverlay(bool show)
{
    DropOverlay.IsVisible = show;
}

private void UpdateDropOverlay(string message)
{
    DropOverlayText.Text = message;
}
```

### Drop Overlay XAML

```xml
<!-- Add to MainWindow.axaml -->

<!-- Drop Overlay -->
<Border x:Name="DropOverlay"
        Grid.RowSpan="3"
        Background="#CC1E1E1E"
        IsVisible="False"
        IsHitTestVisible="False"
        ZIndex="1000">
    <Border Background="#402196F3"
            BorderBrush="#2196F3"
            BorderThickness="3"
            CornerRadius="12"
            Margin="24"
            Padding="32">
        <StackPanel HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="16">
            <PathIcon Data="{StaticResource DropIcon}"
                      Width="48" Height="48"
                      Foreground="#2196F3" />
            <TextBlock x:Name="DropOverlayText"
                       Text="Drop to open"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Foreground="#2196F3"
                       HorizontalAlignment="Center" />
        </StackPanel>
    </Border>
</Border>
```

### Files to Create (v0.3.5f)

None - modifications only.

### Files to Modify (v0.3.5f)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add drop overlay |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml.cs` | Add drag-drop handlers |
| `src/SeniorIntern.Desktop/Assets/Icons.axaml` | Add DropIcon |

### Acceptance Criteria (v0.3.5f)
- [ ] Drop overlay shows on drag enter
- [ ] Drop overlay hides on drag leave
- [ ] Folder drop opens as workspace
- [ ] File drop opens in editor
- [ ] Multiple files open in tabs
- [ ] Overlay shows appropriate message
- [ ] Invalid drops rejected

---

## v0.3.5g: Keyboard Shortcuts Manager

### Objective
Create a centralized keyboard shortcuts manager for handling global and context-specific shortcuts.

### IKeyboardShortcutService Interface

```csharp
namespace SeniorIntern.Core.Interfaces;

using Avalonia.Input;

public interface IKeyboardShortcutService
{
    /// <summary>
    /// Registers a global keyboard shortcut.
    /// </summary>
    void Register(KeyGesture gesture, string commandId, string description);

    /// <summary>
    /// Handles a key press and executes matching command.
    /// </summary>
    /// <returns>True if a command was executed.</returns>
    bool HandleKeyPress(KeyEventArgs e);

    /// <summary>
    /// Gets all registered shortcuts.
    /// </summary>
    IReadOnlyList<ShortcutInfo> GetAllShortcuts();

    /// <summary>
    /// Gets conflicting shortcuts for a gesture.
    /// </summary>
    IReadOnlyList<ShortcutInfo> GetConflicts(KeyGesture gesture);

    /// <summary>
    /// Event raised when a command should be executed.
    /// </summary>
    event EventHandler<string>? CommandRequested;
}

public sealed class ShortcutInfo
{
    public KeyGesture Gesture { get; init; } = null!;
    public string CommandId { get; init; } = string.Empty;
    public string Description { get; init; } = string.Empty;
    public string Category { get; init; } = "General";
    public string DisplayGesture => FormatGesture(Gesture);

    private static string FormatGesture(KeyGesture gesture)
    {
        var parts = new List<string>();

        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Control))
            parts.Add("Ctrl");
        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Shift))
            parts.Add("Shift");
        if (gesture.KeyModifiers.HasFlag(KeyModifiers.Alt))
            parts.Add("Alt");

        parts.Add(gesture.Key.ToString());

        return string.Join("+", parts);
    }
}
```

### KeyboardShortcutService Implementation

```csharp
namespace SeniorIntern.Services;

using System;
using System.Collections.Generic;
using System.Linq;
using Avalonia.Input;
using SeniorIntern.Core.Interfaces;

public sealed class KeyboardShortcutService : IKeyboardShortcutService
{
    private readonly Dictionary<(Key, KeyModifiers), ShortcutInfo> _shortcuts = new();

    public event EventHandler<string>? CommandRequested;

    public KeyboardShortcutService()
    {
        RegisterDefaultShortcuts();
    }

    private void RegisterDefaultShortcuts()
    {
        // Workspace
        Register(new KeyGesture(Key.O, KeyModifiers.Control), "workspace.open", "Open Folder");
        Register(new KeyGesture(Key.O, KeyModifiers.Control | KeyModifiers.Shift), "file.open", "Open File");

        // Editor
        Register(new KeyGesture(Key.S, KeyModifiers.Control), "file.save", "Save");
        Register(new KeyGesture(Key.S, KeyModifiers.Control | KeyModifiers.Shift), "file.saveAll", "Save All");
        Register(new KeyGesture(Key.W, KeyModifiers.Control), "editor.closeTab", "Close Tab");
        Register(new KeyGesture(Key.Tab, KeyModifiers.Control), "editor.nextTab", "Next Tab");
        Register(new KeyGesture(Key.Tab, KeyModifiers.Control | KeyModifiers.Shift), "editor.previousTab", "Previous Tab");
        Register(new KeyGesture(Key.G, KeyModifiers.Control), "editor.goToLine", "Go to Line");
        Register(new KeyGesture(Key.F, KeyModifiers.Control), "editor.find", "Find");
        Register(new KeyGesture(Key.H, KeyModifiers.Control), "editor.replace", "Find and Replace");
        Register(new KeyGesture(Key.P, KeyModifiers.Control), "quickOpen", "Quick Open File");
        Register(new KeyGesture(Key.N, KeyModifiers.Control), "file.new", "New File");

        // Chat
        Register(new KeyGesture(Key.Enter, KeyModifiers.Control), "chat.send", "Send Message");
        Register(new KeyGesture(Key.A, KeyModifiers.Control | KeyModifiers.Shift), "context.attachSelection", "Attach Selection");
        Register(new KeyGesture(Key.E, KeyModifiers.Control | KeyModifiers.Shift), "context.attachFile", "Attach Current File");

        // Explorer
        Register(new KeyGesture(Key.F2, KeyModifiers.None), "explorer.rename", "Rename");
        Register(new KeyGesture(Key.Delete, KeyModifiers.None), "explorer.delete", "Delete");

        // Settings
        Register(new KeyGesture(Key.OemComma, KeyModifiers.Control), "settings.open", "Open Settings");
    }

    public void Register(KeyGesture gesture, string commandId, string description)
    {
        var key = (gesture.Key, gesture.KeyModifiers);
        _shortcuts[key] = new ShortcutInfo
        {
            Gesture = gesture,
            CommandId = commandId,
            Description = description,
            Category = GetCategory(commandId)
        };
    }

    public bool HandleKeyPress(KeyEventArgs e)
    {
        var key = (e.Key, e.KeyModifiers);

        if (_shortcuts.TryGetValue(key, out var shortcut))
        {
            CommandRequested?.Invoke(this, shortcut.CommandId);
            return true;
        }

        return false;
    }

    public IReadOnlyList<ShortcutInfo> GetAllShortcuts()
    {
        return _shortcuts.Values
            .OrderBy(s => s.Category)
            .ThenBy(s => s.Description)
            .ToList();
    }

    public IReadOnlyList<ShortcutInfo> GetConflicts(KeyGesture gesture)
    {
        var key = (gesture.Key, gesture.KeyModifiers);
        return _shortcuts.TryGetValue(key, out var existing)
            ? new[] { existing }
            : Array.Empty<ShortcutInfo>();
    }

    private static string GetCategory(string commandId)
    {
        var prefix = commandId.Split('.')[0];
        return prefix switch
        {
            "workspace" => "Workspace",
            "file" => "File",
            "editor" => "Editor",
            "chat" => "Chat",
            "context" => "Context",
            "explorer" => "Explorer",
            "settings" => "Settings",
            _ => "General"
        };
    }
}
```

### Files to Create (v0.3.5g)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Core/Interfaces/IKeyboardShortcutService.cs` | Shortcut service interface |
| `src/SeniorIntern.Services/KeyboardShortcutService.cs` | Shortcut service implementation |
| `src/SeniorIntern.Core/Models/ShortcutInfo.cs` | Shortcut info model |

### Files to Modify (v0.3.5g)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml.cs` | Wire up shortcut service |
| `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Handle shortcut commands |

### Acceptance Criteria (v0.3.5g)
- [ ] All shortcuts registered and working
- [ ] Shortcuts execute correct commands
- [ ] GetAllShortcuts returns full list
- [ ] Shortcuts organized by category
- [ ] No conflicts in default shortcuts

---

## v0.3.5h: Startup & Integration

### Objective
Implement workspace restoration on startup, welcome screen for new users, and final integration of all components.

### App.axaml.cs Startup

```csharp
// Update App.axaml.cs

public override async void OnFrameworkInitializationCompleted()
{
    if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
    {
        // Initialize services
        var services = ConfigureServices();
        var settingsService = services.GetRequiredService<ISettingsService>();
        var workspaceService = services.GetRequiredService<IWorkspaceService>();

        // Load settings
        var settings = await settingsService.LoadSettingsAsync();

        // Create main window
        var mainWindow = new MainWindow
        {
            DataContext = services.GetRequiredService<MainWindowViewModel>()
        };

        desktop.MainWindow = mainWindow;
        mainWindow.Show();

        // Restore last workspace if enabled
        if (settings.RestoreLastWorkspace)
        {
            try
            {
                var restored = await workspaceService.RestoreLastWorkspaceAsync();
                if (restored != null)
                {
                    var viewModel = mainWindow.DataContext as MainWindowViewModel;
                    await viewModel?.RestoreWorkspaceStateAsync(restored);
                }
            }
            catch (Exception ex)
            {
                // Log error, continue without workspace
                Debug.WriteLine($"Failed to restore workspace: {ex.Message}");
            }
        }

        // Handle shutdown
        desktop.ShutdownRequested += async (sender, args) =>
        {
            var viewModel = mainWindow.DataContext as MainWindowViewModel;
            if (viewModel != null)
            {
                // Check for unsaved changes
                if (!await viewModel.CanCloseAsync())
                {
                    args.Cancel = true;
                    return;
                }

                // Save workspace state
                await viewModel.SaveWorkspaceStateAsync();
            }
        };
    }

    base.OnFrameworkInitializationCompleted();
}
```

### WelcomeView Implementation

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             x:Class="SeniorIntern.Desktop.Views.WelcomeView"
             x:DataType="vm:WelcomeViewModel">

    <Grid RowDefinitions="*, Auto, *" ColumnDefinitions="*, Auto, *">
        <StackPanel Grid.Row="1" Grid.Column="1"
                    Spacing="24"
                    HorizontalAlignment="Center">

            <!-- Logo and Title -->
            <StackPanel Spacing="8" HorizontalAlignment="Center">
                <Image Source="/Assets/logo.png"
                       Width="64" Height="64" />
                <TextBlock Text="The Senior Intern"
                           FontSize="24"
                           FontWeight="Bold"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Your Local AI Coding Assistant"
                           FontSize="14"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
            </StackPanel>

            <!-- Actions -->
            <StackPanel Spacing="12" Width="300">
                <Button Classes="primary large"
                        Command="{Binding OpenFolderCommand}"
                        HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{StaticResource FolderOpenIcon}"
                                  Width="18" Height="18" />
                        <TextBlock Text="Open Folder" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding NewFileCommand}"
                        HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{StaticResource NewFileIcon}"
                                  Width="18" Height="18" />
                        <TextBlock Text="New File" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Recent Workspaces -->
            <StackPanel Spacing="8" IsVisible="{Binding HasRecentWorkspaces}">
                <TextBlock Text="Recent"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <ItemsControl ItemsSource="{Binding RecentWorkspaces}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Classes="link-button"
                                    Command="{Binding $parent[UserControl].((vm:WelcomeViewModel)DataContext).OpenRecentCommand}"
                                    CommandParameter="{Binding RootPath}"
                                    HorizontalAlignment="Left"
                                    Margin="0,2">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{StaticResource FolderIcon}"
                                              Width="14" Height="14" />
                                    <TextBlock Text="{Binding DisplayName}" />
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Keyboard Shortcuts Hint -->
            <StackPanel Spacing="4" Opacity="0.7">
                <TextBlock Text="Quick Tips"
                           FontSize="11"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+O</Run>
                    <Run Text=" Open folder" />
                </TextBlock>
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+P</Run>
                    <Run Text=" Quick open file" />
                </TextBlock>
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+,</Run>
                    <Run Text=" Settings" />
                </TextBlock>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
```

### Files to Create (v0.3.5h)

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/Views/WelcomeView.axaml` | Welcome screen UI |
| `src/SeniorIntern.Desktop/Views/WelcomeView.axaml.cs` | Welcome screen code-behind |
| `src/SeniorIntern.Desktop/ViewModels/WelcomeViewModel.cs` | Welcome screen ViewModel |

### Files to Modify (v0.3.5h)

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/App.axaml.cs` | Add startup restoration |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add WelcomeView to layout |
| `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Add workspace state management |
| `src/SeniorIntern.Services/WorkspaceService.cs` | Add RestoreLastWorkspaceAsync |

### Acceptance Criteria (v0.3.5h)
- [ ] Last workspace restored on startup (if enabled)
- [ ] Open files restored in tabs
- [ ] Expanded folders restored
- [ ] Welcome screen shows when no workspace
- [ ] Recent workspaces shown on welcome
- [ ] Unsaved changes prompt on close
- [ ] Workspace state saved on close

---

## Complete File Summary

### Files to Create

| File | Part |
|------|------|
| `src/SeniorIntern.Desktop/ViewModels/WorkspaceSettingsViewModel.cs` | v0.3.5a |
| `src/SeniorIntern.Desktop/Views/WorkspaceSettingsPanel.axaml` | v0.3.5b |
| `src/SeniorIntern.Desktop/Views/WorkspaceSettingsPanel.axaml.cs` | v0.3.5b |
| `src/SeniorIntern.Core/Interfaces/IFileIndexService.cs` | v0.3.5c |
| `src/SeniorIntern.Services/FileIndexService.cs` | v0.3.5c |
| `src/SeniorIntern.Desktop/ViewModels/QuickOpenViewModel.cs` | v0.3.5c |
| `src/SeniorIntern.Desktop/ViewModels/QuickOpenItemViewModel.cs` | v0.3.5c |
| `src/SeniorIntern.Desktop/Views/QuickOpenDialog.axaml` | v0.3.5c |
| `src/SeniorIntern.Desktop/Views/QuickOpenDialog.axaml.cs` | v0.3.5c |
| `src/SeniorIntern.Desktop/ViewModels/StatusBarViewModel.cs` | v0.3.5d |
| `src/SeniorIntern.Desktop/Views/StatusBar.axaml` | v0.3.5d |
| `src/SeniorIntern.Desktop/Views/StatusBar.axaml.cs` | v0.3.5d |
| `src/SeniorIntern.Desktop/ViewModels/RecentWorkspacesViewModel.cs` | v0.3.5e |
| `src/SeniorIntern.Desktop/ViewModels/RecentWorkspaceItemViewModel.cs` | v0.3.5e |
| `src/SeniorIntern.Desktop/Views/RecentWorkspacesMenu.axaml` | v0.3.5e |
| `src/SeniorIntern.Desktop/Views/RecentWorkspacesMenu.axaml.cs` | v0.3.5e |
| `src/SeniorIntern.Core/Interfaces/IKeyboardShortcutService.cs` | v0.3.5g |
| `src/SeniorIntern.Services/KeyboardShortcutService.cs` | v0.3.5g |
| `src/SeniorIntern.Core/Models/ShortcutInfo.cs` | v0.3.5g |
| `src/SeniorIntern.Desktop/Views/WelcomeView.axaml` | v0.3.5h |
| `src/SeniorIntern.Desktop/Views/WelcomeView.axaml.cs` | v0.3.5h |
| `src/SeniorIntern.Desktop/ViewModels/WelcomeViewModel.cs` | v0.3.5h |

**Total: 22 files to create**

### Files to Modify

| File | Part | Changes |
|------|------|---------|
| `src/SeniorIntern.Core/Models/AppSettings.cs` | v0.3.5a | Add all workspace settings |
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | v0.3.5b,c,d | Add styles |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | v0.3.5d,e,f,h | Add status bar, menu, drop overlay, welcome |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml.cs` | v0.3.5f,g | Add drag-drop, shortcuts |
| `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` | v0.3.5d,g,h | Add status bar, shortcuts, state |
| `src/SeniorIntern.Core/Models/Workspace.cs` | v0.3.5e | Add IsPinned |
| `src/SeniorIntern.Core/Interfaces/IWorkspaceService.cs` | v0.3.5e,h | Add pin/clear/restore methods |
| `src/SeniorIntern.Services/WorkspaceService.cs` | v0.3.5e,h | Implement methods |
| `src/SeniorIntern.Desktop/App.axaml.cs` | v0.3.5h | Add startup restoration |
| `src/SeniorIntern.Desktop/Assets/Icons.axaml` | v0.3.5d,e,f | Add icons |

**Total: 10 files to modify**

---

## Testing Strategy

### Unit Tests

```csharp
// WorkspaceSettingsViewModelTests.cs
public class WorkspaceSettingsViewModelTests
{
    [Fact]
    public void LoadFromSettings_SetsAllProperties()
    {
        var settings = new AppSettings { TabSize = 2, WordWrap = true };
        var service = new Mock<ISettingsService>();
        service.Setup(s => s.CurrentSettings).Returns(settings);

        var viewModel = new WorkspaceSettingsViewModel(service.Object);

        Assert.Equal(2, viewModel.TabSize);
        Assert.True(viewModel.WordWrap);
    }

    [Fact]
    public void PropertyChange_SetsHasChanges()
    {
        var viewModel = CreateViewModel();
        viewModel.TabSize = 8;

        Assert.True(viewModel.HasChanges);
    }

    [Fact]
    public void Validate_InvalidTokens_ReturnsError()
    {
        var viewModel = CreateViewModel();
        viewModel.MaxTokensPerFile = 10000;
        viewModel.MaxTotalContextTokens = 5000;

        var result = viewModel.SaveCommand.CanExecute(null);
        // Validation should fail
    }
}

// FileIndexServiceTests.cs
public class FileIndexServiceTests
{
    [Fact]
    public async Task IndexWorkspace_IndexesAllFiles()
    {
        var tempDir = CreateTempWorkspace();
        var service = new FileIndexService(new FileSystemService());

        await service.IndexWorkspaceAsync(tempDir);

        Assert.True(service.IsIndexed);
        Assert.True(service.IndexedFileCount > 0);
    }

    [Fact]
    public void Search_EmptyQuery_ReturnsRecentFiles()
    {
        var service = CreateIndexedService();
        service.AddToRecent("/path/recent.cs");

        var results = service.Search("");

        Assert.Contains(results, r => r.FilePath == "/path/recent.cs");
    }

    [Fact]
    public void Search_FuzzyMatch_FindsFiles()
    {
        var service = CreateIndexedService();

        var results = service.Search("mainvm");

        Assert.Contains(results, r => r.FileName.Contains("MainViewModel", StringComparison.OrdinalIgnoreCase));
    }
}

// KeyboardShortcutServiceTests.cs
public class KeyboardShortcutServiceTests
{
    [Fact]
    public void HandleKeyPress_RegisteredShortcut_RaisesEvent()
    {
        var service = new KeyboardShortcutService();
        string? receivedCommand = null;
        service.CommandRequested += (s, cmd) => receivedCommand = cmd;

        var keyArgs = CreateKeyEventArgs(Key.S, KeyModifiers.Control);
        service.HandleKeyPress(keyArgs);

        Assert.Equal("file.save", receivedCommand);
    }

    [Fact]
    public void GetAllShortcuts_ReturnsAllRegistered()
    {
        var service = new KeyboardShortcutService();

        var shortcuts = service.GetAllShortcuts();

        Assert.True(shortcuts.Count > 10);
    }
}
```

### Integration Tests

```csharp
// WorkspaceRestorationTests.cs
public class WorkspaceRestorationTests
{
    [Fact]
    public async Task RestoreLastWorkspace_RestoresState()
    {
        var service = CreateWorkspaceService();
        await service.OpenWorkspaceAsync("/test/workspace");

        var restored = await service.RestoreLastWorkspaceAsync();

        Assert.NotNull(restored);
        Assert.Equal("/test/workspace", restored.RootPath);
    }

    [Fact]
    public async Task SaveWorkspaceState_PersistsOpenFiles()
    {
        var viewModel = CreateMainWindowViewModel();
        await viewModel.EditorPanel.OpenFileAsync("/test/file.cs");

        await viewModel.SaveWorkspaceStateAsync();

        // Verify state was saved
    }
}
```

### Manual Testing Checklist

- [ ] Settings panel opens with Ctrl+,
- [ ] All settings save and load correctly
- [ ] Settings changes apply immediately to editor
- [ ] Quick Open opens with Ctrl+P
- [ ] Quick Open search finds files
- [ ] Quick Open keyboard navigation works
- [ ] Status bar shows all segments
- [ ] Status bar segments clickable
- [ ] Recent workspaces appear in menu
- [ ] Pinned workspaces stay at top
- [ ] Drag folder opens as workspace
- [ ] Drag files open in editor
- [ ] All keyboard shortcuts work
- [ ] Last workspace restores on startup
- [ ] Welcome screen shows when no workspace
- [ ] Unsaved changes prompt on close

---

## Keyboard Shortcuts Summary

| Category | Shortcut | Action |
|----------|----------|--------|
| **Workspace** | Ctrl+O | Open Folder |
| | Ctrl+Shift+O | Open File |
| | Ctrl+, | Settings |
| **Editor** | Ctrl+N | New File |
| | Ctrl+S | Save |
| | Ctrl+Shift+S | Save All |
| | Ctrl+W | Close Tab |
| | Ctrl+Tab | Next Tab |
| | Ctrl+Shift+Tab | Previous Tab |
| | Ctrl+G | Go to Line |
| | Ctrl+F | Find |
| | Ctrl+H | Replace |
| | Ctrl+P | Quick Open |
| **Chat** | Ctrl+Enter | Send Message |
| | Ctrl+Shift+A | Attach Selection |
| | Ctrl+Shift+E | Attach File |
| **Explorer** | F2 | Rename |
| | Delete | Delete |
| | Enter | Open File |

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Settings migration issues | Medium | Medium | Version settings file, migrate on load |
| File index performance | Medium | Low | Background indexing, limit file count |
| Shortcut conflicts | Low | Low | Conflict detection, allow customization later |
| Drag-drop cross-platform | Medium | Low | Test on all platforms, fallback to menu |
| State restoration errors | Medium | Medium | Graceful fallback, log errors |

---

## References

- [Avalonia Drag and Drop](https://docs.avaloniaui.net/docs/input/drag-and-drop)
- [Fuzzy String Matching](https://en.wikipedia.org/wiki/Approximate_string_matching)
- [VS Code Quick Open](https://code.visualstudio.com/docs/getstarted/tips-and-tricks#_quick-open)
- [Application Settings Best Practices](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/app-development/application-settings)
