# Design Specification: The Senior Intern v0.3.4f "Editor Integration"

## Executive Summary

This document provides a detailed implementation specification for v0.3.4f, which integrates context attachment functionality into the Editor Panel. Users can attach code selections or entire files to chat context via keyboard shortcuts, context menu items, and toolbar buttons. This enables seamless workflow between editing code and asking questions about it.

### v0.3.4f Scope

- Create `SelectionInfo` model for selection data
- Create `SelectionAttachmentEventArgs` for the attachment event
- Implement `GetCurrentSelection()` method in EditorPanel
- Implement `AttachSelection()` and `AttachCurrentFile()` commands
- Add keyboard shortcuts (Ctrl+Shift+A, Ctrl+Shift+F)
- Add context menu items for attachment
- Add toolbar button for quick attachment
- Add `HasSelection` property for command enablement

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| SelectionInfo | Model containing selection data |
| SelectionAttachmentEventArgs | Event args for attachment |
| GetCurrentSelection() | Extracts selection info from editor |
| AttachSelection command | Attaches current selection |
| AttachCurrentFile command | Attaches entire file |
| Keyboard shortcuts | Ctrl+Shift+A, Ctrl+Shift+F |
| Context menu items | Attach Selection, Attach File |
| Toolbar button | Quick attach selection |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.3.4f Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  SelectionInfo (Model)                                            â”‚
â”‚  â”œâ”€â”€ FilePath: string                                            â”‚
â”‚  â”œâ”€â”€ FileName: string                                            â”‚
â”‚  â”œâ”€â”€ Language: string?                                           â”‚
â”‚  â”œâ”€â”€ Content: string                                             â”‚
â”‚  â”œâ”€â”€ StartLine: int                                              â”‚
â”‚  â”œâ”€â”€ EndLine: int                                                â”‚
â”‚  â”œâ”€â”€ StartColumn: int                                            â”‚
â”‚  â”œâ”€â”€ EndColumn: int                                              â”‚
â”‚  â””â”€â”€ IsFullFile: bool                                            â”‚
â”‚                                                                   â”‚
â”‚  SelectionAttachmentEventArgs                                     â”‚
â”‚  â””â”€â”€ Selection: SelectionInfo                                    â”‚
â”‚                                                                   â”‚
â”‚  EditorPanel (View)                                               â”‚
â”‚  â”œâ”€â”€ Events                                                      â”‚
â”‚  â”‚   â””â”€â”€ AttachSelectionRequested: EventHandler<...>            â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Methods                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ GetCurrentSelection() â†’ SelectionInfo?                 â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Returns null if no selection                       â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Extracts FilePath, Content, StartLine, EndLine     â”‚
â”‚  â”‚   â”œâ”€â”€ AttachSelection() â†’ void                               â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Calls GetCurrentSelection()                        â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Raises AttachSelectionRequested                    â”‚
â”‚  â”‚   â””â”€â”€ AttachCurrentFile() â†’ void                             â”‚
â”‚  â”‚       â”œâ”€â”€ Gets ActiveTab content                             â”‚
â”‚  â”‚       â”œâ”€â”€ Sets IsFullFile = true                             â”‚
â”‚  â”‚       â””â”€â”€ Raises AttachSelectionRequested                    â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Keyboard Shortcuts                                          â”‚
â”‚      â”œâ”€â”€ Ctrl+Shift+A â†’ AttachSelection()                       â”‚
â”‚      â””â”€â”€ Ctrl+Shift+F â†’ AttachCurrentFile()                     â”‚
â”‚                                                                   â”‚
â”‚  EditorPanelViewModel                                             â”‚
â”‚  â”œâ”€â”€ HasSelection: bool (computed property)                      â”‚
â”‚  â”œâ”€â”€ AttachSelectionCommand: RelayCommand                       â”‚
â”‚  â””â”€â”€ AttachCurrentFileCommand: RelayCommand                     â”‚
â”‚                                                                   â”‚
â”‚  Context Menu Items                                               â”‚
â”‚  â”œâ”€â”€ "Attach Selection to Chat" (Ctrl+Shift+A)                  â”‚
â”‚  â”‚   â””â”€â”€ IsEnabled="{Binding HasSelection}"                     â”‚
â”‚  â””â”€â”€ "Attach File to Chat" (Ctrl+Shift+F)                       â”‚
â”‚                                                                   â”‚
â”‚  Toolbar Button                                                   â”‚
â”‚  â””â”€â”€ Attach Selection icon button                                â”‚
â”‚      â””â”€â”€ IsEnabled="{Binding HasSelection}"                     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Selection Attachment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Selection Attachment Flow                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User selects code in editor â†’ presses Ctrl+Shift+A             â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ EditorPanel.OnKeyDown()                                    â”‚  â”‚
â”‚  â”‚ â†’ AttachSelection()                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GetCurrentSelection()                                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var selection = Editor.TextArea.Selection;                 â”‚  â”‚
â”‚  â”‚ if (selection.IsEmpty) return null;                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ return new SelectionInfo {                                 â”‚  â”‚
â”‚  â”‚     FilePath = ActiveTab.FilePath,                         â”‚  â”‚
â”‚  â”‚     FileName = ActiveTab.FileName,                         â”‚  â”‚
â”‚  â”‚     Language = ActiveTab.Language,                         â”‚  â”‚
â”‚  â”‚     Content = Editor.SelectedText,                         â”‚  â”‚
â”‚  â”‚     StartLine = selection.StartPosition.Line,              â”‚  â”‚
â”‚  â”‚     EndLine = selection.EndPosition.Line,                  â”‚  â”‚
â”‚  â”‚     StartColumn = selection.StartPosition.Column,          â”‚  â”‚
â”‚  â”‚     EndColumn = selection.EndPosition.Column               â”‚  â”‚
â”‚  â”‚ };                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AttachSelectionRequested?.Invoke(this, eventArgs)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MainWindowViewModel.OnAttachSelectionRequested()           â”‚  â”‚
â”‚  â”‚ â†’ ChatViewModel.AttachSelectionAsync(selectionInfo)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ChatViewModel:                                             â”‚  â”‚
â”‚  â”‚ 1. Estimate tokens                                         â”‚  â”‚
â”‚  â”‚ 2. Create FileContextViewModel.FromSelection()             â”‚  â”‚
â”‚  â”‚ 3. Add to AttachedContexts                                 â”‚  â”‚
â”‚  â”‚ 4. Update TotalContextTokens                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  Context pill appears in ChatContextBar                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Full File Attachment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Full File Attachment Flow                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User presses Ctrl+Shift+F (or uses context menu)                â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ EditorPanel.AttachCurrentFile()                            â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (ActiveTab == null) return;                             â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ AttachSelectionRequested?.Invoke(this, new EventArgs(      â”‚  â”‚
â”‚  â”‚     new SelectionInfo {                                    â”‚  â”‚
â”‚  â”‚         FilePath = ActiveTab.FilePath,                     â”‚  â”‚
â”‚  â”‚         FileName = ActiveTab.FileName,                     â”‚  â”‚
â”‚  â”‚         Language = ActiveTab.Language,                     â”‚  â”‚
â”‚  â”‚         Content = ActiveTab.GetContent(),                  â”‚  â”‚
â”‚  â”‚         IsFullFile = true   â† Indicates full file          â”‚  â”‚
â”‚  â”‚     }                                                       â”‚  â”‚
â”‚  â”‚ ));                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ChatViewModel.AttachSelectionAsync()                       â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (selection.IsFullFile)                                  â”‚  â”‚
â”‚  â”‚     FileContextViewModel.FromFile(...)                     â”‚  â”‚
â”‚  â”‚ else                                                        â”‚  â”‚
â”‚  â”‚     FileContextViewModel.FromSelection(...)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Context Menu Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Editor Context Menu                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Copy                                      Ctrl+C           â”‚  â”‚
â”‚  â”‚ Cut                                       Ctrl+X           â”‚  â”‚
â”‚  â”‚ Paste                                     Ctrl+V           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ Undo                                      Ctrl+Z           â”‚  â”‚
â”‚  â”‚ Redo                                      Ctrl+Y           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸ“ Attach Selection to Chat             Ctrl+Shift+A      â”‚  â”‚ â† NEW
â”‚  â”‚ ğŸ“„ Attach File to Chat                  Ctrl+Shift+F      â”‚  â”‚ â† NEW
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Note: "Attach Selection to Chat" is disabled when no selection â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ SelectionInfo.cs                              (NEW)
â”‚   â””â”€â”€ SelectionAttachmentEventArgs.cs               (NEW)
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ EditorPanel.axaml                             (MODIFY)
â”‚   â””â”€â”€ EditorPanel.axaml.cs                          (MODIFY)
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ EditorPanelViewModel.cs                       (MODIFY)
â””â”€â”€ Assets/
    â””â”€â”€ Icons.axaml                                   (MODIFY)
```

---

## Implementation Details

### Task 1: Create SelectionInfo Model

**File:** `src/SeniorIntern.Desktop/Models/SelectionInfo.cs`

```csharp
namespace SeniorIntern.Desktop.Models;

/// <summary>
/// Information about a code selection for attachment to chat context.
/// </summary>
public sealed class SelectionInfo
{
    /// <summary>
    /// Full path to the file containing the selection.
    /// </summary>
    public string FilePath { get; init; } = string.Empty;

    /// <summary>
    /// File name for display.
    /// </summary>
    public string FileName { get; init; } = string.Empty;

    /// <summary>
    /// Detected language identifier.
    /// </summary>
    public string? Language { get; init; }

    /// <summary>
    /// The selected text content.
    /// </summary>
    public string Content { get; init; } = string.Empty;

    /// <summary>
    /// Starting line number (1-based).
    /// </summary>
    public int StartLine { get; init; }

    /// <summary>
    /// Ending line number (1-based).
    /// </summary>
    public int EndLine { get; init; }

    /// <summary>
    /// Starting column number (1-based).
    /// </summary>
    public int StartColumn { get; init; }

    /// <summary>
    /// Ending column number (1-based).
    /// </summary>
    public int EndColumn { get; init; }

    /// <summary>
    /// Whether this represents the entire file content.
    /// </summary>
    public bool IsFullFile { get; init; }

    /// <summary>
    /// Number of lines in the selection.
    /// </summary>
    public int LineCount => IsFullFile
        ? Content.Split('\n').Length
        : EndLine - StartLine + 1;
}
```

### Task 2: Create SelectionAttachmentEventArgs

**File:** `src/SeniorIntern.Desktop/Models/SelectionAttachmentEventArgs.cs`

```csharp
namespace SeniorIntern.Desktop.Models;

using System;

/// <summary>
/// Event args for selection attachment requests.
/// </summary>
public sealed class SelectionAttachmentEventArgs : EventArgs
{
    /// <summary>
    /// The selection information to attach.
    /// </summary>
    public SelectionInfo Selection { get; }

    public SelectionAttachmentEventArgs(SelectionInfo selection)
    {
        Selection = selection ?? throw new ArgumentNullException(nameof(selection));
    }
}
```

### Task 3: Update EditorPanel.axaml.cs

**File:** `src/SeniorIntern.Desktop/Views/EditorPanel.axaml.cs` (additions)

```csharp
/// <summary>
/// Event raised when user wants to attach the current selection to chat.
/// </summary>
public event EventHandler<SelectionAttachmentEventArgs>? AttachSelectionRequested;

/// <summary>
/// Gets the current selection info for attachment.
/// </summary>
public SelectionInfo? GetCurrentSelection()
{
    if (_viewModel?.ActiveTab == null) return null;

    var selection = Editor.TextArea.Selection;
    if (selection.IsEmpty) return null;

    return new SelectionInfo
    {
        FilePath = _viewModel.ActiveTab.FilePath,
        FileName = _viewModel.ActiveTab.FileName,
        Language = _viewModel.ActiveTab.Language,
        Content = Editor.SelectedText,
        StartLine = selection.StartPosition.Line,
        EndLine = selection.EndPosition.Line,
        StartColumn = selection.StartPosition.Column,
        EndColumn = selection.EndPosition.Column
    };
}

/// <summary>
/// Attaches the current selection to chat context.
/// </summary>
public void AttachSelection()
{
    var selection = GetCurrentSelection();
    if (selection == null)
    {
        // No selection - could show a message or do nothing
        return;
    }

    AttachSelectionRequested?.Invoke(this, new SelectionAttachmentEventArgs(selection));
}

/// <summary>
/// Attaches the entire current file to chat context.
/// </summary>
public void AttachCurrentFile()
{
    if (_viewModel?.ActiveTab == null) return;

    var selection = new SelectionInfo
    {
        FilePath = _viewModel.ActiveTab.FilePath,
        FileName = _viewModel.ActiveTab.FileName,
        Language = _viewModel.ActiveTab.Language,
        Content = _viewModel.ActiveTab.GetContent(),
        IsFullFile = true
    };

    AttachSelectionRequested?.Invoke(this, new SelectionAttachmentEventArgs(selection));
}

// Add to OnKeyDown method:
protected override void OnKeyDown(KeyEventArgs e)
{
    base.OnKeyDown(e);

    // ... existing shortcuts ...

    // Ctrl+Shift+A: Attach selection to chat
    if (e.KeyModifiers == (KeyModifiers.Control | KeyModifiers.Shift) && e.Key == Key.A)
    {
        AttachSelection();
        e.Handled = true;
        return;
    }

    // Ctrl+Shift+F: Attach full file to chat
    if (e.KeyModifiers == (KeyModifiers.Control | KeyModifiers.Shift) && e.Key == Key.F)
    {
        AttachCurrentFile();
        e.Handled = true;
        return;
    }
}
```

### Task 4: Update EditorPanelViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/EditorPanelViewModel.cs` (additions)

```csharp
/// <summary>
/// Whether there is currently a text selection in the active editor.
/// </summary>
[ObservableProperty]
private bool _hasSelection;

/// <summary>
/// Updates the HasSelection property based on editor selection state.
/// Called by the view when selection changes.
/// </summary>
public void UpdateSelectionState(bool hasSelection)
{
    HasSelection = hasSelection;
}
```

### Task 5: Add Context Menu Items

**File:** `src/SeniorIntern.Desktop/Views/EditorPanel.axaml` (additions)

```xml
<!-- Add to Editor.ContextMenu -->

<ContextMenu>
    <!-- ... existing items ... -->

    <Separator />

    <MenuItem Header="Attach Selection to Chat"
              Click="OnAttachSelectionClicked"
              InputGesture="Ctrl+Shift+A"
              IsEnabled="{Binding HasSelection}">
        <MenuItem.Icon>
            <PathIcon Data="{StaticResource AttachIcon}" Width="14" Height="14" />
        </MenuItem.Icon>
    </MenuItem>

    <MenuItem Header="Attach File to Chat"
              Click="OnAttachFileClicked"
              InputGesture="Ctrl+Shift+F">
        <MenuItem.Icon>
            <PathIcon Data="{StaticResource AttachFileIcon}" Width="14" Height="14" />
        </MenuItem.Icon>
    </MenuItem>
</ContextMenu>
```

**Add handlers in code-behind:**

```csharp
private void OnAttachSelectionClicked(object? sender, RoutedEventArgs e)
{
    AttachSelection();
}

private void OnAttachFileClicked(object? sender, RoutedEventArgs e)
{
    AttachCurrentFile();
}

// Selection changed handler to update HasSelection
private void OnSelectionChanged(object? sender, EventArgs e)
{
    _viewModel?.UpdateSelectionState(!Editor.TextArea.Selection.IsEmpty);
}
```

### Task 6: Add Toolbar Button (Optional)

**File:** `src/SeniorIntern.Desktop/Views/EditorPanel.axaml` (additions)

```xml
<!-- Add to toolbar if present -->

<Button Classes="toolbar-button"
        Click="OnAttachSelectionClicked"
        ToolTip.Tip="Attach Selection to Chat (Ctrl+Shift+A)"
        IsEnabled="{Binding HasSelection}">
    <PathIcon Data="{StaticResource AttachIcon}" Width="16" Height="16" />
</Button>
```

---

## Keyboard Shortcuts Reference

| Shortcut | Action | Condition |
|----------|--------|-----------|
| Ctrl+Shift+A | Attach selection to chat | Has selection |
| Ctrl+Shift+F | Attach full file to chat | Has active tab |

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| SelectionInfo | 3 | Properties, LineCount calculation |
| SelectionAttachmentEventArgs | 1 | Constructor |
| GetCurrentSelection | 3 | No selection, valid selection, line numbers |
| AttachSelection | 2 | With selection, without selection |
| AttachCurrentFile | 2 | Active tab, no active tab |
| OnKeyDown | 2 | Ctrl+Shift+A, Ctrl+Shift+F |
| HasSelection | 2 | True when selected, false when empty |
| Context menu | 2 | Items enabled/disabled correctly |
| **Total** | **17** | |

---

## Files Summary

### Files to Create (2)

| File | Lines |
|------|-------|
| `Models/SelectionInfo.cs` | 50 |
| `Models/SelectionAttachmentEventArgs.cs` | 20 |

### Files to Modify (4)

| File | Changes |
|------|---------|
| `Views/EditorPanel.axaml` | Add context menu items, toolbar button |
| `Views/EditorPanel.axaml.cs` | Add attachment methods, keyboard shortcuts |
| `ViewModels/EditorPanelViewModel.cs` | Add HasSelection property |
| `Assets/Icons.axaml` | Add AttachIcon, AttachFileIcon |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Ctrl+Shift+A attaches current selection to chat |
| AC-2 | Ctrl+Shift+F attaches entire file to chat |
| AC-3 | Context menu shows "Attach Selection to Chat" option |
| AC-4 | Context menu shows "Attach File to Chat" option |
| AC-5 | "Attach Selection" is disabled when no selection |
| AC-6 | Selection info includes correct line numbers |
| AC-7 | AttachSelectionRequested event raised with correct data |
| AC-8 | Full file attachment sets IsFullFile = true |
| AC-9 | Language is correctly detected and included |
| AC-10 | Toolbar button (if present) works correctly |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.3 | EditorPanel, EditorPanelViewModel |
| v0.3.4c | FileContextViewModel for creating contexts |
| v0.3.4d | ChatViewModel for receiving attachments |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.4f | 0.5 day |
