# Design Specification: The Senior Intern v0.3.5h "Startup & Integration"

## Executive Summary

This document provides a detailed implementation specification for v0.3.5h, which implements workspace restoration on startup, a welcome screen for new users, and final integration of all v0.3.5 components. This part ties together all the polish features (settings, quick open, status bar, recent workspaces, drag-drop, shortcuts) into a cohesive startup and shutdown experience.

### v0.3.5h Scope

- Implement workspace restoration on startup (if enabled in settings)
- Restore open files, expanded folders, and cursor positions
- Create welcome screen for when no workspace is open
- Display recent workspaces on welcome screen
- Show keyboard shortcuts hints
- Handle unsaved changes prompt on application close
- Save workspace state on shutdown
- Integrate all v0.3.5 components in App.axaml.cs

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| App startup logic | Load settings, restore workspace |
| WelcomeView | Welcome screen UI |
| WelcomeViewModel | Welcome screen logic |
| Workspace state save | Persist on shutdown |
| Unsaved changes prompt | Prevent data loss |
| Final DI integration | Wire all services |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.3.5h Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  App.axaml.cs Startup                                             â”‚
â”‚  â”œâ”€â”€ OnFrameworkInitializationCompleted()                        â”‚
â”‚  â”‚   â”œâ”€â”€ ConfigureServices() â†’ ServiceProvider                  â”‚
â”‚  â”‚   â”œâ”€â”€ Load settings via ISettingsService                     â”‚
â”‚  â”‚   â”œâ”€â”€ Create MainWindow + MainWindowViewModel                â”‚
â”‚  â”‚   â”œâ”€â”€ Show MainWindow                                        â”‚
â”‚  â”‚   â”œâ”€â”€ If RestoreLastWorkspace enabled:                       â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Call workspaceService.RestoreLastWorkspaceAsync()  â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Call viewModel.RestoreWorkspaceStateAsync()        â”‚
â”‚  â”‚   â”‚                                                           â”‚
â”‚  â”‚   â””â”€â”€ Register ShutdownRequested handler                     â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€â”€ OnShutdown                                                  â”‚
â”‚      â”œâ”€â”€ Check CanCloseAsync() for unsaved changes              â”‚
â”‚      â”œâ”€â”€ If unsaved, show prompt (Cancel=true)                  â”‚
â”‚      â””â”€â”€ Save workspace state                                   â”‚
â”‚                                                                   â”‚
â”‚  WelcomeViewModel                                                 â”‚
â”‚  â”œâ”€â”€ Dependencies                                                â”‚
â”‚  â”‚   â”œâ”€â”€ IWorkspaceService                                      â”‚
â”‚  â”‚   â””â”€â”€ MainWindowViewModel (for navigation)                   â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Properties                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ RecentWorkspaces: ObservableCollection                 â”‚
â”‚  â”‚   â””â”€â”€ HasRecentWorkspaces: bool                              â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Commands                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ OpenFolderCommand â†’ Opens folder picker                â”‚
â”‚  â”‚   â”œâ”€â”€ NewFileCommand â†’ Creates new file                      â”‚
â”‚  â”‚   â””â”€â”€ OpenRecentCommand(path) â†’ Opens workspace              â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Methods                                                     â”‚
â”‚  â”‚   â””â”€â”€ LoadAsync() â†’ Load recent workspaces                   â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Events                                                      â”‚
â”‚      â””â”€â”€ WorkspaceOpened â†’ Navigate away from welcome           â”‚
â”‚                                                                   â”‚
â”‚  WelcomeView.axaml                                                â”‚
â”‚  â”œâ”€â”€ Logo and title section                                      â”‚
â”‚  â”‚   â”œâ”€â”€ App logo (64x64)                                       â”‚
â”‚  â”‚   â”œâ”€â”€ "The Senior Intern"                                    â”‚
â”‚  â”‚   â””â”€â”€ "Your Local AI Coding Assistant"                       â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Action buttons                                              â”‚
â”‚  â”‚   â”œâ”€â”€ "Open Folder" (primary, large)                         â”‚
â”‚  â”‚   â””â”€â”€ "New File"                                             â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Recent workspaces list                                      â”‚
â”‚  â”‚   â””â”€â”€ Each item: Folder icon + name, clickable               â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Quick Tips section                                          â”‚
â”‚      â”œâ”€â”€ Ctrl+O - Open folder                                   â”‚
â”‚      â”œâ”€â”€ Ctrl+P - Quick open file                               â”‚
â”‚      â””â”€â”€ Ctrl+, - Settings                                      â”‚
â”‚                                                                   â”‚
â”‚  Workspace State Management                                       â”‚
â”‚  â”œâ”€â”€ WorkspaceState model                                        â”‚
â”‚  â”‚   â”œâ”€â”€ WorkspaceId: Guid                                      â”‚
â”‚  â”‚   â”œâ”€â”€ OpenFiles: List<OpenFileState>                         â”‚
â”‚  â”‚   â”œâ”€â”€ ActiveFileIndex: int                                   â”‚
â”‚  â”‚   â””â”€â”€ ExpandedFolders: List<string>                          â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ OpenFileState model                                         â”‚
â”‚  â”‚   â”œâ”€â”€ FilePath: string                                       â”‚
â”‚  â”‚   â”œâ”€â”€ CaretLine: int                                         â”‚
â”‚  â”‚   â”œâ”€â”€ CaretColumn: int                                       â”‚
â”‚  â”‚   â”œâ”€â”€ ScrollOffsetY: double                                  â”‚
â”‚  â”‚   â””â”€â”€ HasUnsavedChanges: bool                                â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ MainWindowViewModel methods                                 â”‚
â”‚  â”‚   â”œâ”€â”€ SaveWorkspaceStateAsync()                              â”‚
â”‚  â”‚   â”œâ”€â”€ RestoreWorkspaceStateAsync(Workspace)                  â”‚
â”‚  â”‚   â””â”€â”€ CanCloseAsync() â†’ bool                                 â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ IWorkspaceService additions                                 â”‚
â”‚      â”œâ”€â”€ GetLastWorkspaceIdAsync() â†’ Guid?                      â”‚
â”‚      â”œâ”€â”€ RestoreLastWorkspaceAsync() â†’ Workspace?               â”‚
â”‚      â”œâ”€â”€ SaveWorkspaceStateAsync(WorkspaceState)                â”‚
â”‚      â””â”€â”€ LoadWorkspaceStateAsync(Guid) â†’ WorkspaceState?        â”‚
â”‚                                                                   â”‚
â”‚  MainWindow Integration                                           â”‚
â”‚  â”œâ”€â”€ Show WelcomeView when no workspace                          â”‚
â”‚  â”œâ”€â”€ Hide WelcomeView when workspace opened                      â”‚
â”‚  â””â”€â”€ Visibility binding to HasWorkspace                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Startup Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Startup Flow                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Application Launch                                              â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ App.OnFrameworkInitializationCompleted()                   â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var services = ConfigureServices();                        â”‚  â”‚
â”‚  â”‚ // Register all services: ISettingsService, IWorkspace..., â”‚  â”‚
â”‚  â”‚ // IFileIndexService, IKeyboardShortcutService, etc.       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Load settings                                              â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var settingsService = services.Get<ISettingsService>();    â”‚  â”‚
â”‚  â”‚ var settings = await settingsService.LoadSettingsAsync();  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Create and show MainWindow                                 â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var mainWindow = new MainWindow();                         â”‚  â”‚
â”‚  â”‚ mainWindow.DataContext = services.Get<MainWindowVM>();     â”‚  â”‚
â”‚  â”‚ desktop.MainWindow = mainWindow;                           â”‚  â”‚
â”‚  â”‚ mainWindow.Show();                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Restore last workspace (if enabled)                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (settings.RestoreLastWorkspace)                         â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     var workspace = await workspaceService                 â”‚  â”‚
â”‚  â”‚         .RestoreLastWorkspaceAsync();                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚     if (workspace != null)                                 â”‚  â”‚
â”‚  â”‚     {                                                       â”‚  â”‚
â”‚  â”‚         await viewModel.RestoreWorkspaceStateAsync(        â”‚  â”‚
â”‚  â”‚             workspace);                                    â”‚  â”‚
â”‚  â”‚     }                                                       â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚       â”Œâ”€â”´â”€â”                                                      â”‚
â”‚       â–¼   â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Workspace   â”‚  â”‚ No Workspace                              â”‚   â”‚
â”‚  â”‚ Restored    â”‚  â”‚                                           â”‚   â”‚
â”‚  â”‚             â”‚  â”‚ â†’ Show WelcomeView                        â”‚   â”‚
â”‚  â”‚ â†’ Show      â”‚  â”‚ â†’ Display "Open Folder" + Recent list    â”‚   â”‚
â”‚  â”‚   Editor    â”‚  â”‚                                           â”‚   â”‚
â”‚  â”‚   + Files   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Shutdown Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Shutdown Flow                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User clicks X or Alt+F4                                         â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ desktop.ShutdownRequested += async (sender, args) =>       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Check for unsaved changes                                  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (!await viewModel.CanCloseAsync())                      â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     args.Cancel = true; // Prevent close                   â”‚  â”‚
â”‚  â”‚     return;                                                â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MainWindowViewModel.CanCloseAsync()                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ var unsavedCount = EditorPanel.Tabs                        â”‚  â”‚
â”‚  â”‚     .Count(t => t.HasUnsavedChanges);                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (unsavedCount == 0) return true;                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ // Show dialog                                             â”‚  â”‚
â”‚  â”‚ var result = await ShowUnsavedChangesDialogAsync(          â”‚  â”‚
â”‚  â”‚     unsavedCount);                                         â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ switch (result)                                            â”‚  â”‚
â”‚  â”‚ {                                                           â”‚  â”‚
â”‚  â”‚     case SaveAll:                                          â”‚  â”‚
â”‚  â”‚         await EditorPanel.SaveAllAsync();                  â”‚  â”‚
â”‚  â”‚         return true;                                       â”‚  â”‚
â”‚  â”‚     case DontSave:                                         â”‚  â”‚
â”‚  â”‚         return true;                                       â”‚  â”‚
â”‚  â”‚     case Cancel:                                           â”‚  â”‚
â”‚  â”‚         return false;                                      â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼ (if CanClose = true)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Save workspace state                                       â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ await viewModel.SaveWorkspaceStateAsync();                 â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ // Saves: open files, cursor positions, expanded folders   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â–¼                                                        â”‚
â”‚  Application closes                                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Welcome Screen Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Welcome Screen Layout                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚                          ğŸ¤–                                â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚                  The Senior Intern                         â”‚   â”‚
â”‚  â”‚             Your Local AI Coding Assistant                â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚              â”‚   ğŸ“‚ Open Folder        â”‚   â† Primary      â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚              â”‚   ğŸ“„ New File           â”‚                   â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚              Recent                                        â”‚   â”‚
â”‚  â”‚              ğŸ“ senior-intern                              â”‚   â”‚
â”‚  â”‚              ğŸ“ my-project                                 â”‚   â”‚
â”‚  â”‚              ğŸ“ dotnet-samples                             â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚              Quick Tips                                    â”‚   â”‚
â”‚  â”‚              Ctrl+O  Open folder                          â”‚   â”‚
â”‚  â”‚              Ctrl+P  Quick open file                      â”‚   â”‚
â”‚  â”‚              Ctrl+,  Settings                             â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Visibility: IsVisible="{Binding !HasWorkspace}"                 â”‚
â”‚  When workspace opens, this hides automatically                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Core/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ WorkspaceState.cs                             (NEW)
â”‚   â””â”€â”€ OpenFileState.cs                              (NEW)
â””â”€â”€ Interfaces/
    â””â”€â”€ IWorkspaceService.cs                          (MODIFY)

src/SeniorIntern.Services/
â””â”€â”€ WorkspaceService.cs                               (MODIFY)

src/SeniorIntern.Desktop/
â”œâ”€â”€ App.axaml.cs                                      (MODIFY)
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ WelcomeViewModel.cs                           (NEW)
â”‚   â””â”€â”€ MainWindowViewModel.cs                        (MODIFY)
â””â”€â”€ Views/
    â”œâ”€â”€ WelcomeView.axaml                             (NEW)
    â”œâ”€â”€ WelcomeView.axaml.cs                          (NEW)
    â””â”€â”€ MainWindow.axaml                              (MODIFY)
```

---

## Implementation Details

### Task 1: Create WorkspaceState Models

**File:** `src/SeniorIntern.Core/Models/WorkspaceState.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Represents the saved state of a workspace session.
/// </summary>
public sealed class WorkspaceState
{
    /// <summary>
    /// The workspace this state belongs to.
    /// </summary>
    public Guid WorkspaceId { get; init; }

    /// <summary>
    /// List of open files with their states.
    /// </summary>
    public List<OpenFileState> OpenFiles { get; init; } = new();

    /// <summary>
    /// Index of the active (focused) file tab.
    /// </summary>
    public int ActiveFileIndex { get; init; }

    /// <summary>
    /// List of expanded folder paths in the file explorer.
    /// </summary>
    public List<string> ExpandedFolders { get; init; } = new();

    /// <summary>
    /// Timestamp when this state was saved.
    /// </summary>
    public DateTime SavedAt { get; init; } = DateTime.UtcNow;
}
```

**File:** `src/SeniorIntern.Core/Models/OpenFileState.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Represents the saved state of an open file.
/// </summary>
public sealed class OpenFileState
{
    /// <summary>
    /// Full path to the file.
    /// </summary>
    public string FilePath { get; init; } = string.Empty;

    /// <summary>
    /// Caret line position (1-indexed).
    /// </summary>
    public int CaretLine { get; init; } = 1;

    /// <summary>
    /// Caret column position (1-indexed).
    /// </summary>
    public int CaretColumn { get; init; } = 1;

    /// <summary>
    /// Vertical scroll offset.
    /// </summary>
    public double ScrollOffsetY { get; init; }

    /// <summary>
    /// Whether the file had unsaved changes when state was saved.
    /// </summary>
    public bool HasUnsavedChanges { get; init; }
}
```

### Task 2: Update IWorkspaceService Interface

**File:** `src/SeniorIntern.Core/Interfaces/IWorkspaceService.cs` (additions)

```csharp
/// <summary>
/// Gets the ID of the last opened workspace.
/// </summary>
Task<Guid?> GetLastWorkspaceIdAsync();

/// <summary>
/// Restores the last opened workspace.
/// </summary>
Task<Workspace?> RestoreLastWorkspaceAsync();

/// <summary>
/// Saves the current workspace state.
/// </summary>
Task SaveWorkspaceStateAsync(WorkspaceState state);

/// <summary>
/// Loads the saved state for a workspace.
/// </summary>
Task<WorkspaceState?> LoadWorkspaceStateAsync(Guid workspaceId);
```

### Task 3: Update WorkspaceService Implementation

**File:** `src/SeniorIntern.Services/WorkspaceService.cs` (additions)

```csharp
private const string LastWorkspaceKey = "LastWorkspaceId";
private const string WorkspaceStateFolder = "workspace-states";

public async Task<Guid?> GetLastWorkspaceIdAsync()
{
    var path = Path.Combine(_appDataPath, LastWorkspaceKey);
    if (!File.Exists(path)) return null;

    var content = await File.ReadAllTextAsync(path);
    return Guid.TryParse(content, out var id) ? id : null;
}

public async Task<Workspace?> RestoreLastWorkspaceAsync()
{
    var lastId = await GetLastWorkspaceIdAsync();
    if (!lastId.HasValue) return null;

    var workspace = await _repository.GetByIdAsync(lastId.Value);
    if (workspace == null) return null;

    // Verify the folder still exists
    if (!Directory.Exists(workspace.RootPath))
    {
        await RemoveFromRecentAsync(workspace.Id);
        return null;
    }

    // Update last accessed time
    var updated = workspace with { LastAccessedAt = DateTime.UtcNow };
    await _repository.UpdateAsync(updated);

    return updated;
}

public async Task SaveWorkspaceStateAsync(WorkspaceState state)
{
    var folder = Path.Combine(_appDataPath, WorkspaceStateFolder);
    Directory.CreateDirectory(folder);

    var path = Path.Combine(folder, $"{state.WorkspaceId}.json");
    var json = JsonSerializer.Serialize(state, _jsonOptions);
    await File.WriteAllTextAsync(path, json);

    // Also save as last workspace
    var lastPath = Path.Combine(_appDataPath, LastWorkspaceKey);
    await File.WriteAllTextAsync(lastPath, state.WorkspaceId.ToString());
}

public async Task<WorkspaceState?> LoadWorkspaceStateAsync(Guid workspaceId)
{
    var path = Path.Combine(_appDataPath, WorkspaceStateFolder, $"{workspaceId}.json");
    if (!File.Exists(path)) return null;

    var json = await File.ReadAllTextAsync(path);
    return JsonSerializer.Deserialize<WorkspaceState>(json, _jsonOptions);
}
```

### Task 4: Create WelcomeViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/WelcomeViewModel.cs`

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using System.Collections.ObjectModel;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;

public partial class WelcomeViewModel : ViewModelBase
{
    private readonly IWorkspaceService _workspaceService;

    [ObservableProperty]
    private ObservableCollection<RecentWorkspaceInfo> _recentWorkspaces = new();

    [ObservableProperty]
    private bool _hasRecentWorkspaces;

    public event EventHandler<string>? WorkspaceOpenRequested;
    public event EventHandler? NewFileRequested;

    public WelcomeViewModel(IWorkspaceService workspaceService)
    {
        _workspaceService = workspaceService;
    }

    public async Task LoadAsync()
    {
        var recent = await _workspaceService.GetRecentWorkspacesAsync(5);

        RecentWorkspaces.Clear();
        foreach (var workspace in recent)
        {
            RecentWorkspaces.Add(new RecentWorkspaceInfo
            {
                DisplayName = workspace.DisplayName,
                RootPath = workspace.RootPath
            });
        }

        HasRecentWorkspaces = RecentWorkspaces.Count > 0;
    }

    [RelayCommand]
    private void OpenFolder()
    {
        // Trigger folder picker in MainWindow
        WorkspaceOpenRequested?.Invoke(this, string.Empty);
    }

    [RelayCommand]
    private void NewFile()
    {
        NewFileRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void OpenRecent(string rootPath)
    {
        WorkspaceOpenRequested?.Invoke(this, rootPath);
    }
}

public sealed class RecentWorkspaceInfo
{
    public string DisplayName { get; init; } = string.Empty;
    public string RootPath { get; init; } = string.Empty;
}
```

### Task 5: Create WelcomeView.axaml

**File:** `src/SeniorIntern.Desktop/Views/WelcomeView.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             x:Class="SeniorIntern.Desktop.Views.WelcomeView"
             x:DataType="vm:WelcomeViewModel">

    <Grid RowDefinitions="*, Auto, *" ColumnDefinitions="*, Auto, *">
        <StackPanel Grid.Row="1" Grid.Column="1"
                    Spacing="24"
                    HorizontalAlignment="Center">

            <!-- Logo and Title -->
            <StackPanel Spacing="8" HorizontalAlignment="Center">
                <Image Source="/Assets/logo.png"
                       Width="64" Height="64" />
                <TextBlock Text="The Senior Intern"
                           FontSize="24"
                           FontWeight="Bold"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Your Local AI Coding Assistant"
                           FontSize="14"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
            </StackPanel>

            <!-- Actions -->
            <StackPanel Spacing="12" Width="300">
                <Button Classes="primary large"
                        Command="{Binding OpenFolderCommand}"
                        HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{StaticResource FolderOpenIcon}"
                                  Width="18" Height="18" />
                        <TextBlock Text="Open Folder" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding NewFileCommand}"
                        HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{StaticResource NewFileIcon}"
                                  Width="18" Height="18" />
                        <TextBlock Text="New File" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Recent Workspaces -->
            <StackPanel Spacing="8" IsVisible="{Binding HasRecentWorkspaces}">
                <TextBlock Text="Recent"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <ItemsControl ItemsSource="{Binding RecentWorkspaces}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Classes="link-button"
                                    Command="{Binding $parent[UserControl].((vm:WelcomeViewModel)DataContext).OpenRecentCommand}"
                                    CommandParameter="{Binding RootPath}"
                                    HorizontalAlignment="Left"
                                    Margin="0,2">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <PathIcon Data="{StaticResource FolderIcon}"
                                              Width="14" Height="14" />
                                    <TextBlock Text="{Binding DisplayName}" />
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Keyboard Shortcuts Hint -->
            <StackPanel Spacing="4" Opacity="0.7">
                <TextBlock Text="Quick Tips"
                           FontSize="11"
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+O</Run>
                    <Run Text=" Open folder" />
                </TextBlock>
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+P</Run>
                    <Run Text=" Quick open file" />
                </TextBlock>
                <TextBlock FontSize="11" Foreground="{DynamicResource TextMutedBrush}">
                    <Run FontWeight="SemiBold">Ctrl+,</Run>
                    <Run Text=" Settings" />
                </TextBlock>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
```

### Task 6: Create WelcomeView.axaml.cs

**File:** `src/SeniorIntern.Desktop/Views/WelcomeView.axaml.cs`

```csharp
namespace SeniorIntern.Desktop.Views;

using Avalonia.Controls;

public partial class WelcomeView : UserControl
{
    public WelcomeView()
    {
        InitializeComponent();
    }
}
```

### Task 7: Update App.axaml.cs

**File:** `src/SeniorIntern.Desktop/App.axaml.cs` (modifications)

```csharp
public override async void OnFrameworkInitializationCompleted()
{
    if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
    {
        // Initialize services
        var services = ConfigureServices();
        var settingsService = services.GetRequiredService<ISettingsService>();
        var workspaceService = services.GetRequiredService<IWorkspaceService>();

        // Load settings
        var settings = await settingsService.LoadSettingsAsync();

        // Create main window
        var mainWindow = new MainWindow(
            services.GetRequiredService<IKeyboardShortcutService>())
        {
            DataContext = services.GetRequiredService<MainWindowViewModel>()
        };

        desktop.MainWindow = mainWindow;
        mainWindow.Show();

        // Restore last workspace if enabled
        if (settings.RestoreLastWorkspace)
        {
            try
            {
                var restored = await workspaceService.RestoreLastWorkspaceAsync();
                if (restored != null)
                {
                    var viewModel = mainWindow.DataContext as MainWindowViewModel;
                    await viewModel?.RestoreWorkspaceStateAsync(restored);
                }
            }
            catch (Exception ex)
            {
                // Log error, continue without workspace
                Debug.WriteLine($"Failed to restore workspace: {ex.Message}");
            }
        }

        // Handle shutdown
        desktop.ShutdownRequested += async (sender, args) =>
        {
            var viewModel = mainWindow.DataContext as MainWindowViewModel;
            if (viewModel != null)
            {
                // Check for unsaved changes
                if (!await viewModel.CanCloseAsync())
                {
                    args.Cancel = true;
                    return;
                }

                // Save workspace state
                await viewModel.SaveWorkspaceStateAsync();
            }
        };
    }

    base.OnFrameworkInitializationCompleted();
}

private IServiceProvider ConfigureServices()
{
    var services = new ServiceCollection();

    // Core services
    services.AddSingleton<ISettingsService, SettingsService>();
    services.AddSingleton<IWorkspaceService, WorkspaceService>();
    services.AddSingleton<IFileSystemService, FileSystemService>();
    services.AddSingleton<IFileIndexService, FileIndexService>();
    services.AddSingleton<IKeyboardShortcutService, KeyboardShortcutService>();
    services.AddSingleton<ITokenEstimationService, TokenEstimationService>();
    services.AddSingleton<IContextFormatter, ContextFormatter>();

    // ViewModels
    services.AddTransient<MainWindowViewModel>();
    services.AddTransient<WelcomeViewModel>();
    services.AddTransient<WorkspaceSettingsViewModel>();

    return services.BuildServiceProvider();
}
```

### Task 8: Update MainWindowViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` (additions)

```csharp
[ObservableProperty]
private bool _showWelcome = true;

[ObservableProperty]
private WelcomeViewModel _welcomeViewModel;

partial void OnHasWorkspaceChanged(bool value)
{
    ShowWelcome = !value;
}

public async Task<bool> CanCloseAsync()
{
    var unsavedCount = EditorPanel.Tabs.Count(t => t.HasUnsavedChanges);

    if (unsavedCount == 0)
        return true;

    var result = await ShowUnsavedChangesDialogAsync(unsavedCount);

    switch (result)
    {
        case UnsavedChangesResult.SaveAll:
            await EditorPanel.SaveAllAsync();
            return true;
        case UnsavedChangesResult.DontSave:
            return true;
        case UnsavedChangesResult.Cancel:
        default:
            return false;
    }
}

public async Task SaveWorkspaceStateAsync()
{
    if (CurrentWorkspace == null) return;

    var state = new WorkspaceState
    {
        WorkspaceId = CurrentWorkspace.Id,
        OpenFiles = EditorPanel.Tabs.Select(t => new OpenFileState
        {
            FilePath = t.FilePath,
            CaretLine = t.CaretLine,
            CaretColumn = t.CaretColumn,
            ScrollOffsetY = t.ScrollOffsetY,
            HasUnsavedChanges = t.HasUnsavedChanges
        }).ToList(),
        ActiveFileIndex = EditorPanel.Tabs.IndexOf(EditorPanel.ActiveTab),
        ExpandedFolders = FileExplorer.GetExpandedFolders().ToList()
    };

    await _workspaceService.SaveWorkspaceStateAsync(state);
}

public async Task RestoreWorkspaceStateAsync(Workspace workspace)
{
    // Open the workspace
    await OpenWorkspaceAsync(workspace.RootPath);

    // Load saved state
    var state = await _workspaceService.LoadWorkspaceStateAsync(workspace.Id);
    if (state == null) return;

    // Restore open files
    foreach (var fileState in state.OpenFiles)
    {
        if (!File.Exists(fileState.FilePath)) continue;

        await EditorPanel.OpenFileAsync(fileState.FilePath);

        var tab = EditorPanel.Tabs.LastOrDefault();
        if (tab != null)
        {
            tab.GoToPosition(fileState.CaretLine, fileState.CaretColumn);
            tab.ScrollOffsetY = fileState.ScrollOffsetY;
        }
    }

    // Restore active tab
    if (state.ActiveFileIndex >= 0 && state.ActiveFileIndex < EditorPanel.Tabs.Count)
    {
        EditorPanel.ActiveTab = EditorPanel.Tabs[state.ActiveFileIndex];
    }

    // Restore expanded folders
    foreach (var folder in state.ExpandedFolders)
    {
        FileExplorer.ExpandFolder(folder);
    }
}

private async Task<UnsavedChangesResult> ShowUnsavedChangesDialogAsync(int unsavedCount)
{
    var dialog = new ContentDialog
    {
        Title = "Unsaved Changes",
        Content = $"You have {unsavedCount} unsaved file(s). What would you like to do?",
        PrimaryButtonText = "Save All",
        SecondaryButtonText = "Don't Save",
        CloseButtonText = "Cancel"
    };

    var result = await dialog.ShowAsync();

    return result switch
    {
        ContentDialogResult.Primary => UnsavedChangesResult.SaveAll,
        ContentDialogResult.Secondary => UnsavedChangesResult.DontSave,
        _ => UnsavedChangesResult.Cancel
    };
}

public enum UnsavedChangesResult
{
    SaveAll,
    DontSave,
    Cancel
}
```

### Task 9: Update MainWindow.axaml

**File:** `src/SeniorIntern.Desktop/Views/MainWindow.axaml` (additions)

```xml
<!-- Add WelcomeView in the main content area -->
<Grid>
    <!-- Main content (editor, explorer, etc.) -->
    <Grid IsVisible="{Binding HasWorkspace}">
        <!-- Existing layout -->
    </Grid>

    <!-- Welcome view (when no workspace) -->
    <views:WelcomeView DataContext="{Binding WelcomeViewModel}"
                       IsVisible="{Binding ShowWelcome}" />
</Grid>
```

---

## Unsaved Changes Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Unsaved Changes                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  You have 3 unsaved file(s). What would you like to do?         â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚                    [Save All]  [Don't Save]  [Cancel]           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| RestoreLastWorkspaceAsync | 3 | Found, not found, folder deleted |
| SaveWorkspaceStateAsync | 2 | Saves JSON, updates last ID |
| LoadWorkspaceStateAsync | 2 | Found, not found |
| CanCloseAsync | 3 | No unsaved, save all, cancel |
| RestoreWorkspaceStateAsync | 3 | Files, tabs, expanded folders |
| SaveWorkspaceStateAsync (VM) | 2 | Captures all state |
| WelcomeViewModel.LoadAsync | 2 | Has recent, empty |
| WelcomeViewModel commands | 3 | OpenFolder, NewFile, OpenRecent |
| **Total** | **20** | |

---

## Files Summary

### Files to Create (5)

| File | Lines |
|------|-------|
| `Core/Models/WorkspaceState.cs` | 30 |
| `Core/Models/OpenFileState.cs` | 30 |
| `ViewModels/WelcomeViewModel.cs` | 70 |
| `Views/WelcomeView.axaml` | 90 |
| `Views/WelcomeView.axaml.cs` | 15 |

### Files to Modify (5)

| File | Changes |
|------|---------|
| `Core/Interfaces/IWorkspaceService.cs` | Add 4 state methods |
| `Services/WorkspaceService.cs` | Implement 4 methods |
| `App.axaml.cs` | Add startup/shutdown logic |
| `ViewModels/MainWindowViewModel.cs` | Add state save/restore/close |
| `Views/MainWindow.axaml` | Add WelcomeView integration |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Last workspace restored on startup (if enabled) |
| AC-2 | Open files restored in tabs |
| AC-3 | Cursor positions restored |
| AC-4 | Expanded folders restored |
| AC-5 | Welcome screen shows when no workspace |
| AC-6 | Recent workspaces shown on welcome (max 5) |
| AC-7 | Keyboard shortcuts hints displayed |
| AC-8 | Unsaved changes prompt on close |
| AC-9 | "Save All" saves and closes |
| AC-10 | "Cancel" prevents close |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.5a | RestoreLastWorkspace setting |
| v0.3.5e | Recent workspaces for welcome screen |
| v0.3.5g | Shortcuts for tips display |
| EditorPanelViewModel | Tab state, save methods |
| FileExplorerViewModel | Expanded folders |

---

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Last workspace folder deleted | Show welcome screen, remove from recent |
| Open file no longer exists | Skip file, continue with others |
| State file corrupted | Log error, start fresh |
| Save state fails | Log error, don't prevent close |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.5h | 1 day |

---

## v0.3.5 Complete Summary

| Part | Description | Effort |
|------|-------------|--------|
| v0.3.5a | Workspace Settings ViewModel | 0.5 day |
| v0.3.5b | Workspace Settings Panel UI | 0.5 day |
| v0.3.5c | Quick Open Dialog | 1 day |
| v0.3.5d | Enhanced Status Bar | 0.75 day |
| v0.3.5e | Recent Workspaces | 0.75 day |
| v0.3.5f | Global Drag-Drop | 0.5 day |
| v0.3.5g | Keyboard Shortcuts Manager | 0.75 day |
| v0.3.5h | Startup & Integration | 1 day |
| **Total** | | **5.75 days** |
