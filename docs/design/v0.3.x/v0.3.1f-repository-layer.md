# Design Specification: The Senior Intern v0.3.1f "Repository Layer"

## Executive Summary

This document provides a detailed implementation specification for v0.3.1f, which implements the workspace repository for database persistence. This layer handles CRUD operations for recent workspaces, pinning/renaming, and enforces maximum recent workspace limits.

### v0.3.1f Scope (from v0.3.1 Design Document)

- Create `IWorkspaceRepository` interface
- Implement `WorkspaceRepository` with EF Core
- Implement recent workspaces retrieval (sorted by pinned, then access time)
- Implement add/update with upsert pattern
- Implement max recent enforcement (20 workspaces)
- Update DbContext with new DbSets
- Update AppSettings with workspace/editor settings

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| IWorkspaceRepository | Interface for workspace persistence |
| WorkspaceRepository | EF Core implementation |
| DbContext Updates | DbSets for new entities |
| AppSettings Updates | Workspace and editor settings |
| Service Registration | DI container registration |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.3.1f Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  IWorkspaceRepository                                             â”‚
â”‚  â”œâ”€â”€ Query Methods                                                â”‚
â”‚  â”‚   â”œâ”€â”€ GetRecentAsync(count)                                   â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Order by IsPinned DESC                              â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Then by LastAccessedAt DESC                         â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Take(count)                                         â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ GetByPathAsync(rootPath)                                â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Normalize path before comparison                    â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â””â”€â”€ GetByIdAsync(id)                                        â”‚
â”‚  â”‚       â””â”€â”€ FindAsync with primary key                          â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Mutation Methods                                             â”‚
â”‚  â”‚   â”œâ”€â”€ AddOrUpdateAsync(workspace)                             â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Check if exists by RootPath                         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Update existing OR add new                          â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ SaveChangesAsync                                    â”‚
â”‚  â”‚   â”‚   â””â”€â”€ EnforceMaxRecentAsync()                             â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ RemoveAsync(id)                                         â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Find and delete entity                              â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ ClearAllAsync()                                         â”‚
â”‚  â”‚   â”‚   â””â”€â”€ ExecuteDeleteAsync (bulk)                           â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â”œâ”€â”€ SetPinnedAsync(id, isPinned)                            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ ExecuteUpdateAsync (single property)                â”‚
â”‚  â”‚   â”‚                                                            â”‚
â”‚  â”‚   â””â”€â”€ RenameAsync(id, newName)                                â”‚
â”‚  â”‚       â””â”€â”€ ExecuteUpdateAsync (single property)                â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Internal Methods                                             â”‚
â”‚      â””â”€â”€ EnforceMaxRecentAsync()                                  â”‚
â”‚          â”œâ”€â”€ Max = 20 workspaces                                 â”‚
â”‚          â”œâ”€â”€ Skip pinned workspaces                              â”‚
â”‚          â””â”€â”€ Delete oldest non-pinned if over limit              â”‚
â”‚                                                                   â”‚
â”‚  AppSettings Extensions                                           â”‚
â”‚  â”œâ”€â”€ RestoreLastWorkspace (bool, default: true)                  â”‚
â”‚  â”œâ”€â”€ ShowHiddenFiles (bool, default: false)                      â”‚
â”‚  â”œâ”€â”€ UseGitIgnore (bool, default: true)                          â”‚
â”‚  â”œâ”€â”€ MaxRecentWorkspaces (int, default: 10)                      â”‚
â”‚  â”œâ”€â”€ CustomIgnorePatterns (IReadOnlyList<string>)                â”‚
â”‚  â”œâ”€â”€ WordWrap (bool, default: false)                             â”‚
â”‚  â”œâ”€â”€ TabSize (int, default: 4)                                   â”‚
â”‚  â”œâ”€â”€ ShowLineNumbers (bool, default: true)                       â”‚
â”‚  â”œâ”€â”€ HighlightCurrentLine (bool, default: true)                  â”‚
â”‚  â”œâ”€â”€ EditorFontFamily (string)                                   â”‚
â”‚  â””â”€â”€ EditorFontSize (int, default: 14)                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Repository Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Repository Pattern                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  WorkspaceService                                                â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”‚ Uses interface                                           â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              IWorkspaceRepository                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ GetRecentAsync(count)                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ GetByPathAsync(rootPath)                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ GetByIdAsync(id)                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ AddOrUpdateAsync(workspace)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ RemoveAsync(id)                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ClearAllAsync()                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ SetPinnedAsync(id, isPinned)                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ RenameAsync(id, newName)                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”‚ Implemented by                                           â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              WorkspaceRepository                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ _dbContext: SeniorInternDbContext                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Upsert pattern for AddOrUpdateAsync               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ExecuteUpdateAsync for single-property updates    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ExecuteDeleteAsync for bulk deletes               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Automatic max-recent enforcement                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Path normalization for lookups                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              SeniorInternDbContext                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ DbSet<RecentWorkspaceEntity> RecentWorkspaces       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ DbSet<FileContextEntity> FileContextHistory         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                                          â”‚
â”‚       â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              SQLite Database                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ RecentWorkspaces table                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ FileContextHistory table                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Upsert Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AddOrUpdateAsync Flow                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Input: Workspace { RootPath: "/project", OpenFiles: [...] }     â”‚
â”‚                     â”‚                                            â”‚
â”‚                     â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Query: SELECT * FROM RecentWorkspaces                   â”‚  â”‚
â”‚  â”‚           WHERE RootPath = '/project'                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                  â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚               â”‚                               â”‚                  â”‚
â”‚               â–¼                               â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Found: existing entity â”‚     â”‚ Not Found: new workspace   â”‚   â”‚
â”‚  â”‚                        â”‚     â”‚                            â”‚   â”‚
â”‚  â”‚ 2a. Update properties: â”‚     â”‚ 2b. Create entity:         â”‚   â”‚
â”‚  â”‚    â€¢ Name              â”‚     â”‚   FromWorkspace(workspace) â”‚   â”‚
â”‚  â”‚    â€¢ LastAccessedAt    â”‚     â”‚                            â”‚   â”‚
â”‚  â”‚    â€¢ OpenFilesJson     â”‚     â”‚ 3b. _dbContext.Add(entity) â”‚   â”‚
â”‚  â”‚    â€¢ ActiveFilePath    â”‚     â”‚                            â”‚   â”‚
â”‚  â”‚    â€¢ ExpandedFoldersJsonâ”‚    â”‚                            â”‚   â”‚
â”‚  â”‚    â€¢ IsPinned          â”‚     â”‚                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                               â”‚                  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. await _dbContext.SaveChangesAsync()                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. await EnforceMaxRecentAsync()                           â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚    IF COUNT(*) > 20:                                        â”‚  â”‚
â”‚  â”‚      DELETE oldest non-pinned workspaces                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GetRecentAsync Ordering

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GetRecentAsync Ordering                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Database records (unsorted):                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ID   | Name        | LastAccessed  | IsPinned            â”‚    â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚
â”‚  â”‚ 1    | project-a   | 2025-01-08    | false               â”‚    â”‚
â”‚  â”‚ 2    | project-b   | 2025-01-10    | false               â”‚    â”‚
â”‚  â”‚ 3    | my-lib      | 2025-01-05    | true  ğŸ“Œ            â”‚    â”‚
â”‚  â”‚ 4    | demo        | 2025-01-09    | false               â”‚    â”‚
â”‚  â”‚ 5    | important   | 2025-01-01    | true  ğŸ“Œ            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  ORDER BY IsPinned DESC, LastAccessedAt DESC                     â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Result (sorted):                                          â”‚    â”‚
â”‚  â”‚                                                           â”‚    â”‚
â”‚  â”‚ 1. my-lib      ğŸ“Œ (2025-01-05) - pinned, newer           â”‚    â”‚
â”‚  â”‚ 2. important   ğŸ“Œ (2025-01-01) - pinned, older           â”‚    â”‚
â”‚  â”‚ 3. project-b      (2025-01-10) - not pinned, newest      â”‚    â”‚
â”‚  â”‚ 4. demo           (2025-01-09) - not pinned              â”‚    â”‚
â”‚  â”‚ 5. project-a      (2025-01-08) - not pinned, oldest      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  UI Display:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ Recent Workspaces                  â”‚                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚  â”‚ ğŸ“Œ my-lib                          â”‚  â† Pinned section       â”‚
â”‚  â”‚ ğŸ“Œ important                       â”‚                          â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                          â”‚
â”‚  â”‚    project-b                       â”‚  â† Recent section       â”‚
â”‚  â”‚    demo                            â”‚                          â”‚
â”‚  â”‚    project-a                       â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Data/
â””â”€â”€ Repositories/
    â”œâ”€â”€ IWorkspaceRepository.cs                       (NEW)
    â””â”€â”€ WorkspaceRepository.cs                        (NEW)

src/SeniorIntern.Data/
â””â”€â”€ SeniorInternDbContext.cs                          (MODIFY)

src/SeniorIntern.Core/
â””â”€â”€ Models/
    â””â”€â”€ AppSettings.cs                                (MODIFY)

src/SeniorIntern.Desktop/
â””â”€â”€ Extensions/
    â””â”€â”€ ServiceCollectionExtensions.cs                (MODIFY)
```

---

## Implementation Details

### Task 1: Create IWorkspaceRepository Interface

**File:** `src/SeniorIntern.Data/Repositories/IWorkspaceRepository.cs`

```csharp
namespace SeniorIntern.Data.Repositories;

using SeniorIntern.Core.Models;

/// <summary>
/// Repository for workspace persistence operations.
/// </summary>
public interface IWorkspaceRepository
{
    /// <summary>
    /// Gets recent workspaces ordered by pinned status then last accessed time.
    /// </summary>
    /// <param name="count">Maximum number to return (default: 10).</param>
    /// <param name="cancellationToken">Cancellation token.</param>
    /// <returns>List of workspaces, pinned first, then by most recent.</returns>
    Task<IReadOnlyList<Workspace>> GetRecentAsync(
        int count = 10,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Gets a workspace by its root path.
    /// </summary>
    /// <param name="rootPath">Absolute path to workspace root.</param>
    /// <param name="cancellationToken">Cancellation token.</param>
    /// <returns>Workspace if found, null otherwise.</returns>
    Task<Workspace?> GetByPathAsync(
        string rootPath,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Gets a workspace by its unique ID.
    /// </summary>
    Task<Workspace?> GetByIdAsync(
        Guid id,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Adds a new workspace or updates an existing one (by RootPath).
    /// Automatically enforces maximum recent workspace limit.
    /// </summary>
    Task AddOrUpdateAsync(
        Workspace workspace,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Removes a workspace from the database.
    /// </summary>
    Task RemoveAsync(
        Guid id,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Clears all workspaces from the database.
    /// </summary>
    Task ClearAllAsync(CancellationToken cancellationToken = default);

    /// <summary>
    /// Sets the pinned status of a workspace.
    /// </summary>
    Task SetPinnedAsync(
        Guid id,
        bool isPinned,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Renames a workspace (sets custom name).
    /// </summary>
    Task RenameAsync(
        Guid id,
        string newName,
        CancellationToken cancellationToken = default);
}
```

---

### Task 2: Create WorkspaceRepository Implementation

**File:** `src/SeniorIntern.Data/Repositories/WorkspaceRepository.cs`

```csharp
namespace SeniorIntern.Data.Repositories;

using Microsoft.EntityFrameworkCore;
using SeniorIntern.Core.Entities;
using SeniorIntern.Core.Models;
using System.Text.Json;

public sealed class WorkspaceRepository : IWorkspaceRepository
{
    private const int MaxRecentWorkspaces = 20;

    private readonly SeniorInternDbContext _dbContext;

    public WorkspaceRepository(SeniorInternDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    public async Task<IReadOnlyList<Workspace>> GetRecentAsync(
        int count = 10,
        CancellationToken cancellationToken = default)
    {
        var entities = await _dbContext.RecentWorkspaces
            .OrderByDescending(w => w.IsPinned)
            .ThenByDescending(w => w.LastAccessedAt)
            .Take(count)
            .ToListAsync(cancellationToken);

        return entities.Select(e => e.ToWorkspace()).ToList();
    }

    public async Task<Workspace?> GetByPathAsync(
        string rootPath,
        CancellationToken cancellationToken = default)
    {
        // Normalize path for comparison
        rootPath = Path.GetFullPath(rootPath);

        var entity = await _dbContext.RecentWorkspaces
            .FirstOrDefaultAsync(w => w.RootPath == rootPath, cancellationToken);

        return entity?.ToWorkspace();
    }

    public async Task<Workspace?> GetByIdAsync(
        Guid id,
        CancellationToken cancellationToken = default)
    {
        var entity = await _dbContext.RecentWorkspaces
            .FindAsync([id], cancellationToken);

        return entity?.ToWorkspace();
    }

    public async Task AddOrUpdateAsync(
        Workspace workspace,
        CancellationToken cancellationToken = default)
    {
        var normalizedPath = Path.GetFullPath(workspace.RootPath);

        var existing = await _dbContext.RecentWorkspaces
            .FirstOrDefaultAsync(w => w.RootPath == normalizedPath, cancellationToken);

        if (existing != null)
        {
            // Update existing entity
            existing.Name = string.IsNullOrWhiteSpace(workspace.Name) ? null : workspace.Name;
            existing.LastAccessedAt = workspace.LastAccessedAt;
            existing.OpenFilesJson = SerializeList(workspace.OpenFiles);
            existing.ActiveFilePath = workspace.ActiveFilePath;
            existing.ExpandedFoldersJson = SerializeList(workspace.ExpandedFolders);
            existing.IsPinned = workspace.IsPinned;
        }
        else
        {
            // Add new entity
            var entity = RecentWorkspaceEntity.FromWorkspace(workspace);
            _dbContext.RecentWorkspaces.Add(entity);
        }

        await _dbContext.SaveChangesAsync(cancellationToken);

        // Enforce max recent workspaces limit
        await EnforceMaxRecentAsync(cancellationToken);
    }

    public async Task RemoveAsync(
        Guid id,
        CancellationToken cancellationToken = default)
    {
        var entity = await _dbContext.RecentWorkspaces
            .FindAsync([id], cancellationToken);

        if (entity != null)
        {
            _dbContext.RecentWorkspaces.Remove(entity);
            await _dbContext.SaveChangesAsync(cancellationToken);
        }
    }

    public async Task ClearAllAsync(CancellationToken cancellationToken = default)
    {
        await _dbContext.RecentWorkspaces.ExecuteDeleteAsync(cancellationToken);
    }

    public async Task SetPinnedAsync(
        Guid id,
        bool isPinned,
        CancellationToken cancellationToken = default)
    {
        await _dbContext.RecentWorkspaces
            .Where(w => w.Id == id)
            .ExecuteUpdateAsync(
                setters => setters.SetProperty(w => w.IsPinned, isPinned),
                cancellationToken);
    }

    public async Task RenameAsync(
        Guid id,
        string newName,
        CancellationToken cancellationToken = default)
    {
        var name = string.IsNullOrWhiteSpace(newName) ? null : newName;

        await _dbContext.RecentWorkspaces
            .Where(w => w.Id == id)
            .ExecuteUpdateAsync(
                setters => setters.SetProperty(w => w.Name, name),
                cancellationToken);
    }

    /// <summary>
    /// Enforces the maximum number of recent workspaces.
    /// Removes oldest non-pinned workspaces if over limit.
    /// </summary>
    private async Task EnforceMaxRecentAsync(CancellationToken cancellationToken)
    {
        var count = await _dbContext.RecentWorkspaces.CountAsync(cancellationToken);

        if (count <= MaxRecentWorkspaces)
            return;

        // Get IDs of oldest non-pinned workspaces to remove
        var toRemove = await _dbContext.RecentWorkspaces
            .Where(w => !w.IsPinned)
            .OrderBy(w => w.LastAccessedAt)
            .Take(count - MaxRecentWorkspaces)
            .Select(w => w.Id)
            .ToListAsync(cancellationToken);

        if (toRemove.Count > 0)
        {
            await _dbContext.RecentWorkspaces
                .Where(w => toRemove.Contains(w.Id))
                .ExecuteDeleteAsync(cancellationToken);
        }
    }

    private static string? SerializeList(IReadOnlyList<string> list)
    {
        if (list.Count == 0) return null;
        return JsonSerializer.Serialize(list);
    }
}
```

---

### Task 3: Update DbContext

**File:** `src/SeniorIntern.Data/SeniorInternDbContext.cs` (additions)

```csharp
// Add to SeniorInternDbContext class

using SeniorIntern.Core.Entities;
using SeniorIntern.Data.Configurations;

public partial class SeniorInternDbContext
{
    // Workspace entities (v0.3.0)
    public DbSet<RecentWorkspaceEntity> RecentWorkspaces => Set<RecentWorkspaceEntity>();
    public DbSet<FileContextEntity> FileContextHistory => Set<FileContextEntity>();

    // In OnModelCreating, add:
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);
        
        // ... existing configurations ...
        
        // Workspace configurations (v0.3.0)
        modelBuilder.ApplyConfiguration(new RecentWorkspaceConfiguration());
        modelBuilder.ApplyConfiguration(new FileContextConfiguration());
    }
}
```

---

### Task 4: Update AppSettings

**File:** `src/SeniorIntern.Core/Models/AppSettings.cs` (additions)

```csharp
namespace SeniorIntern.Core.Models;

public sealed class AppSettings
{
    // ... existing properties from v0.2.x ...

    #region Workspace Settings (v0.3.0)

    /// <summary>
    /// Whether to restore the last opened workspace on application startup.
    /// </summary>
    public bool RestoreLastWorkspace { get; set; } = true;

    /// <summary>
    /// Whether to show hidden files in the file explorer.
    /// </summary>
    public bool ShowHiddenFiles { get; set; } = false;

    /// <summary>
    /// Whether to respect .gitignore patterns when displaying files.
    /// </summary>
    public bool UseGitIgnore { get; set; } = true;

    /// <summary>
    /// Maximum number of recent workspaces to display.
    /// </summary>
    public int MaxRecentWorkspaces { get; set; } = 10;

    /// <summary>
    /// Custom ignore patterns (in addition to .gitignore).
    /// </summary>
    public IReadOnlyList<string> CustomIgnorePatterns { get; set; } = [];

    #endregion

    #region Editor Settings (v0.3.0)

    /// <summary>
    /// Whether to enable word wrap in the code editor.
    /// </summary>
    public bool WordWrap { get; set; } = false;

    /// <summary>
    /// Tab size in spaces.
    /// </summary>
    public int TabSize { get; set; } = 4;

    /// <summary>
    /// Whether to show line numbers in the code editor.
    /// </summary>
    public bool ShowLineNumbers { get; set; } = true;

    /// <summary>
    /// Whether to highlight the current line.
    /// </summary>
    public bool HighlightCurrentLine { get; set; } = true;

    /// <summary>
    /// Font family for the code editor.
    /// </summary>
    public string EditorFontFamily { get; set; } = "Cascadia Code, Consolas, monospace";

    /// <summary>
    /// Font size for the code editor.
    /// </summary>
    public int EditorFontSize { get; set; } = 14;

    #endregion
}
```

---

### Task 5: Update Service Registration

**File:** `src/SeniorIntern.Desktop/Extensions/ServiceCollectionExtensions.cs` (additions)

```csharp
// Add to RegisterServices method

using SeniorIntern.Core.Interfaces;
using SeniorIntern.Data.Repositories;
using SeniorIntern.Services;

public static IServiceCollection RegisterWorkspaceServices(this IServiceCollection services)
{
    // Repositories
    services.AddScoped<IWorkspaceRepository, WorkspaceRepository>();

    // Services
    services.AddSingleton<IFileSystemService, FileSystemService>();
    services.AddSingleton<IWorkspaceService, WorkspaceService>();

    return services;
}
```

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| GetRecentAsync | 3 | Ordering, count limit |
| GetByPathAsync | 2 | Found, not found, normalization |
| AddOrUpdateAsync | 4 | New, update, max enforcement |
| RemoveAsync | 2 | Exists, not exists |
| ClearAllAsync | 1 | Bulk delete |
| SetPinnedAsync | 2 | Pin, unpin |
| RenameAsync | 2 | Set name, clear name |
| EnforceMaxRecentAsync | 2 | Under limit, over limit |
| **Total** | **18** | |

### Key Test Scenarios

```csharp
// GetRecentAsync Tests
[Fact]
public async Task GetRecentAsync_OrdersByPinnedThenLastAccessed()
{
    // Arrange
    await _repository.AddOrUpdateAsync(new Workspace { RootPath = "/old", IsPinned = false });
    await _repository.AddOrUpdateAsync(new Workspace { RootPath = "/new", IsPinned = false });
    await _repository.AddOrUpdateAsync(new Workspace { RootPath = "/pinned", IsPinned = true });

    // Act
    var result = await _repository.GetRecentAsync(10);

    // Assert
    Assert.Equal("/pinned", result[0].RootPath);
    Assert.Equal("/new", result[1].RootPath);
    Assert.Equal("/old", result[2].RootPath);
}

[Fact]
public async Task GetRecentAsync_RespectsCountLimit()
{
    // Add 5 workspaces
    for (int i = 0; i < 5; i++)
        await _repository.AddOrUpdateAsync(new Workspace { RootPath = $"/project{i}" });

    var result = await _repository.GetRecentAsync(3);

    Assert.Equal(3, result.Count);
}

// GetByPathAsync Tests
[Fact]
public async Task GetByPathAsync_NormalizesPath()
{
    await _repository.AddOrUpdateAsync(new Workspace { RootPath = "/home/user/project" });

    // Query with different formatting
    var result = await _repository.GetByPathAsync("/home/user/project/");

    Assert.NotNull(result);
}

// AddOrUpdateAsync Tests
[Fact]
public async Task AddOrUpdateAsync_UpdatesExistingByPath()
{
    var workspace = new Workspace { RootPath = "/project", Name = "Original" };
    await _repository.AddOrUpdateAsync(workspace);

    workspace.Name = "Updated";
    await _repository.AddOrUpdateAsync(workspace);

    var result = await _repository.GetByPathAsync("/project");
    Assert.Equal("Updated", result?.Name);

    var count = await _dbContext.RecentWorkspaces.CountAsync();
    Assert.Equal(1, count); // Only one entry
}

[Fact]
public async Task AddOrUpdateAsync_EnforcesMaxLimit()
{
    // Add 25 workspaces
    for (int i = 0; i < 25; i++)
    {
        await _repository.AddOrUpdateAsync(new Workspace { RootPath = $"/project{i}" });
    }

    var count = await _dbContext.RecentWorkspaces.CountAsync();
    Assert.Equal(20, count); // Max limit
}

[Fact]
public async Task AddOrUpdateAsync_PreservesPinnedWhenEnforcing()
{
    // Add pinned workspace
    await _repository.AddOrUpdateAsync(new Workspace { RootPath = "/pinned", IsPinned = true });

    // Add 25 more non-pinned
    for (int i = 0; i < 25; i++)
    {
        await _repository.AddOrUpdateAsync(new Workspace { RootPath = $"/project{i}" });
    }

    var pinned = await _repository.GetByPathAsync("/pinned");
    Assert.NotNull(pinned); // Pinned preserved
}

// SetPinnedAsync / RenameAsync Tests
[Fact]
public async Task SetPinnedAsync_UpdatesOnlyPinnedProperty()
{
    var workspace = new Workspace { RootPath = "/project", Name = "Test" };
    await _repository.AddOrUpdateAsync(workspace);

    await _repository.SetPinnedAsync(workspace.Id, true);

    var result = await _repository.GetByIdAsync(workspace.Id);
    Assert.True(result?.IsPinned);
    Assert.Equal("Test", result?.Name); // Other props unchanged
}

[Fact]
public async Task RenameAsync_ClearsNameWhenEmpty()
{
    var workspace = new Workspace { RootPath = "/project", Name = "Custom" };
    await _repository.AddOrUpdateAsync(workspace);

    await _repository.RenameAsync(workspace.Id, "");

    var result = await _repository.GetByIdAsync(workspace.Id);
    Assert.True(string.IsNullOrEmpty(result?.Name));
}
```

---

## Files Summary

### Files to Create (2)

| File | Lines (approx) |
|------|----------------|
| `Repositories/IWorkspaceRepository.cs` | 50 |
| `Repositories/WorkspaceRepository.cs` | 130 |

### Files to Modify (3)

| File | Changes |
|------|---------|
| `SeniorInternDbContext.cs` | Add DbSets, apply configurations |
| `AppSettings.cs` | Add workspace/editor settings |
| `ServiceCollectionExtensions.cs` | Register new services |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | GetRecentAsync sorts by pinned then access time |
| AC-2 | GetByPathAsync normalizes paths before comparison |
| AC-3 | AddOrUpdateAsync uses upsert pattern by path |
| AC-4 | AddOrUpdateAsync enforces 20 workspace limit |
| AC-5 | EnforceMaxRecentAsync preserves pinned workspaces |
| AC-6 | SetPinnedAsync uses ExecuteUpdateAsync |
| AC-7 | RenameAsync clears name when empty string |
| AC-8 | ClearAllAsync uses bulk delete |
| AC-9 | DbContext has both new DbSets |
| AC-10 | AppSettings has all workspace/editor properties |

---

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| Max 20 workspaces | Balance between history and storage |
| Preserve pinned on cleanup | User intent for important projects |
| ExecuteUpdateAsync | Efficient single-property updates |
| Path normalization | Cross-platform path consistency |
| JSON for list properties | Simple storage without join tables |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.1a | Workspace model |
| v0.3.1b | RecentWorkspaceEntity |
| v0.3.1e | WorkspaceService uses this repository |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.1f | 0.5 day |
