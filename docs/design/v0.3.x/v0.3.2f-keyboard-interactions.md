# Design Specification: The Senior Intern v0.3.2f "Keyboard & Interactions"

## Executive Summary

This document provides a detailed specification for v0.3.2f, which documents and formalizes all keyboard shortcuts, interaction patterns, and user flows for the file explorer. While the implementation is in `FileExplorerView.axaml.cs` (created in v0.3.2d), this document provides comprehensive documentation for keyboard shortcuts, inline rename flow, delete confirmation, and focus management.

### v0.3.2f Scope

- Document all keyboard shortcuts with contexts
- Define inline rename flow with validation
- Define delete confirmation behavior
- Define double-click and navigation behaviors
- Document focus management patterns

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| Keyboard Shortcut Reference | Complete shortcut documentation |
| Rename Flow | Start → Edit → Commit/Cancel |
| Delete Flow | Confirm dialog with warnings |
| Navigation Patterns | Arrow keys, expand/collapse |

**Note:** No new files are created in v0.3.2f. All implementation is in `FileExplorerView.axaml.cs` from v0.3.2d.

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.3.2f Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  Keyboard Shortcuts                                               │
│  ├── Navigation                                                  │
│  │   ├── Up Arrow        → Select previous item                 │
│  │   ├── Down Arrow      → Select next item                     │
│  │   ├── Right Arrow     → Expand folder                        │
│  │   ├── Left Arrow      → Collapse folder                      │
│  │   ├── Home            → Select first item                    │
│  │   └── End             → Select last item                     │
│  │                                                                │
│  ├── Actions                                                     │
│  │   ├── Enter           → Open file / Toggle folder            │
│  │   ├── F2              → Start rename                         │
│  │   ├── Delete          → Delete with confirmation             │
│  │   └── Escape          → Cancel rename / Clear filter         │
│  │                                                                │
│  ├── File Operations                                             │
│  │   ├── Ctrl+N          → New file in current folder           │
│  │   ├── Ctrl+Shift+N    → New folder in current folder         │
│  │   └── Ctrl+R          → Refresh tree                         │
│  │                                                                │
│  └── Clipboard                                                   │
│      ├── Ctrl+C          → Copy absolute path                   │
│      └── Ctrl+Shift+C    → Copy relative path                   │
│                                                                   │
│  Mouse Interactions                                               │
│  ├── Single Click        → Select item                          │
│  ├── Double Click (file) → Open in editor                       │
│  ├── Double Click (folder) → Toggle expand/collapse             │
│  └── Right Click         → Show context menu                    │
│                                                                   │
│  Inline Rename Flow                                               │
│  ├── Trigger: F2 or context menu                                │
│  ├── Enter rename mode: TextBox appears                         │
│  ├── Edit name with validation                                  │
│  ├── Commit: Enter or focus loss                                │
│  └── Cancel: Escape                                             │
│                                                                   │
│  Delete Confirmation                                              │
│  ├── Trigger: Delete key or context menu                        │
│  ├── Show ContentDialog with warning                            │
│  ├── Different message for files vs folders                     │
│  └── Default button: Cancel (safety)                            │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Keyboard Shortcut Reference

### Complete Shortcut Table

| Shortcut | Action | Context | Notes |
|----------|--------|---------|-------|
| `↑` (Up) | Select previous | TreeView focused | Built-in TreeView |
| `↓` (Down) | Select next | TreeView focused | Built-in TreeView |
| `→` (Right) | Expand folder | Folder selected | Custom handler |
| `←` (Left) | Collapse folder | Folder selected | Custom handler |
| `Home` | Select first | TreeView focused | Built-in TreeView |
| `End` | Select last | TreeView focused | Built-in TreeView |
| `Enter` | Open/Toggle | Item selected | File→Open, Folder→Toggle |
| `F2` | Start rename | Item selected | Enters inline edit mode |
| `Delete` | Delete item | Item selected | Shows confirmation |
| `Escape` | Cancel | Rename mode or filter | Cancel rename / clear filter |
| `Ctrl+C` | Copy path | Item selected | Absolute path to clipboard |
| `Ctrl+Shift+C` | Copy relative | Item selected | Relative path to clipboard |
| `Ctrl+N` | New file | Any | Creates in selected/root folder |
| `Ctrl+Shift+N` | New folder | Any | Creates in selected/root folder |
| `Ctrl+R` | Refresh | Any | Reloads entire tree |

### Shortcut Priority

When multiple shortcuts could apply:

```
1. Rename TextBox (highest priority)
   - Enter → Commit rename
   - Escape → Cancel rename
   - Other keys → Edit text

2. TreeView focused
   - F2 → Start rename
   - Delete → Delete item
   - Ctrl+C → Copy path
   - Ctrl+N → New file
   - etc.

3. Filter TextBox focused
   - Escape → Clear filter and return focus to tree
   - Other keys → Edit filter text
```

---

## Interaction Flows

### Inline Rename Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Inline Rename Flow                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌───────────────────┐                                           │
│  │ User presses F2   │  (or right-click → Rename)               │
│  │ on selected item  │                                           │
│  └─────────┬─────────┘                                           │
│            │                                                     │
│            ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ item.BeginRename()                                      │     │
│  │                                                          │     │
│  │ • EditingName = Name                                    │     │
│  │ • IsRenaming = true                                     │     │
│  └─────────────────────────────────────────────────────────┘     │
│            │                                                     │
│            ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ UI switches to TextBox                                  │     │
│  │                                                          │     │
│  │ ┌────────────────────────────────────────────────┐      │     │
│  │ │ [myfile.ts                              ] ▮    │      │     │
│  │ └────────────────────────────────────────────────┘      │     │
│  │                                                          │     │
│  │ • TextBox gets focus                                    │     │
│  │ • Text is selected (SelectAll)                         │     │
│  └─────────────────────────────────────────────────────────┘     │
│            │                                                     │
│     ┌──────┴──────┬──────────────┐                              │
│     ▼             ▼              ▼                              │
│ [Enter]       [Escape]       [LostFocus]                        │
│     │             │              │                              │
│     ▼             ▼              ▼                              │
│ ┌─────────┐  ┌─────────────┐  ┌────────────────────────────┐    │
│ │ Commit  │  │ Cancel      │  │ Commit (auto-save)        │    │
│ │ Rename  │  │ Rename      │  │                            │    │
│ └────┬────┘  └──────┬──────┘  └────────────┬───────────────┘    │
│      │              │                       │                    │
│      ▼              ▼                       ▼                    │
│ ┌──────────────────────────────────────────────────────────┐    │
│ │ CommitRenameAsync()                  CancelRename()      │    │
│ │                                                           │    │
│ │ Validate:                            Revert:             │    │
│ │ • Not empty                          • EditingName = Name│    │
│ │ • Different from original            • IsRenaming = false│    │
│ │ • No invalid characters              • UI → TextBlock   │    │
│ │                                                           │    │
│ │ If valid:                                                 │    │
│ │ • FileSystemService.RenameAsync()                        │    │
│ │ • Update Name & Path                                     │    │
│ │ • IsRenaming = false                                     │    │
│ │ • UI → TextBlock                                         │    │
│ └──────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Name Validation Rules

```
┌─────────────────────────────────────────────────────────────────┐
│                    Name Validation Rules                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ✅ Valid names:                                                 │
│  • "MyComponent.tsx"                                            │
│  • "file-with-dashes.cs"                                        │
│  • "file_with_underscores.py"                                   │
│  • "File.Name.With.Dots.js"                                     │
│  • ".gitignore" (hidden files)                                  │
│  • "README" (no extension)                                      │
│                                                                  │
│  ❌ Invalid (rejected):                                          │
│  • "" (empty)                                                   │
│  • "   " (whitespace only)                                      │
│  • "file/name.txt" (contains /)                                 │
│  • "file\name.txt" (contains \)                                 │
│  • "file:name.txt" (contains :) [Windows]                       │
│  • "file*name.txt" (contains *)                                 │
│  • "file?name.txt" (contains ?)                                 │
│  • "file<name.txt" (contains <)                                 │
│  • "file>name.txt" (contains >)                                 │
│  • "file|name.txt" (contains |)                                 │
│  • 'file"name.txt' (contains ")                                 │
│                                                                  │
│  Invalid characters checked via:                                 │
│  Path.GetInvalidFileNameChars()                                 │
│                                                                  │
│  ⚠️ Shows error but doesn't cancel rename (user can correct):   │
│  • Invalid characters found                                     │
│                                                                  │
│  ✓ Silently cancels (no error shown):                           │
│  • Empty after trim                                             │
│  • Same as original name                                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Delete Confirmation Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Delete Confirmation Flow                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  User presses Delete (or context menu → Delete)                  │
│            │                                                     │
│            ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ ConfirmAndDeleteAsync(item)                             │     │
│  └─────────────────────────────────────────────────────────┘     │
│            │                                                     │
│     ┌──────┴──────┐                                             │
│     ▼             ▼                                             │
│  [File]       [Folder]                                           │
│     │             │                                              │
│     ▼             ▼                                              │
│ ┌─────────────────────────────────────────────────────────┐     │
│ │ ContentDialog                                           │     │
│ │ ┌─────────────────────────────────────────────────────┐ │     │
│ │ │ Title: "Delete file" / "Delete folder"              │ │     │
│ │ ├─────────────────────────────────────────────────────┤ │     │
│ │ │                                                     │ │     │
│ │ │  FILE:                                              │ │     │
│ │ │  "Delete 'MyComponent.tsx'?"                        │ │     │
│ │ │                                                     │ │     │
│ │ │  FOLDER:                                            │ │     │
│ │ │  "Delete 'components' and all its contents?"        │ │     │
│ │ │                                                     │ │     │
│ │ ├─────────────────────────────────────────────────────┤ │     │
│ │ │  [Delete]                      [Cancel] (default)   │ │     │
│ │ └─────────────────────────────────────────────────────┘ │     │
│ └─────────────────────────────────────────────────────────┘     │
│            │                                                     │
│     ┌──────┴──────┐                                             │
│     ▼             ▼                                             │
│  [Delete]     [Cancel]                                           │
│     │             │                                              │
│     ▼             ▼                                              │
│ ┌───────────┐ ┌───────────┐                                     │
│ │ Delete    │ │ Do        │                                     │
│ │ item      │ │ nothing   │                                     │
│ └───────────┘ └───────────┘                                     │
│     │                                                            │
│     ▼                                                            │
│ FileSystemService.DeleteFileAsync() / DeleteDirectoryAsync()    │
│     │                                                            │
│     ▼                                                            │
│ RemoveItemFromTree(item)                                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Double-Click Behavior

```
┌─────────────────────────────────────────────────────────────────┐
│                    Double-Click Behavior                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  User double-clicks on tree item                                 │
│            │                                                     │
│            ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ OnTreeViewDoubleTapped()                                │     │
│  └─────────────────────────────────────────────────────────┘     │
│            │                                                     │
│     ┌──────┴──────┐                                             │
│     ▼             ▼                                             │
│  [File]       [Directory]                                        │
│     │             │                                              │
│     ▼             ▼                                              │
│ ┌───────────────────────┐  ┌─────────────────────────────────┐  │
│ │ OpenFileCommand       │  │ item.IsExpanded = !IsExpanded   │  │
│ │                       │  │                                 │  │
│ │ Raises event:         │  │ If expanding and not loaded:   │  │
│ │ FileOpenRequested     │  │   → LoadChildrenAsync()        │  │
│ │                       │  │                                 │  │
│ │ Editor opens file     │  │ Tree expands/collapses         │  │
│ └───────────────────────┘  └─────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Focus Management

### Focus States

```
┌─────────────────────────────────────────────────────────────────┐
│                    Focus Management                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Primary Focus Locations:                                        │
│  1. TreeView (most common)                                      │
│  2. Filter TextBox                                              │
│  3. Rename TextBox (within tree item)                           │
│                                                                  │
│  Focus Transitions:                                              │
│                                                                  │
│  ┌──────────────────┐                                           │
│  │ App starts or    │                                           │
│  │ workspace opens  │                                           │
│  └────────┬─────────┘                                           │
│           │                                                      │
│           ▼                                                      │
│  ┌──────────────────┐   Tab   ┌──────────────────┐              │
│  │                  │ ◄────►  │                  │              │
│  │    TreeView      │         │  Filter TextBox  │              │
│  │                  │         │                  │              │
│  └────────┬─────────┘         └──────────────────┘              │
│           │                                                      │
│           │ F2 (on selected item)                                │
│           ▼                                                      │
│  ┌──────────────────┐                                           │
│  │ Rename TextBox   │                                           │
│  │ (inline)         │                                           │
│  │                  │                                           │
│  │ Enter/Escape/    │                                           │
│  │ LostFocus        │                                           │
│  └────────┬─────────┘                                           │
│           │                                                      │
│           ▼                                                      │
│  ┌──────────────────┐                                           │
│  │ TreeView         │  (focus returns to tree)                  │
│  │ (same item       │                                           │
│  │  selected)       │                                           │
│  └──────────────────┘                                           │
│                                                                  │
│  Filter → TreeView:                                              │
│  • Escape clears filter and returns focus to tree               │
│  • Enter or debounce applies filter (focus stays)               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Implementation Notes

Since v0.3.2f has no additional files (implementation is in v0.3.2d), this section documents the key implementation patterns used.

### Keyboard Handler Pattern

```csharp
// OnTreeViewKeyDown in FileExplorerView.axaml.cs
private void OnTreeViewKeyDown(object? sender, KeyEventArgs e)
{
    if (ViewModel?.SelectedItem is not { } item) return;

    switch (e.Key)
    {
        case Key.Enter:
            if (item.IsFile) ViewModel.OpenFileCommand.Execute(item);
            else item.IsExpanded = !item.IsExpanded;
            e.Handled = true;
            break;

        case Key.F2:
            item.BeginRename();
            e.Handled = true;
            break;

        case Key.Delete:
            _ = ConfirmAndDeleteAsync(item);
            e.Handled = true;
            break;

        // Modifier combinations
        case Key.C when e.KeyModifiers.HasFlag(KeyModifiers.Control):
            if (e.KeyModifiers.HasFlag(KeyModifiers.Shift))
                ViewModel.CopyRelativePathCommand.Execute(item);
            else
                ViewModel.CopyPathCommand.Execute(item);
            e.Handled = true;
            break;

        // ... more shortcuts
    }
}
```

### Rename Handler Pattern

```csharp
// OnRenameKeyDown handles Enter/Escape in rename TextBox
private void OnRenameKeyDown(object? sender, KeyEventArgs e)
{
    if (sender is not TextBox { DataContext: FileTreeItemViewModel item }) return;

    if (e.Key == Key.Enter)
    {
        item.CommitRenameCommand.Execute(null);
        e.Handled = true;
    }
    else if (e.Key == Key.Escape)
    {
        item.CancelRenameCommand.Execute(null);
        e.Handled = true;
    }
}

// OnRenameLostFocus auto-commits when clicking away
private void OnRenameLostFocus(object? sender, RoutedEventArgs e)
{
    if (sender is TextBox { DataContext: FileTreeItemViewModel { IsRenaming: true } item })
        item.CommitRenameCommand.Execute(null);
}
```

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Enter opens files, toggles folders |
| AC-2 | F2 starts inline rename |
| AC-3 | Escape cancels rename, clears filter |
| AC-4 | Delete shows confirmation dialog |
| AC-5 | Right/Left arrows expand/collapse |
| AC-6 | Ctrl+C copies absolute path |
| AC-7 | Ctrl+Shift+C copies relative path |
| AC-8 | Ctrl+N creates new file |
| AC-9 | Ctrl+Shift+N creates new folder |
| AC-10 | Ctrl+R refreshes tree |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.2a | FileTreeItemViewModel (BeginRename, etc.) |
| v0.3.2b | FileExplorerViewModel (commands) |
| v0.3.2d | FileExplorerView.axaml.cs (implementation) |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.2f | 0 days (documentation only - implemented in v0.3.2d) |
