# Design Specification: The Senior Intern v0.3.2a "File Tree Item ViewModel"

## Executive Summary

This document provides a detailed implementation specification for v0.3.2a, which implements the ViewModel for individual items in the file explorer tree. Each file or folder is represented by a `FileTreeItemViewModel` that supports lazy loading, inline rename, expansion state, filtering, and icon resolution.

### v0.3.2a Scope (from v0.3.2 Design Document)

- Create `FileTreeItemViewModel` with CommunityToolkit.Mvvm
- Implement lazy loading for directory contents
- Implement inline rename support with validation
- Implement filter matching and visibility
- Implement icon key resolution based on type/extension
- Support expansion state tracking and persistence

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| FileTreeItemViewModel | ViewModel for single tree item |
| Lazy Loading | Load children only when expanded |
| Inline Rename | Edit name in place with validation |
| Filter Support | Match, highlight, auto-expand |
| Icon Resolution | Extension-based icon keys |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.3.2a Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  FileTreeItemViewModel                                            â”‚
â”‚  â”œâ”€â”€ Observable Properties                                        â”‚
â”‚  â”‚   â”œâ”€â”€ Name (string) - display name                            â”‚
â”‚  â”‚   â”œâ”€â”€ Path (string) - absolute path                           â”‚
â”‚  â”‚   â”œâ”€â”€ ItemType (FileSystemItemType)                           â”‚
â”‚  â”‚   â”œâ”€â”€ IsExpanded (bool) - folder expansion state              â”‚
â”‚  â”‚   â”œâ”€â”€ IsSelected (bool) - selection highlight                 â”‚
â”‚  â”‚   â”œâ”€â”€ IsLoading (bool) - loading spinner                      â”‚
â”‚  â”‚   â”œâ”€â”€ IsRenaming (bool) - inline edit mode                    â”‚
â”‚  â”‚   â”œâ”€â”€ EditingName (string) - name during edit                 â”‚
â”‚  â”‚   â”œâ”€â”€ IsModified (bool) - unsaved changes indicator           â”‚
â”‚  â”‚   â”œâ”€â”€ IsVisible (bool) - filter visibility                    â”‚
â”‚  â”‚   â”œâ”€â”€ IsHighlighted (bool) - filter match                     â”‚
â”‚  â”‚   â”œâ”€â”€ HasChildren (bool) - expander arrow                     â”‚
â”‚  â”‚   â””â”€â”€ Depth (int) - tree indentation level                    â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Computed Properties                                          â”‚
â”‚  â”‚   â”œâ”€â”€ IsDirectory â†’ ItemType == Directory                     â”‚
â”‚  â”‚   â”œâ”€â”€ IsFile â†’ ItemType == File                               â”‚
â”‚  â”‚   â”œâ”€â”€ Extension â†’ Path.GetExtension()                         â”‚
â”‚  â”‚   â”œâ”€â”€ Language â†’ LanguageDetector.DetectByFileName()          â”‚
â”‚  â”‚   â”œâ”€â”€ IconKey â†’ folder/folder-open/extension-based            â”‚
â”‚  â”‚   â”œâ”€â”€ ChildrenLoaded â†’ _childrenLoaded                        â”‚
â”‚  â”‚   â””â”€â”€ ShowExpander â†’ IsDirectory && HasChildren               â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Collections                                                  â”‚
â”‚  â”‚   â””â”€â”€ Children: ObservableCollection<FileTreeItemViewModel>   â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Lazy Loading                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ OnIsExpandedChanged()                                   â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Triggers LoadChildrenAsync() if not loaded          â”‚
â”‚  â”‚   â”œâ”€â”€ LoadChildrenAsync()                                     â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Calls parent.LoadChildrenForItemAsync()             â”‚
â”‚  â”‚   â””â”€â”€ RefreshChildrenAsync()                                  â”‚
â”‚  â”‚       â””â”€â”€ Forces reload on next expand                        â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Inline Rename                                                â”‚
â”‚  â”‚   â”œâ”€â”€ BeginRename()                                           â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Sets IsRenaming = true, EditingName = Name          â”‚
â”‚  â”‚   â”œâ”€â”€ CommitRenameAsync()                                     â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Validates name                                      â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ Checks for invalid characters                       â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Calls parent.RenameItemAsync()                      â”‚
â”‚  â”‚   â””â”€â”€ CancelRename()                                          â”‚
â”‚  â”‚       â””â”€â”€ Reverts EditingName, IsRenaming = false             â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Filtering                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ MatchesFilter(filter) â†’ bool                            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Name.Contains(filter, OrdinalIgnoreCase)            â”‚
â”‚  â”‚   â””â”€â”€ ApplyFilter(filter) â†’ bool (any match)                  â”‚
â”‚  â”‚       â”œâ”€â”€ Sets IsVisible based on match                       â”‚
â”‚  â”‚       â”œâ”€â”€ Sets IsHighlighted for self matches                 â”‚
â”‚  â”‚       â””â”€â”€ Auto-expands if children match                      â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Factory Method                                               â”‚
â”‚      â””â”€â”€ FromFileSystemItem(item, parent, depth)                 â”‚
â”‚          â””â”€â”€ Creates ViewModel from model                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Lazy Loading Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lazy Loading Flow                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User clicks expansion arrow on folder                           â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TreeView binding sets IsExpanded = true                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OnIsExpandedChanged(true) fires                            â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (value && !_childrenLoaded && IsDirectory)              â”‚  â”‚
â”‚  â”‚     _ = LoadChildrenAsync();                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LoadChildrenAsync()                                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 1. IsLoading = true  (shows spinner in UI)                 â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 2. await _parent.LoadChildrenForItemAsync(this)            â”‚  â”‚
â”‚  â”‚    â†“                                                        â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚    â”‚ FileExplorerViewModel                              â”‚  â”‚  â”‚
â”‚  â”‚    â”‚                                                    â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ _fileSystemService.GetDirectoryContentsAsync()  â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Filter by .gitignore patterns                   â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Filter by ShowHiddenFiles setting               â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Create FileTreeItemViewModel for each           â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Set Depth = parentDepth + 1                     â”‚  â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 3. Dispatcher.UIThread.InvokeAsync(() =>                   â”‚  â”‚
â”‚  â”‚        Children.Clear();                                   â”‚  â”‚
â”‚  â”‚        foreach (var child in children)                     â”‚  â”‚
â”‚  â”‚            Children.Add(child);                            â”‚  â”‚
â”‚  â”‚    );                                                       â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 4. _childrenLoaded = true                                  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 5. IsLoading = false  (hides spinner)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UI automatically updates via data binding                  â”‚  â”‚
â”‚  â”‚ TreeView shows child items under expanded folder          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Inline Rename Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Inline Rename Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User triggers rename (F2 key or context menu)                   â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ BeginRename()                                              â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ EditingName = Name     // Copy current name               â”‚  â”‚
â”‚  â”‚ IsRenaming = true      // Switch to edit mode             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UI switches from TextBlock to TextBox                      â”‚  â”‚
â”‚  â”‚ TextBox gets focus, SelectAll()                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚      â”‚               â”‚                                          â”‚
â”‚      â–¼               â–¼                                          â”‚
â”‚  [Enter Key]     [Escape Key]                                    â”‚
â”‚      â”‚               â”‚                                          â”‚
â”‚      â–¼               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ Commit   â”‚   â”‚ Cancel   â”‚                                    â”‚
â”‚  â”‚ Rename   â”‚   â”‚ Rename   â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚      â”‚               â”‚                                          â”‚
â”‚      â–¼               â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CommitRenameAsync()                                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 1. newName = EditingName.Trim()                            â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 2. Validate:                                                â”‚  â”‚
â”‚  â”‚    â€¢ Not empty                                              â”‚  â”‚
â”‚  â”‚    â€¢ Different from current name                            â”‚  â”‚
â”‚  â”‚    â€¢ No invalid file name characters                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 3. await _parent.RenameItemAsync(this, newName)            â”‚  â”‚
â”‚  â”‚    â†“                                                        â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚    â”‚ FileExplorerViewModel.RenameItemAsync()            â”‚  â”‚  â”‚
â”‚  â”‚    â”‚                                                    â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ _fileSystemService.RenameAsync(path, newName)   â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Update item.Name = newName                      â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ â€¢ Update item.Path = newPath                      â”‚  â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ 4. IsRenaming = false                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚               â”‚                                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                      â”‚                                           â”‚
â”‚                      â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UI switches back to TextBlock with updated name            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Filter Application Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Filter Application Flow                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ApplyFilter("test")                                             â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ For each child:                                            â”‚  â”‚
â”‚  â”‚     child.ApplyFilter(filter)  (recursive)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ selfMatches = Name.Contains("test", OrdinalIgnoreCase)     â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ Example tree:                                               â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ src/                  selfMatches: âŒ  childMatches: âœ…     â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€ components/       selfMatches: âŒ  childMatches: âœ…     â”‚  â”‚
â”‚  â”‚ â”‚   â”œâ”€â”€ Button.tsx    selfMatches: âŒ  visible: âŒ          â”‚  â”‚
â”‚  â”‚ â”‚   â””â”€â”€ TestCard.tsx  selfMatches: âœ…  visible: âœ… ğŸ”†       â”‚  â”‚
â”‚  â”‚ â””â”€â”€ utils/            selfMatches: âŒ  childMatches: âŒ     â”‚  â”‚
â”‚  â”‚     â””â”€â”€ helpers.ts    selfMatches: âŒ  visible: âŒ          â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ Result:                                                     â”‚  â”‚
â”‚  â”‚ â€¢ src/ â†’ visible (has matching child)                      â”‚  â”‚
â”‚  â”‚ â€¢ components/ â†’ visible, auto-expanded                     â”‚  â”‚
â”‚  â”‚ â€¢ Button.tsx â†’ hidden (no match)                           â”‚  â”‚
â”‚  â”‚ â€¢ TestCard.tsx â†’ visible, highlighted ğŸ”†                   â”‚  â”‚
â”‚  â”‚ â€¢ utils/ â†’ hidden (no matches)                             â”‚  â”‚
â”‚  â”‚ â€¢ helpers.ts â†’ hidden (no match)                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Set visibility and highlight:                              â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ IsVisible = selfMatches || childMatches                    â”‚  â”‚
â”‚  â”‚ IsHighlighted = selfMatches                                â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ if (childMatches && !IsExpanded && IsDirectory)            â”‚  â”‚
â”‚  â”‚     IsExpanded = true  // Auto-expand to show matches      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  Returns: true if this item or any descendant matches            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
â””â”€â”€ ViewModels/
    â””â”€â”€ FileTreeItemViewModel.cs                      (NEW)
```

---

## Implementation Details

### Task 1: Create FileTreeItemViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/FileTreeItemViewModel.cs`

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Models;
using SeniorIntern.Core.Utilities;
using System.Collections.ObjectModel;

/// <summary>
/// ViewModel for a file or folder in the file explorer tree.
/// Supports lazy loading, inline rename, and various display states.
/// </summary>
public partial class FileTreeItemViewModel : ViewModelBase
{
    private readonly FileExplorerViewModel _parent;
    private bool _childrenLoaded;

    #region Observable Properties

    /// <summary>Display name of the file or folder.</summary>
    [ObservableProperty]
    private string _name = string.Empty;

    /// <summary>Absolute path to the item.</summary>
    [ObservableProperty]
    private string _path = string.Empty;

    /// <summary>Type of item (file, directory, symbolic link).</summary>
    [ObservableProperty]
    private FileSystemItemType _itemType;

    /// <summary>Whether this folder is expanded in the tree.</summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(IconKey))]
    private bool _isExpanded;

    /// <summary>Whether this item is currently selected.</summary>
    [ObservableProperty]
    private bool _isSelected;

    /// <summary>Whether children are currently being loaded.</summary>
    [ObservableProperty]
    private bool _isLoading;

    /// <summary>Whether the item is in inline rename mode.</summary>
    [ObservableProperty]
    private bool _isRenaming;

    /// <summary>The name being edited during rename.</summary>
    [ObservableProperty]
    private string _editingName = string.Empty;

    /// <summary>Whether the file has unsaved changes (editor integration).</summary>
    [ObservableProperty]
    private bool _isModified;

    /// <summary>Whether this item is visible after filtering.</summary>
    [ObservableProperty]
    private bool _isVisible = true;

    /// <summary>Whether to highlight this item (matches filter).</summary>
    [ObservableProperty]
    private bool _isHighlighted;

    /// <summary>Child items (for directories).</summary>
    public ObservableCollection<FileTreeItemViewModel> Children { get; } = [];

    /// <summary>Whether this directory has children (for expansion indicator).</summary>
    [ObservableProperty]
    private bool _hasChildren;

    /// <summary>Depth level in the tree (for indentation).</summary>
    [ObservableProperty]
    private int _depth;

    #endregion

    #region Computed Properties

    /// <summary>Whether this is a directory.</summary>
    public bool IsDirectory => ItemType == FileSystemItemType.Directory;

    /// <summary>Whether this is a file.</summary>
    public bool IsFile => ItemType == FileSystemItemType.File;

    /// <summary>File extension including dot (e.g., ".cs").</summary>
    public string Extension => IsFile ? System.IO.Path.GetExtension(Path) : string.Empty;

    /// <summary>Detected programming language.</summary>
    public string? Language => IsFile ? LanguageDetector.DetectByFileName(Name) : null;

    /// <summary>Icon key based on item type, extension, and expansion state.</summary>
    public string IconKey => GetIconKey();

    /// <summary>Whether children have been loaded (for lazy loading).</summary>
    public bool ChildrenLoaded => _childrenLoaded;

    /// <summary>Whether to show the expansion arrow.</summary>
    public bool ShowExpander => IsDirectory && HasChildren;

    /// <summary>Indentation margin for tree hierarchy.</summary>
    public double IndentMargin => Depth * 16; // 16px per level

    /// <summary>Relative path from workspace root (for display/tooltips).</summary>
    public string RelativePath => _parent.GetRelativePath(Path);

    #endregion

    #region Constructor

    public FileTreeItemViewModel(FileExplorerViewModel parent)
    {
        _parent = parent ?? throw new ArgumentNullException(nameof(parent));
    }

    /// <summary>Creates a FileTreeItemViewModel from a FileSystemItem.</summary>
    public static FileTreeItemViewModel FromFileSystemItem(
        FileSystemItem item,
        FileExplorerViewModel parent,
        int depth = 0)
    {
        ArgumentNullException.ThrowIfNull(item);
        ArgumentNullException.ThrowIfNull(parent);

        return new FileTreeItemViewModel(parent)
        {
            Name = item.Name,
            Path = item.Path,
            ItemType = item.Type,
            HasChildren = item.HasChildren,
            Depth = depth,
            _childrenLoaded = false
        };
    }

    #endregion

    #region Expansion / Lazy Loading

    /// <summary>Called when IsExpanded changes.</summary>
    partial void OnIsExpandedChanged(bool value)
    {
        if (value && !_childrenLoaded && IsDirectory)
        {
            // Fire-and-forget load (UI will update via binding)
            _ = LoadChildrenAsync();
        }

        // Notify parent to persist expanded state
        _parent.OnItemExpansionChanged(this);
    }

    /// <summary>Loads children for this directory.</summary>
    public async Task LoadChildrenAsync()
    {
        if (_childrenLoaded || !IsDirectory)
            return;

        IsLoading = true;
        try
        {
            var children = await _parent.LoadChildrenForItemAsync(this);

            await Avalonia.Threading.Dispatcher.UIThread.InvokeAsync(() =>
            {
                Children.Clear();
                foreach (var child in children)
                {
                    Children.Add(child);
                }
            });

            _childrenLoaded = true;
        }
        catch (Exception ex)
        {
            // Parent handles logging; we just ensure proper state
            _childrenLoaded = false;
            throw;
        }
        finally
        {
            IsLoading = false;
        }
    }

    /// <summary>Forces a reload of children on next expansion.</summary>
    public void InvalidateChildren()
    {
        _childrenLoaded = false;
        Children.Clear();
    }

    /// <summary>Forces an immediate reload of children.</summary>
    public async Task RefreshChildrenAsync()
    {
        InvalidateChildren();

        if (IsExpanded)
        {
            await LoadChildrenAsync();
        }
    }

    /// <summary>Collapses this item and all descendants.</summary>
    public void CollapseAll()
    {
        IsExpanded = false;
        foreach (var child in Children)
        {
            child.CollapseAll();
        }
    }

    /// <summary>Expands this item and optionally all descendants.</summary>
    public async Task ExpandAllAsync(bool recursive = true, int maxDepth = 3)
    {
        if (!IsDirectory || Depth >= maxDepth)
            return;

        IsExpanded = true;
        await LoadChildrenAsync();

        if (recursive)
        {
            foreach (var child in Children.Where(c => c.IsDirectory))
            {
                await child.ExpandAllAsync(recursive, maxDepth);
            }
        }
    }

    #endregion

    #region Inline Rename

    /// <summary>Starts inline rename mode.</summary>
    public void BeginRename()
    {
        EditingName = Name;
        IsRenaming = true;
    }

    /// <summary>Commits the rename operation.</summary>
    [RelayCommand]
    private async Task CommitRenameAsync()
    {
        if (!IsRenaming)
            return;

        var newName = EditingName.Trim();

        // Validation
        if (string.IsNullOrEmpty(newName))
        {
            CancelRename();
            return;
        }

        if (newName == Name)
        {
            CancelRename();
            return;
        }

        // Check for invalid characters
        var invalidChars = System.IO.Path.GetInvalidFileNameChars();
        if (newName.IndexOfAny(invalidChars) >= 0)
        {
            // TODO: Show validation error in UI
            _parent.ShowError($"Name contains invalid characters");
            return; // Stay in rename mode for correction
        }

        try
        {
            await _parent.RenameItemAsync(this, newName);
            IsRenaming = false;
        }
        catch (Exception ex)
        {
            _parent.ShowError($"Rename failed: {ex.Message}");
            // Stay in rename mode for retry
        }
    }

    /// <summary>Cancels the rename operation.</summary>
    [RelayCommand]
    private void CancelRename()
    {
        IsRenaming = false;
        EditingName = Name;
    }

    #endregion

    #region Filtering

    /// <summary>Checks if this item matches the given filter.</summary>
    public bool MatchesFilter(string filter)
    {
        if (string.IsNullOrWhiteSpace(filter))
            return true;

        return Name.Contains(filter, StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Applies filter to this item and its children.
    /// Returns true if this item or any descendant matches.
    /// </summary>
    public bool ApplyFilter(string filter)
    {
        // Empty filter: show everything, no highlights
        if (string.IsNullOrWhiteSpace(filter))
        {
            IsVisible = true;
            IsHighlighted = false;

            foreach (var child in Children)
            {
                child.ApplyFilter(filter);
            }

            return true;
        }

        // Check self
        var selfMatches = MatchesFilter(filter);

        // Check children recursively
        var childMatches = false;
        foreach (var child in Children)
        {
            if (child.ApplyFilter(filter))
            {
                childMatches = true;
            }
        }

        // Update visibility and highlight
        IsVisible = selfMatches || childMatches;
        IsHighlighted = selfMatches;

        // Auto-expand if children match but we're collapsed
        if (childMatches && !IsExpanded && IsDirectory)
        {
            IsExpanded = true;
        }

        return IsVisible;
    }

    /// <summary>Clears all filter state.</summary>
    public void ClearFilter()
    {
        IsVisible = true;
        IsHighlighted = false;

        foreach (var child in Children)
        {
            child.ClearFilter();
        }
    }

    #endregion

    #region Icon Resolution

    private string GetIconKey()
    {
        if (IsDirectory)
        {
            // Special folder icons
            var lowerName = Name.ToLowerInvariant();
            return lowerName switch
            {
                "src" or "source" => IsExpanded ? "folder-src-open" : "folder-src",
                "test" or "tests" => IsExpanded ? "folder-test-open" : "folder-test",
                "docs" or "documentation" => IsExpanded ? "folder-docs-open" : "folder-docs",
                "assets" or "images" => IsExpanded ? "folder-images-open" : "folder-images",
                "node_modules" => "folder-node",
                ".git" => "folder-git",
                "bin" or "obj" => "folder-dist",
                _ => IsExpanded ? "folder-open" : "folder"
            };
        }

        // File icon by extension
        return FileIconProvider.GetIconKeyForExtension(Extension);
    }

    #endregion

    #region Equality / Comparison

    public override bool Equals(object? obj)
    {
        return obj is FileTreeItemViewModel other && 
               string.Equals(Path, other.Path, StringComparison.Ordinal);
    }

    public override int GetHashCode()
    {
        return StringComparer.Ordinal.GetHashCode(Path);
    }

    public override string ToString()
    {
        return $"{(IsDirectory ? "ğŸ“" : "ğŸ“„")} {Name}";
    }

    #endregion
}
```

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| FromFileSystemItem | 3 | Factory, properties, depth |
| IsExpanded / Lazy Load | 4 | Trigger, already loaded, not directory |
| RefreshChildrenAsync | 2 | Reload, when collapsed |
| BeginRename | 2 | Initial state, EditingName |
| CommitRenameAsync | 5 | Valid, empty, same, invalid chars, error |
| CancelRename | 2 | Revert state |
| MatchesFilter | 3 | Case insensitive, empty, no match |
| ApplyFilter | 5 | Self match, child match, auto-expand, clear |
| GetIconKey | 4 | Folder, folder-open, special folders, file |
| **Total** | **30** | |

### Key Test Scenarios

```csharp
// Factory Tests
[Fact]
public void FromFileSystemItem_CreatesCorrectViewModel()
{
    var item = new FileSystemItem
    {
        Name = "test.cs",
        Path = "/project/src/test.cs",
        Type = FileSystemItemType.File,
        HasChildren = false
    };
    var parent = CreateMockParent();

    var vm = FileTreeItemViewModel.FromFileSystemItem(item, parent, depth: 2);

    Assert.Equal("test.cs", vm.Name);
    Assert.Equal("/project/src/test.cs", vm.Path);
    Assert.True(vm.IsFile);
    Assert.False(vm.IsDirectory);
    Assert.Equal(2, vm.Depth);
    Assert.False(vm.ChildrenLoaded);
}

// Lazy Loading Tests
[Fact]
public async Task IsExpanded_TriggersLoadChildren_WhenNotLoaded()
{
    var vm = CreateFolderViewModel();
    var loadCalled = false;
    _mockParent.Setup(p => p.LoadChildrenForItemAsync(It.IsAny<FileTreeItemViewModel>()))
        .ReturnsAsync(new List<FileTreeItemViewModel>())
        .Callback(() => loadCalled = true);

    vm.IsExpanded = true;
    await Task.Delay(100); // Allow async to complete

    Assert.True(loadCalled);
}

[Fact]
public async Task IsExpanded_DoesNotReload_WhenAlreadyLoaded()
{
    var vm = CreateFolderViewModel();
    vm.IsExpanded = true;
    await Task.Delay(100);
    
    // Collapse and re-expand
    vm.IsExpanded = false;
    _mockParent.Invocations.Clear();
    vm.IsExpanded = true;

    _mockParent.Verify(p => p.LoadChildrenForItemAsync(It.IsAny<FileTreeItemViewModel>()), 
        Times.Never); // Should not reload
}

// Rename Tests
[Fact]
public void BeginRename_SetsRenameState()
{
    var vm = new FileTreeItemViewModel(_mockParent.Object) { Name = "test.cs" };

    vm.BeginRename();

    Assert.True(vm.IsRenaming);
    Assert.Equal("test.cs", vm.EditingName);
}

[Fact]
public async Task CommitRenameAsync_Validates_InvalidCharacters()
{
    var vm = new FileTreeItemViewModel(_mockParent.Object) { Name = "test.cs" };
    vm.BeginRename();
    vm.EditingName = "test/invalid.cs"; // Contains path separator

    await vm.CommitRenameCommand.ExecuteAsync(null);

    Assert.True(vm.IsRenaming); // Should stay in rename mode
    _mockParent.Verify(p => p.ShowError(It.IsAny<string>()), Times.Once);
}

// Filter Tests
[Theory]
[InlineData("test", "TestFile.cs", true)]
[InlineData("TEST", "testfile.cs", true)]  // Case insensitive
[InlineData("xyz", "TestFile.cs", false)]
public void MatchesFilter_ReturnsCorrectResult(string filter, string name, bool expected)
{
    var vm = new FileTreeItemViewModel(_mockParent.Object) { Name = name };
    
    Assert.Equal(expected, vm.MatchesFilter(filter));
}

[Fact]
public void ApplyFilter_AutoExpandsFolder_WhenChildMatches()
{
    var parent = CreateFolderViewModel();
    var child = new FileTreeItemViewModel(_mockParent.Object) { Name = "match.cs" };
    parent.Children.Add(child);
    parent.IsExpanded = false;

    parent.ApplyFilter("match");

    Assert.True(parent.IsExpanded);
    Assert.True(parent.IsVisible);
    Assert.False(parent.IsHighlighted); // Parent doesn't match
    Assert.True(child.IsVisible);
    Assert.True(child.IsHighlighted);   // Child matches
}

// Icon Tests
[Theory]
[InlineData("src", false, "folder-src")]
[InlineData("src", true, "folder-src-open")]
[InlineData("test", false, "folder-test")]
[InlineData("random", false, "folder")]
[InlineData("random", true, "folder-open")]
public void IconKey_ReturnsCorrectKey_ForDirectories(string name, bool expanded, string expected)
{
    var vm = new FileTreeItemViewModel(_mockParent.Object)
    {
        Name = name,
        ItemType = FileSystemItemType.Directory,
        IsExpanded = expanded
    };

    Assert.Equal(expected, vm.IconKey);
}
```

---

## Files Summary

### Files to Create (1)

| File | Lines (approx) |
|------|----------------|
| `ViewModels/FileTreeItemViewModel.cs` | 350 |

### Files to Modify (0)

No files need modification for v0.3.2a.

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | FromFileSystemItem creates ViewModel with correct properties |
| AC-2 | IsExpanded triggers lazy LoadChildrenAsync |
| AC-3 | Children only load once until InvalidateChildren |
| AC-4 | BeginRename enters edit mode correctly |
| AC-5 | CommitRenameAsync validates and calls parent |
| AC-6 | CancelRename reverts to original name |
| AC-7 | MatchesFilter is case-insensitive |
| AC-8 | ApplyFilter sets visibility and auto-expands |
| AC-9 | IconKey returns folder-open when expanded |
| AC-10 | Special folder names get unique icons |

---

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| Reference to parent VM | Delegate operations (rename, load) to parent |
| Fire-and-forget load | Non-blocking UI when expanding |
| InvalidateChildren | Allow manual refresh without immediate reload |
| Auto-expand on child match | User expects to see match path |
| Special folder icons | Visual cues for common project folders |

---

## Dependencies

| Part | Dependency Description |
|------|------------------------|
| v0.3.1a | FileSystemItem, FileSystemItemType models |
| v0.3.1c | LanguageDetector for language detection |
| v0.3.2b | FileExplorerViewModel (parent) |
| v0.3.2c | FileIconProvider for icon keys |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.3.2a | 0.5 day |
