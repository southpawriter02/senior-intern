# Design Specification: The Senior Intern v0.4.1h "UI Rendering"

**Status**: _IMPLEMENTED_

## Executive Summary

This document provides a comprehensive implementation specification for v0.4.1h, which creates the visual representation of code blocks within chat messages. This includes the `CodeBlockControl` user control, styling system, converters, icon resources, and integration with the existing `ChatMessageControl`. The UI must support streaming indicators, status badges, action buttons (copy, apply), and responsive layout with proper overflow handling.

### v0.4.1h Scope

- Create `CodeBlockControl` user control for rendering individual code blocks
- Define code block styling system in the theme (colors, borders, typography)
- Implement value converters for UI binding transformations
- Add icon resources (copy, diff, code icons)
- Update `ChatMessageControl` to display code blocks collection
- Add code block summary section for batch operations
- Implement responsive layout with scrolling and text truncation

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| CodeBlockControl.axaml | User control for individual code block rendering |
| CodeBlockControl.axaml.cs | Code-behind with initialization |
| CodeBlockConverters.cs | Value converters for enum/type comparisons |
| Dark.axaml (updated) | Code block styling and color resources |
| App.axaml (updated) | Icon resources and converter registrations |
| ChatMessageControl.axaml (updated) | Code blocks ItemsControl integration |

---

## Prerequisites

Before implementing v0.4.1h, ensure:

- v0.4.1a is complete (CodeBlock, CodeBlockType, CodeBlockStatus enums)
- v0.4.1g is complete (CodeBlockViewModel with all observable properties)
- v0.1.0 is complete (existing ChatMessageControl, Dark.axaml theme)
- Avalonia 11.x with FluentTheme is configured

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.4.1h Feature Tree                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  CodeBlockControl                                                      â”‚
â”‚  â”œâ”€â”€ Header Section                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ Language Badge â†’ colored pill with language name             â”‚
â”‚  â”‚   â”œâ”€â”€ Block Type Indicator â†’ "example", "command", etc.            â”‚
â”‚  â”‚   â”œâ”€â”€ File Path â†’ monospace, truncated with ellipsis               â”‚
â”‚  â”‚   â”œâ”€â”€ Line Count â†’ "X lines" indicator                             â”‚
â”‚  â”‚   â”œâ”€â”€ Copy Button â†’ icon button, copies to clipboard               â”‚
â”‚  â”‚   â””â”€â”€ Apply Button â†’ primary button, visible for applicable        â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ Content Section                                                   â”‚
â”‚  â”‚   â”œâ”€â”€ ScrollViewer â†’ horizontal + vertical scrolling               â”‚
â”‚  â”‚   â”œâ”€â”€ SelectableTextBlock â†’ monospace, syntax-highlighted (future) â”‚
â”‚  â”‚   â””â”€â”€ Max Height â†’ 400px with vertical scroll                      â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ Footer Section                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ Status Badge â†’ Applied/Rejected/Conflict with colors         â”‚
â”‚  â”‚   â””â”€â”€ Streaming Indicator â†’ progress bar + "Receiving..." text     â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ Conditional Styling                                               â”‚
â”‚      â”œâ”€â”€ .applicable â†’ accent border on left                          â”‚
â”‚      â”œâ”€â”€ .example â†’ reduced opacity                                   â”‚
â”‚      â””â”€â”€ .command â†’ dark blue background                              â”‚
â”‚                                                                        â”‚
â”‚  Theme Resources                                                       â”‚
â”‚  â”œâ”€â”€ Color Palette                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ CodeBlockBackground (#1E1E1E)                                â”‚
â”‚  â”‚   â”œâ”€â”€ CodeBlockBorder (#3E3E3E)                                    â”‚
â”‚  â”‚   â”œâ”€â”€ CodeBlockHeaderBackground (#252526)                          â”‚
â”‚  â”‚   â”œâ”€â”€ CommandBlockBackground (#1A1A2E)                             â”‚
â”‚  â”‚   â”œâ”€â”€ LanguageBadgeBackground (#0E639C)                            â”‚
â”‚  â”‚   â”œâ”€â”€ CodeForeground (#D4D4D4)                                     â”‚
â”‚  â”‚   â””â”€â”€ WarningBackground (#5A3D1D)                                  â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ Style Selectors                                                   â”‚
â”‚      â”œâ”€â”€ Border.code-block, .applicable, .example, .command           â”‚
â”‚      â”œâ”€â”€ Border.code-block-header                                      â”‚
â”‚      â”œâ”€â”€ Border.language-badge                                         â”‚
â”‚      â”œâ”€â”€ TextBlock.file-path                                          â”‚
â”‚      â”œâ”€â”€ Border.code-content                                          â”‚
â”‚      â”œâ”€â”€ SelectableTextBlock.code-text                                â”‚
â”‚      â”œâ”€â”€ Button.apply-button, Button.icon-button                      â”‚
â”‚      â””â”€â”€ Border.status-badge, .applied, .rejected, .conflict          â”‚
â”‚                                                                        â”‚
â”‚  Converters                                                            â”‚
â”‚  â”œâ”€â”€ EnumEqualsConverter â†’ compares enum to parameter string          â”‚
â”‚  â”œâ”€â”€ GreaterThanOneConverter â†’ int > 1                                â”‚
â”‚  â”œâ”€â”€ IsApplicableBlockConverter â†’ CodeBlockType check                 â”‚
â”‚  â””â”€â”€ InverseBoolConverter â†’ !bool                                     â”‚
â”‚                                                                        â”‚
â”‚  Icon Resources                                                        â”‚
â”‚  â”œâ”€â”€ CopyIcon (StreamGeometry)                                        â”‚
â”‚  â”œâ”€â”€ DiffIcon (StreamGeometry)                                        â”‚
â”‚  â”œâ”€â”€ CodeIcon (StreamGeometry)                                        â”‚
â”‚  â”œâ”€â”€ CheckIcon (StreamGeometry)                                       â”‚
â”‚  â””â”€â”€ WarningIcon (StreamGeometry)                                     â”‚
â”‚                                                                        â”‚
â”‚  ChatMessageControl Updates                                            â”‚
â”‚  â”œâ”€â”€ CodeBlocks ItemsControl                                          â”‚
â”‚  â”œâ”€â”€ Code Block Summary Panel                                         â”‚
â”‚  â””â”€â”€ Namespace import for Controls                                    â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Visual Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatMessageControl                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Border.user-message / Border.assistant-message                       â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ StackPanel                                                       â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ TextBlock (Role Label)                                       â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ SelectableTextBlock (Message Content)                        â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ ItemsControl (CodeBlocks)                                    â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ CodeBlockControl (for each CodeBlockViewModel)           â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Header: [C#] [example] src/File.cs  12 lines [ğŸ“‹][â–¶]â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ public class Example                                â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ {                                                    â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚     // Code content...                              â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ }                                                    â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ Footer: [âœ“ Applied] or [â”â”â” Receiving...]           â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ Border.code-summary (when multiple applicable blocks)       â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ [</>] 3 code block(s), 2 applicable         [Apply All]    â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ StackPanel (Loading Indicator - IsStreaming)                â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CodeBlockControl Internal Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Border.code-block (.applicable | .example | .command)                    â”‚
â”‚ Background: CodeBlockBackground                                          â”‚
â”‚ Border: CodeBlockBorder (accent left for .applicable)                   â”‚
â”‚                                                                          â”‚
â”‚ Grid (RowDefinitions="Auto, *, Auto")                                   â”‚
â”‚                                                                          â”‚
â”‚ Row 0: Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Border.code-block-header                                             â”‚ â”‚
â”‚ â”‚ Background: CodeBlockHeaderBackground                                â”‚ â”‚
â”‚ â”‚                                                                      â”‚ â”‚
â”‚ â”‚ Grid (Cols: Auto, Auto, *, Auto, Auto, Auto)                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ [Lang] â”‚ [Type]  â”‚ path/to/file.cs    â”‚ 42 ln  â”‚ ğŸ“‹  â”‚ Apply    â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ Badge  â”‚ if ex.  â”‚ TextBlock.file-pathâ”‚ count  â”‚ btn â”‚ Button   â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚ Row 1: Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Border.code-content                                                  â”‚ â”‚
â”‚ â”‚ Padding: 12,8                                                        â”‚ â”‚
â”‚ â”‚                                                                      â”‚ â”‚
â”‚ â”‚ ScrollViewer (H: Auto, V: Auto, MaxHeight: 400)                     â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ SelectableTextBlock.code-text                                    â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ FontFamily: Cascadia Code, Consolas, monospace                   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ TextWrapping: NoWrap                                             â”‚ â”‚ â”‚
â”‚ â”‚ â”‚                                                                   â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ public class MyService                                           â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ {                                                                 â”‚ â”‚ â”‚
â”‚ â”‚ â”‚     private readonly ILogger _logger;                            â”‚ â”‚ â”‚
â”‚ â”‚ â”‚     ...                                                          â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ }                                                                 â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚ Row 2: Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ (Conditional: ShowStatusBadge OR IsStreaming)                        â”‚ â”‚
â”‚ â”‚                                                                      â”‚ â”‚
â”‚ â”‚ If ShowStatusBadge:                                                  â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ Border.status-badge (.applied | .rejected | .conflict)           â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [âœ“ Applied] / [âœ— Rejected] / [âš  Conflict]                        â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                                                      â”‚ â”‚
â”‚ â”‚ If IsStreaming:                                                      â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ ProgressBar (Indeterminate) + TextBlock "Receiving..."           â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Style Inheritance Diagram

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   FluentTheme       â”‚
                          â”‚   (Base Avalonia)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ extends
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    Dark.axaml       â”‚
                          â”‚  (App Theme Layer)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ defines
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
        â–¼                            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Color Palette â”‚          â”‚ Border Styles â”‚          â”‚ Button Themes â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CodeBlock-    â”‚          â”‚ .code-block   â”‚          â”‚ .apply-button â”‚
â”‚   Background  â”‚          â”‚ .code-block-  â”‚          â”‚ .icon-button  â”‚
â”‚ CodeBlock-    â”‚          â”‚   header      â”‚          â”‚ .copy-button  â”‚
â”‚   Border      â”‚          â”‚ .code-content â”‚          â”‚               â”‚
â”‚ CodeBlock-    â”‚          â”‚ .language-    â”‚          â”‚               â”‚
â”‚   Header...   â”‚          â”‚   badge       â”‚          â”‚               â”‚
â”‚ LanguageBadge-â”‚          â”‚ .status-badge â”‚          â”‚               â”‚
â”‚   Background  â”‚          â”‚   .applied    â”‚          â”‚               â”‚
â”‚ CodeForegroundâ”‚          â”‚   .rejected   â”‚          â”‚               â”‚
â”‚ Warning-      â”‚          â”‚   .conflict   â”‚          â”‚               â”‚
â”‚   Background  â”‚          â”‚ .file-path    â”‚          â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                            â”‚                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ consumed by
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  CodeBlockControl   â”‚
                          â”‚     .axaml          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Binding Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CodeBlockViewModel (from v0.4.1g)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Observable Properties              UI Bindings                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚                                                                          â”‚
â”‚  Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SelectableTextBlock.Text            â”‚
â”‚  DisplayLanguage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Language Badge TextBlock.Text       â”‚
â”‚  TargetFilePath â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º File Path TextBlock.Text            â”‚
â”‚  LineCount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Line Count TextBlock.Text           â”‚
â”‚  IsStreaming â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Streaming Indicator.IsVisible       â”‚
â”‚  Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Status Badge (via EnumEquals)       â”‚
â”‚                                                                          â”‚
â”‚  Computed Properties               UI Bindings                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                          â”‚
â”‚  IsApplicable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Border.code-block Classes           â”‚
â”‚  IsExample â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Border.code-block Classes           â”‚
â”‚  IsCommand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Border.code-block Classes           â”‚
â”‚  ShowApplyButton â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Apply Button.IsVisible              â”‚
â”‚  ShowStatusBadge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Status Footer.IsVisible             â”‚
â”‚  StatusText â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Status Badge TextBlock.Text         â”‚
â”‚                                                                          â”‚
â”‚  Commands                          UI Bindings                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                          â”‚
â”‚  CopyToClipboardCommand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Copy Button.Command                 â”‚
â”‚  ShowDiffCommand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Apply Button.Command                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Details

### 1. Theme Resources (Dark.axaml)

#### 1.1 Color Palette

Add the following color resources to support code block rendering:

```xml
<!-- Code Block Color Palette -->

<!-- Base Colors (as Color values for potential gradient use) -->
<Color x:Key="CodeBlockBackgroundColor">#1E1E1E</Color>
<Color x:Key="CodeBlockBorderColor">#3E3E3E</Color>
<Color x:Key="CodeBlockHeaderBackgroundColor">#252526</Color>
<Color x:Key="CommandBlockBackgroundColor">#1A1A2E</Color>
<Color x:Key="LanguageBadgeBackgroundColor">#0E639C</Color>
<Color x:Key="CodeForegroundColor">#D4D4D4</Color>
<Color x:Key="WarningBackgroundColor">#5A3D1D</Color>
<Color x:Key="WarningForegroundColor">#F5C842</Color>
<Color x:Key="SurfaceBackgroundColor">#2D2D30</Color>

<!-- SolidColorBrush Resources -->
<SolidColorBrush x:Key="CodeBlockBackground" Color="{StaticResource CodeBlockBackgroundColor}" />
<SolidColorBrush x:Key="CodeBlockBorder" Color="{StaticResource CodeBlockBorderColor}" />
<SolidColorBrush x:Key="CodeBlockHeaderBackground" Color="{StaticResource CodeBlockHeaderBackgroundColor}" />
<SolidColorBrush x:Key="CommandBlockBackground" Color="{StaticResource CommandBlockBackgroundColor}" />
<SolidColorBrush x:Key="LanguageBadgeBackground" Color="{StaticResource LanguageBadgeBackgroundColor}" />
<SolidColorBrush x:Key="LanguageBadgeForeground" Color="White" />
<SolidColorBrush x:Key="CodeForeground" Color="{StaticResource CodeForegroundColor}" />
<SolidColorBrush x:Key="WarningBackground" Color="{StaticResource WarningBackgroundColor}" />
<SolidColorBrush x:Key="WarningForeground" Color="{StaticResource WarningForegroundColor}" />
<SolidColorBrush x:Key="SurfaceBackground" Color="{StaticResource SurfaceBackgroundColor}" />
```

| Resource Key | Hex Value | Purpose |
|--------------|-----------|---------|
| CodeBlockBackground | #1E1E1E | Main code block container background |
| CodeBlockBorder | #3E3E3E | Default border color for code blocks |
| CodeBlockHeaderBackground | #252526 | Header bar background (slightly lighter) |
| CommandBlockBackground | #1A1A2E | Special background for shell/command blocks |
| LanguageBadgeBackground | #0E639C | Blue pill badge for language indicator |
| LanguageBadgeForeground | White | Text color within language badge |
| CodeForeground | #D4D4D4 | Default code text color |
| WarningBackground | #5A3D1D | Background for conflict status badge |
| WarningForeground | #F5C842 | Text color for conflict status |
| SurfaceBackground | #2D2D30 | Summary panel background |

#### 1.2 Style Selectors

```xml
<!-- Code Block Container Styles -->

<Style Selector="Border.code-block">
    <Setter Property="Background" Value="{DynamicResource CodeBlockBackground}" />
    <Setter Property="BorderBrush" Value="{DynamicResource CodeBlockBorder}" />
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="CornerRadius" Value="6" />
    <Setter Property="Margin" Value="0,8" />
</Style>

<Style Selector="Border.code-block.applicable">
    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
    <Setter Property="BorderThickness" Value="1,1,1,3" />
</Style>

<Style Selector="Border.code-block.example">
    <Setter Property="Opacity" Value="0.8" />
</Style>

<Style Selector="Border.code-block.command">
    <Setter Property="Background" Value="{DynamicResource CommandBlockBackground}" />
</Style>

<!-- Code Block Header Styles -->

<Style Selector="Border.code-block-header">
    <Setter Property="Background" Value="{DynamicResource CodeBlockHeaderBackground}" />
    <Setter Property="Padding" Value="8,6" />
    <Setter Property="CornerRadius" Value="6,6,0,0" />
</Style>

<!-- Language Badge Styles -->

<Style Selector="Border.language-badge">
    <Setter Property="Background" Value="{DynamicResource LanguageBadgeBackground}" />
    <Setter Property="CornerRadius" Value="3" />
    <Setter Property="Padding" Value="6,2" />
</Style>

<Style Selector="Border.language-badge TextBlock">
    <Setter Property="FontSize" Value="11" />
    <Setter Property="FontWeight" Value="SemiBold" />
    <Setter Property="Foreground" Value="{DynamicResource LanguageBadgeForeground}" />
</Style>

<!-- File Path Styles -->

<Style Selector="TextBlock.file-path">
    <Setter Property="FontFamily" Value="Cascadia Code, Consolas, monospace" />
    <Setter Property="FontSize" Value="12" />
    <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
    <Setter Property="TextTrimming" Value="CharacterEllipsis" />
</Style>

<!-- Code Content Styles -->

<Style Selector="Border.code-content">
    <Setter Property="Padding" Value="12,8" />
</Style>

<Style Selector="SelectableTextBlock.code-text">
    <Setter Property="FontFamily" Value="Cascadia Code, Consolas, monospace" />
    <Setter Property="FontSize" Value="13" />
    <Setter Property="Foreground" Value="{DynamicResource CodeForeground}" />
    <Setter Property="TextWrapping" Value="NoWrap" />
</Style>

<!-- Button Styles -->

<Style Selector="Button.apply-button">
    <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
    <Setter Property="Foreground" Value="White" />
    <Setter Property="Padding" Value="8,4" />
    <Setter Property="CornerRadius" Value="4" />
    <Setter Property="FontSize" Value="12" />
</Style>

<Style Selector="Button.apply-button:pointerover">
    <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}" />
</Style>

<Style Selector="Button.apply-button:disabled">
    <Setter Property="Opacity" Value="0.5" />
</Style>

<Style Selector="Button.icon-button">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
    <Setter Property="Padding" Value="6" />
    <Setter Property="CornerRadius" Value="4" />
    <Setter Property="MinWidth" Value="28" />
    <Setter Property="MinHeight" Value="28" />
</Style>

<Style Selector="Button.icon-button:pointerover">
    <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
    <Setter Property="Foreground" Value="{DynamicResource TextPrimary}" />
</Style>

<!-- Status Badge Styles -->

<Style Selector="Border.status-badge">
    <Setter Property="CornerRadius" Value="3" />
    <Setter Property="Padding" Value="6,2" />
</Style>

<Style Selector="Border.status-badge TextBlock">
    <Setter Property="FontSize" Value="11" />
    <Setter Property="FontWeight" Value="SemiBold" />
</Style>

<Style Selector="Border.status-badge.applied">
    <Setter Property="Background" Value="{DynamicResource SuccessBackground}" />
</Style>

<Style Selector="Border.status-badge.applied TextBlock">
    <Setter Property="Foreground" Value="{DynamicResource SuccessForeground}" />
</Style>

<Style Selector="Border.status-badge.rejected">
    <Setter Property="Background" Value="{DynamicResource ErrorBackground}" />
</Style>

<Style Selector="Border.status-badge.rejected TextBlock">
    <Setter Property="Foreground" Value="{DynamicResource ErrorForeground}" />
</Style>

<Style Selector="Border.status-badge.conflict">
    <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
</Style>

<Style Selector="Border.status-badge.conflict TextBlock">
    <Setter Property="Foreground" Value="{DynamicResource WarningForeground}" />
</Style>

<!-- Code Summary Panel -->

<Style Selector="Border.code-summary">
    <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
    <Setter Property="CornerRadius" Value="4" />
    <Setter Property="Padding" Value="12,8" />
    <Setter Property="Margin" Value="0,8,0,0" />
</Style>
```

### 2. Icon Resources (App.axaml)

Add StreamGeometry icon definitions to the application resources:

```xml
<!-- Icon Resources -->

<StreamGeometry x:Key="CopyIcon">M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z</StreamGeometry>

<StreamGeometry x:Key="DiffIcon">M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z</StreamGeometry>

<StreamGeometry x:Key="CodeIcon">M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z</StreamGeometry>

<StreamGeometry x:Key="CheckIcon">M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z</StreamGeometry>

<StreamGeometry x:Key="CloseIcon">M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z</StreamGeometry>

<StreamGeometry x:Key="WarningIcon">M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z</StreamGeometry>

<StreamGeometry x:Key="ExpandIcon">M7 10l5 5 5-5z</StreamGeometry>

<StreamGeometry x:Key="CollapseIcon">M7 14l5-5 5 5z</StreamGeometry>
```

| Icon Key | Purpose | Usage |
|----------|---------|-------|
| CopyIcon | Copy to clipboard | Copy button in header |
| DiffIcon | Show diff view | Apply button icon |
| CodeIcon | Code representation | Summary panel icon |
| CheckIcon | Success/applied state | Applied status badge |
| CloseIcon | Rejected/dismiss | Rejected status badge, close buttons |
| WarningIcon | Conflict warning | Conflict status badge |
| ExpandIcon | Expand collapsed block | Toggle expand/collapse |
| CollapseIcon | Collapse expanded block | Toggle expand/collapse |

### 3. Value Converters

#### 3.1 EnumEqualsConverter

Compares an enum value to a string parameter for conditional styling:

```csharp
// src/SeniorIntern.Desktop/Converters/CodeBlockConverters.cs

using System;
using System.Globalization;
using Avalonia.Data.Converters;
using SeniorIntern.Core.Models;

namespace SeniorIntern.Desktop.Converters;

/// <summary>
/// Compares an enum value to a parameter string for conditional visibility/styling.
/// </summary>
/// <example>
/// <![CDATA[
/// <Border Classes.applied="{Binding Status,
///     Converter={StaticResource EnumEqualsConverter},
///     ConverterParameter=Applied}" />
/// ]]>
/// </example>
public class EnumEqualsConverter : IValueConverter
{
    /// <summary>
    /// Singleton instance for XAML resource usage.
    /// </summary>
    public static readonly EnumEqualsConverter Instance = new();

    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is null || parameter is null)
            return false;

        var paramString = parameter.ToString();
        var valueString = value.ToString();

        return string.Equals(paramString, valueString, StringComparison.OrdinalIgnoreCase);
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("EnumEqualsConverter does not support ConvertBack.");
    }
}
```

#### 3.2 GreaterThanOneConverter

Returns true when an integer value is greater than 1 (for "Apply All" visibility):

```csharp
/// <summary>
/// Returns true when an integer value is greater than 1.
/// Used to show "Apply All" button when multiple applicable blocks exist.
/// </summary>
public class GreaterThanOneConverter : IValueConverter
{
    public static readonly GreaterThanOneConverter Instance = new();

    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value is int intValue && intValue > 1;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("GreaterThanOneConverter does not support ConvertBack.");
    }
}
```

#### 3.3 IsApplicableBlockConverter

Checks if a CodeBlockType represents an applicable (non-example) block:

```csharp
/// <summary>
/// Determines if a CodeBlockType represents applicable code
/// (CompleteFile or Snippet, but not Example, Command, Output, or Config).
/// </summary>
public class IsApplicableBlockConverter : IValueConverter
{
    public static readonly IsApplicableBlockConverter Instance = new();

    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is CodeBlockType blockType)
        {
            return blockType is CodeBlockType.CompleteFile or CodeBlockType.Snippet;
        }
        return false;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("IsApplicableBlockConverter does not support ConvertBack.");
    }
}
```

#### 3.4 InverseBoolConverter

Inverts a boolean value for visibility toggling:

```csharp
/// <summary>
/// Inverts a boolean value. Useful for mutually exclusive visibility.
/// </summary>
public class InverseBoolConverter : IValueConverter
{
    public static readonly InverseBoolConverter Instance = new();

    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value is bool boolValue && !boolValue;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value is bool boolValue && !boolValue;
    }
}
```

#### 3.5 NullToVisibilityConverter

Returns true when value is not null (for conditional visibility):

```csharp
/// <summary>
/// Returns true when value is not null, for binding IsVisible.
/// </summary>
public class NotNullConverter : IValueConverter
{
    public static readonly NotNullConverter Instance = new();

    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value is not null;
    }

    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("NotNullConverter does not support ConvertBack.");
    }
}
```

#### Converter Summary Table

| Converter | Input | Output | Usage |
|-----------|-------|--------|-------|
| EnumEqualsConverter | Enum, string param | bool | Status badge styling |
| GreaterThanOneConverter | int | bool | "Apply All" visibility |
| IsApplicableBlockConverter | CodeBlockType | bool | Determine if block can be applied |
| InverseBoolConverter | bool | bool | Inverse visibility |
| NotNullConverter | any | bool | Show when value exists |

### 4. CodeBlockControl

#### 4.1 AXAML Definition

```xml
<!-- src/SeniorIntern.Desktop/Controls/CodeBlockControl.axaml -->

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:conv="using:SeniorIntern.Desktop.Converters"
             x:Class="SeniorIntern.Desktop.Controls.CodeBlockControl"
             x:DataType="vm:CodeBlockViewModel">

    <UserControl.Resources>
        <conv:EnumEqualsConverter x:Key="EnumEqualsConverter" />
    </UserControl.Resources>

    <Border Classes="code-block"
            Classes.applicable="{Binding IsApplicable}"
            Classes.example="{Binding IsExample}"
            Classes.command="{Binding IsCommand}">

        <Grid RowDefinitions="Auto, *, Auto">

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Row 0: Header                                           -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Border Grid.Row="0" Classes="code-block-header">
                <Grid ColumnDefinitions="Auto, Auto, *, Auto, Auto, Auto">

                    <!-- Language Badge -->
                    <Border Grid.Column="0"
                            Classes="language-badge"
                            IsVisible="{Binding DisplayLanguage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="{Binding DisplayLanguage}" />
                    </Border>

                    <!-- Block Type Indicator (for non-applicable blocks) -->
                    <TextBlock Grid.Column="1"
                               Text="{Binding BlockTypeDisplay}"
                               Margin="8,0,0,0"
                               FontSize="10"
                               Foreground="{DynamicResource TextMuted}"
                               VerticalAlignment="Center"
                               IsVisible="{Binding IsExample}" />

                    <!-- File Path -->
                    <TextBlock Grid.Column="2"
                               Text="{Binding TargetFilePath}"
                               Classes="file-path"
                               Margin="8,0"
                               VerticalAlignment="Center"
                               MaxWidth="300"
                               ToolTip.Tip="{Binding TargetFilePath}"
                               IsVisible="{Binding TargetFilePath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                    <!-- Line Count -->
                    <TextBlock Grid.Column="3"
                               FontSize="11"
                               Foreground="{DynamicResource TextMuted}"
                               VerticalAlignment="Center"
                               Margin="8,0">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0} lines">
                                <Binding Path="LineCount" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>

                    <!-- Copy Button -->
                    <Button Grid.Column="4"
                            Classes="icon-button"
                            Command="{Binding CopyToClipboardCommand}"
                            ToolTip.Tip="Copy to clipboard">
                        <PathIcon Data="{StaticResource CopyIcon}"
                                  Width="14"
                                  Height="14" />
                    </Button>

                    <!-- Apply Button (visible only for applicable blocks) -->
                    <Button Grid.Column="5"
                            Classes="apply-button"
                            Command="{Binding ShowDiffCommand}"
                            IsVisible="{Binding ShowApplyButton}"
                            ToolTip.Tip="Review and apply changes"
                            Margin="4,0,0,0">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <PathIcon Data="{StaticResource DiffIcon}"
                                      Width="12"
                                      Height="12" />
                            <TextBlock Text="Apply" />
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Row 1: Code Content                                     -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Border Grid.Row="1" Classes="code-content">
                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              MaxHeight="400">
                    <SelectableTextBlock Text="{Binding Content}"
                                         Classes="code-text" />
                </ScrollViewer>
            </Border>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Row 2: Footer (Status Badge OR Streaming Indicator)     -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

            <!-- Status Badge (when not streaming and has final status) -->
            <Border Grid.Row="2"
                    Padding="8,4"
                    IsVisible="{Binding ShowStatusBadge}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Border Classes="status-badge"
                            Classes.applied="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Applied}"
                            Classes.rejected="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Rejected}"
                            Classes.conflict="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Conflicted}">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <!-- Status Icon -->
                            <PathIcon Width="12" Height="12"
                                      IsVisible="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Applied}"
                                      Data="{StaticResource CheckIcon}" />
                            <PathIcon Width="12" Height="12"
                                      IsVisible="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Rejected}"
                                      Data="{StaticResource CloseIcon}" />
                            <PathIcon Width="12" Height="12"
                                      IsVisible="{Binding Status, Converter={StaticResource EnumEqualsConverter}, ConverterParameter=Conflicted}"
                                      Data="{StaticResource WarningIcon}" />

                            <!-- Status Text -->
                            <TextBlock Text="{Binding StatusText}" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Streaming Indicator (while receiving tokens) -->
            <Border Grid.Row="2"
                    Padding="8,4"
                    IsVisible="{Binding IsStreaming}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <ProgressBar IsIndeterminate="True"
                                 Width="60"
                                 Height="3" />
                    <TextBlock Text="Receiving..."
                               FontSize="11"
                               FontStyle="Italic"
                               Foreground="{DynamicResource TextMuted}" />
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</UserControl>
```

#### 4.2 Code-Behind

```csharp
// src/SeniorIntern.Desktop/Controls/CodeBlockControl.axaml.cs

using Avalonia.Controls;

namespace SeniorIntern.Desktop.Controls;

/// <summary>
/// User control for rendering a single code block extracted from LLM output.
/// Displays language badge, file path, code content, and action buttons.
/// </summary>
public partial class CodeBlockControl : UserControl
{
    public CodeBlockControl()
    {
        InitializeComponent();
    }
}
```

### 5. ChatMessageControl Updates

#### 5.1 Updated AXAML

```xml
<!-- src/SeniorIntern.Desktop/Views/ChatMessageControl.axaml -->

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:controls="using:SeniorIntern.Desktop.Controls"
             xmlns:conv="using:SeniorIntern.Desktop.Converters"
             x:Class="SeniorIntern.Desktop.Views.ChatMessageControl"
             x:DataType="vm:ChatMessageViewModel">

    <UserControl.Resources>
        <conv:GreaterThanOneConverter x:Key="GreaterThanOneConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Border.user-message">
            <Setter Property="Background" Value="{DynamicResource UserMessageBackground}" />
            <Setter Property="HorizontalAlignment" Value="Right" />
        </Style>
        <Style Selector="Border.assistant-message">
            <Setter Property="Background" Value="{DynamicResource AssistantMessageBackground}" />
            <Setter Property="HorizontalAlignment" Value="Left" />
        </Style>
    </UserControl.Styles>

    <Border x:Name="MessageBorder"
            Classes.user-message="{Binding IsUser}"
            Classes.assistant-message="{Binding IsAssistant}"
            CornerRadius="12"
            Padding="16"
            MaxWidth="800">

        <StackPanel Spacing="8">
            <!-- Role Label -->
            <TextBlock Text="{Binding RoleLabel}"
                       FontWeight="SemiBold"
                       FontSize="12"
                       Foreground="{DynamicResource TextMuted}" />

            <!-- Message Content -->
            <SelectableTextBlock Text="{Binding Content}"
                                 TextWrapping="Wrap"
                                 Foreground="{DynamicResource TextPrimary}" />

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- Code Blocks Section (NEW)                            -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <ItemsControl ItemsSource="{Binding CodeBlocks}"
                          IsVisible="{Binding HasCodeBlocks}"
                          Margin="0,8,0,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:CodeBlockViewModel}">
                        <controls:CodeBlockControl />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Code Block Summary (when multiple applicable blocks) -->
            <Border Classes="code-summary"
                    IsVisible="{Binding HasApplicableCode}"
                    Margin="0,8,0,0">
                <Grid ColumnDefinitions="*, Auto">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{StaticResource CodeIcon}"
                                  Width="16"
                                  Height="16"
                                  Foreground="{DynamicResource TextMuted}" />
                        <TextBlock Foreground="{DynamicResource TextPrimary}">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} code block(s), {1} applicable">
                                    <Binding Path="TotalBlockCount" />
                                    <Binding Path="ApplicableBlockCount" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Content="Apply All"
                            Theme="{StaticResource PrimaryButton}"
                            Padding="12,4"
                            IsVisible="{Binding ApplicableBlockCount, Converter={StaticResource GreaterThanOneConverter}}"
                            Command="{Binding ApplyAllBlocksCommand}" />
                </Grid>
            </Border>

            <!-- Loading Indicator -->
            <StackPanel Orientation="Horizontal"
                        IsVisible="{Binding IsStreaming}"
                        Spacing="8">
                <ProgressBar IsIndeterminate="True"
                             Width="50"
                             Height="4" />
                <TextBlock Text="Generating..."
                           FontStyle="Italic"
                           Foreground="{DynamicResource TextMuted}"
                           FontSize="12" />
            </StackPanel>
        </StackPanel>
    </Border>

</UserControl>
```

### 6. App.axaml Updates

Update the application resources to include converters and icons:

```xml
<!-- src/SeniorIntern.Desktop/App.axaml -->

<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="using:SeniorIntern.Desktop.Converters"
             x:Class="SeniorIntern.Desktop.App"
             RequestedThemeVariant="Dark">

    <Application.Styles>
        <FluentTheme />
    </Application.Styles>

    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceInclude Source="avares://SeniorIntern.Desktop/Themes/Dark.axaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters -->
            <conv:EnumEqualsConverter x:Key="EnumEqualsConverter" />
            <conv:GreaterThanOneConverter x:Key="GreaterThanOneConverter" />
            <conv:IsApplicableBlockConverter x:Key="IsApplicableBlockConverter" />
            <conv:InverseBoolConverter x:Key="InverseBoolConverter" />
            <conv:NotNullConverter x:Key="NotNullConverter" />

            <!-- Icon Resources -->
            <StreamGeometry x:Key="CopyIcon">M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z</StreamGeometry>
            <StreamGeometry x:Key="DiffIcon">M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z</StreamGeometry>
            <StreamGeometry x:Key="CodeIcon">M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z</StreamGeometry>
            <StreamGeometry x:Key="CheckIcon">M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z</StreamGeometry>
            <StreamGeometry x:Key="CloseIcon">M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z</StreamGeometry>
            <StreamGeometry x:Key="WarningIcon">M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z</StreamGeometry>
            <StreamGeometry x:Key="ExpandIcon">M7 10l5 5 5-5z</StreamGeometry>
            <StreamGeometry x:Key="CollapseIcon">M7 14l5-5 5 5z</StreamGeometry>
        </ResourceDictionary>
    </Application.Resources>

</Application>
```

---

## Visual Design Specifications

### Code Block Anatomy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEADER BAR                                                    H: 32px   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚  C#    â”‚ â”‚example â”‚ â”‚ src/Services/MyS...   â”‚ â”‚ 42 ln â”‚ â”‚ ğŸ“‹â”‚ â”‚Applyâ”‚â”‚
â”‚ â”‚ badge  â”‚ â”‚  type  â”‚ â”‚ file path (truncated) â”‚ â”‚ count â”‚ â”‚btnâ”‚ â”‚ btn â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CODE CONTENT                                        Max H: 400px scroll â”‚
â”‚                                                                         â”‚
â”‚ public class MyService : IMyService                                     â”‚
â”‚ {                                                                       â”‚
â”‚     private readonly ILogger<MyService> _logger;                        â”‚
â”‚                                                                         â”‚
â”‚     public MyService(ILogger<MyService> logger)                         â”‚
â”‚     {                                                                   â”‚
â”‚         _logger = logger;                                               â”‚
â”‚     }                                                                   â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FOOTER BAR (conditional)                                      H: 28px   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚ â”‚ âœ“ Applied      â”‚  (or: âœ— Rejected, âš  Conflict, â”â”â” Receiving...)     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Spacing and Padding

| Element | Padding/Margin | Value |
|---------|----------------|-------|
| Code block container | Margin | 0,8 (vertical spacing between blocks) |
| Code block container | CornerRadius | 6px |
| Header bar | Padding | 8,6 |
| Language badge | Padding | 6,2 |
| Language badge | CornerRadius | 3px |
| Code content | Padding | 12,8 |
| Status badge | Padding | 6,2 |
| Status badge | CornerRadius | 3px |
| Icon button | Min Size | 28x28 |
| Apply button | Padding | 8,4 |

### Typography

| Element | Font | Size | Weight |
|---------|------|------|--------|
| Language badge | System | 11px | SemiBold |
| Block type indicator | System | 10px | Normal |
| File path | Cascadia Code / Consolas | 12px | Normal |
| Line count | System | 11px | Normal |
| Code content | Cascadia Code / Consolas | 13px | Normal |
| Apply button | System | 12px | Normal |
| Status text | System | 11px | SemiBold |
| Streaming text | System | 11px | Italic |

### Color States

#### Code Block Container

| State | Background | Border | Border Thickness |
|-------|------------|--------|------------------|
| Default | #1E1E1E | #3E3E3E | 1px all sides |
| Applicable | #1E1E1E | AccentBrush | 1,1,1,3 (accent left) |
| Example | #1E1E1E (0.8 opacity) | #3E3E3E | 1px all sides |
| Command | #1A1A2E | #3E3E3E | 1px all sides |

#### Status Badges

| Status | Background | Foreground |
|--------|------------|------------|
| Applied | #1D3D1D | #89D185 |
| Rejected | #5A1D1D | #F48771 |
| Conflict | #5A3D1D | #F5C842 |
| PendingReview | (not shown) | - |
| Streaming | (progress bar) | - |

### Responsive Behavior

| Condition | Behavior |
|-----------|----------|
| Long file path | Truncate with ellipsis, show full path in tooltip |
| File path max width | 300px |
| Long code lines | Horizontal scroll (no wrap) |
| Many code lines | Vertical scroll after 400px |
| Narrow viewport | Header elements wrap or hide low-priority items |

---

## Files Summary

### Files to Create

| File | Purpose | Lines (Est.) |
|------|---------|--------------|
| `src/SeniorIntern.Desktop/Controls/CodeBlockControl.axaml` | Code block UI control | ~120 |
| `src/SeniorIntern.Desktop/Controls/CodeBlockControl.axaml.cs` | Code-behind | ~15 |
| `src/SeniorIntern.Desktop/Converters/CodeBlockConverters.cs` | UI value converters | ~100 |

### Files to Modify

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | Add code block color resources and styles (~100 lines) |
| `src/SeniorIntern.Desktop/Views/ChatMessageControl.axaml` | Add code blocks ItemsControl and summary panel (~40 lines) |
| `src/SeniorIntern.Desktop/App.axaml` | Add icon resources and converter registrations (~30 lines) |

---

## Testing Strategy

### Visual Verification Tests

Since UI rendering involves visual output, primary testing is through manual verification and design review:

| Test Case | Verification Steps |
|-----------|-------------------|
| Basic rendering | Code block displays with header, content, footer |
| Language badge | Badge shows correct language name with blue background |
| File path display | Path shows with monospace font, truncates with ellipsis |
| File path tooltip | Full path appears on hover |
| Line count | Shows "X lines" format correctly |
| Copy button | Icon visible, hover state works |
| Apply button visibility | Only shows for applicable blocks (CompleteFile, Snippet) |
| Apply button hidden | Hidden for Example, Command, Output, Config types |
| Applicable styling | Left accent border appears for applicable blocks |
| Example styling | Reduced opacity (0.8) for example blocks |
| Command styling | Dark blue background for command blocks |
| Status badge - Applied | Green background, checkmark icon, "Applied" text |
| Status badge - Rejected | Red background, X icon, "Rejected" text |
| Status badge - Conflict | Yellow background, warning icon, "Conflict" text |
| Streaming indicator | Progress bar animates, "Receiving..." text shows |
| Code scrolling | Horizontal scroll for long lines, vertical after 400px |
| Code selection | Text is selectable within code content |
| Summary panel | Shows when HasApplicableCode is true |
| Apply All button | Only visible when ApplicableBlockCount > 1 |

### Unit Tests for Converters

```csharp
// tests/SeniorIntern.Desktop.Tests/Converters/CodeBlockConvertersTests.cs

namespace SeniorIntern.Desktop.Tests.Converters;

public class EnumEqualsConverterTests
{
    [Fact]
    public void Convert_MatchingEnum_ReturnsTrue()
    {
        var converter = EnumEqualsConverter.Instance;
        var result = converter.Convert(CodeBlockStatus.Applied, typeof(bool), "Applied", CultureInfo.InvariantCulture);
        Assert.True((bool)result);
    }

    [Fact]
    public void Convert_NonMatchingEnum_ReturnsFalse()
    {
        var converter = EnumEqualsConverter.Instance;
        var result = converter.Convert(CodeBlockStatus.Applied, typeof(bool), "Rejected", CultureInfo.InvariantCulture);
        Assert.False((bool)result);
    }

    [Fact]
    public void Convert_CaseInsensitive_ReturnsTrue()
    {
        var converter = EnumEqualsConverter.Instance;
        var result = converter.Convert(CodeBlockStatus.Applied, typeof(bool), "applied", CultureInfo.InvariantCulture);
        Assert.True((bool)result);
    }

    [Fact]
    public void Convert_NullValue_ReturnsFalse()
    {
        var converter = EnumEqualsConverter.Instance;
        var result = converter.Convert(null, typeof(bool), "Applied", CultureInfo.InvariantCulture);
        Assert.False((bool)result);
    }

    [Fact]
    public void Convert_NullParameter_ReturnsFalse()
    {
        var converter = EnumEqualsConverter.Instance;
        var result = converter.Convert(CodeBlockStatus.Applied, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.False((bool)result);
    }
}

public class GreaterThanOneConverterTests
{
    [Theory]
    [InlineData(0, false)]
    [InlineData(1, false)]
    [InlineData(2, true)]
    [InlineData(10, true)]
    public void Convert_IntegerValues_ReturnsExpected(int value, bool expected)
    {
        var converter = GreaterThanOneConverter.Instance;
        var result = converter.Convert(value, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }

    [Fact]
    public void Convert_NonInteger_ReturnsFalse()
    {
        var converter = GreaterThanOneConverter.Instance;
        var result = converter.Convert("not an int", typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.False((bool)result);
    }
}

public class IsApplicableBlockConverterTests
{
    [Theory]
    [InlineData(CodeBlockType.CompleteFile, true)]
    [InlineData(CodeBlockType.Snippet, true)]
    [InlineData(CodeBlockType.Example, false)]
    [InlineData(CodeBlockType.Command, false)]
    [InlineData(CodeBlockType.Output, false)]
    [InlineData(CodeBlockType.Config, false)]
    public void Convert_BlockType_ReturnsExpected(CodeBlockType type, bool expected)
    {
        var converter = IsApplicableBlockConverter.Instance;
        var result = converter.Convert(type, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }
}

public class InverseBoolConverterTests
{
    [Theory]
    [InlineData(true, false)]
    [InlineData(false, true)]
    public void Convert_BoolValue_ReturnsInverse(bool value, bool expected)
    {
        var converter = InverseBoolConverter.Instance;
        var result = converter.Convert(value, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }

    [Theory]
    [InlineData(true, false)]
    [InlineData(false, true)]
    public void ConvertBack_BoolValue_ReturnsInverse(bool value, bool expected)
    {
        var converter = InverseBoolConverter.Instance;
        var result = converter.ConvertBack(value, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }
}

public class NotNullConverterTests
{
    [Fact]
    public void Convert_NonNullValue_ReturnsTrue()
    {
        var converter = NotNullConverter.Instance;
        var result = converter.Convert("something", typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.True((bool)result);
    }

    [Fact]
    public void Convert_NullValue_ReturnsFalse()
    {
        var converter = NotNullConverter.Instance;
        var result = converter.Convert(null, typeof(bool), null, CultureInfo.InvariantCulture);
        Assert.False((bool)result);
    }
}
```

### Test Summary

| Category | Test Count |
|----------|------------|
| EnumEqualsConverter | 5 |
| GreaterThanOneConverter | 2 |
| IsApplicableBlockConverter | 1 (parameterized with 6 cases) |
| InverseBoolConverter | 2 |
| NotNullConverter | 2 |
| **Total** | **12** |

---

## Acceptance Criteria

### Must Have

- [ ] CodeBlockControl renders with proper styling (background, border, corner radius)
- [ ] Language badges display correct display names with blue pill background
- [ ] File paths display with monospace font and truncate with ellipsis
- [ ] File path tooltips show full path on hover
- [ ] Line count displays in "X lines" format
- [ ] Copy button visible and positioned correctly in header
- [ ] Apply button only visible for applicable block types (CompleteFile, Snippet)
- [ ] Apply button hidden for non-applicable types (Example, Command, Output, Config)
- [ ] Applicable blocks have accent-colored left border
- [ ] Example blocks have reduced opacity (0.8)
- [ ] Command blocks have dark blue background
- [ ] Status badges show correct colors (green=applied, red=rejected, yellow=conflict)
- [ ] Status badges include appropriate icons (check, X, warning)
- [ ] Streaming indicator shows progress bar and "Receiving..." text
- [ ] Code text is selectable
- [ ] Horizontal scroll available for long code lines
- [ ] Vertical scroll available when content exceeds 400px height
- [ ] Code blocks render within ChatMessageControl
- [ ] Summary panel shows when message has applicable code blocks
- [ ] "Apply All" button only visible when ApplicableBlockCount > 1
- [ ] All converters work correctly

### Should Have

- [ ] Smooth transitions on hover states
- [ ] Consistent spacing between multiple code blocks
- [ ] Proper keyboard navigation support
- [ ] Screen reader accessibility (alt text on icons)

### Could Have

- [ ] Syntax highlighting (future enhancement)
- [ ] Collapse/expand functionality for long code blocks
- [ ] Copy feedback animation ("Copied!" tooltip)
- [ ] Line numbers in gutter

---

## Dependencies

### Required from Previous Parts

| Part | Dependency |
|------|------------|
| v0.4.1a | CodeBlockType, CodeBlockStatus enums |
| v0.4.1g | CodeBlockViewModel with all observable properties |
| v0.4.1g | ChatMessageViewModel.CodeBlocks collection |
| v0.4.1g | ChatMessageViewModel.HasCodeBlocks property |
| v0.4.1g | ChatMessageViewModel.HasApplicableCode property |
| v0.4.1g | ChatMessageViewModel.ApplicableBlockCount property |
| v0.4.1g | ChatMessageViewModel.TotalBlockCount property |
| v0.4.1g | ChatMessageViewModel.ApplyAllBlocksCommand |

### External Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| Avalonia | 11.x | UI framework |
| Avalonia.Themes.Fluent | 11.x | FluentTheme base |

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Font not available | Low | Low | Fallback chain: Cascadia Code â†’ Consolas â†’ monospace |
| Icon path rendering issues | Low | Medium | Test on multiple platforms |
| Converter null reference | Medium | Medium | Null checks in all converters |
| Style selector specificity conflicts | Medium | Low | Use unique class names, test in isolation |
| Performance with many code blocks | Low | Medium | ItemsControl virtualization if needed |
| ScrollViewer nested scroll issues | Low | Medium | Test scroll behavior thoroughly |

---

## Future Enhancements

The following are explicitly out of scope for v0.4.1h but documented for future consideration:

1. **Syntax Highlighting** (v0.5.x) - Integrate AvaloniaEdit or custom syntax highlighter
2. **Line Numbers** (v0.5.x) - Add gutter with line numbers
3. **Collapse/Expand** (v0.4.2) - Toggle to show/hide code content
4. **Copy Feedback** (v0.4.2) - "Copied!" tooltip animation
5. **Keyboard Shortcuts** (v0.4.2) - Ctrl+C to copy focused block
6. **Theme Variants** (v0.5.x) - Light theme support
7. **Custom Language Colors** (v0.5.x) - Per-language badge colors

---

## References

- [v0.4.1-code-block-extraction.md](v0.4.1-code-block-extraction.md) - Parent specification
- [v0.4.1g-viewmodel-integration.md](v0.4.1g-viewmodel-integration.md) - ViewModel definitions
- [Avalonia Documentation](https://docs.avaloniaui.net/) - UI framework reference
- [FluentAvalonia](https://github.com/amwx/FluentAvalonia) - Design system reference
- [Material Design Icons](https://materialdesignicons.com/) - Icon source

---

**Proceed to v0.4.2: Diff View & Apply**
- Create unified diff view for code changes
- Implement side-by-side comparison
- Add line-by-line apply/reject functionality
- Handle file conflicts and merge scenarios
