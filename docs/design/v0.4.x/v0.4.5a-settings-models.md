# v0.4.5a: Settings Models - Design Specification

**Status**: _PLANNED_

## Executive Summary

This specification details the **Settings Models** for The Senior Intern's Polish & Integration system, extending `AppSettings` with code generation preferences that persist across sessions. These settings control behavior for streaming diff previews, code block handling, backup creation, undo windows, diff viewer preferences, and change history management.

### Key Deliverables

| Component | Type | Purpose |
|-----------|------|---------|
| `DiffViewMode` | Enum | Display mode for diff viewer (SideBySide, Inline, Unified) |
| `CodeGenerationSettings` | Region | Settings group for code generation features |
| `DiffViewerSettings` | Region | Settings group for diff viewer preferences |
| `BackupSettings` | Region | Settings group for backup and undo behavior |
| `HistorySettings` | Region | Settings group for change history tracking |
| `AppSettingsValidator` | Class | Validates settings values and applies constraints |
| `SettingChangedEventArgs` | Class | Event args for setting change notifications |

---

## Feature Overview

```
v0.4.5a: Settings Models
├── DiffViewMode Enum
│   ├── SideBySide (default)
│   ├── Inline
│   └── Unified
├── AppSettings Extensions
│   ├── Code Generation Settings
│   │   ├── AutoDetectCodeBlocks (bool, default: true)
│   │   ├── ShowDiffPreviewDuringStreaming (bool, default: true)
│   │   ├── AutoExpandCodeBlocks (bool, default: true)
│   │   └── ShowCodeBlockQuickActions (bool, default: true)
│   ├── Diff Viewer Settings
│   │   ├── DefaultDiffViewMode (DiffViewMode, default: SideBySide)
│   │   ├── ShowLineNumbersInDiff (bool, default: true)
│   │   ├── HighlightWhitespaceChanges (bool, default: false)
│   │   ├── DiffContextLines (int, default: 3, range: 0-10)
│   │   └── SyntaxHighlightingInDiff (bool, default: true)
│   ├── Backup & Undo Settings
│   │   ├── CreateBackupBeforeApply (bool, default: true)
│   │   ├── UndoWindowMinutes (int, default: 30, range: 5-1440)
│   │   ├── MaxBackupAgeDays (int, default: 7, range: 1-90)
│   │   └── BackupDirectory (string?, default: null → ".senior-intern/backups")
│   ├── Apply Behavior Settings
│   │   ├── AutoRefreshEditorAfterApply (bool, default: true)
│   │   ├── ConfirmBeforeApply (bool, default: true)
│   │   ├── ShowApplyProgressOverlay (bool, default: true)
│   │   └── AutoCloseProgressOnSuccess (bool, default: true)
│   └── History Settings
│       ├── MaxChangeHistoryItems (int, default: 50, range: 10-500)
│       ├── TrackChangeHistory (bool, default: true)
│       └── PersistHistoryAcrossSessions (bool, default: true)
├── AppSettingsValidator
│   ├── Validate(AppSettings) → ValidationResult
│   ├── ApplyDefaults(AppSettings) → AppSettings
│   └── Constraint Constants
└── Setting Change Notification
    ├── ISettingsService.SettingChanged event
    └── SettingChangedEventArgs
```

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AppSettings                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    Existing Settings (v0.1.0 - v0.3.x)                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
│  │  │    Model    │  │  Inference  │  │     UI      │  │   Window    │   │  │
│  │  │  Settings   │  │  Settings   │  │  Settings   │  │   State     │   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    New Settings (v0.4.5a)                              │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                    Code Generation Settings                      │   │  │
│  │  │  ┌────────────────────┐  ┌────────────────────────────────────┐  │   │  │
│  │  │  │AutoDetectCodeBlocks│  │ShowDiffPreviewDuringStreaming     │  │   │  │
│  │  │  └────────────────────┘  └────────────────────────────────────┘  │   │  │
│  │  │  ┌────────────────────┐  ┌────────────────────────────────────┐  │   │  │
│  │  │  │AutoExpandCodeBlocks│  │ShowCodeBlockQuickActions           │  │   │  │
│  │  │  └────────────────────┘  └────────────────────────────────────┘  │   │  │
│  │  └─────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                     Diff Viewer Settings                         │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │DefaultDiffViewMode: enum │  │ShowLineNumbersInDiff: bool   │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │HighlightWhitespaceChanges│  │DiffContextLines: int (0-10)  │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  │  ┌──────────────────────────┐                                    │   │  │
│  │  │  │SyntaxHighlightingInDiff  │                                    │   │  │
│  │  │  └──────────────────────────┘                                    │   │  │
│  │  └─────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                     Backup & Undo Settings                       │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │CreateBackupBeforeApply   │  │UndoWindowMinutes (5-1440)    │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │MaxBackupAgeDays (1-90)   │  │BackupDirectory: string?      │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  └─────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                     Apply Behavior Settings                      │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │AutoRefreshEditorAfterApply│ │ConfirmBeforeApply: bool      │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │ShowApplyProgressOverlay  │  │AutoCloseProgressOnSuccess    │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  └─────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                         │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │  │
│  │  │                       History Settings                           │   │  │
│  │  │  ┌──────────────────────────┐  ┌──────────────────────────────┐  │   │  │
│  │  │  │MaxChangeHistoryItems     │  │TrackChangeHistory: bool      │  │   │  │
│  │  │  │      (10-500)            │  │                               │  │   │  │
│  │  │  └──────────────────────────┘  └──────────────────────────────┘  │   │  │
│  │  │  ┌──────────────────────────┐                                    │   │  │
│  │  │  │PersistHistoryAcross-     │                                    │   │  │
│  │  │  │Sessions: bool            │                                    │   │  │
│  │  │  └──────────────────────────┘                                    │   │  │
│  │  └─────────────────────────────────────────────────────────────────┘   │  │
│  │                                                                         │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Settings Consumer Diagram

```
                           ┌─────────────────────────────────────────┐
                           │              AppSettings                 │
                           │         (v0.4.5a additions)              │
                           └───────────────────┬─────────────────────┘
                                               │
                    ┌──────────────────────────┼──────────────────────────┐
                    │                          │                          │
                    ▼                          ▼                          ▼
    ┌───────────────────────────┐ ┌────────────────────────┐ ┌────────────────────────┐
    │   Code Generation         │ │    Diff Viewer         │ │    Backup & History    │
    │        Settings           │ │       Settings         │ │       Settings         │
    └─────────────┬─────────────┘ └───────────┬────────────┘ └───────────┬────────────┘
                  │                           │                          │
        ┌─────────┼─────────┐         ┌───────┴───────┐          ┌───────┴───────┐
        ▼         ▼         ▼         ▼               ▼          ▼               ▼
┌─────────────┐ ┌───────┐ ┌───────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────┐
│CodeBlock    │ │Stream-│ │Quick  │ │DiffView │ │DiffView │ │Undo     │ │Change       │
│Parser       │ │ingDiff│ │Actions│ │Control  │ │ViewModel│ │Manager  │ │History      │
│(v0.4.1)     │ │(v0.4.5b)│(v0.4.5g)│(v0.4.2)│ │(v0.4.2) │ │(v0.4.3) │ │Panel(v0.4.5h)│
└─────────────┘ └───────┘ └───────┘ └─────────┘ └─────────┘ └─────────┘ └─────────────┘
```

---

## Detailed Design

### 1. DiffViewMode Enum

```csharp
// src/SeniorIntern.Core/Models/DiffViewMode.cs
namespace SeniorIntern.Core.Models;

/// <summary>
/// Display mode for the diff viewer component.
/// </summary>
public enum DiffViewMode
{
    /// <summary>
    /// Side-by-side comparison with synchronized scrolling.
    /// Original content on left, new content on right.
    /// Best for: Viewing additions and modifications in context.
    /// </summary>
    SideBySide = 0,

    /// <summary>
    /// Inline changes with additions and deletions interleaved.
    /// Deletions shown with strikethrough, additions highlighted.
    /// Best for: Compact view of small changes.
    /// </summary>
    Inline = 1,

    /// <summary>
    /// Unified diff format (similar to git diff output).
    /// Lines prefixed with +/- indicators, context lines shown.
    /// Best for: Developers familiar with command-line diff tools.
    /// </summary>
    Unified = 2
}
```

### 2. Updated AppSettings Class

```csharp
// src/SeniorIntern.Core/Models/AppSettings.cs
namespace SeniorIntern.Core.Models;

public sealed class AppSettings
{
    // ═══════════════════════════════════════════════════════════════
    // Model Settings (existing from v0.1.0)
    // ═══════════════════════════════════════════════════════════════

    public string? LastModelPath { get; set; }
    public uint DefaultContextSize { get; set; } = 4096;
    public int DefaultGpuLayers { get; set; } = -1; // -1 = auto-detect
    public uint DefaultBatchSize { get; set; } = 512;

    // ═══════════════════════════════════════════════════════════════
    // Inference Settings (existing from v0.1.0)
    // ═══════════════════════════════════════════════════════════════

    public float Temperature { get; set; } = 0.7f;
    public float TopP { get; set; } = 0.9f;
    public int MaxTokens { get; set; } = 2048;

    // ═══════════════════════════════════════════════════════════════
    // UI Settings (existing from v0.1.0)
    // ═══════════════════════════════════════════════════════════════

    public string Theme { get; set; } = "Dark";
    public double SidebarWidth { get; set; } = 280;

    // ═══════════════════════════════════════════════════════════════
    // Window State (existing from v0.1.0)
    // ═══════════════════════════════════════════════════════════════

    public double WindowWidth { get; set; } = 1200;
    public double WindowHeight { get; set; } = 800;
    public double? WindowX { get; set; }
    public double? WindowY { get; set; }

    // ═══════════════════════════════════════════════════════════════
    // Code Generation Settings (v0.4.5a)
    // ═══════════════════════════════════════════════════════════════

    /// <summary>
    /// Automatically detect and parse code blocks from LLM responses.
    /// When enabled, code fences (```) are parsed into CodeBlock models.
    /// </summary>
    public bool AutoDetectCodeBlocks { get; set; } = true;

    /// <summary>
    /// Show diff preview while LLM is still streaming response.
    /// Enables real-time diff computation during generation.
    /// </summary>
    public bool ShowDiffPreviewDuringStreaming { get; set; } = true;

    /// <summary>
    /// Auto-expand code blocks in chat messages.
    /// When false, code blocks show collapsed by default.
    /// </summary>
    public bool AutoExpandCodeBlocks { get; set; } = true;

    /// <summary>
    /// Show quick action buttons (Copy, Apply, Preview) on code blocks.
    /// </summary>
    public bool ShowCodeBlockQuickActions { get; set; } = true;

    // ═══════════════════════════════════════════════════════════════
    // Diff Viewer Settings (v0.4.5a)
    // ═══════════════════════════════════════════════════════════════

    /// <summary>
    /// Default view mode for diff viewer.
    /// </summary>
    public DiffViewMode DefaultDiffViewMode { get; set; } = DiffViewMode.SideBySide;

    /// <summary>
    /// Show line numbers in diff viewer.
    /// </summary>
    public bool ShowLineNumbersInDiff { get; set; } = true;

    /// <summary>
    /// Highlight whitespace changes (spaces, tabs, line endings) in diff viewer.
    /// </summary>
    public bool HighlightWhitespaceChanges { get; set; } = false;

    /// <summary>
    /// Number of context lines to show around changes in diff viewer.
    /// Valid range: 0-10.
    /// </summary>
    public int DiffContextLines { get; set; } = 3;

    /// <summary>
    /// Enable syntax highlighting in diff viewer.
    /// </summary>
    public bool SyntaxHighlightingInDiff { get; set; } = true;

    // ═══════════════════════════════════════════════════════════════
    // Backup & Undo Settings (v0.4.5a)
    // ═══════════════════════════════════════════════════════════════

    /// <summary>
    /// Create backup file before applying changes.
    /// Enables undo functionality for applied changes.
    /// </summary>
    public bool CreateBackupBeforeApply { get; set; } = true;

    /// <summary>
    /// Time window in minutes during which undo is available.
    /// Valid range: 5-1440 (5 minutes to 24 hours).
    /// </summary>
    public int UndoWindowMinutes { get; set; } = 30;

    /// <summary>
    /// Maximum age in days for backup files before automatic cleanup.
    /// Valid range: 1-90 days.
    /// </summary>
    public int MaxBackupAgeDays { get; set; } = 7;

    /// <summary>
    /// Custom directory for storing backup files.
    /// Null uses default: ".senior-intern/backups" in workspace root.
    /// </summary>
    public string? BackupDirectory { get; set; }

    // ═══════════════════════════════════════════════════════════════
    // Apply Behavior Settings (v0.4.5a)
    // ═══════════════════════════════════════════════════════════════

    /// <summary>
    /// Automatically refresh/reload file in editor after applying changes.
    /// </summary>
    public bool AutoRefreshEditorAfterApply { get; set; } = true;

    /// <summary>
    /// Show confirmation dialog before applying changes.
    /// When false, changes apply immediately on click.
    /// </summary>
    public bool ConfirmBeforeApply { get; set; } = true;

    /// <summary>
    /// Show modal progress overlay during batch apply operations.
    /// </summary>
    public bool ShowApplyProgressOverlay { get; set; } = true;

    /// <summary>
    /// Automatically close progress overlay when operation succeeds.
    /// When false, overlay stays open until user dismisses it.
    /// </summary>
    public bool AutoCloseProgressOnSuccess { get; set; } = true;

    // ═══════════════════════════════════════════════════════════════
    // History Settings (v0.4.5a)
    // ═══════════════════════════════════════════════════════════════

    /// <summary>
    /// Maximum number of recent changes to track in history panel.
    /// Valid range: 10-500.
    /// </summary>
    public int MaxChangeHistoryItems { get; set; } = 50;

    /// <summary>
    /// Enable change history tracking.
    /// When disabled, no history is recorded.
    /// </summary>
    public bool TrackChangeHistory { get; set; } = true;

    /// <summary>
    /// Persist change history across application sessions.
    /// When false, history is cleared on restart.
    /// </summary>
    public bool PersistHistoryAcrossSessions { get; set; } = true;
}
```

### 3. AppSettingsValidator Class

```csharp
// src/SeniorIntern.Core/Validation/AppSettingsValidator.cs
namespace SeniorIntern.Core.Validation;

/// <summary>
/// Validates AppSettings values and applies constraints.
/// </summary>
public static class AppSettingsValidator
{
    // ═══════════════════════════════════════════════════════════════
    // Constraint Constants
    // ═══════════════════════════════════════════════════════════════

    public const int MinDiffContextLines = 0;
    public const int MaxDiffContextLines = 10;
    public const int DefaultDiffContextLines = 3;

    public const int MinUndoWindowMinutes = 5;
    public const int MaxUndoWindowMinutes = 1440; // 24 hours
    public const int DefaultUndoWindowMinutes = 30;

    public const int MinBackupAgeDays = 1;
    public const int MaxBackupAgeDays = 90;
    public const int DefaultBackupAgeDays = 7;

    public const int MinChangeHistoryItems = 10;
    public const int MaxChangeHistoryItems = 500;
    public const int DefaultChangeHistoryItems = 50;

    public const string DefaultBackupSubdirectory = ".senior-intern/backups";

    /// <summary>
    /// Validates the given settings and returns any validation issues.
    /// </summary>
    /// <param name="settings">The settings to validate.</param>
    /// <returns>A validation result containing any issues found.</returns>
    public static SettingsValidationResult Validate(AppSettings settings)
    {
        ArgumentNullException.ThrowIfNull(settings);

        var issues = new List<SettingsValidationIssue>();

        // Validate DiffContextLines
        if (settings.DiffContextLines < MinDiffContextLines ||
            settings.DiffContextLines > MaxDiffContextLines)
        {
            issues.Add(new SettingsValidationIssue(
                nameof(AppSettings.DiffContextLines),
                $"DiffContextLines must be between {MinDiffContextLines} and {MaxDiffContextLines}.",
                SettingsValidationSeverity.Warning,
                DefaultDiffContextLines));
        }

        // Validate UndoWindowMinutes
        if (settings.UndoWindowMinutes < MinUndoWindowMinutes ||
            settings.UndoWindowMinutes > MaxUndoWindowMinutes)
        {
            issues.Add(new SettingsValidationIssue(
                nameof(AppSettings.UndoWindowMinutes),
                $"UndoWindowMinutes must be between {MinUndoWindowMinutes} and {MaxUndoWindowMinutes}.",
                SettingsValidationSeverity.Warning,
                DefaultUndoWindowMinutes));
        }

        // Validate MaxBackupAgeDays
        if (settings.MaxBackupAgeDays < MinBackupAgeDays ||
            settings.MaxBackupAgeDays > MaxBackupAgeDays)
        {
            issues.Add(new SettingsValidationIssue(
                nameof(AppSettings.MaxBackupAgeDays),
                $"MaxBackupAgeDays must be between {MinBackupAgeDays} and {MaxBackupAgeDays}.",
                SettingsValidationSeverity.Warning,
                DefaultBackupAgeDays));
        }

        // Validate MaxChangeHistoryItems
        if (settings.MaxChangeHistoryItems < MinChangeHistoryItems ||
            settings.MaxChangeHistoryItems > MaxChangeHistoryItems)
        {
            issues.Add(new SettingsValidationIssue(
                nameof(AppSettings.MaxChangeHistoryItems),
                $"MaxChangeHistoryItems must be between {MinChangeHistoryItems} and {MaxChangeHistoryItems}.",
                SettingsValidationSeverity.Warning,
                DefaultChangeHistoryItems));
        }

        // Validate BackupDirectory path (if specified)
        if (!string.IsNullOrWhiteSpace(settings.BackupDirectory))
        {
            try
            {
                var path = Path.GetFullPath(settings.BackupDirectory);
                var invalidChars = Path.GetInvalidPathChars();
                if (settings.BackupDirectory.IndexOfAny(invalidChars) >= 0)
                {
                    issues.Add(new SettingsValidationIssue(
                        nameof(AppSettings.BackupDirectory),
                        "BackupDirectory contains invalid path characters.",
                        SettingsValidationSeverity.Error,
                        null));
                }
            }
            catch (Exception)
            {
                issues.Add(new SettingsValidationIssue(
                    nameof(AppSettings.BackupDirectory),
                    "BackupDirectory is not a valid path.",
                    SettingsValidationSeverity.Error,
                    null));
            }
        }

        // Validate DiffViewMode is a valid enum value
        if (!Enum.IsDefined(typeof(DiffViewMode), settings.DefaultDiffViewMode))
        {
            issues.Add(new SettingsValidationIssue(
                nameof(AppSettings.DefaultDiffViewMode),
                "DefaultDiffViewMode is not a valid value.",
                SettingsValidationSeverity.Warning,
                DiffViewMode.SideBySide));
        }

        return new SettingsValidationResult(issues);
    }

    /// <summary>
    /// Applies default values to any out-of-range settings.
    /// </summary>
    /// <param name="settings">The settings to normalize.</param>
    /// <returns>The normalized settings (same instance, modified in place).</returns>
    public static AppSettings ApplyDefaults(AppSettings settings)
    {
        ArgumentNullException.ThrowIfNull(settings);

        // Clamp DiffContextLines
        settings.DiffContextLines = Math.Clamp(
            settings.DiffContextLines,
            MinDiffContextLines,
            MaxDiffContextLines);

        // Clamp UndoWindowMinutes
        settings.UndoWindowMinutes = Math.Clamp(
            settings.UndoWindowMinutes,
            MinUndoWindowMinutes,
            MaxUndoWindowMinutes);

        // Clamp MaxBackupAgeDays
        settings.MaxBackupAgeDays = Math.Clamp(
            settings.MaxBackupAgeDays,
            MinBackupAgeDays,
            MaxBackupAgeDays);

        // Clamp MaxChangeHistoryItems
        settings.MaxChangeHistoryItems = Math.Clamp(
            settings.MaxChangeHistoryItems,
            MinChangeHistoryItems,
            MaxChangeHistoryItems);

        // Reset invalid DiffViewMode to default
        if (!Enum.IsDefined(typeof(DiffViewMode), settings.DefaultDiffViewMode))
        {
            settings.DefaultDiffViewMode = DiffViewMode.SideBySide;
        }

        return settings;
    }

    /// <summary>
    /// Gets the effective backup directory path.
    /// </summary>
    /// <param name="settings">The settings to read from.</param>
    /// <param name="workspaceRoot">The workspace root path.</param>
    /// <returns>The absolute path to the backup directory.</returns>
    public static string GetEffectiveBackupDirectory(AppSettings settings, string workspaceRoot)
    {
        ArgumentNullException.ThrowIfNull(settings);
        ArgumentException.ThrowIfNullOrWhiteSpace(workspaceRoot);

        if (!string.IsNullOrWhiteSpace(settings.BackupDirectory))
        {
            return Path.IsPathRooted(settings.BackupDirectory)
                ? settings.BackupDirectory
                : Path.Combine(workspaceRoot, settings.BackupDirectory);
        }

        return Path.Combine(workspaceRoot, DefaultBackupSubdirectory);
    }
}
```

### 4. SettingsValidationResult Class

```csharp
// src/SeniorIntern.Core/Validation/SettingsValidationResult.cs
namespace SeniorIntern.Core.Validation;

/// <summary>
/// Result of validating AppSettings.
/// </summary>
public sealed class SettingsValidationResult
{
    /// <summary>
    /// Creates a new validation result with the given issues.
    /// </summary>
    public SettingsValidationResult(IEnumerable<SettingsValidationIssue> issues)
    {
        Issues = issues?.ToList().AsReadOnly()
            ?? throw new ArgumentNullException(nameof(issues));
    }

    /// <summary>
    /// All validation issues found.
    /// </summary>
    public IReadOnlyList<SettingsValidationIssue> Issues { get; }

    /// <summary>
    /// True if all settings are valid (no errors, warnings acceptable).
    /// </summary>
    public bool IsValid => !Issues.Any(i => i.Severity == SettingsValidationSeverity.Error);

    /// <summary>
    /// True if there are no issues at all.
    /// </summary>
    public bool HasNoIssues => Issues.Count == 0;

    /// <summary>
    /// Get all error-severity issues.
    /// </summary>
    public IEnumerable<SettingsValidationIssue> Errors =>
        Issues.Where(i => i.Severity == SettingsValidationSeverity.Error);

    /// <summary>
    /// Get all warning-severity issues.
    /// </summary>
    public IEnumerable<SettingsValidationIssue> Warnings =>
        Issues.Where(i => i.Severity == SettingsValidationSeverity.Warning);

    /// <summary>
    /// Creates a valid result with no issues.
    /// </summary>
    public static SettingsValidationResult Valid() =>
        new(Array.Empty<SettingsValidationIssue>());
}

/// <summary>
/// A single validation issue for a settings property.
/// </summary>
/// <param name="PropertyName">Name of the property with the issue.</param>
/// <param name="Message">Human-readable description of the issue.</param>
/// <param name="Severity">Severity level of the issue.</param>
/// <param name="SuggestedValue">Suggested value to fix the issue (if applicable).</param>
public sealed record SettingsValidationIssue(
    string PropertyName,
    string Message,
    SettingsValidationSeverity Severity,
    object? SuggestedValue);

/// <summary>
/// Severity level for settings validation issues.
/// </summary>
public enum SettingsValidationSeverity
{
    /// <summary>
    /// Informational note, not a problem.
    /// </summary>
    Info,

    /// <summary>
    /// Out-of-range or unusual value, will be clamped/fixed.
    /// </summary>
    Warning,

    /// <summary>
    /// Invalid value that cannot be automatically fixed.
    /// </summary>
    Error
}
```

### 5. SettingChangedEventArgs Class

```csharp
// src/SeniorIntern.Core/Events/SettingChangedEventArgs.cs
namespace SeniorIntern.Core.Events;

/// <summary>
/// Event arguments for when a setting value changes.
/// </summary>
public sealed class SettingChangedEventArgs : EventArgs
{
    /// <summary>
    /// Creates new setting changed event args.
    /// </summary>
    /// <param name="propertyName">Name of the changed property.</param>
    /// <param name="oldValue">Previous value (may be null).</param>
    /// <param name="newValue">New value (may be null).</param>
    public SettingChangedEventArgs(string propertyName, object? oldValue, object? newValue)
    {
        PropertyName = propertyName ?? throw new ArgumentNullException(nameof(propertyName));
        OldValue = oldValue;
        NewValue = newValue;
        ChangedAt = DateTime.UtcNow;
    }

    /// <summary>
    /// Name of the property that changed.
    /// </summary>
    public string PropertyName { get; }

    /// <summary>
    /// Previous value of the setting.
    /// </summary>
    public object? OldValue { get; }

    /// <summary>
    /// New value of the setting.
    /// </summary>
    public object? NewValue { get; }

    /// <summary>
    /// Timestamp when the change occurred.
    /// </summary>
    public DateTime ChangedAt { get; }

    /// <summary>
    /// Checks if the changed property matches the given name.
    /// </summary>
    public bool IsProperty(string name) =>
        string.Equals(PropertyName, name, StringComparison.Ordinal);

    /// <summary>
    /// Gets the new value as the specified type.
    /// </summary>
    public T? GetNewValue<T>() => NewValue is T value ? value : default;

    /// <summary>
    /// Gets the old value as the specified type.
    /// </summary>
    public T? GetOldValue<T>() => OldValue is T value ? value : default;
}
```

### 6. ISettingsService Interface Update

```csharp
// src/SeniorIntern.Core/Interfaces/ISettingsService.cs (additions)
using SeniorIntern.Core.Events;

namespace SeniorIntern.Core.Interfaces;

/// <summary>
/// Service for managing application settings.
/// </summary>
public interface ISettingsService
{
    // ... existing members ...

    /// <summary>
    /// Event raised when any setting value changes.
    /// </summary>
    event EventHandler<SettingChangedEventArgs>? SettingChanged;

    /// <summary>
    /// Gets the current settings, validating and applying defaults if needed.
    /// </summary>
    /// <param name="cancellationToken">Cancellation token.</param>
    /// <returns>The validated settings.</returns>
    Task<AppSettings> GetValidatedSettingsAsync(CancellationToken cancellationToken = default);

    /// <summary>
    /// Updates a single setting value.
    /// </summary>
    /// <typeparam name="T">Type of the setting value.</typeparam>
    /// <param name="propertyName">Name of the property to update.</param>
    /// <param name="value">New value for the setting.</param>
    /// <param name="cancellationToken">Cancellation token.</param>
    Task UpdateSettingAsync<T>(
        string propertyName,
        T value,
        CancellationToken cancellationToken = default);

    /// <summary>
    /// Resets all code generation settings to defaults.
    /// </summary>
    Task ResetCodeGenerationSettingsAsync(CancellationToken cancellationToken = default);
}
```

### 7. Settings Defaults Provider

```csharp
// src/SeniorIntern.Core/Configuration/SettingsDefaults.cs
namespace SeniorIntern.Core.Configuration;

/// <summary>
/// Provides default values for all AppSettings properties.
/// Centralized location for defaults to ensure consistency.
/// </summary>
public static class SettingsDefaults
{
    // ═══════════════════════════════════════════════════════════════
    // Code Generation Defaults
    // ═══════════════════════════════════════════════════════════════

    public const bool AutoDetectCodeBlocks = true;
    public const bool ShowDiffPreviewDuringStreaming = true;
    public const bool AutoExpandCodeBlocks = true;
    public const bool ShowCodeBlockQuickActions = true;

    // ═══════════════════════════════════════════════════════════════
    // Diff Viewer Defaults
    // ═══════════════════════════════════════════════════════════════

    public const DiffViewMode DefaultDiffViewMode = DiffViewMode.SideBySide;
    public const bool ShowLineNumbersInDiff = true;
    public const bool HighlightWhitespaceChanges = false;
    public const int DiffContextLines = 3;
    public const bool SyntaxHighlightingInDiff = true;

    // ═══════════════════════════════════════════════════════════════
    // Backup & Undo Defaults
    // ═══════════════════════════════════════════════════════════════

    public const bool CreateBackupBeforeApply = true;
    public const int UndoWindowMinutes = 30;
    public const int MaxBackupAgeDays = 7;
    public const string? BackupDirectory = null;

    // ═══════════════════════════════════════════════════════════════
    // Apply Behavior Defaults
    // ═══════════════════════════════════════════════════════════════

    public const bool AutoRefreshEditorAfterApply = true;
    public const bool ConfirmBeforeApply = true;
    public const bool ShowApplyProgressOverlay = true;
    public const bool AutoCloseProgressOnSuccess = true;

    // ═══════════════════════════════════════════════════════════════
    // History Defaults
    // ═══════════════════════════════════════════════════════════════

    public const int MaxChangeHistoryItems = 50;
    public const bool TrackChangeHistory = true;
    public const bool PersistHistoryAcrossSessions = true;

    /// <summary>
    /// Creates a new AppSettings instance with all default values.
    /// </summary>
    public static AppSettings CreateDefault() => new()
    {
        // Code Generation
        AutoDetectCodeBlocks = SettingsDefaults.AutoDetectCodeBlocks,
        ShowDiffPreviewDuringStreaming = SettingsDefaults.ShowDiffPreviewDuringStreaming,
        AutoExpandCodeBlocks = SettingsDefaults.AutoExpandCodeBlocks,
        ShowCodeBlockQuickActions = SettingsDefaults.ShowCodeBlockQuickActions,

        // Diff Viewer
        DefaultDiffViewMode = SettingsDefaults.DefaultDiffViewMode,
        ShowLineNumbersInDiff = SettingsDefaults.ShowLineNumbersInDiff,
        HighlightWhitespaceChanges = SettingsDefaults.HighlightWhitespaceChanges,
        DiffContextLines = SettingsDefaults.DiffContextLines,
        SyntaxHighlightingInDiff = SettingsDefaults.SyntaxHighlightingInDiff,

        // Backup & Undo
        CreateBackupBeforeApply = SettingsDefaults.CreateBackupBeforeApply,
        UndoWindowMinutes = SettingsDefaults.UndoWindowMinutes,
        MaxBackupAgeDays = SettingsDefaults.MaxBackupAgeDays,
        BackupDirectory = SettingsDefaults.BackupDirectory,

        // Apply Behavior
        AutoRefreshEditorAfterApply = SettingsDefaults.AutoRefreshEditorAfterApply,
        ConfirmBeforeApply = SettingsDefaults.ConfirmBeforeApply,
        ShowApplyProgressOverlay = SettingsDefaults.ShowApplyProgressOverlay,
        AutoCloseProgressOnSuccess = SettingsDefaults.AutoCloseProgressOnSuccess,

        // History
        MaxChangeHistoryItems = SettingsDefaults.MaxChangeHistoryItems,
        TrackChangeHistory = SettingsDefaults.TrackChangeHistory,
        PersistHistoryAcrossSessions = SettingsDefaults.PersistHistoryAcrossSessions
    };
}
```

---

## Unit Tests

### DiffViewModeTests

```csharp
// tests/SeniorIntern.Core.Tests/Models/DiffViewModeTests.cs
namespace SeniorIntern.Core.Tests.Models;

public class DiffViewModeTests
{
    [Fact]
    public void DiffViewMode_ShouldHaveThreeValues()
    {
        // Arrange & Act
        var values = Enum.GetValues<DiffViewMode>();

        // Assert
        Assert.Equal(3, values.Length);
    }

    [Theory]
    [InlineData(DiffViewMode.SideBySide, 0)]
    [InlineData(DiffViewMode.Inline, 1)]
    [InlineData(DiffViewMode.Unified, 2)]
    public void DiffViewMode_ShouldHaveCorrectUnderlyingValues(DiffViewMode mode, int expected)
    {
        // Act
        var value = (int)mode;

        // Assert
        Assert.Equal(expected, value);
    }

    [Fact]
    public void DiffViewMode_SideBySide_ShouldBeDefault()
    {
        // Arrange
        var settings = new AppSettings();

        // Assert
        Assert.Equal(DiffViewMode.SideBySide, settings.DefaultDiffViewMode);
    }
}
```

### AppSettingsValidatorTests

```csharp
// tests/SeniorIntern.Core.Tests/Validation/AppSettingsValidatorTests.cs
namespace SeniorIntern.Core.Tests.Validation;

public class AppSettingsValidatorTests
{
    [Fact]
    public void Validate_WithDefaultSettings_ShouldReturnValid()
    {
        // Arrange
        var settings = new AppSettings();

        // Act
        var result = AppSettingsValidator.Validate(settings);

        // Assert
        Assert.True(result.IsValid);
        Assert.True(result.HasNoIssues);
    }

    [Theory]
    [InlineData(-1)]
    [InlineData(11)]
    [InlineData(100)]
    public void Validate_WithInvalidDiffContextLines_ShouldReturnWarning(int value)
    {
        // Arrange
        var settings = new AppSettings { DiffContextLines = value };

        // Act
        var result = AppSettingsValidator.Validate(settings);

        // Assert
        Assert.True(result.IsValid); // Warnings don't make it invalid
        Assert.Contains(result.Issues, i =>
            i.PropertyName == nameof(AppSettings.DiffContextLines));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(-1)]
    [InlineData(91)]
    [InlineData(365)]
    public void Validate_WithInvalidMaxBackupAgeDays_ShouldReturnWarning(int value)
    {
        // Arrange
        var settings = new AppSettings { MaxBackupAgeDays = value };

        // Act
        var result = AppSettingsValidator.Validate(settings);

        // Assert
        Assert.Contains(result.Issues, i =>
            i.PropertyName == nameof(AppSettings.MaxBackupAgeDays));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(4)]
    [InlineData(1441)]
    public void Validate_WithInvalidUndoWindowMinutes_ShouldReturnWarning(int value)
    {
        // Arrange
        var settings = new AppSettings { UndoWindowMinutes = value };

        // Act
        var result = AppSettingsValidator.Validate(settings);

        // Assert
        Assert.Contains(result.Issues, i =>
            i.PropertyName == nameof(AppSettings.UndoWindowMinutes));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(9)]
    [InlineData(501)]
    public void Validate_WithInvalidMaxChangeHistoryItems_ShouldReturnWarning(int value)
    {
        // Arrange
        var settings = new AppSettings { MaxChangeHistoryItems = value };

        // Act
        var result = AppSettingsValidator.Validate(settings);

        // Assert
        Assert.Contains(result.Issues, i =>
            i.PropertyName == nameof(AppSettings.MaxChangeHistoryItems));
    }

    [Fact]
    public void ApplyDefaults_ShouldClampDiffContextLines()
    {
        // Arrange
        var settings = new AppSettings { DiffContextLines = 50 };

        // Act
        AppSettingsValidator.ApplyDefaults(settings);

        // Assert
        Assert.Equal(AppSettingsValidator.MaxDiffContextLines, settings.DiffContextLines);
    }

    [Fact]
    public void ApplyDefaults_ShouldClampUndoWindowMinutes()
    {
        // Arrange
        var settings = new AppSettings { UndoWindowMinutes = 2 };

        // Act
        AppSettingsValidator.ApplyDefaults(settings);

        // Assert
        Assert.Equal(AppSettingsValidator.MinUndoWindowMinutes, settings.UndoWindowMinutes);
    }

    [Fact]
    public void ApplyDefaults_ShouldResetInvalidDiffViewMode()
    {
        // Arrange
        var settings = new AppSettings { DefaultDiffViewMode = (DiffViewMode)99 };

        // Act
        AppSettingsValidator.ApplyDefaults(settings);

        // Assert
        Assert.Equal(DiffViewMode.SideBySide, settings.DefaultDiffViewMode);
    }

    [Theory]
    [InlineData(null, "/workspace", "/workspace/.senior-intern/backups")]
    [InlineData("", "/workspace", "/workspace/.senior-intern/backups")]
    [InlineData("custom/backups", "/workspace", "/workspace/custom/backups")]
    [InlineData("/absolute/path", "/workspace", "/absolute/path")]
    public void GetEffectiveBackupDirectory_ShouldReturnCorrectPath(
        string? backupDir, string workspaceRoot, string expected)
    {
        // Arrange
        var settings = new AppSettings { BackupDirectory = backupDir };

        // Act
        var result = AppSettingsValidator.GetEffectiveBackupDirectory(settings, workspaceRoot);

        // Assert
        Assert.Equal(expected, result.Replace('\\', '/'));
    }
}
```

### SettingChangedEventArgsTests

```csharp
// tests/SeniorIntern.Core.Tests/Events/SettingChangedEventArgsTests.cs
namespace SeniorIntern.Core.Tests.Events;

public class SettingChangedEventArgsTests
{
    [Fact]
    public void Constructor_ShouldSetProperties()
    {
        // Arrange & Act
        var args = new SettingChangedEventArgs("TestProperty", "old", "new");

        // Assert
        Assert.Equal("TestProperty", args.PropertyName);
        Assert.Equal("old", args.OldValue);
        Assert.Equal("new", args.NewValue);
        Assert.True(args.ChangedAt <= DateTime.UtcNow);
    }

    [Fact]
    public void Constructor_WithNullPropertyName_ShouldThrow()
    {
        // Act & Assert
        Assert.Throws<ArgumentNullException>(() =>
            new SettingChangedEventArgs(null!, "old", "new"));
    }

    [Fact]
    public void IsProperty_WithMatchingName_ShouldReturnTrue()
    {
        // Arrange
        var args = new SettingChangedEventArgs("DiffContextLines", 3, 5);

        // Act & Assert
        Assert.True(args.IsProperty("DiffContextLines"));
        Assert.False(args.IsProperty("diffcontextlines")); // Case-sensitive
    }

    [Fact]
    public void GetNewValue_ShouldCastCorrectly()
    {
        // Arrange
        var args = new SettingChangedEventArgs("DiffContextLines", 3, 5);

        // Act
        var newValue = args.GetNewValue<int>();
        var oldValue = args.GetOldValue<int>();

        // Assert
        Assert.Equal(5, newValue);
        Assert.Equal(3, oldValue);
    }

    [Fact]
    public void GetNewValue_WithWrongType_ShouldReturnDefault()
    {
        // Arrange
        var args = new SettingChangedEventArgs("DiffContextLines", 3, 5);

        // Act
        var result = args.GetNewValue<string>();

        // Assert
        Assert.Null(result);
    }
}
```

### SettingsDefaultsTests

```csharp
// tests/SeniorIntern.Core.Tests/Configuration/SettingsDefaultsTests.cs
namespace SeniorIntern.Core.Tests.Configuration;

public class SettingsDefaultsTests
{
    [Fact]
    public void CreateDefault_ShouldReturnValidSettings()
    {
        // Act
        var settings = SettingsDefaults.CreateDefault();

        // Assert
        var result = AppSettingsValidator.Validate(settings);
        Assert.True(result.IsValid);
        Assert.True(result.HasNoIssues);
    }

    [Fact]
    public void CreateDefault_ShouldMatchConstantValues()
    {
        // Act
        var settings = SettingsDefaults.CreateDefault();

        // Assert - Code Generation
        Assert.Equal(SettingsDefaults.AutoDetectCodeBlocks, settings.AutoDetectCodeBlocks);
        Assert.Equal(SettingsDefaults.ShowDiffPreviewDuringStreaming, settings.ShowDiffPreviewDuringStreaming);
        Assert.Equal(SettingsDefaults.AutoExpandCodeBlocks, settings.AutoExpandCodeBlocks);
        Assert.Equal(SettingsDefaults.ShowCodeBlockQuickActions, settings.ShowCodeBlockQuickActions);

        // Assert - Diff Viewer
        Assert.Equal(SettingsDefaults.DefaultDiffViewMode, settings.DefaultDiffViewMode);
        Assert.Equal(SettingsDefaults.ShowLineNumbersInDiff, settings.ShowLineNumbersInDiff);
        Assert.Equal(SettingsDefaults.HighlightWhitespaceChanges, settings.HighlightWhitespaceChanges);
        Assert.Equal(SettingsDefaults.DiffContextLines, settings.DiffContextLines);
        Assert.Equal(SettingsDefaults.SyntaxHighlightingInDiff, settings.SyntaxHighlightingInDiff);

        // Assert - Backup & Undo
        Assert.Equal(SettingsDefaults.CreateBackupBeforeApply, settings.CreateBackupBeforeApply);
        Assert.Equal(SettingsDefaults.UndoWindowMinutes, settings.UndoWindowMinutes);
        Assert.Equal(SettingsDefaults.MaxBackupAgeDays, settings.MaxBackupAgeDays);
        Assert.Equal(SettingsDefaults.BackupDirectory, settings.BackupDirectory);

        // Assert - Apply Behavior
        Assert.Equal(SettingsDefaults.AutoRefreshEditorAfterApply, settings.AutoRefreshEditorAfterApply);
        Assert.Equal(SettingsDefaults.ConfirmBeforeApply, settings.ConfirmBeforeApply);
        Assert.Equal(SettingsDefaults.ShowApplyProgressOverlay, settings.ShowApplyProgressOverlay);
        Assert.Equal(SettingsDefaults.AutoCloseProgressOnSuccess, settings.AutoCloseProgressOnSuccess);

        // Assert - History
        Assert.Equal(SettingsDefaults.MaxChangeHistoryItems, settings.MaxChangeHistoryItems);
        Assert.Equal(SettingsDefaults.TrackChangeHistory, settings.TrackChangeHistory);
        Assert.Equal(SettingsDefaults.PersistHistoryAcrossSessions, settings.PersistHistoryAcrossSessions);
    }
}
```

---

## Files to Create

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Core/Models/DiffViewMode.cs` | Diff view mode enum |
| `src/SeniorIntern.Core/Validation/AppSettingsValidator.cs` | Settings validation logic |
| `src/SeniorIntern.Core/Validation/SettingsValidationResult.cs` | Validation result models |
| `src/SeniorIntern.Core/Events/SettingChangedEventArgs.cs` | Setting change event args |
| `src/SeniorIntern.Core/Configuration/SettingsDefaults.cs` | Centralized default values |
| `tests/SeniorIntern.Core.Tests/Models/DiffViewModeTests.cs` | Enum tests |
| `tests/SeniorIntern.Core.Tests/Validation/AppSettingsValidatorTests.cs` | Validator tests |
| `tests/SeniorIntern.Core.Tests/Events/SettingChangedEventArgsTests.cs` | Event args tests |
| `tests/SeniorIntern.Core.Tests/Configuration/SettingsDefaultsTests.cs` | Defaults tests |

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/SeniorIntern.Core/Models/AppSettings.cs` | Add all v0.4.5a settings properties |
| `src/SeniorIntern.Core/Interfaces/ISettingsService.cs` | Add SettingChanged event and new methods |

---

## Acceptance Criteria

### Functional Requirements

1. **DiffViewMode Enum**
   - [ ] Has three values: SideBySide (0), Inline (1), Unified (2)
   - [ ] Default value is SideBySide

2. **AppSettings Extensions**
   - [ ] All 17 new settings properties are defined
   - [ ] All properties have XML documentation
   - [ ] All properties have sensible default values
   - [ ] Existing settings remain unchanged

3. **Validation**
   - [ ] DiffContextLines validated: 0-10
   - [ ] UndoWindowMinutes validated: 5-1440
   - [ ] MaxBackupAgeDays validated: 1-90
   - [ ] MaxChangeHistoryItems validated: 10-500
   - [ ] BackupDirectory path validated for invalid characters
   - [ ] DiffViewMode validated for defined enum values

4. **Defaults Application**
   - [ ] Out-of-range values are clamped to valid range
   - [ ] Invalid enum values reset to defaults
   - [ ] Valid values are preserved

5. **Setting Change Notification**
   - [ ] SettingChangedEventArgs captures property name, old value, new value
   - [ ] ChangedAt timestamp is populated
   - [ ] Helper methods work correctly

### Non-Functional Requirements

1. **Serialization Compatibility**
   - [ ] Settings serialize to JSON correctly
   - [ ] Settings deserialize from JSON correctly
   - [ ] Missing properties use defaults during deserialization
   - [ ] Unknown properties are ignored during deserialization

2. **Thread Safety**
   - [ ] SettingChangedEventArgs is immutable
   - [ ] Validation methods are thread-safe (stateless)

3. **Backward Compatibility**
   - [ ] Existing settings files from previous versions load successfully
   - [ ] New settings use defaults when not present in saved file

---

## Design Decisions

### 1. Settings Organization

**Decision**: Group settings by feature area rather than creating nested objects.

**Rationale**:
- Simpler JSON serialization (flat structure)
- Easier to add new settings without breaking existing serialization
- Comments/regions provide logical grouping in code
- Consistent with existing AppSettings pattern

**Alternatives Considered**:
- Nested settings objects (e.g., `AppSettings.CodeGeneration.AutoDetect`) - More complex serialization
- Separate settings classes per feature - Harder to manage single settings file

### 2. Validation Strategy

**Decision**: Use static validator class with explicit Validate/ApplyDefaults methods.

**Rationale**:
- Validation can be called at load time, save time, or on-demand
- ApplyDefaults allows auto-correction without rejecting entire settings
- Warnings vs Errors distinction allows graceful handling
- Centralized validation constants for consistency

**Alternatives Considered**:
- Data annotations on properties - Less flexible, harder to customize messages
- Constructor validation - Can't fix invalid persisted settings
- Property setters with validation - Side effects on deserialization

### 3. Default Values Provider

**Decision**: Create SettingsDefaults static class with constants and factory method.

**Rationale**:
- Single source of truth for all default values
- Constants usable in validation and testing
- Factory method ensures new AppSettings instances match documented defaults
- Easier to maintain than scattered default values in property initializers

### 4. Event-Based Change Notification

**Decision**: Use EventHandler<SettingChangedEventArgs> on ISettingsService.

**Rationale**:
- Standard .NET event pattern
- Components can subscribe to relevant changes
- Supports UI bindings and reactive updates
- Property name allows filtering for specific settings

**Alternatives Considered**:
- INotifyPropertyChanged on AppSettings - Requires more boilerplate, harder with POCO
- WeakReferenceMessenger - Adds MVVM Toolkit dependency to Core
- Observer pattern - More complex for simple notification needs

### 5. Backup Directory Handling

**Decision**: Allow null for BackupDirectory with computed default path.

**Rationale**:
- Null signals "use default location"
- Default location (.senior-intern/backups) keeps backups in workspace
- GetEffectiveBackupDirectory handles resolution at runtime
- Users can override with absolute or relative paths

---

## Accessibility Considerations

1. **Settings UI (future v0.4.5 panels)**
   - All settings should have descriptive labels and tooltips
   - Numeric inputs should support keyboard increment/decrement
   - Enum dropdowns should be keyboard navigable

2. **Screen Reader Support**
   - Setting descriptions should be exposed via automation properties
   - Validation errors should be announced

---

## Performance Considerations

1. **Settings Loading**
   - Settings loaded once at startup, cached in memory
   - Validation runs once after load, not on every access
   - ApplyDefaults modifies in-place, no allocations

2. **Change Notifications**
   - Events fired only when value actually changes
   - Subscribers should avoid heavy processing in handlers

3. **Serialization**
   - JSON serialization uses System.Text.Json (fast, low allocation)
   - Unknown properties ignored during deserialization (forward compatibility)

---

## Dependencies

### Internal Dependencies
- None (this is a foundational spec)

### External Dependencies
- System.Text.Json (for serialization, existing)

### Consumers (future specs)
- v0.4.5b (Streaming Diff Preview) - Uses ShowDiffPreviewDuringStreaming
- v0.4.5e (Snippet Options UI) - Uses ConfirmBeforeApply
- v0.4.5g (Quick Actions) - Uses ShowCodeBlockQuickActions
- v0.4.5h (Change History Panel) - Uses MaxChangeHistoryItems, TrackChangeHistory
- v0.4.3 (Apply Changes) - Uses CreateBackupBeforeApply, UndoWindowMinutes
- v0.4.2 (Diff Engine) - Uses DefaultDiffViewMode, DiffContextLines

---

## Future Considerations

1. **Settings Migration**
   - If settings schema changes significantly, may need migration logic
   - Version field could help detect old settings format

2. **Per-Workspace Settings**
   - Currently settings are global
   - May want workspace-specific overrides in future

3. **Settings Profiles**
   - Power users may want to save/load settings profiles
   - Could add import/export functionality

4. **Settings Sync**
   - Cloud sync of settings across machines
   - Would require account integration
