# v0.4.4g: Progress Overlay - Design Specification

**Status**: _IMPLEMENTED_

## Executive Summary

This specification details the **Progress Overlay** for The Senior Intern's Multi-File Creation system. The overlay provides visual feedback during batch apply operations, displaying the current phase, file being processed, progress percentage, and file counts. It includes cancellation support for safe operation termination and auto-hides on completion. This component is essential for user confidence during potentially lengthy file operations.

### Key Deliverables

| Component | Type | Purpose |
|-----------|------|---------|
| `ApplyProgressOverlay.axaml` | UserControl | Semi-transparent overlay with progress UI |
| `ApplyProgressOverlay.axaml.cs` | Code-behind | Minimal code-behind for overlay |
| `ApplyProgressViewModel` | ViewModel | Progress state and cancellation logic |
| `PhaseToIconConverter` | IValueConverter | Converts BatchApplyPhase to icon geometry |
| `PhaseToTitleConverter` | IValueConverter | Converts BatchApplyPhase to display title |
| `ApplyProgressStyles.axaml` | ResourceDictionary | Overlay-specific styles |

---

## Feature Overview

```
v0.4.4g: Progress Overlay
â”œâ”€â”€ ApplyProgressOverlay.axaml
â”‚   â”œâ”€â”€ Layout Structure
â”‚   â”‚   â”œâ”€â”€ Semi-transparent backdrop (#CC000000)
â”‚   â”‚   â”œâ”€â”€ Centered modal card (400px min-width)
â”‚   â”‚   â”œâ”€â”€ Drop shadow for elevation (BoxShadow)
â”‚   â”‚   â””â”€â”€ IsVisible bound to ViewModel.IsVisible
â”‚   â”œâ”€â”€ Content Structure (5-row Grid)
â”‚   â”‚   â”œâ”€â”€ Row 0: Phase Icon (48x48 PathIcon)
â”‚   â”‚   â”œâ”€â”€ Row 1: Phase Title (18pt, SemiBold)
â”‚   â”‚   â”œâ”€â”€ Row 2: Current File (muted, ellipsis)
â”‚   â”‚   â”œâ”€â”€ Row 3: Progress Bar + Percentage
â”‚   â”‚   â””â”€â”€ Row 4: File Count + Cancel Button
â”‚   â””â”€â”€ Accessibility
â”‚       â”œâ”€â”€ AutomationProperties.Name
â”‚       â”œâ”€â”€ IsTabStop on Cancel button
â”‚       â””â”€â”€ KeyboardNavigation.TabNavigation
â”œâ”€â”€ ApplyProgressViewModel
â”‚   â”œâ”€â”€ Observable Properties
â”‚   â”‚   â”œâ”€â”€ IsVisible (bool)
â”‚   â”‚   â”œâ”€â”€ Phase (BatchApplyPhase)
â”‚   â”‚   â”œâ”€â”€ CurrentFile (string)
â”‚   â”‚   â”œâ”€â”€ ProgressPercent (double, 0-100)
â”‚   â”‚   â”œâ”€â”€ CompletedCount (int)
â”‚   â”‚   â”œâ”€â”€ TotalCount (int)
â”‚   â”‚   â””â”€â”€ CanCancel (bool)
â”‚   â”œâ”€â”€ Computed Properties
â”‚   â”‚   â”œâ”€â”€ PhaseTitle (from Phase)
â”‚   â”‚   â”œâ”€â”€ PhaseIcon (from Phase)
â”‚   â”‚   â”œâ”€â”€ IsIndeterminate (for Validating/Finalizing)
â”‚   â”‚   â””â”€â”€ FileCountText (formatted)
â”‚   â”œâ”€â”€ Lifecycle Methods
â”‚   â”‚   â”œâ”€â”€ Start(CancellationTokenSource)
â”‚   â”‚   â”œâ”€â”€ Update(BatchApplyProgress)
â”‚   â”‚   â”œâ”€â”€ Complete()
â”‚   â”‚   â””â”€â”€ Error(string message)
â”‚   â”œâ”€â”€ Commands
â”‚   â”‚   â””â”€â”€ CancelCommand
â”‚   â””â”€â”€ Events
â”‚       â””â”€â”€ PropertyChanged (INotifyPropertyChanged)
â”œâ”€â”€ Converters
â”‚   â”œâ”€â”€ PhaseToIconConverter
â”‚   â”‚   â”œâ”€â”€ Validating â†’ ChecklistIcon
â”‚   â”‚   â”œâ”€â”€ CreatingBackups â†’ BackupIcon
â”‚   â”‚   â”œâ”€â”€ CreatingDirectories â†’ FolderPlusIcon
â”‚   â”‚   â”œâ”€â”€ WritingFiles â†’ FileEditIcon
â”‚   â”‚   â”œâ”€â”€ Finalizing â†’ CheckCircleIcon
â”‚   â”‚   â”œâ”€â”€ Completed â†’ CheckCircleIcon (success color)
â”‚   â”‚   â””â”€â”€ RollingBack â†’ UndoIcon
â”‚   â””â”€â”€ PhaseToTitleConverter
â”‚       â”œâ”€â”€ Validating â†’ "Validating..."
â”‚       â”œâ”€â”€ CreatingBackups â†’ "Creating Backups..."
â”‚       â”œâ”€â”€ CreatingDirectories â†’ "Creating Directories..."
â”‚       â”œâ”€â”€ WritingFiles â†’ "Writing Files..."
â”‚       â”œâ”€â”€ Finalizing â†’ "Finalizing..."
â”‚       â”œâ”€â”€ Completed â†’ "Complete!"
â”‚       â””â”€â”€ RollingBack â†’ "Rolling Back..."
â””â”€â”€ Styles
    â”œâ”€â”€ ProgressOverlayBackdrop
    â”œâ”€â”€ ProgressOverlayCard
    â”œâ”€â”€ ProgressPhaseIcon
    â”œâ”€â”€ ProgressPhaseTitle
    â”œâ”€â”€ ProgressCurrentFile
    â”œâ”€â”€ ProgressBarStyle
    â””â”€â”€ ProgressCancelButton
```

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ApplyProgressOverlay                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Visual Structure                                â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                    Backdrop (Border)                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                 Background: #CC000000                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                     Modal Card                             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              Background: SurfaceBackground                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              CornerRadius: 8                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              BoxShadow: 0 8 32 0 #80000000                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Row 0: Phase Icon (PathIcon, 48x48)                  â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Row 1: Phase Title (TextBlock, 18pt, SemiBold)       â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Row 2: Current File (TextBlock, muted, ellipsis)     â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Row 3: [ProgressBar] [Percentage]                    â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Row 4: "X of Y files"            [Cancel]            â”‚ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      DataContext Bindings                              â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  IsVisible â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ApplyProgressViewModel.IsVisible           â”‚  â”‚
â”‚  â”‚  PathIcon.Data â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Phase â†’ PhaseToIconConverter               â”‚  â”‚
â”‚  â”‚  PhaseTitle.Text â†â”€â”€â”€â”€â”€â”€â”€â”€ Phase â†’ PhaseToTitleConverter              â”‚  â”‚
â”‚  â”‚  CurrentFile.Text â†â”€â”€â”€â”€â”€â”€â”€ CurrentFile                                â”‚  â”‚
â”‚  â”‚  ProgressBar.Value â†â”€â”€â”€â”€â”€â”€ ProgressPercent                            â”‚  â”‚
â”‚  â”‚  Percentage.Text â†â”€â”€â”€â”€â”€â”€â”€â”€ ProgressPercent (StringFormat)             â”‚  â”‚
â”‚  â”‚  FileCount.Text â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ CompletedCount, TotalCount (MultiBinding)  â”‚  â”‚
â”‚  â”‚  CancelButton.Command â†â”€â”€â”€ CancelCommand                              â”‚  â”‚
â”‚  â”‚  CancelButton.IsVisible â†â”€ CanCancel                                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Progress Flow Diagram

```
                        FileTreeProposalService.ApplyProposalAsync
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Start Progress                                    â”‚
â”‚                                                                             â”‚
â”‚  1. Create CancellationTokenSource                                          â”‚
â”‚  2. Call viewModel.Start(cts)                                               â”‚
â”‚  3. IsVisible = true                                                        â”‚
â”‚  4. Phase = Validating                                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Update Progress Loop                                â”‚
â”‚                                                                             â”‚
â”‚  IProgress<BatchApplyProgress>.Report(progress)                             â”‚
â”‚                           â”‚                                                 â”‚
â”‚                           â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   viewModel.Update(progress)                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  Phase = progress.Phase                                              â”‚   â”‚
â”‚  â”‚  CurrentFile = progress.CurrentFile                                  â”‚   â”‚
â”‚  â”‚  ProgressPercent = progress.ProgressPercent                          â”‚   â”‚
â”‚  â”‚  CompletedCount = progress.CompletedOperations                       â”‚   â”‚
â”‚  â”‚  TotalCount = progress.TotalOperations                               â”‚   â”‚
â”‚  â”‚  CanCancel = progress.CanCancel                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                    UI Updates                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Phase Icon â†’ Updates via PhaseToIconConverter                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Phase Title â†’ Updates via PhaseToTitleConverter              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Progress Bar â†’ Animates to new value                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Percentage â†’ "67%" format                                    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  File Count â†’ "2 of 3 files"                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Cancel Button â†’ Shows/hides based on CanCancel               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                   â–¼                   â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Complete   â”‚     â”‚   Cancel    â”‚     â”‚   Error     â”‚
           â”‚  (Success)  â”‚     â”‚  Requested  â”‚     â”‚  Occurred   â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                   â”‚                   â”‚
                  â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Complete/Error Handler                               â”‚
â”‚                                                                             â”‚
â”‚  viewModel.Complete():                viewModel.Error(message):             â”‚
â”‚  â”œâ”€â”€ Phase = Completed                â”œâ”€â”€ Phase = RollingBack               â”‚
â”‚  â”œâ”€â”€ ProgressPercent = 100            â”œâ”€â”€ Show error message                â”‚
â”‚  â”œâ”€â”€ Icon = CheckCircle (success)     â”œâ”€â”€ Wait for rollback...              â”‚
â”‚  â””â”€â”€ Auto-hide after 1500ms           â””â”€â”€ Then hide                         â”‚
â”‚                                                                             â”‚
â”‚  User Cancel:                                                                â”‚
â”‚  â”œâ”€â”€ CancelCommand invoked                                                  â”‚
â”‚  â”œâ”€â”€ _cts.Cancel()                                                          â”‚
â”‚  â”œâ”€â”€ CanCancel = false                                                      â”‚
â”‚  â””â”€â”€ Phase = RollingBack                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    IsVisible = false      â”‚
                        â”‚    (Overlay dismissed)    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase Transition Diagram

```
                    Start
                      â”‚
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  Validating â”‚  â† "Validating operations..."
               â”‚   ğŸ“‹        â”‚    IsIndeterminate = true
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚CreatingBackups  â”‚  â† "Creating backups..."
            â”‚   ğŸ’¾            â”‚    Shows file being backed up
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚CreatingDirectoriesâ”‚  â† "Creating directories..."
          â”‚   ğŸ“+             â”‚    Shows directory being created
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚WritingFiles â”‚  â† "Writing files..."
             â”‚   ğŸ“        â”‚    Main progress, shows file path
             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    ProgressBar active
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼          â–¼          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Finalizingâ”‚ â”‚Cancel â”‚ â”‚  Error    â”‚
  â”‚   âœ“       â”‚ â”‚       â”‚ â”‚           â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚           â”‚
        â–¼           â–¼           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Completed â”‚ â”‚RollingBackâ”‚ â”‚RollingBackâ”‚
  â”‚   âœ“ âœ“     â”‚ â”‚   â†©ï¸      â”‚ â”‚   â†©ï¸      â”‚
  â”‚  (green)  â”‚ â”‚"Rolling   â”‚ â”‚"Rolling   â”‚
  â”‚           â”‚ â”‚ back..."  â”‚ â”‚ back..."  â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           Auto-hide                  â”‚
  â”‚  Complete: 1500ms delay             â”‚
  â”‚  Cancel/Error: After rollback done  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Design

### 1. ApplyProgressViewModel

The ViewModel manages all progress state and user interaction.

```csharp
// src/SeniorIntern.Desktop/ViewModels/ApplyProgressViewModel.cs
namespace SeniorIntern.Desktop.ViewModels;

using Avalonia.Threading;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Models;

/// <summary>
/// ViewModel for the progress overlay shown during batch apply operations.
/// Manages visibility, progress state, and cancellation.
/// </summary>
public partial class ApplyProgressViewModel : ViewModelBase
{
    #region Private Fields

    /// <summary>
    /// The cancellation token source for the current operation.
    /// </summary>
    private CancellationTokenSource? _cts;

    /// <summary>
    /// Timer for auto-hide after completion.
    /// </summary>
    private CancellationTokenSource? _autoHideCts;

    /// <summary>
    /// Default auto-hide delay in milliseconds.
    /// </summary>
    private const int AutoHideDelayMs = 1500;

    #endregion

    #region Observable Properties

    /// <summary>
    /// Whether the overlay is visible.
    /// Controls the entire overlay visibility.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(IsActive))]
    private bool _isVisible;

    /// <summary>
    /// Current phase of the batch apply operation.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(PhaseTitle))]
    [NotifyPropertyChangedFor(nameof(IsIndeterminate))]
    [NotifyPropertyChangedFor(nameof(IsCompleted))]
    [NotifyPropertyChangedFor(nameof(IsError))]
    private BatchApplyPhase _phase;

    /// <summary>
    /// The current file being processed.
    /// Displayed below the phase title.
    /// </summary>
    [ObservableProperty]
    private string _currentFile = string.Empty;

    /// <summary>
    /// Progress percentage (0-100).
    /// Drives the progress bar value.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(ProgressPercentText))]
    private double _progressPercent;

    /// <summary>
    /// Number of completed operations.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(FileCountText))]
    private int _completedCount;

    /// <summary>
    /// Total number of operations.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(FileCountText))]
    private int _totalCount;

    /// <summary>
    /// Whether the operation can be cancelled at this point.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(ShowCancelButton))]
    private bool _canCancel = true;

    /// <summary>
    /// Error message if an error occurred.
    /// </summary>
    [ObservableProperty]
    [NotifyPropertyChangedFor(nameof(HasError))]
    private string? _errorMessage;

    /// <summary>
    /// Whether cancellation was requested by the user.
    /// </summary>
    [ObservableProperty]
    private bool _cancellationRequested;

    #endregion

    #region Computed Properties

    /// <summary>
    /// Human-readable phase title.
    /// </summary>
    public string PhaseTitle => Phase switch
    {
        BatchApplyPhase.Validating => "Validating...",
        BatchApplyPhase.CreatingBackups => "Creating Backups...",
        BatchApplyPhase.CreatingDirectories => "Creating Directories...",
        BatchApplyPhase.WritingFiles => "Writing Files...",
        BatchApplyPhase.Finalizing => "Finalizing...",
        BatchApplyPhase.Completed => "Complete!",
        BatchApplyPhase.RollingBack => "Rolling Back...",
        _ => "Processing..."
    };

    /// <summary>
    /// Whether the progress bar should be indeterminate.
    /// Used for phases where we can't measure progress.
    /// </summary>
    public bool IsIndeterminate => Phase is
        BatchApplyPhase.Validating or
        BatchApplyPhase.Finalizing;

    /// <summary>
    /// Whether the operation is actively in progress.
    /// </summary>
    public bool IsActive => IsVisible && !IsCompleted;

    /// <summary>
    /// Whether the operation completed successfully.
    /// </summary>
    public bool IsCompleted => Phase == BatchApplyPhase.Completed;

    /// <summary>
    /// Whether an error occurred.
    /// </summary>
    public bool IsError => Phase == BatchApplyPhase.RollingBack;

    /// <summary>
    /// Whether there is an error message to display.
    /// </summary>
    public bool HasError => !string.IsNullOrEmpty(ErrorMessage);

    /// <summary>
    /// Whether to show the cancel button.
    /// Hidden when cancelled or during rollback.
    /// </summary>
    public bool ShowCancelButton => CanCancel && !CancellationRequested && !IsError;

    /// <summary>
    /// Formatted progress percentage text.
    /// </summary>
    public string ProgressPercentText => $"{ProgressPercent:F0}%";

    /// <summary>
    /// Formatted file count text.
    /// </summary>
    public string FileCountText => TotalCount > 0
        ? $"{CompletedCount} of {TotalCount} files"
        : string.Empty;

    #endregion

    #region Lifecycle Methods

    /// <summary>
    /// Start showing progress for a new operation.
    /// </summary>
    /// <param name="cts">The cancellation token source to use for cancellation.</param>
    /// <param name="totalOperations">Total number of operations to process.</param>
    public void Start(CancellationTokenSource cts, int totalOperations = 0)
    {
        // Cancel any pending auto-hide
        _autoHideCts?.Cancel();
        _autoHideCts = null;

        _cts = cts;

        // Reset all state
        Phase = BatchApplyPhase.Validating;
        CurrentFile = string.Empty;
        ProgressPercent = 0;
        CompletedCount = 0;
        TotalCount = totalOperations;
        CanCancel = true;
        CancellationRequested = false;
        ErrorMessage = null;

        IsVisible = true;
    }

    /// <summary>
    /// Update progress from a BatchApplyProgress report.
    /// Called by the proposal service via IProgress.
    /// </summary>
    /// <param name="progress">The progress information.</param>
    public void Update(BatchApplyProgress progress)
    {
        // Ensure we're on the UI thread
        if (!Dispatcher.UIThread.CheckAccess())
        {
            Dispatcher.UIThread.Post(() => Update(progress));
            return;
        }

        Phase = progress.Phase;
        CurrentFile = progress.CurrentFile;
        ProgressPercent = progress.ProgressPercent;
        CompletedCount = progress.CompletedOperations;
        TotalCount = progress.TotalOperations;
        CanCancel = progress.CanCancel;
        CancellationRequested = progress.CancellationRequested;
    }

    /// <summary>
    /// Mark the operation as complete and start auto-hide timer.
    /// </summary>
    public void Complete()
    {
        // Ensure we're on the UI thread
        if (!Dispatcher.UIThread.CheckAccess())
        {
            Dispatcher.UIThread.Post(Complete);
            return;
        }

        Phase = BatchApplyPhase.Completed;
        ProgressPercent = 100;
        CanCancel = false;
        CurrentFile = string.Empty;

        // Start auto-hide timer
        StartAutoHide();
    }

    /// <summary>
    /// Mark the operation as failed and show error.
    /// </summary>
    /// <param name="message">The error message to display.</param>
    public void Error(string message)
    {
        // Ensure we're on the UI thread
        if (!Dispatcher.UIThread.CheckAccess())
        {
            Dispatcher.UIThread.Post(() => Error(message));
            return;
        }

        Phase = BatchApplyPhase.RollingBack;
        ErrorMessage = message;
        CanCancel = false;
    }

    /// <summary>
    /// Mark rollback as complete and hide.
    /// </summary>
    public void RollbackComplete()
    {
        // Ensure we're on the UI thread
        if (!Dispatcher.UIThread.CheckAccess())
        {
            Dispatcher.UIThread.Post(RollbackComplete);
            return;
        }

        CurrentFile = "Rollback complete";

        // Delay before hiding to show final state
        StartAutoHide();
    }

    /// <summary>
    /// Immediately hide the overlay.
    /// </summary>
    public void Hide()
    {
        _autoHideCts?.Cancel();
        _autoHideCts = null;
        IsVisible = false;
    }

    #endregion

    #region Private Methods

    /// <summary>
    /// Start the auto-hide timer.
    /// </summary>
    private void StartAutoHide()
    {
        _autoHideCts?.Cancel();
        _autoHideCts = new CancellationTokenSource();

        var token = _autoHideCts.Token;

        Task.Delay(AutoHideDelayMs, token).ContinueWith(_ =>
        {
            if (!token.IsCancellationRequested)
            {
                Dispatcher.UIThread.Post(() => IsVisible = false);
            }
        }, TaskScheduler.Default);
    }

    #endregion

    #region Commands

    /// <summary>
    /// Cancel the current operation.
    /// </summary>
    [RelayCommand(CanExecute = nameof(ShowCancelButton))]
    private void Cancel()
    {
        if (_cts == null || _cts.IsCancellationRequested)
        {
            return;
        }

        _cts.Cancel();
        CancellationRequested = true;
        CanCancel = false;
        Phase = BatchApplyPhase.RollingBack;
        CurrentFile = "Cancelling...";
    }

    #endregion

    #region IDisposable

    /// <summary>
    /// Clean up resources.
    /// </summary>
    public void Dispose()
    {
        _autoHideCts?.Cancel();
        _autoHideCts?.Dispose();
        _autoHideCts = null;

        // Note: We don't dispose _cts as we don't own it
        _cts = null;
    }

    #endregion
}
```

### 2. PhaseToIconConverter

Converts `BatchApplyPhase` to the appropriate icon geometry.

```csharp
// src/SeniorIntern.Desktop/Converters/PhaseToIconConverter.cs
namespace SeniorIntern.Desktop.Converters;

using System.Globalization;
using Avalonia.Data.Converters;
using Avalonia.Media;
using SeniorIntern.Core.Models;

/// <summary>
/// Converts a BatchApplyPhase to the corresponding icon geometry.
/// Used in the progress overlay to display phase-appropriate icons.
/// </summary>
public class PhaseToIconConverter : IValueConverter
{
    /// <summary>
    /// Static geometries for each phase icon.
    /// Using StreamGeometry for efficiency.
    /// </summary>
    private static readonly Lazy<Dictionary<BatchApplyPhase, StreamGeometry>> PhaseIcons = new(() =>
    {
        var icons = new Dictionary<BatchApplyPhase, StreamGeometry>();

        // Checklist icon for Validating
        icons[BatchApplyPhase.Validating] = StreamGeometry.Parse(
            "M4 4h16v16H4V4zm2 2v12h12V6H6zm2 2h4v2H8V8zm0 4h8v2H8v-2zm0 4h6v2H8v-2z");

        // Backup/Save icon for CreatingBackups
        icons[BatchApplyPhase.CreatingBackups] = StreamGeometry.Parse(
            "M17 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6V6z");

        // Folder plus icon for CreatingDirectories
        icons[BatchApplyPhase.CreatingDirectories] = StreamGeometry.Parse(
            "M10 4H2v16h20V6H12l-2-2zm1 9h3v3h2v-3h3v-2h-3V8h-2v3h-3v2z");

        // File edit icon for WritingFiles
        icons[BatchApplyPhase.WritingFiles] = StreamGeometry.Parse(
            "M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 9h-2v2H9v-2H7v-2h2V7h2v2h2v2zm0-4V3.5L17.5 9H13z");

        // Check circle icon for Finalizing and Completed
        var checkCircle = StreamGeometry.Parse(
            "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z");
        icons[BatchApplyPhase.Finalizing] = checkCircle;
        icons[BatchApplyPhase.Completed] = checkCircle;

        // Undo/Rollback icon
        icons[BatchApplyPhase.RollingBack] = StreamGeometry.Parse(
            "M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z");

        return icons;
    });

    /// <summary>
    /// Default geometry for unknown phases.
    /// </summary>
    private static readonly Lazy<StreamGeometry> DefaultIcon = new(() =>
        StreamGeometry.Parse("M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"));

    /// <summary>
    /// Convert a phase to an icon geometry.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not BatchApplyPhase phase)
        {
            return DefaultIcon.Value;
        }

        return PhaseIcons.Value.TryGetValue(phase, out var icon)
            ? icon
            : DefaultIcon.Value;
    }

    /// <summary>
    /// Not supported for one-way binding.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("PhaseToIconConverter is one-way only.");
    }
}
```

### 3. PhaseToTitleConverter

Converts `BatchApplyPhase` to display title text.

```csharp
// src/SeniorIntern.Desktop/Converters/PhaseToTitleConverter.cs
namespace SeniorIntern.Desktop.Converters;

using System.Globalization;
using Avalonia.Data.Converters;
using SeniorIntern.Core.Models;

/// <summary>
/// Converts a BatchApplyPhase to a human-readable title string.
/// Used in the progress overlay to display the current phase.
/// </summary>
public class PhaseToTitleConverter : IValueConverter
{
    /// <summary>
    /// Phase to title mappings.
    /// </summary>
    private static readonly Dictionary<BatchApplyPhase, string> PhaseTitles = new()
    {
        [BatchApplyPhase.Validating] = "Validating...",
        [BatchApplyPhase.CreatingBackups] = "Creating Backups...",
        [BatchApplyPhase.CreatingDirectories] = "Creating Directories...",
        [BatchApplyPhase.WritingFiles] = "Writing Files...",
        [BatchApplyPhase.Finalizing] = "Finalizing...",
        [BatchApplyPhase.Completed] = "Complete!",
        [BatchApplyPhase.RollingBack] = "Rolling Back..."
    };

    /// <summary>
    /// Convert a phase to a title string.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not BatchApplyPhase phase)
        {
            return "Processing...";
        }

        return PhaseTitles.TryGetValue(phase, out var title)
            ? title
            : "Processing...";
    }

    /// <summary>
    /// Not supported for one-way binding.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("PhaseToTitleConverter is one-way only.");
    }
}
```

### 4. PhaseToBrushConverter

Converts `BatchApplyPhase` to the appropriate foreground brush color.

```csharp
// src/SeniorIntern.Desktop/Converters/PhaseToBrushConverter.cs
namespace SeniorIntern.Desktop.Converters;

using System.Globalization;
using Avalonia;
using Avalonia.Data.Converters;
using Avalonia.Media;
using SeniorIntern.Core.Models;

/// <summary>
/// Converts a BatchApplyPhase to a foreground brush color.
/// Provides visual feedback about the phase status (success, error, neutral).
/// </summary>
public class PhaseToBrushConverter : IValueConverter
{
    /// <summary>
    /// Default brush for most phases.
    /// </summary>
    private static readonly SolidColorBrush AccentBrush = new(Color.Parse("#007ACC"));

    /// <summary>
    /// Success brush for completed phase.
    /// </summary>
    private static readonly SolidColorBrush SuccessBrush = new(Color.Parse("#89D185"));

    /// <summary>
    /// Error brush for rollback phase.
    /// </summary>
    private static readonly SolidColorBrush ErrorBrush = new(Color.Parse("#F48771"));

    /// <summary>
    /// Warning brush for cancellation.
    /// </summary>
    private static readonly SolidColorBrush WarningBrush = new(Color.Parse("#CCA700"));

    /// <summary>
    /// Convert a phase to a brush.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not BatchApplyPhase phase)
        {
            return AccentBrush;
        }

        return phase switch
        {
            BatchApplyPhase.Completed => SuccessBrush,
            BatchApplyPhase.RollingBack => ErrorBrush,
            _ => AccentBrush
        };
    }

    /// <summary>
    /// Not supported for one-way binding.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("PhaseToBrushConverter is one-way only.");
    }
}
```

### 5. ApplyProgressOverlay.axaml

The overlay control providing visual feedback during batch operations.

```xml
<!-- src/SeniorIntern.Desktop/Controls/ApplyProgressOverlay.axaml -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:converters="using:SeniorIntern.Desktop.Converters"
             x:Class="SeniorIntern.Desktop.Controls.ApplyProgressOverlay"
             x:DataType="vm:ApplyProgressViewModel"
             IsVisible="{Binding IsVisible}"
             AutomationProperties.Name="Apply progress overlay">

    <UserControl.Resources>
        <converters:PhaseToIconConverter x:Key="PhaseToIconConverter" />
        <converters:PhaseToTitleConverter x:Key="PhaseToTitleConverter" />
        <converters:PhaseToBrushConverter x:Key="PhaseToBrushConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Backdrop style -->
        <Style Selector="Border.progress-backdrop">
            <Setter Property="Background" Value="#CC000000" />
        </Style>

        <!-- Modal card style -->
        <Style Selector="Border.progress-card">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="32" />
            <Setter Property="MinWidth" Value="400" />
            <Setter Property="MaxWidth" Value="500" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="BoxShadow" Value="0 8 32 0 #80000000" />
        </Style>

        <!-- Phase icon style -->
        <Style Selector="PathIcon.phase-icon">
            <Setter Property="Width" Value="48" />
            <Setter Property="Height" Value="48" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>

        <!-- Phase icon - completed state (pulsing) -->
        <Style Selector="PathIcon.phase-icon.completed">
            <Style.Animations>
                <Animation Duration="0:0:0.5" IterationCount="1">
                    <KeyFrame Cue="0%">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="RenderTransform">
                            <ScaleTransform ScaleX="0.8" ScaleY="0.8" />
                        </Setter>
                    </KeyFrame>
                    <KeyFrame Cue="50%">
                        <Setter Property="Opacity" Value="1" />
                        <Setter Property="RenderTransform">
                            <ScaleTransform ScaleX="1.1" ScaleY="1.1" />
                        </Setter>
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Opacity" Value="1" />
                        <Setter Property="RenderTransform">
                            <ScaleTransform ScaleX="1" ScaleY="1" />
                        </Setter>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- Phase title style -->
        <Style Selector="TextBlock.phase-title">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <!-- Current file style -->
        <Style Selector="TextBlock.current-file">
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
            <Setter Property="MaxWidth" Value="350" />
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="FontSize" Value="13" />
        </Style>

        <!-- Error message style -->
        <Style Selector="TextBlock.error-message">
            <Setter Property="Foreground" Value="{DynamicResource ErrorForeground}" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="MaxWidth" Value="350" />
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="FontSize" Value="13" />
        </Style>

        <!-- Progress bar container style -->
        <Style Selector="Grid.progress-bar-container">
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>

        <!-- Progress bar style -->
        <Style Selector="ProgressBar.apply-progress">
            <Setter Property="Height" Value="8" />
            <Setter Property="Minimum" Value="0" />
            <Setter Property="Maximum" Value="100" />
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
            <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
        </Style>

        <!-- Progress percentage text style -->
        <Style Selector="TextBlock.progress-percent">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="12,0,0,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- File count style -->
        <Style Selector="TextBlock.file-count">
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="FontSize" Value="13" />
        </Style>

        <!-- Cancel button style -->
        <Style Selector="Button.cancel-progress">
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="CornerRadius" Value="4" />
        </Style>

        <Style Selector="Button.cancel-progress:pointerover">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimary}" />
        </Style>

        <Style Selector="Button.cancel-progress:disabled">
            <Setter Property="Opacity" Value="0.5" />
        </Style>
    </UserControl.Styles>

    <!-- Backdrop -->
    <Border Classes="progress-backdrop"
            KeyboardNavigation.TabNavigation="Cycle">

        <!-- Modal Card -->
        <Border Classes="progress-card">
            <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto">

                <!-- Row 0: Phase Icon -->
                <PathIcon Grid.Row="0"
                          Classes="phase-icon"
                          Classes.completed="{Binding IsCompleted}"
                          Data="{Binding Phase, Converter={StaticResource PhaseToIconConverter}}"
                          Foreground="{Binding Phase, Converter={StaticResource PhaseToBrushConverter}}" />

                <!-- Row 1: Phase Title -->
                <TextBlock Grid.Row="1"
                           Classes="phase-title"
                           Text="{Binding Phase, Converter={StaticResource PhaseToTitleConverter}}" />

                <!-- Row 2: Current File -->
                <TextBlock Grid.Row="2"
                           Classes="current-file"
                           Text="{Binding CurrentFile}"
                           IsVisible="{Binding CurrentFile, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Row 2 Alt: Error Message -->
                <TextBlock Grid.Row="2"
                           Classes="error-message"
                           Text="{Binding ErrorMessage}"
                           IsVisible="{Binding HasError}" />

                <!-- Row 3: Progress Bar + Percentage -->
                <Grid Grid.Row="3"
                      Classes="progress-bar-container"
                      ColumnDefinitions="*, Auto"
                      IsVisible="{Binding !IsIndeterminate}">
                    <ProgressBar Classes="apply-progress"
                                 Value="{Binding ProgressPercent}" />
                    <TextBlock Grid.Column="1"
                               Classes="progress-percent"
                               Text="{Binding ProgressPercentText}" />
                </Grid>

                <!-- Row 3 Alt: Indeterminate Progress -->
                <ProgressBar Grid.Row="3"
                             Classes="apply-progress"
                             IsIndeterminate="True"
                             IsVisible="{Binding IsIndeterminate}"
                             Margin="0,0,0,8" />

                <!-- Row 4: File Count -->
                <TextBlock Grid.Row="4"
                           Classes="file-count"
                           Text="{Binding FileCountText}"
                           IsVisible="{Binding FileCountText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Row 5: Cancel Button -->
                <Button Grid.Row="5"
                        Classes="cancel-progress"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        IsVisible="{Binding ShowCancelButton}"
                        Margin="0,16,0,0"
                        HorizontalAlignment="Center"
                        AutomationProperties.Name="Cancel file operation" />
            </Grid>
        </Border>
    </Border>
</UserControl>
```

### 6. ApplyProgressOverlay.axaml.cs

Minimal code-behind for the overlay control.

```csharp
// src/SeniorIntern.Desktop/Controls/ApplyProgressOverlay.axaml.cs
namespace SeniorIntern.Desktop.Controls;

using Avalonia.Controls;
using Avalonia.Input;

/// <summary>
/// Code-behind for the ApplyProgressOverlay control.
/// Provides keyboard handling and initialization.
/// </summary>
public partial class ApplyProgressOverlay : UserControl
{
    /// <summary>
    /// Initialize the overlay control.
    /// </summary>
    public ApplyProgressOverlay()
    {
        InitializeComponent();
    }

    /// <summary>
    /// Handle keyboard input when overlay is visible.
    /// Escape key triggers cancellation if allowed.
    /// </summary>
    protected override void OnKeyDown(KeyEventArgs e)
    {
        base.OnKeyDown(e);

        if (e.Key == Key.Escape && DataContext is ViewModels.ApplyProgressViewModel viewModel)
        {
            if (viewModel.ShowCancelButton)
            {
                viewModel.CancelCommand.Execute(null);
                e.Handled = true;
            }
        }
    }
}
```

### 7. ApplyProgressStyles.axaml

Dedicated style dictionary for progress overlay styling.

```xml
<!-- src/SeniorIntern.Desktop/Styles/ApplyProgressStyles.axaml -->
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- Progress overlay specific colors -->
    <SolidColorBrush x:Key="ProgressBackdropBackground" Color="#CC000000" />
    <SolidColorBrush x:Key="ProgressCardBackground" Color="#252526" />

    <!-- Progress bar colors by phase -->
    <SolidColorBrush x:Key="ProgressDefaultForeground" Color="#007ACC" />
    <SolidColorBrush x:Key="ProgressSuccessForeground" Color="#89D185" />
    <SolidColorBrush x:Key="ProgressErrorForeground" Color="#F48771" />
    <SolidColorBrush x:Key="ProgressWarningForeground" Color="#CCA700" />

    <!-- Icon geometries for phases -->
    <StreamGeometry x:Key="ChecklistIcon">
        M4 4h16v16H4V4zm2 2v12h12V6H6zm2 2h4v2H8V8zm0 4h8v2H8v-2zm0 4h6v2H8v-2z
    </StreamGeometry>

    <StreamGeometry x:Key="BackupIcon">
        M17 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6V6z
    </StreamGeometry>

    <StreamGeometry x:Key="FolderPlusIcon">
        M10 4H2v16h20V6H12l-2-2zm1 9h3v3h2v-3h3v-2h-3V8h-2v3h-3v2z
    </StreamGeometry>

    <StreamGeometry x:Key="FileEditIcon">
        M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 9h-2v2H9v-2H7v-2h2V7h2v2h2v2zm0-4V3.5L17.5 9H13z
    </StreamGeometry>

    <StreamGeometry x:Key="CheckCircleIcon">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z
    </StreamGeometry>

    <StreamGeometry x:Key="UndoIcon">
        M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z
    </StreamGeometry>

    <StreamGeometry x:Key="ProcessingIcon">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z
    </StreamGeometry>

</ResourceDictionary>
```

### 8. IProgressReporter Interface

Optional interface for type-safe progress reporting.

```csharp
// src/SeniorIntern.Core/Interfaces/IProgressReporter.cs
namespace SeniorIntern.Core.Interfaces;

using SeniorIntern.Core.Models;

/// <summary>
/// Interface for components that can report batch apply progress.
/// Provides a typed alternative to IProgress{BatchApplyProgress}.
/// </summary>
public interface IProgressReporter
{
    /// <summary>
    /// Report progress update.
    /// </summary>
    /// <param name="progress">The current progress state.</param>
    void Report(BatchApplyProgress progress);

    /// <summary>
    /// Report that the operation has completed successfully.
    /// </summary>
    void ReportComplete();

    /// <summary>
    /// Report that an error occurred.
    /// </summary>
    /// <param name="message">The error message.</param>
    void ReportError(string message);

    /// <summary>
    /// Report that rollback has completed.
    /// </summary>
    void ReportRollbackComplete();
}
```

### 9. ProgressReporterAdapter

Adapts `ApplyProgressViewModel` to `IProgress<BatchApplyProgress>`.

```csharp
// src/SeniorIntern.Desktop/Services/ProgressReporterAdapter.cs
namespace SeniorIntern.Desktop.Services;

using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;
using SeniorIntern.Desktop.ViewModels;

/// <summary>
/// Adapts ApplyProgressViewModel to IProgress for use with async operations.
/// Enables the proposal service to report progress without UI dependencies.
/// </summary>
public class ProgressReporterAdapter : IProgress<BatchApplyProgress>, IProgressReporter
{
    private readonly ApplyProgressViewModel _viewModel;

    /// <summary>
    /// Create a new adapter for the given ViewModel.
    /// </summary>
    /// <param name="viewModel">The ViewModel to update.</param>
    public ProgressReporterAdapter(ApplyProgressViewModel viewModel)
    {
        _viewModel = viewModel ?? throw new ArgumentNullException(nameof(viewModel));
    }

    /// <summary>
    /// Report progress update (IProgress implementation).
    /// </summary>
    /// <param name="value">The progress value.</param>
    public void Report(BatchApplyProgress value)
    {
        _viewModel.Update(value);
    }

    /// <summary>
    /// Report that the operation has completed successfully.
    /// </summary>
    public void ReportComplete()
    {
        _viewModel.Complete();
    }

    /// <summary>
    /// Report that an error occurred.
    /// </summary>
    /// <param name="message">The error message.</param>
    public void ReportError(string message)
    {
        _viewModel.Error(message);
    }

    /// <summary>
    /// Report that rollback has completed.
    /// </summary>
    public void ReportRollbackComplete()
    {
        _viewModel.RollbackComplete();
    }
}
```

---

## Integration with ProposalService

### Usage Pattern

```csharp
// Example usage in FileTreeProposalPanel.axaml.cs or ViewModel
public async Task ApplyWithProgressAsync(FileTreeProposal proposal, string workspacePath)
{
    // Get the progress ViewModel (could be from DI or parent ViewModel)
    var progressVm = _serviceProvider.GetRequiredService<ApplyProgressViewModel>();

    // Create cancellation token source
    var cts = new CancellationTokenSource();

    // Start showing progress
    progressVm.Start(cts, proposal.SelectedCount);

    try
    {
        // Create the progress adapter
        var progress = new ProgressReporterAdapter(progressVm);

        // Apply the proposal with progress reporting
        var result = await _proposalService.ApplyProposalAsync(
            proposal,
            workspacePath,
            options: new ApplyOptions { CreateBackup = true },
            progress: progress,
            cancellationToken: cts.Token);

        if (result.AllSucceeded)
        {
            progressVm.Complete();
        }
        else if (result.WasCancelled)
        {
            progressVm.RollbackComplete();
        }
        else
        {
            var failedFile = result.FailedResults.FirstOrDefault()?.FilePath ?? "Unknown";
            progressVm.Error($"Failed to write: {failedFile}");
        }
    }
    catch (OperationCanceledException)
    {
        progressVm.RollbackComplete();
    }
    catch (Exception ex)
    {
        progressVm.Error(ex.Message);
    }
}
```

### Service Integration

```csharp
// In FileTreeProposalService.ApplyProposalAsync
public async Task<BatchApplyResult> ApplyProposalAsync(
    FileTreeProposal proposal,
    string workspacePath,
    ApplyOptions? options = null,
    IProgress<BatchApplyProgress>? progress = null,
    CancellationToken cancellationToken = default)
{
    var startedAt = DateTime.UtcNow;
    var selectedOps = proposal.SelectedOperations.ToList();

    // Phase 1: Validation
    progress?.Report(new BatchApplyProgress
    {
        Phase = BatchApplyPhase.Validating,
        TotalOperations = selectedOps.Count,
        CompletedOperations = 0,
        CurrentFile = "Checking paths...",
        CanCancel = true
    });

    // ... validation logic ...

    // Phase 2: Creating Directories
    progress?.Report(new BatchApplyProgress
    {
        Phase = BatchApplyPhase.CreatingDirectories,
        TotalOperations = selectedOps.Count,
        CompletedOperations = 0,
        CurrentFile = directories.First(),
        CanCancel = true
    });

    // ... create directories ...

    // Phase 3: Creating Backups
    if (options?.CreateBackup == true)
    {
        progress?.Report(new BatchApplyProgress
        {
            Phase = BatchApplyPhase.CreatingBackups,
            TotalOperations = selectedOps.Count,
            CompletedOperations = 0,
            CurrentFile = "Creating safety backups...",
            CanCancel = true
        });

        // ... create backups ...
    }

    // Phase 4: Writing Files
    for (int i = 0; i < selectedOps.Count; i++)
    {
        cancellationToken.ThrowIfCancellationRequested();

        var op = selectedOps[i];

        progress?.Report(new BatchApplyProgress
        {
            Phase = BatchApplyPhase.WritingFiles,
            TotalOperations = selectedOps.Count,
            CompletedOperations = i,
            CurrentFile = op.Path,
            CurrentOperation = op.Type,
            CurrentOperationId = op.Id,
            CanCancel = true,
            CancellationRequested = cancellationToken.IsCancellationRequested
        });

        // ... write file ...
    }

    // Phase 5: Finalizing
    progress?.Report(new BatchApplyProgress
    {
        Phase = BatchApplyPhase.Finalizing,
        TotalOperations = selectedOps.Count,
        CompletedOperations = selectedOps.Count,
        CurrentFile = "Cleaning up...",
        CanCancel = false
    });

    // ... finalize ...

    // Complete
    progress?.Report(new BatchApplyProgress
    {
        Phase = BatchApplyPhase.Completed,
        TotalOperations = selectedOps.Count,
        CompletedOperations = selectedOps.Count,
        CanCancel = false
    });

    return BatchApplyResult.Success(results, startedAt);
}
```

---

## Unit Tests

### ApplyProgressViewModelTests

```csharp
// tests/SeniorIntern.Desktop.Tests/ViewModels/ApplyProgressViewModelTests.cs
namespace SeniorIntern.Desktop.Tests.ViewModels;

using SeniorIntern.Core.Models;
using SeniorIntern.Desktop.ViewModels;
using Xunit;

public class ApplyProgressViewModelTests
{
    [Fact]
    public void Start_SetsInitialState()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        var cts = new CancellationTokenSource();

        // Act
        viewModel.Start(cts, totalOperations: 5);

        // Assert
        Assert.True(viewModel.IsVisible);
        Assert.Equal(BatchApplyPhase.Validating, viewModel.Phase);
        Assert.Equal(0, viewModel.ProgressPercent);
        Assert.Equal(0, viewModel.CompletedCount);
        Assert.Equal(5, viewModel.TotalCount);
        Assert.True(viewModel.CanCancel);
        Assert.False(viewModel.CancellationRequested);
    }

    [Fact]
    public void Update_UpdatesAllProperties()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        var progress = new BatchApplyProgress
        {
            Phase = BatchApplyPhase.WritingFiles,
            CurrentFile = "src/Models/User.cs",
            TotalOperations = 3,
            CompletedOperations = 1,
            CanCancel = true
        };

        // Act
        viewModel.Update(progress);

        // Assert
        Assert.Equal(BatchApplyPhase.WritingFiles, viewModel.Phase);
        Assert.Equal("src/Models/User.cs", viewModel.CurrentFile);
        Assert.Equal(1, viewModel.CompletedCount);
        Assert.Equal(3, viewModel.TotalCount);
    }

    [Fact]
    public void PhaseTitle_ReturnsCorrectTitle()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();

        // Act & Assert
        viewModel.Phase = BatchApplyPhase.Validating;
        Assert.Equal("Validating...", viewModel.PhaseTitle);

        viewModel.Phase = BatchApplyPhase.WritingFiles;
        Assert.Equal("Writing Files...", viewModel.PhaseTitle);

        viewModel.Phase = BatchApplyPhase.Completed;
        Assert.Equal("Complete!", viewModel.PhaseTitle);

        viewModel.Phase = BatchApplyPhase.RollingBack;
        Assert.Equal("Rolling Back...", viewModel.PhaseTitle);
    }

    [Fact]
    public void IsIndeterminate_TrueForValidatingAndFinalizing()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();

        // Act & Assert
        viewModel.Phase = BatchApplyPhase.Validating;
        Assert.True(viewModel.IsIndeterminate);

        viewModel.Phase = BatchApplyPhase.Finalizing;
        Assert.True(viewModel.IsIndeterminate);

        viewModel.Phase = BatchApplyPhase.WritingFiles;
        Assert.False(viewModel.IsIndeterminate);

        viewModel.Phase = BatchApplyPhase.Completed;
        Assert.False(viewModel.IsIndeterminate);
    }

    [Fact]
    public void ProgressPercentText_FormatsCorrectly()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();

        // Act & Assert
        viewModel.ProgressPercent = 0;
        Assert.Equal("0%", viewModel.ProgressPercentText);

        viewModel.ProgressPercent = 50.5;
        Assert.Equal("51%", viewModel.ProgressPercentText);

        viewModel.ProgressPercent = 100;
        Assert.Equal("100%", viewModel.ProgressPercentText);
    }

    [Fact]
    public void FileCountText_FormatsCorrectly()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();

        // Act & Assert
        viewModel.CompletedCount = 0;
        viewModel.TotalCount = 0;
        Assert.Equal(string.Empty, viewModel.FileCountText);

        viewModel.CompletedCount = 2;
        viewModel.TotalCount = 5;
        Assert.Equal("2 of 5 files", viewModel.FileCountText);
    }

    [Fact]
    public void Cancel_CancelsTokenAndUpdatesState()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        var cts = new CancellationTokenSource();
        viewModel.Start(cts, 3);

        // Act
        viewModel.CancelCommand.Execute(null);

        // Assert
        Assert.True(cts.IsCancellationRequested);
        Assert.True(viewModel.CancellationRequested);
        Assert.False(viewModel.CanCancel);
        Assert.Equal(BatchApplyPhase.RollingBack, viewModel.Phase);
    }

    [Fact]
    public void ShowCancelButton_FalseWhenCancelled()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        // Pre-condition
        Assert.True(viewModel.ShowCancelButton);

        // Act
        viewModel.CancellationRequested = true;

        // Assert
        Assert.False(viewModel.ShowCancelButton);
    }

    [Fact]
    public void ShowCancelButton_FalseWhenRollingBack()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        // Act
        viewModel.Phase = BatchApplyPhase.RollingBack;

        // Assert
        Assert.False(viewModel.ShowCancelButton);
    }

    [Fact]
    public void Complete_SetsCompletedState()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        // Act
        viewModel.Complete();

        // Assert
        Assert.Equal(BatchApplyPhase.Completed, viewModel.Phase);
        Assert.Equal(100, viewModel.ProgressPercent);
        Assert.False(viewModel.CanCancel);
        Assert.True(viewModel.IsCompleted);
    }

    [Fact]
    public void Error_SetsErrorState()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        // Act
        viewModel.Error("File write failed: Permission denied");

        // Assert
        Assert.Equal(BatchApplyPhase.RollingBack, viewModel.Phase);
        Assert.Equal("File write failed: Permission denied", viewModel.ErrorMessage);
        Assert.True(viewModel.HasError);
        Assert.False(viewModel.CanCancel);
    }

    [Fact]
    public void Hide_ImmediatelyHidesOverlay()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);

        // Pre-condition
        Assert.True(viewModel.IsVisible);

        // Act
        viewModel.Hide();

        // Assert
        Assert.False(viewModel.IsVisible);
    }

    [Fact]
    public void Start_ResetsErrorState()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);
        viewModel.Error("Previous error");

        // Act
        viewModel.Start(new CancellationTokenSource(), 5);

        // Assert
        Assert.Null(viewModel.ErrorMessage);
        Assert.False(viewModel.HasError);
        Assert.Equal(BatchApplyPhase.Validating, viewModel.Phase);
    }
}
```

### PhaseToIconConverterTests

```csharp
// tests/SeniorIntern.Desktop.Tests/Converters/PhaseToIconConverterTests.cs
namespace SeniorIntern.Desktop.Tests.Converters;

using Avalonia.Media;
using SeniorIntern.Core.Models;
using SeniorIntern.Desktop.Converters;
using Xunit;

public class PhaseToIconConverterTests
{
    private readonly PhaseToIconConverter _converter = new();

    [Theory]
    [InlineData(BatchApplyPhase.Validating)]
    [InlineData(BatchApplyPhase.CreatingBackups)]
    [InlineData(BatchApplyPhase.CreatingDirectories)]
    [InlineData(BatchApplyPhase.WritingFiles)]
    [InlineData(BatchApplyPhase.Finalizing)]
    [InlineData(BatchApplyPhase.Completed)]
    [InlineData(BatchApplyPhase.RollingBack)]
    public void Convert_ReturnsStreamGeometry_ForAllPhases(BatchApplyPhase phase)
    {
        // Act
        var result = _converter.Convert(phase, typeof(StreamGeometry), null, null);

        // Assert
        Assert.NotNull(result);
        Assert.IsType<StreamGeometry>(result);
    }

    [Fact]
    public void Convert_ReturnsDefaultIcon_ForNullValue()
    {
        // Act
        var result = _converter.Convert(null, typeof(StreamGeometry), null, null);

        // Assert
        Assert.NotNull(result);
        Assert.IsType<StreamGeometry>(result);
    }

    [Fact]
    public void Convert_ReturnsDefaultIcon_ForInvalidType()
    {
        // Act
        var result = _converter.Convert("not a phase", typeof(StreamGeometry), null, null);

        // Assert
        Assert.NotNull(result);
        Assert.IsType<StreamGeometry>(result);
    }

    [Fact]
    public void ConvertBack_ThrowsNotSupportedException()
    {
        // Act & Assert
        Assert.Throws<NotSupportedException>(() =>
            _converter.ConvertBack(null, typeof(BatchApplyPhase), null, null));
    }
}
```

### PhaseToTitleConverterTests

```csharp
// tests/SeniorIntern.Desktop.Tests/Converters/PhaseToTitleConverterTests.cs
namespace SeniorIntern.Desktop.Tests.Converters;

using SeniorIntern.Core.Models;
using SeniorIntern.Desktop.Converters;
using Xunit;

public class PhaseToTitleConverterTests
{
    private readonly PhaseToTitleConverter _converter = new();

    [Theory]
    [InlineData(BatchApplyPhase.Validating, "Validating...")]
    [InlineData(BatchApplyPhase.CreatingBackups, "Creating Backups...")]
    [InlineData(BatchApplyPhase.CreatingDirectories, "Creating Directories...")]
    [InlineData(BatchApplyPhase.WritingFiles, "Writing Files...")]
    [InlineData(BatchApplyPhase.Finalizing, "Finalizing...")]
    [InlineData(BatchApplyPhase.Completed, "Complete!")]
    [InlineData(BatchApplyPhase.RollingBack, "Rolling Back...")]
    public void Convert_ReturnsCorrectTitle(BatchApplyPhase phase, string expectedTitle)
    {
        // Act
        var result = _converter.Convert(phase, typeof(string), null, null);

        // Assert
        Assert.Equal(expectedTitle, result);
    }

    [Fact]
    public void Convert_ReturnsProcessing_ForNullValue()
    {
        // Act
        var result = _converter.Convert(null, typeof(string), null, null);

        // Assert
        Assert.Equal("Processing...", result);
    }

    [Fact]
    public void Convert_ReturnsProcessing_ForInvalidType()
    {
        // Act
        var result = _converter.Convert(123, typeof(string), null, null);

        // Assert
        Assert.Equal("Processing...", result);
    }
}
```

### ProgressReporterAdapterTests

```csharp
// tests/SeniorIntern.Desktop.Tests/Services/ProgressReporterAdapterTests.cs
namespace SeniorIntern.Desktop.Tests.Services;

using Moq;
using SeniorIntern.Core.Models;
using SeniorIntern.Desktop.Services;
using SeniorIntern.Desktop.ViewModels;
using Xunit;

public class ProgressReporterAdapterTests
{
    [Fact]
    public void Constructor_ThrowsOnNullViewModel()
    {
        // Act & Assert
        Assert.Throws<ArgumentNullException>(() => new ProgressReporterAdapter(null!));
    }

    [Fact]
    public void Report_CallsViewModelUpdate()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);
        var adapter = new ProgressReporterAdapter(viewModel);

        var progress = new BatchApplyProgress
        {
            Phase = BatchApplyPhase.WritingFiles,
            CurrentFile = "test.cs",
            CompletedOperations = 1,
            TotalOperations = 3
        };

        // Act
        adapter.Report(progress);

        // Assert
        Assert.Equal(BatchApplyPhase.WritingFiles, viewModel.Phase);
        Assert.Equal("test.cs", viewModel.CurrentFile);
        Assert.Equal(1, viewModel.CompletedCount);
    }

    [Fact]
    public void ReportComplete_CallsViewModelComplete()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);
        var adapter = new ProgressReporterAdapter(viewModel);

        // Act
        adapter.ReportComplete();

        // Assert
        Assert.Equal(BatchApplyPhase.Completed, viewModel.Phase);
    }

    [Fact]
    public void ReportError_CallsViewModelError()
    {
        // Arrange
        var viewModel = new ApplyProgressViewModel();
        viewModel.Start(new CancellationTokenSource(), 3);
        var adapter = new ProgressReporterAdapter(viewModel);

        // Act
        adapter.ReportError("Test error message");

        // Assert
        Assert.Equal(BatchApplyPhase.RollingBack, viewModel.Phase);
        Assert.Equal("Test error message", viewModel.ErrorMessage);
    }
}
```

---

## Files to Create

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/Controls/ApplyProgressOverlay.axaml` | Progress overlay UI |
| `src/SeniorIntern.Desktop/Controls/ApplyProgressOverlay.axaml.cs` | Overlay code-behind |
| `src/SeniorIntern.Desktop/ViewModels/ApplyProgressViewModel.cs` | Progress ViewModel |
| `src/SeniorIntern.Desktop/Converters/PhaseToIconConverter.cs` | Phase to icon geometry converter |
| `src/SeniorIntern.Desktop/Converters/PhaseToTitleConverter.cs` | Phase to title text converter |
| `src/SeniorIntern.Desktop/Converters/PhaseToBrushConverter.cs` | Phase to color brush converter |
| `src/SeniorIntern.Desktop/Styles/ApplyProgressStyles.axaml` | Overlay styles and icon geometries |
| `src/SeniorIntern.Core/Interfaces/IProgressReporter.cs` | Progress reporting interface |
| `src/SeniorIntern.Desktop/Services/ProgressReporterAdapter.cs` | IProgress adapter |
| `tests/SeniorIntern.Desktop.Tests/ViewModels/ApplyProgressViewModelTests.cs` | ViewModel tests |
| `tests/SeniorIntern.Desktop.Tests/Converters/PhaseToIconConverterTests.cs` | Icon converter tests |
| `tests/SeniorIntern.Desktop.Tests/Converters/PhaseToTitleConverterTests.cs` | Title converter tests |
| `tests/SeniorIntern.Desktop.Tests/Services/ProgressReporterAdapterTests.cs` | Adapter tests |

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/App.axaml` | Add ApplyProgressStyles to merged dictionaries |
| `src/SeniorIntern.Desktop/Extensions/ServiceCollectionExtensions.cs` | Register ApplyProgressViewModel |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add overlay to window content |

---

## Acceptance Criteria

- [ ] Overlay appears when batch apply starts
- [ ] Phase icon updates correctly for each phase
- [ ] Phase title updates correctly for each phase
- [ ] Current file path is displayed and truncates with ellipsis
- [ ] Progress bar animates smoothly during WritingFiles phase
- [ ] Progress bar is indeterminate during Validating and Finalizing phases
- [ ] Percentage text updates correctly (0-100%)
- [ ] File count displays as "X of Y files"
- [ ] Cancel button is visible when CanCancel is true
- [ ] Cancel button triggers cancellation and shows rollback phase
- [ ] Escape key triggers cancellation when overlay is focused
- [ ] Overlay auto-hides 1.5 seconds after completion
- [ ] Error message displays on failure
- [ ] Rollback phase shows undo icon and message
- [ ] Overlay blocks interaction with underlying UI
- [ ] Overlay is centered in the window
- [ ] Drop shadow provides visual elevation
- [ ] Success completion shows green check icon with animation
- [ ] All unit tests pass

---

## Design Decisions

### 1. Modal Overlay vs Inline Progress

**Decision**: Modal overlay blocking the full window.

**Rationale**:
- Prevents accidental interactions during file operations
- Clear indication that an operation is in progress
- Consistent with destructive operation patterns
- Provides focused attention on progress

**Alternatives Considered**:
- Inline progress in proposal panel - less intrusive but allows conflicting interactions
- Status bar progress - easily overlooked, no cancellation affordance

### 2. Auto-Hide Behavior

**Decision**: 1.5 second delay before auto-hide on completion.

**Rationale**:
- Allows user to see the "Complete!" confirmation
- Not so long that it feels slow
- Immediate hide would be jarring
- User can still manually navigate away

### 3. Indeterminate Progress for Validation

**Decision**: Use indeterminate progress bar during Validating and Finalizing phases.

**Rationale**:
- These phases don't have measurable file-by-file progress
- Honest representation of what we can measure
- Avoids stuck-at-0% perception
- Standard UX pattern for unknown-duration operations

### 4. Phase-Specific Icons

**Decision**: Different icons for each BatchApplyPhase.

**Rationale**:
- Visual differentiation aids at-a-glance understanding
- Reinforces what's happening at each stage
- More engaging than a static icon
- Consistent with phase-based feedback

### 5. Escape Key Cancellation

**Decision**: Support Escape key to cancel (when cancellation is allowed).

**Rationale**:
- Standard keyboard shortcut for cancel
- Accessibility benefit
- Quick escape from long-running operation
- Consistent with dialog cancel patterns

---

## Accessibility Considerations

1. **Screen Reader Support**
   - AutomationProperties.Name on overlay and cancel button
   - Phase title and current file are announced
   - Progress percentage is screen-reader friendly

2. **Keyboard Navigation**
   - TabNavigation.Cycle keeps focus within overlay
   - Escape key triggers cancellation
   - Cancel button is focusable via Tab

3. **Visual Accessibility**
   - High contrast between overlay and card
   - Sufficient color contrast on text and icons
   - Progress bar uses distinct foreground color
   - Error states use red color (with text support)

4. **Motion Sensitivity**
   - Completion animation is brief (0.5s)
   - No continuous animations during operation
   - Progress bar updates smoothly but not distractingly

---

## Performance Considerations

1. **UI Thread Updates**
   - Progress updates marshaled to UI thread via Dispatcher
   - Batching of rapid updates handled by property change system
   - No blocking of UI thread during operations

2. **Memory Efficiency**
   - StreamGeometry instances are lazy-loaded and cached
   - No unnecessary object allocation during progress updates
   - CancellationTokenSource properly disposed

3. **Animation Performance**
   - CSS-style animations use GPU acceleration
   - Animation only triggers once on completion
   - No continuous animation during operation

---

## Future Enhancements

1. **Estimated Time Remaining**
   - Calculate average time per operation
   - Display "~X seconds remaining" estimate
   - Update estimate as operations complete

2. **Detailed Progress Log**
   - Expandable section showing completed files
   - Show success/failure status per file
   - Allow scrolling through history

3. **Pause/Resume Support**
   - Pause button in addition to Cancel
   - Resume from last completed operation
   - Useful for large batch operations

4. **Sound Feedback**
   - Optional completion sound
   - Error sound for failures
   - Configurable in settings

5. **Progress Persistence**
   - Remember progress if app crashes
   - Resume from last known state
   - Show recovery UI on restart
