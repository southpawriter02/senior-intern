# v0.4.4e: Proposal Panel - Design Specification

**Status**: _IMPLEMENTED_

## Executive Summary

This specification details the **Proposal Panel** UI component for The Senior Intern's Multi-File Creation system. This Avalonia UserControl provides the visual interface for displaying multi-file proposals with an interactive tree view, selection controls, validation feedback, progress indication, and action buttons. It binds to the FileTreeProposalViewModel (v0.4.4d) and integrates with the application's existing theme system.

### Key Deliverables

| Component | Type | Purpose |
|-----------|------|---------|
| `FileTreeProposalPanel.axaml` | UserControl | Main proposal panel UI markup |
| `FileTreeProposalPanel.axaml.cs` | Code-behind | Event handlers and control logic |
| `FileTreeItemControl.axaml` | UserControl | Individual tree item template |
| `FileTreeItemControl.axaml.cs` | Code-behind | Tree item interaction logic |
| `IconNameConverter` | IValueConverter | Converts icon names to PathIcon data |
| `BoolToStringConverter` | IValueConverter | Converts bool to conditional strings |
| `SelectionStateToCheckStateConverter` | IValueConverter | Maps SelectionState to checkbox state |
| `ProposalPanelStyles.axaml` | ResourceDictionary | Panel-specific styles and templates |

---

## Feature Overview

```
v0.4.4e: Proposal Panel
â”œâ”€â”€ FileTreeProposalPanel
â”‚   â”œâ”€â”€ Layout Structure (5-row Grid)
â”‚   â”‚   â”œâ”€â”€ Row 0: Header Section
â”‚   â”‚   â”‚   â”œâ”€â”€ Icon (FolderPlusIcon)
â”‚   â”‚   â”‚   â”œâ”€â”€ Title ("Multi-File Proposal")
â”‚   â”‚   â”‚   â”œâ”€â”€ Description (from ViewModel)
â”‚   â”‚   â”‚   â””â”€â”€ Stats (file count, folder count)
â”‚   â”‚   â”œâ”€â”€ Row 1: Validation/Selection Bar
â”‚   â”‚   â”‚   â”œâ”€â”€ Error Banner (when HasErrors)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Error Icon
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Error Message
â”‚   â”‚   â”‚   â””â”€â”€ Selection Controls (when !HasErrors)
â”‚   â”‚   â”‚       â”œâ”€â”€ Select All Button
â”‚   â”‚   â”‚       â”œâ”€â”€ Deselect All Button
â”‚   â”‚   â”‚       â””â”€â”€ Selection Summary Text
â”‚   â”‚   â”œâ”€â”€ Row 2: File Tree (main content)
â”‚   â”‚   â”‚   â””â”€â”€ TreeView with FileTreeItemControl
â”‚   â”‚   â”œâ”€â”€ Row 3: Options Section
â”‚   â”‚   â”‚   â””â”€â”€ Backup Checkbox
â”‚   â”‚   â””â”€â”€ Row 4: Actions Section
â”‚   â”‚       â”œâ”€â”€ Progress Display (when IsApplying)
â”‚   â”‚       â”‚   â”œâ”€â”€ ProgressBar
â”‚   â”‚       â”‚   â””â”€â”€ Current File Text
â”‚   â”‚       â””â”€â”€ Action Buttons
â”‚   â”‚           â”œâ”€â”€ Cancel Button (when IsApplying)
â”‚   â”‚           â”œâ”€â”€ Preview Button
â”‚   â”‚           â””â”€â”€ Apply Button (accent)
â”‚   â”œâ”€â”€ Visual States
â”‚   â”‚   â”œâ”€â”€ Default (ready to apply)
â”‚   â”‚   â”œâ”€â”€ HasErrors (apply disabled)
â”‚   â”‚   â”œâ”€â”€ HasWarnings (apply enabled, warning shown)
â”‚   â”‚   â”œâ”€â”€ Applying (progress visible)
â”‚   â”‚   â””â”€â”€ Completed (success indicator)
â”‚   â””â”€â”€ Interactions
â”‚       â”œâ”€â”€ Tree expand/collapse
â”‚       â”œâ”€â”€ Checkbox selection
â”‚       â”œâ”€â”€ Keyboard navigation
â”‚       â””â”€â”€ Tooltip on hover
â”œâ”€â”€ FileTreeItemControl
â”‚   â”œâ”€â”€ Directory Item Layout
â”‚   â”‚   â”œâ”€â”€ Expand/Collapse Toggle
â”‚   â”‚   â”œâ”€â”€ Tri-state Checkbox (optional)
â”‚   â”‚   â”œâ”€â”€ Folder Icon (open/closed)
â”‚   â”‚   â””â”€â”€ Directory Name
â”‚   â”œâ”€â”€ File Item Layout
â”‚   â”‚   â”œâ”€â”€ Selection Checkbox
â”‚   â”‚   â”œâ”€â”€ File Type Icon
â”‚   â”‚   â”œâ”€â”€ File Name
â”‚   â”‚   â”œâ”€â”€ Language Badge
â”‚   â”‚   â”œâ”€â”€ Status Badges
â”‚   â”‚   â”‚   â”œâ”€â”€ "exists" (when FileExists)
â”‚   â”‚   â”‚   â”œâ”€â”€ "new" (when Create operation)
â”‚   â”‚   â”‚   â””â”€â”€ Status icon (Applied/Failed/etc.)
â”‚   â”‚   â””â”€â”€ Validation Icons
â”‚   â”‚       â”œâ”€â”€ Warning Icon (with tooltip)
â”‚   â”‚       â””â”€â”€ Error Icon (with tooltip)
â”‚   â””â”€â”€ Visual States
â”‚       â”œâ”€â”€ Default
â”‚       â”œâ”€â”€ Selected (highlighted)
â”‚       â”œâ”€â”€ Hovered
â”‚       â”œâ”€â”€ Disabled
â”‚       â””â”€â”€ HasIssue (warning/error styling)
â”œâ”€â”€ Value Converters
â”‚   â”œâ”€â”€ IconNameConverter
â”‚   â”‚   â””â”€â”€ Converts string icon names to StreamGeometry
â”‚   â”œâ”€â”€ BoolToStringConverter
â”‚   â”‚   â””â”€â”€ Converts bool to parameterized strings
â”‚   â”œâ”€â”€ SelectionStateToCheckStateConverter
â”‚   â”‚   â””â”€â”€ Maps None/Some/All to unchecked/indeterminate/checked
â”‚   â””â”€â”€ ValidationSeverityToBrushConverter
â”‚       â””â”€â”€ Maps severity to appropriate color brush
â””â”€â”€ Styles (ProposalPanelStyles.axaml)
    â”œâ”€â”€ Panel Container Styles
    â”‚   â”œâ”€â”€ proposal-panel (main border)
    â”‚   â””â”€â”€ proposal-panel-compact (smaller variant)
    â”œâ”€â”€ Tree Item Styles
    â”‚   â”œâ”€â”€ tree-item-default
    â”‚   â”œâ”€â”€ tree-item-selected
    â”‚   â”œâ”€â”€ tree-item-hovered
    â”‚   â””â”€â”€ tree-item-disabled
    â”œâ”€â”€ Badge Styles
    â”‚   â”œâ”€â”€ language-badge
    â”‚   â”œâ”€â”€ exists-badge
    â”‚   â”œâ”€â”€ new-badge
    â”‚   â””â”€â”€ status-badge
    â”œâ”€â”€ Button Styles
    â”‚   â”œâ”€â”€ secondary (Select All, Deselect All)
    â”‚   â”œâ”€â”€ accent (Create Files)
    â”‚   â””â”€â”€ icon-button (expand/collapse)
    â””â”€â”€ Animation Styles
        â”œâ”€â”€ expand-collapse-animation
        â””â”€â”€ progress-fade-animation
```

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FileTreeProposalPanel                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HEADER (Row 0)                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Icon â”‚  â”‚ Multi-File Proposal            â”‚  â”‚  5 files 3 foldersâ”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“+ â”‚  â”‚ Creating auth system files...  â”‚  â”‚    ğŸ“„      ğŸ“     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VALIDATION/SELECTION BAR (Row 1)                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Select All  â”‚ â”‚ Deselect All  â”‚  â”‚     3 of 5 files selected    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FILE TREE (Row 2)                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  â–¼ ğŸ“ src                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â–¼ ğŸ“ Services                                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â˜‘ ğŸ“„ UserService.cs          C#                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â˜‘ ğŸ“„ AuthService.cs          C#          exists  âš         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â–¼ ğŸ“ Models                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â˜‘ ğŸ“„ User.cs                 C#                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚      â˜ ğŸ“„ Token.cs                C#          new              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â–¶ ğŸ“ tests                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OPTIONS (Row 3)                                                        â”‚  â”‚
â”‚  â”‚  â˜‘ Create backup for existing files                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ACTIONS (Row 4)                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ (Progress bar when applying)       â”‚  â”‚ Preview â”‚ â”‚ Create Files â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Creating UserService.cs...        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Component Relationships                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ChatView                                                                   â”‚
â”‚  â””â”€â”€ ItemsControl (Messages)                                                â”‚
â”‚      â””â”€â”€ ChatMessageControl                                                 â”‚
â”‚          â””â”€â”€ FileTreeProposalPanel  â—„â”€â”€â”€ NEW COMPONENT                     â”‚
â”‚              â”œâ”€â”€ DataContext: FileTreeProposalViewModel                     â”‚
â”‚              â”œâ”€â”€ TreeView                                                   â”‚
â”‚              â”‚   â””â”€â”€ TreeDataTemplate                                       â”‚
â”‚              â”‚       â””â”€â”€ FileTreeItemControl                                â”‚
â”‚              â”‚           â””â”€â”€ DataContext: FileTreeItemViewModel             â”‚
â”‚              â””â”€â”€ Event Handlers                                             â”‚
â”‚                  â”œâ”€â”€ PreviewRequested â†’ Opens BatchPreviewDialog            â”‚
â”‚                  â””â”€â”€ ApplyCompleted â†’ Shows UndoToast                       â”‚
â”‚                                                                             â”‚
â”‚  Theme Integration                                                          â”‚
â”‚  â””â”€â”€ Dark.axaml                                                             â”‚
â”‚      â””â”€â”€ ProposalPanelStyles.axaml  â—„â”€â”€â”€ NEW STYLES                        â”‚
â”‚          â”œâ”€â”€ Proposal Panel Styles                                          â”‚
â”‚          â”œâ”€â”€ Tree Item Styles                                               â”‚
â”‚          â”œâ”€â”€ Badge Styles                                                   â”‚
â”‚          â””â”€â”€ Button Styles                                                  â”‚
â”‚                                                                             â”‚
â”‚  Converters                                                                 â”‚
â”‚  â””â”€â”€ App.axaml Resources                                                    â”‚
â”‚      â”œâ”€â”€ IconNameConverter  â—„â”€â”€â”€ NEW                                       â”‚
â”‚      â”œâ”€â”€ BoolToStringConverter  â—„â”€â”€â”€ NEW                                   â”‚
â”‚      â””â”€â”€ SelectionStateToCheckStateConverter  â—„â”€â”€â”€ NEW                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visual State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Panel Visual States                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚   Default    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  (Ready)     â”‚                                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚                â”‚
â”‚         â”‚                                                 â”‚                â”‚
â”‚         â”‚ HasErrors=true                                  â”‚ Reset          â”‚
â”‚         â–¼                                                 â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚                â”‚
â”‚  â”‚  HasErrors   â”‚â”€â”€â”€â”€â”€â”€â”€ Fix errors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
â”‚  â”‚ (Blocked)    â”‚                                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚                â”‚
â”‚                                                           â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚                â”‚
â”‚  â”‚   Default    â”‚                                         â”‚                â”‚
â”‚  â”‚  (Ready)     â”‚                                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚                â”‚
â”‚         â”‚                                                 â”‚                â”‚
â”‚         â”‚ ApplyCommand                                    â”‚                â”‚
â”‚         â–¼                                                 â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚                â”‚
â”‚  â”‚   Applying   â”‚â”€â”€â”€â”€â”€â”€â”€ CancelCommand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
â”‚  â”‚ (Progress)   â”‚                                         â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚                â”‚
â”‚         â”‚                                                 â”‚                â”‚
â”‚         â”‚ Complete                                        â”‚                â”‚
â”‚         â–¼                                                 â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚                â”‚
â”‚  â”‚  Completed   â”‚â”€â”€â”€â”€â”€â”€â”€ Dismiss/Timer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
â”‚  â”‚  (Success)   â”‚                                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Design

### FileTreeProposalPanel.axaml

```xml
<!-- src/SeniorIntern.Desktop/Controls/FileTreeProposalPanel.axaml -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:controls="using:SeniorIntern.Desktop.Controls"
             xmlns:converters="using:SeniorIntern.Desktop.Converters"
             mc:Ignorable="d"
             d:DesignWidth="600" d:DesignHeight="400"
             x:Class="SeniorIntern.Desktop.Controls.FileTreeProposalPanel"
             x:DataType="vm:FileTreeProposalViewModel">

    <UserControl.Resources>
        <converters:IconNameConverter x:Key="IconNameConverter" />
        <converters:BoolToStringConverter x:Key="BoolToStringConverter" />
        <converters:SelectionStateToCheckStateConverter x:Key="SelectionStateConverter" />
        <converters:ValidationSeverityToBrushConverter x:Key="SeverityToBrushConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Panel Container -->
        <Style Selector="Border.proposal-panel">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
            <Setter Property="BorderThickness" Value="1,1,1,3" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Margin" Value="0,8" />
            <Setter Property="Padding" Value="16" />
        </Style>

        <!-- Error Banner -->
        <Style Selector="Border.error-banner">
            <Setter Property="Background" Value="{DynamicResource ErrorBackground}" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,12,0,0" />
        </Style>

        <!-- Warning Banner -->
        <Style Selector="Border.warning-banner">
            <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,12,0,0" />
        </Style>

        <!-- Selection Controls -->
        <Style Selector="Button.selection-button">
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="MinWidth" Value="80" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
        </Style>
        <Style Selector="Button.selection-button:pointerover">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
        </Style>
        <Style Selector="Button.selection-button:disabled">
            <Setter Property="Opacity" Value="0.5" />
        </Style>

        <!-- Language Badge -->
        <Style Selector="Border.language-badge">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
            <Setter Property="Padding" Value="6,2" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>

        <!-- Exists Badge -->
        <Style Selector="Border.exists-badge">
            <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>

        <!-- New Badge -->
        <Style Selector="Border.new-badge">
            <Setter Property="Background" Value="{DynamicResource SuccessBackground}" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="CornerRadius" Value="3" />
        </Style>

        <!-- Tree Item -->
        <Style Selector="TreeViewItem">
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
            <Setter Property="Padding" Value="4,2" />
        </Style>

        <!-- Accent Button -->
        <Style Selector="Button.accent">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="16,8" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>
        <Style Selector="Button.accent:pointerover">
            <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}" />
        </Style>
        <Style Selector="Button.accent:disabled">
            <Setter Property="Opacity" Value="0.5" />
        </Style>

        <!-- Stats Text -->
        <Style Selector="TextBlock.stat-text">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
    </UserControl.Styles>

    <Border Classes="proposal-panel">
        <Grid RowDefinitions="Auto, Auto, *, Auto, Auto">

            <!-- Row 0: Header -->
            <Grid ColumnDefinitions="Auto, *, Auto">
                <!-- Icon -->
                <PathIcon Data="{StaticResource FolderPlusIcon}"
                          Width="24" Height="24"
                          Foreground="{DynamicResource AccentBrush}"
                          VerticalAlignment="Top"
                          Margin="0,2,0,0" />

                <!-- Title and Description -->
                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                    <TextBlock Text="Multi-File Proposal"
                               FontWeight="SemiBold"
                               FontSize="16"
                               Foreground="{DynamicResource TextPrimary}" />
                    <TextBlock Text="{Binding Description}"
                               Foreground="{DynamicResource TextMuted}"
                               TextWrapping="Wrap"
                               MaxLines="2"
                               TextTrimming="CharacterEllipsis"
                               IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               Margin="0,4,0,0" />
                </StackPanel>

                <!-- Stats -->
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            Spacing="16"
                            VerticalAlignment="Top">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <PathIcon Data="{StaticResource FileIcon}"
                                  Width="14" Height="14"
                                  Foreground="{DynamicResource TextMuted}" />
                        <TextBlock Classes="stat-text"
                                   Text="{Binding FileCount, StringFormat='{}{0} files'}" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <PathIcon Data="{StaticResource FolderIcon}"
                                  Width="14" Height="14"
                                  Foreground="{DynamicResource TextMuted}" />
                        <TextBlock Classes="stat-text"
                                   Text="{Binding DirectoryCount, StringFormat='{}{0} folders'}" />
                    </StackPanel>
                </StackPanel>
            </Grid>

            <!-- Row 1: Validation Messages OR Selection Controls -->
            <Panel Grid.Row="1">
                <!-- Error Banner (shown when HasErrors) -->
                <Border Classes="error-banner"
                        IsVisible="{Binding HasErrors}">
                    <Grid ColumnDefinitions="Auto, *, Auto">
                        <PathIcon Data="{StaticResource ErrorIcon}"
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource ErrorForeground}" />
                        <TextBlock Grid.Column="1"
                                   Text="Some files have validation errors and cannot be created"
                                   Foreground="{DynamicResource ErrorForeground}"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="2"
                                Content="View Details"
                                Command="{Binding ShowValidationDetailsCommand}"
                                Classes="selection-button"
                                Foreground="{DynamicResource ErrorForeground}"
                                Margin="8,0,0,0" />
                    </Grid>
                </Border>

                <!-- Warning Banner (shown when HasWarnings but no errors) -->
                <Border Classes="warning-banner"
                        IsVisible="{Binding HasWarnings}">
                    <Grid ColumnDefinitions="Auto, *">
                        <PathIcon Data="{StaticResource WarningIcon}"
                                  Width="16" Height="16"
                                  Foreground="{DynamicResource WarningForeground}" />
                        <TextBlock Grid.Column="1"
                                   Text="Some files already exist and will be overwritten"
                                   Foreground="{DynamicResource WarningForeground}"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center" />
                    </Grid>
                </Border>

                <!-- Selection Controls (shown when no errors) -->
                <StackPanel Orientation="Horizontal"
                            Spacing="8"
                            Margin="0,12,0,0"
                            IsVisible="{Binding !HasErrors}">
                    <Button Content="Select All"
                            Command="{Binding SelectAllCommand}"
                            Classes="selection-button"
                            ToolTip.Tip="Select all files (Ctrl+A)" />
                    <Button Content="Deselect All"
                            Command="{Binding DeselectAllCommand}"
                            Classes="selection-button"
                            ToolTip.Tip="Deselect all files (Ctrl+D)" />

                    <Rectangle Width="1"
                               Fill="{DynamicResource BorderBrush}"
                               Margin="8,4" />

                    <Button Command="{Binding ExpandAllCommand}"
                            Classes="selection-button"
                            ToolTip.Tip="Expand all folders"
                            Padding="6,4">
                        <PathIcon Data="{StaticResource ExpandAllIcon}"
                                  Width="14" Height="14" />
                    </Button>
                    <Button Command="{Binding CollapseAllCommand}"
                            Classes="selection-button"
                            ToolTip.Tip="Collapse all folders"
                            Padding="6,4">
                        <PathIcon Data="{StaticResource CollapseAllIcon}"
                                  Width="14" Height="14" />
                    </Button>

                    <!-- Selection Summary -->
                    <TextBlock VerticalAlignment="Center"
                               Margin="12,0,0,0"
                               Foreground="{DynamicResource TextMuted}">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0} of {1} selected">
                                <Binding Path="SelectedCount" />
                                <Binding Path="FileCount" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
            </Panel>

            <!-- Row 2: File Tree -->
            <Border Grid.Row="2"
                    Background="{DynamicResource ControlBackground}"
                    CornerRadius="4"
                    Margin="0,12"
                    Padding="4"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              MaxHeight="300">
                    <TreeView x:Name="FileTree"
                              ItemsSource="{Binding TreeItems}"
                              SelectedItem="{Binding SelectedItem}"
                              SelectionMode="Single"
                              AutoScrollToSelectedItem="True">
                        <TreeView.ItemTemplate>
                            <TreeDataTemplate ItemsSource="{Binding Children}">
                                <controls:FileTreeItemControl DataContext="{Binding}" />
                            </TreeDataTemplate>
                        </TreeView.ItemTemplate>

                        <TreeView.KeyBindings>
                            <KeyBinding Gesture="Space"
                                        Command="{Binding $parent[TreeView].DataContext.ToggleItemSelectionCommand}"
                                        CommandParameter="{Binding $parent[TreeView].SelectedItem}" />
                        </TreeView.KeyBindings>
                    </TreeView>
                </ScrollViewer>
            </Border>

            <!-- Row 3: Options -->
            <StackPanel Grid.Row="3"
                        Orientation="Horizontal"
                        Spacing="16"
                        Margin="0,0,0,12">
                <CheckBox Content="Create backup for existing files"
                          IsChecked="{Binding CreateBackups}"
                          IsEnabled="{Binding !IsApplying}"
                          ToolTip.Tip="Backup existing files before overwriting (recommended)" />
            </StackPanel>

            <!-- Row 4: Actions -->
            <Grid Grid.Row="4" ColumnDefinitions="*, Auto">
                <!-- Progress Display (when applying) -->
                <StackPanel IsVisible="{Binding IsApplying}"
                            Spacing="8"
                            VerticalAlignment="Center">
                    <Grid ColumnDefinitions="*, Auto">
                        <ProgressBar Value="{Binding ApplyProgress}"
                                     Minimum="0"
                                     Maximum="100"
                                     Height="6"
                                     CornerRadius="3" />
                        <TextBlock Grid.Column="1"
                                   Text="{Binding ApplyProgress, StringFormat='{}{0:F0}%'}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextMuted}"
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center" />
                    </Grid>
                    <TextBlock Text="{Binding CurrentFile}"
                               FontSize="12"
                               Foreground="{DynamicResource TextMuted}"
                               TextTrimming="CharacterEllipsis"
                               MaxWidth="400" />
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="8">
                    <!-- Cancel Button (when applying) -->
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            IsVisible="{Binding IsApplying}"
                            ToolTip.Tip="Cancel file creation (Esc)" />

                    <!-- Preview Button -->
                    <Button Content="Preview"
                            Command="{Binding PreviewCommand}"
                            IsEnabled="{Binding !IsApplying}"
                            IsVisible="{Binding !IsApplying}"
                            ToolTip.Tip="Preview changes before applying (Ctrl+P)">
                        <Button.CommandParameter>
                            <x:Boolean>False</x:Boolean>
                        </Button.CommandParameter>
                    </Button>

                    <!-- Apply Button -->
                    <Button Classes="accent"
                            Command="{Binding ApplyCommand}"
                            ToolTip.Tip="Create selected files (Ctrl+Enter)">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <!-- Loading Spinner -->
                            <Border IsVisible="{Binding IsApplying}"
                                    Width="16" Height="16">
                                <PathIcon Data="{StaticResource SpinnerIcon}"
                                          Width="16" Height="16"
                                          Foreground="White"
                                          RenderTransformOrigin="0.5,0.5">
                                    <PathIcon.RenderTransform>
                                        <RotateTransform />
                                    </PathIcon.RenderTransform>
                                    <PathIcon.Styles>
                                        <Style Selector="PathIcon">
                                            <Style.Animations>
                                                <Animation Duration="0:0:1"
                                                           IterationCount="INFINITE">
                                                    <KeyFrame Cue="0%">
                                                        <Setter Property="RenderTransform"
                                                                Value="rotate(0deg)" />
                                                    </KeyFrame>
                                                    <KeyFrame Cue="100%">
                                                        <Setter Property="RenderTransform"
                                                                Value="rotate(360deg)" />
                                                    </KeyFrame>
                                                </Animation>
                                            </Style.Animations>
                                        </Style>
                                    </PathIcon.Styles>
                                </PathIcon>
                            </Border>

                            <!-- Button Text -->
                            <TextBlock Text="{Binding IsApplying,
                                       Converter={StaticResource BoolToStringConverter},
                                       ConverterParameter='Creating...|Create Files'}" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
```

### FileTreeProposalPanel.axaml.cs

```csharp
// src/SeniorIntern.Desktop/Controls/FileTreeProposalPanel.axaml.cs
using Avalonia;
using Avalonia.Controls;
using Avalonia.Input;
using Avalonia.Interactivity;
using Avalonia.Threading;
using SeniorIntern.Desktop.ViewModels;
using SeniorIntern.Desktop.Views;

namespace SeniorIntern.Desktop.Controls;

/// <summary>
/// Code-behind for the FileTreeProposalPanel control.
/// Handles keyboard shortcuts and event forwarding.
/// </summary>
public partial class FileTreeProposalPanel : UserControl
{
    private FileTreeProposalViewModel? _viewModel;

    public FileTreeProposalPanel()
    {
        InitializeComponent();

        // Subscribe to DataContext changes
        DataContextChanged += OnDataContextChanged;

        // Setup keyboard shortcuts
        KeyDown += OnKeyDown;
    }

    private void OnDataContextChanged(object? sender, EventArgs e)
    {
        // Unsubscribe from old ViewModel
        if (_viewModel != null)
        {
            _viewModel.PreviewRequested -= OnPreviewRequested;
            _viewModel.ApplyCompleted -= OnApplyCompleted;
            _viewModel.ApplyCancelled -= OnApplyCancelled;
        }

        // Subscribe to new ViewModel
        _viewModel = DataContext as FileTreeProposalViewModel;
        if (_viewModel != null)
        {
            _viewModel.PreviewRequested += OnPreviewRequested;
            _viewModel.ApplyCompleted += OnApplyCompleted;
            _viewModel.ApplyCancelled += OnApplyCancelled;
        }
    }

    private void OnKeyDown(object? sender, KeyEventArgs e)
    {
        if (_viewModel == null)
            return;

        // Handle keyboard shortcuts
        var modifiers = e.KeyModifiers;

        switch (e.Key)
        {
            case Key.A when modifiers.HasFlag(KeyModifiers.Control):
                if (_viewModel.SelectAllCommand.CanExecute(null))
                {
                    _viewModel.SelectAllCommand.Execute(null);
                    e.Handled = true;
                }
                break;

            case Key.D when modifiers.HasFlag(KeyModifiers.Control):
                if (_viewModel.DeselectAllCommand.CanExecute(null))
                {
                    _viewModel.DeselectAllCommand.Execute(null);
                    e.Handled = true;
                }
                break;

            case Key.P when modifiers.HasFlag(KeyModifiers.Control):
                if (_viewModel.PreviewCommand.CanExecute(null))
                {
                    _ = _viewModel.PreviewCommand.ExecuteAsync(null);
                    e.Handled = true;
                }
                break;

            case Key.Enter when modifiers.HasFlag(KeyModifiers.Control):
                if (_viewModel.ApplyCommand.CanExecute(null))
                {
                    _ = _viewModel.ApplyCommand.ExecuteAsync(null);
                    e.Handled = true;
                }
                break;

            case Key.Escape:
                if (_viewModel.CancelCommand.CanExecute(null))
                {
                    _viewModel.CancelCommand.Execute(null);
                    e.Handled = true;
                }
                break;
        }
    }

    private async void OnPreviewRequested(object? sender, IReadOnlyList<DiffResult> diffs)
    {
        // Open the batch preview dialog
        var window = TopLevel.GetTopLevel(this) as Window;
        if (window == null)
            return;

        var dialog = new BatchPreviewDialog(diffs);
        var result = await dialog.ShowDialog<bool>(window);

        if (result && _viewModel != null)
        {
            // User clicked "Apply All" in preview dialog
            await _viewModel.ApplyCommand.ExecuteAsync(null);
        }
    }

    private void OnApplyCompleted(object? sender, BatchApplyResult result)
    {
        // Show completion notification
        Dispatcher.UIThread.Post(() =>
        {
            if (result.AllSucceeded)
            {
                ShowUndoToast(result);
            }
            else
            {
                ShowErrorNotification(result);
            }
        });
    }

    private void OnApplyCancelled(object? sender, EventArgs e)
    {
        // Show cancellation notification
        Dispatcher.UIThread.Post(() =>
        {
            ShowCancellationNotification();
        });
    }

    private void ShowUndoToast(BatchApplyResult result)
    {
        // Raise event for parent to handle undo toast
        var args = new UndoToastRequestedEventArgs(result);
        RaiseEvent(args);
    }

    private void ShowErrorNotification(BatchApplyResult result)
    {
        // Raise event for parent to handle error notification
        var args = new ApplyErrorEventArgs(result);
        RaiseEvent(args);
    }

    private void ShowCancellationNotification()
    {
        // Raise event for parent to handle cancellation notification
        var args = new ApplyCancelledEventArgs();
        RaiseEvent(args);
    }

    #region Routed Events

    /// <summary>
    /// Event raised when an undo toast should be shown.
    /// </summary>
    public static readonly RoutedEvent<UndoToastRequestedEventArgs> UndoToastRequestedEvent =
        RoutedEvent.Register<FileTreeProposalPanel, UndoToastRequestedEventArgs>(
            nameof(UndoToastRequested),
            RoutingStrategies.Bubble);

    public event EventHandler<UndoToastRequestedEventArgs> UndoToastRequested
    {
        add => AddHandler(UndoToastRequestedEvent, value);
        remove => RemoveHandler(UndoToastRequestedEvent, value);
    }

    /// <summary>
    /// Event raised when apply errors occur.
    /// </summary>
    public static readonly RoutedEvent<ApplyErrorEventArgs> ApplyErrorEvent =
        RoutedEvent.Register<FileTreeProposalPanel, ApplyErrorEventArgs>(
            nameof(ApplyError),
            RoutingStrategies.Bubble);

    public event EventHandler<ApplyErrorEventArgs> ApplyError
    {
        add => AddHandler(ApplyErrorEvent, value);
        remove => RemoveHandler(ApplyErrorEvent, value);
    }

    /// <summary>
    /// Event raised when apply is cancelled.
    /// </summary>
    public static readonly RoutedEvent<ApplyCancelledEventArgs> ApplyCancelledEvent =
        RoutedEvent.Register<FileTreeProposalPanel, ApplyCancelledEventArgs>(
            nameof(ApplyCancelledRouted),
            RoutingStrategies.Bubble);

    public event EventHandler<ApplyCancelledEventArgs> ApplyCancelledRouted
    {
        add => AddHandler(ApplyCancelledEvent, value);
        remove => RemoveHandler(ApplyCancelledEvent, value);
    }

    #endregion

    protected override void OnUnloaded(RoutedEventArgs e)
    {
        base.OnUnloaded(e);

        // Cleanup subscriptions
        if (_viewModel != null)
        {
            _viewModel.PreviewRequested -= OnPreviewRequested;
            _viewModel.ApplyCompleted -= OnApplyCompleted;
            _viewModel.ApplyCancelled -= OnApplyCancelled;
        }
    }
}

/// <summary>
/// Event args for undo toast request.
/// </summary>
public class UndoToastRequestedEventArgs : RoutedEventArgs
{
    public BatchApplyResult Result { get; }

    public UndoToastRequestedEventArgs(BatchApplyResult result)
        : base(FileTreeProposalPanel.UndoToastRequestedEvent)
    {
        Result = result;
    }
}

/// <summary>
/// Event args for apply errors.
/// </summary>
public class ApplyErrorEventArgs : RoutedEventArgs
{
    public BatchApplyResult Result { get; }

    public ApplyErrorEventArgs(BatchApplyResult result)
        : base(FileTreeProposalPanel.ApplyErrorEvent)
    {
        Result = result;
    }
}

/// <summary>
/// Event args for apply cancellation.
/// </summary>
public class ApplyCancelledEventArgs : RoutedEventArgs
{
    public ApplyCancelledEventArgs()
        : base(FileTreeProposalPanel.ApplyCancelledEvent)
    {
    }
}
```

### FileTreeItemControl.axaml

```xml
<!-- src/SeniorIntern.Desktop/Controls/FileTreeItemControl.axaml -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:converters="using:SeniorIntern.Desktop.Converters"
             mc:Ignorable="d"
             d:DesignWidth="400" d:DesignHeight="24"
             x:Class="SeniorIntern.Desktop.Controls.FileTreeItemControl"
             x:DataType="vm:FileTreeItemViewModel">

    <UserControl.Resources>
        <converters:IconNameConverter x:Key="IconNameConverter" />
        <converters:SelectionStateToCheckStateConverter x:Key="SelectionStateConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Item Container -->
        <Style Selector="Grid.tree-item">
            <Setter Property="MinHeight" Value="28" />
        </Style>
        <Style Selector="Grid.tree-item:pointerover">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}" />
        </Style>

        <!-- Checkbox for files -->
        <Style Selector="CheckBox.file-checkbox">
            <Setter Property="Margin" Value="0,0,4,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Tri-state checkbox for directories -->
        <Style Selector="CheckBox.directory-checkbox">
            <Setter Property="Margin" Value="0,0,4,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="IsThreeState" Value="True" />
        </Style>

        <!-- Icon -->
        <Style Selector="PathIcon.item-icon">
            <Setter Property="Width" Value="16" />
            <Setter Property="Height" Value="16" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- File name -->
        <Style Selector="TextBlock.item-name">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
        </Style>
        <Style Selector="TextBlock.item-name.has-error">
            <Setter Property="Foreground" Value="{DynamicResource ErrorForeground}" />
        </Style>
        <Style Selector="TextBlock.item-name.has-warning">
            <Setter Property="Foreground" Value="{DynamicResource WarningForeground}" />
        </Style>

        <!-- Status indicators -->
        <Style Selector="PathIcon.status-icon">
            <Setter Property="Width" Value="14" />
            <Setter Property="Height" Value="14" />
            <Setter Property="Margin" Value="4,0,0,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
    </UserControl.Styles>

    <Grid Classes="tree-item"
          ColumnDefinitions="Auto, Auto, *, Auto, Auto"
          ToolTip.Tip="{Binding Tooltip}">

        <!-- Column 0: Checkbox -->
        <Panel>
            <!-- File checkbox (two-state) -->
            <CheckBox Classes="file-checkbox"
                      IsChecked="{Binding IsSelected}"
                      IsVisible="{Binding IsFile}"
                      IsEnabled="{Binding IsEnabled}" />

            <!-- Directory checkbox (tri-state, optional) -->
            <CheckBox Classes="directory-checkbox"
                      IsChecked="{Binding SelectionState, Converter={StaticResource SelectionStateConverter}}"
                      IsVisible="{Binding IsDirectory}"
                      Command="{Binding $parent[TreeView].DataContext.ToggleItemSelectionCommand}"
                      CommandParameter="{Binding}" />
        </Panel>

        <!-- Column 1: Icon -->
        <PathIcon Grid.Column="1"
                  Classes="item-icon"
                  Data="{Binding Icon, Converter={StaticResource IconNameConverter}}"
                  Foreground="{Binding IsDirectory,
                      Converter={StaticResource BoolToBrushConverter},
                      ConverterParameter='FolderIconColor|FileIconColor'}" />

        <!-- Column 2: Name -->
        <TextBlock Grid.Column="2"
                   Classes="item-name"
                   Classes.has-error="{Binding HasError}"
                   Classes.has-warning="{Binding HasWarning}"
                   Text="{Binding Name}" />

        <!-- Column 3: Language Badge -->
        <Border Grid.Column="3"
                Classes="language-badge"
                IsVisible="{Binding Language, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                Margin="8,0,0,0">
            <TextBlock Text="{Binding Language}"
                       FontSize="10"
                       Foreground="{DynamicResource TextMuted}" />
        </Border>

        <!-- Column 4: Status Indicators -->
        <StackPanel Grid.Column="4"
                    Orientation="Horizontal"
                    Spacing="4"
                    Margin="8,0,0,0">

            <!-- New Badge (for create operations) -->
            <Border Classes="new-badge"
                    IsVisible="{Binding IsNewFile}">
                <TextBlock Text="new"
                           FontSize="10"
                           Foreground="{DynamicResource SuccessForeground}" />
            </Border>

            <!-- Exists Badge -->
            <Border Classes="exists-badge"
                    IsVisible="{Binding FileExists}">
                <TextBlock Text="exists"
                           FontSize="10"
                           Foreground="{DynamicResource WarningForeground}" />
            </Border>

            <!-- Operation Status Icon -->
            <PathIcon Classes="status-icon"
                      Data="{Binding StatusIcon, Converter={StaticResource IconNameConverter}}"
                      Foreground="{Binding OperationStatus, Converter={StaticResource StatusToColorConverter}}"
                      IsVisible="{Binding StatusIcon, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                      ToolTip.Tip="{Binding StatusText}" />

            <!-- Warning Icon -->
            <PathIcon Classes="status-icon"
                      Data="{StaticResource WarningIcon}"
                      Foreground="{DynamicResource WarningForeground}"
                      IsVisible="{Binding HasWarning}"
                      ToolTip.Tip="{Binding ValidationIssue.Message}" />

            <!-- Error Icon -->
            <PathIcon Classes="status-icon"
                      Data="{StaticResource ErrorIcon}"
                      Foreground="{DynamicResource ErrorForeground}"
                      IsVisible="{Binding HasError}"
                      ToolTip.Tip="{Binding ValidationIssue.Message}" />
        </StackPanel>
    </Grid>
</UserControl>
```

### FileTreeItemControl.axaml.cs

```csharp
// src/SeniorIntern.Desktop/Controls/FileTreeItemControl.axaml.cs
using Avalonia.Controls;
using Avalonia.Input;
using SeniorIntern.Desktop.ViewModels;

namespace SeniorIntern.Desktop.Controls;

/// <summary>
/// Code-behind for the FileTreeItemControl.
/// Handles double-click to preview and other interactions.
/// </summary>
public partial class FileTreeItemControl : UserControl
{
    public FileTreeItemControl()
    {
        InitializeComponent();

        // Handle double-click for preview
        DoubleTapped += OnDoubleTapped;
    }

    private void OnDoubleTapped(object? sender, TappedEventArgs e)
    {
        if (DataContext is not FileTreeItemViewModel item)
            return;

        if (item.IsFile && item.Operation != null)
        {
            // Request preview for this single file
            // This will be handled by the parent panel
            RaisePreviewFileRequest(item);
        }
        else if (item.IsDirectory)
        {
            // Toggle expansion
            item.IsExpanded = !item.IsExpanded;
        }
    }

    private void RaisePreviewFileRequest(FileTreeItemViewModel item)
    {
        // Find the parent FileTreeProposalPanel and trigger preview for this file
        var parent = this.FindAncestorOfType<FileTreeProposalPanel>();
        // The parent can handle single-file preview request
    }
}
```

### IconNameConverter

```csharp
// src/SeniorIntern.Desktop/Converters/IconNameConverter.cs
using System.Globalization;
using Avalonia;
using Avalonia.Data.Converters;
using Avalonia.Media;

namespace SeniorIntern.Desktop.Converters;

/// <summary>
/// Converts icon name strings to StreamGeometry resources for PathIcon.Data binding.
/// </summary>
public class IconNameConverter : IValueConverter
{
    /// <summary>
    /// Singleton instance for use in XAML.
    /// </summary>
    public static readonly IconNameConverter Instance = new();

    /// <summary>
    /// Converts an icon name to a StreamGeometry.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not string iconName || string.IsNullOrEmpty(iconName))
            return null;

        // Try to find the icon resource
        if (Application.Current?.TryFindResource(iconName, out var resource) == true)
        {
            return resource as StreamGeometry;
        }

        // Fall back to default file icon
        if (Application.Current?.TryFindResource("FileIcon", out var defaultIcon) == true)
        {
            return defaultIcon as StreamGeometry;
        }

        return null;
    }

    /// <summary>
    /// Not supported - this is a one-way converter.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("IconNameConverter is one-way only.");
    }
}
```

### BoolToStringConverter

```csharp
// src/SeniorIntern.Desktop/Converters/BoolToStringConverter.cs
using System.Globalization;
using Avalonia.Data.Converters;

namespace SeniorIntern.Desktop.Converters;

/// <summary>
/// Converts a boolean value to one of two strings based on the parameter.
/// Parameter format: "TrueValue|FalseValue"
/// </summary>
public class BoolToStringConverter : IValueConverter
{
    /// <summary>
    /// Singleton instance for use in XAML.
    /// </summary>
    public static readonly BoolToStringConverter Instance = new();

    /// <summary>
    /// Converts a bool to a string based on the parameter.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not bool boolValue)
            return null;

        if (parameter is not string paramString)
            return boolValue.ToString();

        var parts = paramString.Split('|');
        if (parts.Length != 2)
            return boolValue.ToString();

        return boolValue ? parts[0] : parts[1];
    }

    /// <summary>
    /// Not supported - this is a one-way converter.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("BoolToStringConverter is one-way only.");
    }
}
```

### SelectionStateToCheckStateConverter

```csharp
// src/SeniorIntern.Desktop/Converters/SelectionStateToCheckStateConverter.cs
using System.Globalization;
using Avalonia.Data.Converters;
using SeniorIntern.Desktop.ViewModels;

namespace SeniorIntern.Desktop.Converters;

/// <summary>
/// Converts SelectionState enum to nullable bool for tri-state checkbox binding.
/// None -> false, Some -> null (indeterminate), All -> true
/// </summary>
public class SelectionStateToCheckStateConverter : IValueConverter
{
    /// <summary>
    /// Singleton instance for use in XAML.
    /// </summary>
    public static readonly SelectionStateToCheckStateConverter Instance = new();

    /// <summary>
    /// Converts SelectionState to nullable bool.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not SelectionState state)
            return false;

        return state switch
        {
            SelectionState.None => false,
            SelectionState.Some => null, // Indeterminate
            SelectionState.All => true,
            _ => false
        };
    }

    /// <summary>
    /// Converts nullable bool back to SelectionState.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value switch
        {
            true => SelectionState.All,
            false => SelectionState.None,
            null => SelectionState.Some,
            _ => SelectionState.None
        };
    }
}
```

### ValidationSeverityToBrushConverter

```csharp
// src/SeniorIntern.Desktop/Converters/ValidationSeverityToBrushConverter.cs
using System.Globalization;
using Avalonia;
using Avalonia.Data.Converters;
using Avalonia.Media;
using SeniorIntern.Core.Models;

namespace SeniorIntern.Desktop.Converters;

/// <summary>
/// Converts ValidationSeverity to an appropriate color brush.
/// </summary>
public class ValidationSeverityToBrushConverter : IValueConverter
{
    /// <summary>
    /// Singleton instance for use in XAML.
    /// </summary>
    public static readonly ValidationSeverityToBrushConverter Instance = new();

    /// <summary>
    /// Converts ValidationSeverity to a brush.
    /// </summary>
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not ValidationSeverity severity)
            return null;

        var resourceKey = severity switch
        {
            ValidationSeverity.Error => "ErrorForeground",
            ValidationSeverity.Warning => "WarningForeground",
            ValidationSeverity.Info => "TextMuted",
            _ => "TextPrimary"
        };

        if (Application.Current?.TryFindResource(resourceKey, out var resource) == true)
        {
            return resource as IBrush;
        }

        return null;
    }

    /// <summary>
    /// Not supported - this is a one-way converter.
    /// </summary>
    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("ValidationSeverityToBrushConverter is one-way only.");
    }
}
```

### ProposalPanelStyles.axaml

```xml
<!-- src/SeniorIntern.Desktop/Themes/ProposalPanelStyles.axaml -->
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- Additional Colors for Proposal Panel -->
    <SolidColorBrush x:Key="WarningBackground" Color="#5A4B1D" />
    <SolidColorBrush x:Key="WarningForeground" Color="#F5C842" />
    <SolidColorBrush x:Key="SurfaceBackground" Color="#252526" />
    <SolidColorBrush x:Key="FolderIconColor" Color="#DCAA5D" />
    <SolidColorBrush x:Key="FileIconColor" Color="#CCCCCC" />

    <!-- Diff Colors -->
    <SolidColorBrush x:Key="DiffAddedForeground" Color="#89D185" />
    <SolidColorBrush x:Key="DiffModifiedForeground" Color="#6CB6FF" />
    <SolidColorBrush x:Key="DiffRemovedForeground" Color="#F48771" />

    <!-- Icon Definitions -->
    <StreamGeometry x:Key="FolderPlusIcon">M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm0 12H4V6h5.17l2 2H20v10zm-8-4h2v2h2v-2h2v-2h-2v-2h-2v2h-2v2z</StreamGeometry>
    <StreamGeometry x:Key="FolderIcon">M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z</StreamGeometry>
    <StreamGeometry x:Key="FolderOpenIcon">M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z</StreamGeometry>
    <StreamGeometry x:Key="FileIcon">M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z</StreamGeometry>
    <StreamGeometry x:Key="ErrorIcon">M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z</StreamGeometry>
    <StreamGeometry x:Key="WarningIcon">M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z</StreamGeometry>
    <StreamGeometry x:Key="CheckIcon">M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z</StreamGeometry>
    <StreamGeometry x:Key="SpinnerIcon">M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z</StreamGeometry>
    <StreamGeometry x:Key="ExpandAllIcon">M12 5.83L15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9 12 5.83zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15 12 18.17z</StreamGeometry>
    <StreamGeometry x:Key="CollapseAllIcon">M7.41 18.59L8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z</StreamGeometry>
    <StreamGeometry x:Key="SkipIcon">M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z</StreamGeometry>

    <!-- File Type Icons -->
    <StreamGeometry x:Key="CSharpIcon">M11.5 15.97l.41 2.44c-.26.14-.68.27-1.24.39-.57.13-1.24.2-2.01.2-2.21-.04-3.87-.7-4.98-1.96C2.56 15.77 2 14.16 2 12.21c.05-2.31.72-4.08 2-5.32C5.32 5.64 6.96 5 8.94 5c.75 0 1.4.07 1.94.19s.94.25 1.2.4l-.58 2.49-1.06-.34c-.4-.1-.86-.15-1.39-.15-1.16-.01-2.12.36-2.87 1.1-.76.73-1.15 1.85-1.18 3.34 0 1.36.37 2.42 1.08 3.2.71.77 1.71 1.17 2.99 1.18l1.33-.12c.43-.08.79-.19 1.1-.32zm6.5-7.47h2v2h-2v2h-2v-2h-2v-2h2v-2h2v2z</StreamGeometry>
    <StreamGeometry x:Key="TypeScriptIcon">M3 3h18v18H3V3zm10.71 14.86c.5.98 1.51 1.73 3.09 1.73 1.6 0 2.8-.83 2.8-2.36 0-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02 0-.41.31-.73.81-.73.48 0 .8.21 1.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51 0-2.48.96-2.48 2.23 0 1.38.81 2.03 2.03 2.55l.42.18c.78.34 1.24.55 1.24 1.13 0 .48-.45.83-1.15.83-.83 0-1.31-.43-1.67-1.03l-1.38.8zM14 11h-2v7h-2v-7H8v-1.5h6V11z</StreamGeometry>
    <StreamGeometry x:Key="JavaScriptIcon">M3 3h18v18H3V3zm4.73 15.04c.4.85 1.19 1.55 2.54 1.55 1.5 0 2.53-.8 2.53-2.55v-5.78h-1.7V17c0 .86-.35 1.08-.9 1.08-.58 0-.82-.4-1.09-.87l-1.38.83zm5.98-.18c.5.98 1.51 1.73 3.09 1.73 1.6 0 2.8-.83 2.8-2.36 0-1.41-.81-2.04-2.25-2.66l-.42-.18c-.73-.31-1.04-.52-1.04-1.02 0-.41.31-.73.81-.73.48 0 .8.21 1.09.73l1.31-.87c-.55-.96-1.33-1.33-2.4-1.33-1.51 0-2.48.96-2.48 2.23 0 1.38.81 2.03 2.03 2.55l.42.18c.78.34 1.24.55 1.24 1.13 0 .48-.45.83-1.15.83-.83 0-1.31-.43-1.67-1.03l-1.38.8z</StreamGeometry>
    <StreamGeometry x:Key="PythonIcon">M12 2c-1.67 0-3 .67-4 2v2H6c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h2v2c1 1.33 2.33 2 4 2s3-.67 4-2v-2h2c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-2V4c-1-1.33-2.33-2-4-2zm-1 3a1 1 0 110 2 1 1 0 010-2zm2 12a1 1 0 110 2 1 1 0 010-2z</StreamGeometry>
    <StreamGeometry x:Key="JsonIcon">M5 3h2v2H5v5a2 2 0 01-2 2 2 2 0 012 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 00-2-2H0v-2h1a2 2 0 002-2V5a2 2 0 012-2m14 0a2 2 0 012 2v4a2 2 0 002 2h1v2h-1a2 2 0 00-2 2v4a2 2 0 01-2 2h-2v-2h2v-5a2 2 0 012-2 2 2 0 01-2-2V5h-2V3h2m-7 12a1 1 0 011 1 1 1 0 01-1 1 1 1 0 01-1-1 1 1 0 011-1m-4 0a1 1 0 011 1 1 1 0 01-1 1 1 1 0 01-1-1 1 1 0 011-1m8 0a1 1 0 011 1 1 1 0 01-1 1 1 1 0 01-1-1 1 1 0 011-1z</StreamGeometry>
    <StreamGeometry x:Key="MarkdownIcon">M20.56 18H3.44C2.65 18 2 17.37 2 16.59V7.41C2 6.63 2.65 6 3.44 6h17.12c.79 0 1.44.63 1.44 1.41v9.18c0 .78-.65 1.41-1.44 1.41M6.81 15.19v-3.66l1.92 2.35 1.92-2.35v3.66h1.93V8.81h-1.93l-1.92 2.35-1.92-2.35H4.89v6.38h1.92M19.69 12h-1.92V8.81h-1.92V12h-1.93l2.89 3.28L19.69 12z</StreamGeometry>
    <StreamGeometry x:Key="XmlIcon">M12.89 3l1.96.4L11.11 21l-1.96-.4L12.89 3m6.7 9L16 8.41V5.58L22.42 12 16 18.41v-2.83L19.59 12M7.41 12L4 15.59v2.83L-2.42 12 4 5.58v2.83L7.41 12z</StreamGeometry>
    <StreamGeometry x:Key="HtmlIcon">M12 17.56l4.07-1.13.55-6.1H9.38L9.2 8.3h7.6l.2-1.99H7l.56 6.01h6.89l-.23 2.58-2.22.6-2.22-.6-.14-1.66H7.65l.28 3.11L12 17.56M4.07 3h15.86L18.5 19.2 12 21l-6.5-1.8L4.07 3z</StreamGeometry>
    <StreamGeometry x:Key="CssIcon">M5 3l-.65 3.34h13.59L17.5 8.5H3.92l-.66 3.33h13.59l-.76 3.81-5.48 1.81-4.75-1.81.33-1.64H2.85l-.79 4 7.85 3 9.05-3 1.2-6.03.24-1.21L21.94 3H5z</StreamGeometry>
    <StreamGeometry x:Key="YamlIcon">M4 3h16c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2m4.5 5L7 9.5V14H5V9.5L3.5 8h2l1 1.5 1-1.5h2M11 8v6h2v-4h1v4h2V8h-5m7 0v6h3v-1.5h-1.5v-1h1.5V10h-1.5V9.5H21V8h-3z</StreamGeometry>
    <StreamGeometry x:Key="GitIcon">M21.62 11.11l-8.73-8.73c-.51-.51-1.33-.51-1.84 0l-1.81 1.81 2.3 2.3a1.49 1.49 0 011.89 1.89l2.21 2.21a1.5 1.5 0 11-.89.89l-2.07-2.07v5.46a1.5 1.5 0 11-1.24-.01V9.1a1.5 1.5 0 01-.81-1.97l-2.27-2.27-5.97 5.97c-.51.51-.51 1.33 0 1.84l8.73 8.73c.51.51 1.33.51 1.84 0l8.66-8.66c.51-.51.51-1.33 0-1.84z</StreamGeometry>
    <StreamGeometry x:Key="DockerIcon">M21 10.5c-.4-.4-1.3-.6-2.1-.5-.1-.8-.5-1.5-1-2.1l-.4-.4-.4.3c-.5.4-.8 1-.9 1.6-.1.4 0 .9.2 1.3-1.1.7-2.9.5-3.4.5h-13c-.3 1 .1 3.3 1.2 5.1 1.3 2 3.3 3 5.9 3 5.3 0 9.2-2.4 11-6.8 1.1 0 2.3-.1 3.1-1.1.2-.3.3-.7.3-1H21l.1-.9zm-15.5.3h-2v2h2v-2zm3 0h-2v2h2v-2zm3 0h-2v2h2v-2zm3 0h-2v2h2v-2zm-6-2.5h-2v2h2v-2zm3 0h-2v2h2v-2zm3 0h-2v2h2v-2zm0-2.5h-2v2h2v-2z</StreamGeometry>

    <!-- Tree Item Animation -->
    <Animation x:Key="ExpandAnimation"
               Duration="0:0:0.2"
               FillMode="Forward">
        <KeyFrame Cue="0%">
            <Setter Property="Opacity" Value="0" />
            <Setter Property="TranslateTransform.Y" Value="-10" />
        </KeyFrame>
        <KeyFrame Cue="100%">
            <Setter Property="Opacity" Value="1" />
            <Setter Property="TranslateTransform.Y" Value="0" />
        </KeyFrame>
    </Animation>

    <!-- Progress Animation -->
    <Animation x:Key="ProgressFadeIn"
               Duration="0:0:0.3">
        <KeyFrame Cue="0%">
            <Setter Property="Opacity" Value="0" />
        </KeyFrame>
        <KeyFrame Cue="100%">
            <Setter Property="Opacity" Value="1" />
        </KeyFrame>
    </Animation>

</ResourceDictionary>
```

---

## Files to Create

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/Controls/FileTreeProposalPanel.axaml` | Main proposal panel UI markup |
| `src/SeniorIntern.Desktop/Controls/FileTreeProposalPanel.axaml.cs` | Panel code-behind |
| `src/SeniorIntern.Desktop/Controls/FileTreeItemControl.axaml` | Individual tree item template |
| `src/SeniorIntern.Desktop/Controls/FileTreeItemControl.axaml.cs` | Tree item code-behind |
| `src/SeniorIntern.Desktop/Converters/IconNameConverter.cs` | Icon name to geometry converter |
| `src/SeniorIntern.Desktop/Converters/BoolToStringConverter.cs` | Bool to string converter |
| `src/SeniorIntern.Desktop/Converters/SelectionStateToCheckStateConverter.cs` | Selection state converter |
| `src/SeniorIntern.Desktop/Converters/ValidationSeverityToBrushConverter.cs` | Severity to brush converter |
| `src/SeniorIntern.Desktop/Themes/ProposalPanelStyles.axaml` | Panel-specific styles |

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/App.axaml` | Register converters and include ProposalPanelStyles.axaml |
| `src/SeniorIntern.Desktop/Themes/Dark.axaml` | Add missing color resources |
| `src/SeniorIntern.Desktop/Views/ChatView.axaml` | Integrate FileTreeProposalPanel display |
| `src/SeniorIntern.Desktop/Views/ChatMessageControl.axaml` | Support proposal message type |

---

## Testing Strategy

### Manual UI Testing Checklist

```markdown
## FileTreeProposalPanel Testing

### Display Tests
- [ ] Panel displays with correct header (icon, title, stats)
- [ ] Description shows when provided, hidden when empty
- [ ] File/folder counts accurate
- [ ] Panel has accent border styling

### Tree View Tests
- [ ] Tree displays hierarchical structure correctly
- [ ] Directories show folder icons (open/closed based on expansion)
- [ ] Files show appropriate file type icons
- [ ] Expand/collapse works via click on arrow
- [ ] Expand/collapse works via double-click on directory
- [ ] All nodes expanded by default

### Selection Tests
- [ ] File checkboxes toggle selection
- [ ] Select All selects all files
- [ ] Deselect All deselects all files
- [ ] Selection count updates in real-time
- [ ] Ctrl+A keyboard shortcut works
- [ ] Ctrl+D keyboard shortcut works
- [ ] Space bar toggles selection on focused item

### Validation Display Tests
- [ ] Error banner shows when HasErrors
- [ ] Warning banner shows when HasWarnings (no errors)
- [ ] Selection controls hidden when HasErrors
- [ ] Error icon shows on items with errors
- [ ] Warning icon shows on items with warnings
- [ ] Tooltip shows validation message on hover
- [ ] "exists" badge shows for existing files

### Apply Operation Tests
- [ ] Apply button disabled when no files selected
- [ ] Apply button disabled when HasErrors
- [ ] Progress bar appears during apply
- [ ] Current file text updates during apply
- [ ] Cancel button appears during apply
- [ ] Esc key cancels operation
- [ ] Apply button shows spinner during operation
- [ ] Button text changes to "Creating..."

### Preview Tests
- [ ] Preview button opens BatchPreviewDialog
- [ ] Ctrl+P keyboard shortcut works
- [ ] Preview shows correct diff for each file

### Options Tests
- [ ] Backup checkbox toggles CreateBackups
- [ ] Checkbox disabled during apply

### Accessibility Tests
- [ ] All interactive elements focusable via Tab
- [ ] Arrow keys navigate tree
- [ ] Screen reader announces tree structure
- [ ] Tooltips accessible
- [ ] Color not sole indicator (icons + badges)

### Theme Tests
- [ ] Correct colors in dark theme
- [ ] Icons visible against background
- [ ] Badges readable
- [ ] Progress bar visible
```

### Unit Tests

```csharp
// tests/SeniorIntern.Desktop.Tests/Controls/FileTreeProposalPanelTests.cs
using Avalonia.Controls;
using Avalonia.Headless.XUnit;
using Avalonia.Input;
using Xunit;
using SeniorIntern.Desktop.Controls;
using SeniorIntern.Desktop.ViewModels;

namespace SeniorIntern.Desktop.Tests.Controls;

public class FileTreeProposalPanelTests
{
    [AvaloniaFact]
    public void Panel_SetsDataContext_BindsToViewModel()
    {
        var viewModel = CreateTestViewModel();
        var panel = new FileTreeProposalPanel
        {
            DataContext = viewModel
        };

        // TreeView should be bound to TreeItems
        var treeView = panel.FindControl<TreeView>("FileTree");
        Assert.NotNull(treeView);
        Assert.Equal(viewModel.TreeItems, treeView.ItemsSource);
    }

    [AvaloniaFact]
    public void Panel_SelectAllShortcut_ExecutesCommand()
    {
        var viewModel = CreateTestViewModel();
        var panel = new FileTreeProposalPanel
        {
            DataContext = viewModel
        };

        // Simulate Ctrl+A
        var args = new KeyEventArgs
        {
            Key = Key.A,
            KeyModifiers = KeyModifiers.Control
        };

        panel.RaiseEvent(args);

        Assert.True(viewModel.SelectAllCommand.CanExecute(null));
    }

    [AvaloniaFact]
    public void Panel_ErrorBanner_VisibleWhenHasErrors()
    {
        var viewModel = CreateTestViewModel();
        viewModel.HasErrors = true;

        var panel = new FileTreeProposalPanel
        {
            DataContext = viewModel
        };

        var errorBanner = panel.FindControl<Border>("ErrorBanner");
        Assert.NotNull(errorBanner);
        Assert.True(errorBanner.IsVisible);
    }

    [AvaloniaFact]
    public void Panel_ApplyButton_DisabledWhenNoSelection()
    {
        var viewModel = CreateTestViewModel();
        viewModel.HasSelectedFiles = false;

        var panel = new FileTreeProposalPanel
        {
            DataContext = viewModel
        };

        var applyButton = panel.FindControl<Button>("ApplyButton");
        Assert.NotNull(applyButton);
        Assert.False(applyButton.IsEnabled);
    }

    private FileTreeProposalViewModel CreateTestViewModel()
    {
        // Create mock dependencies and return test ViewModel
        // Implementation details...
        return null!; // Placeholder
    }
}
```

### Converter Tests

```csharp
// tests/SeniorIntern.Desktop.Tests/Converters/IconNameConverterTests.cs
using System.Globalization;
using Xunit;
using SeniorIntern.Desktop.Converters;

namespace SeniorIntern.Desktop.Tests.Converters;

public class IconNameConverterTests
{
    private readonly IconNameConverter _converter = new();

    [Fact]
    public void Convert_NullValue_ReturnsNull()
    {
        var result = _converter.Convert(null, typeof(object), null, CultureInfo.InvariantCulture);
        Assert.Null(result);
    }

    [Fact]
    public void Convert_EmptyString_ReturnsNull()
    {
        var result = _converter.Convert("", typeof(object), null, CultureInfo.InvariantCulture);
        Assert.Null(result);
    }

    [Fact]
    public void ConvertBack_ThrowsNotSupportedException()
    {
        Assert.Throws<NotSupportedException>(() =>
            _converter.ConvertBack(null, typeof(string), null, CultureInfo.InvariantCulture));
    }
}

// tests/SeniorIntern.Desktop.Tests/Converters/BoolToStringConverterTests.cs
public class BoolToStringConverterTests
{
    private readonly BoolToStringConverter _converter = new();

    [Theory]
    [InlineData(true, "Yes|No", "Yes")]
    [InlineData(false, "Yes|No", "No")]
    [InlineData(true, "Creating...|Create Files", "Creating...")]
    [InlineData(false, "Creating...|Create Files", "Create Files")]
    public void Convert_ReturnsCorrectString(bool input, string parameter, string expected)
    {
        var result = _converter.Convert(input, typeof(string), parameter, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }

    [Fact]
    public void Convert_InvalidParameter_ReturnsBoolString()
    {
        var result = _converter.Convert(true, typeof(string), "invalid", CultureInfo.InvariantCulture);
        Assert.Equal("True", result);
    }
}

// tests/SeniorIntern.Desktop.Tests/Converters/SelectionStateToCheckStateConverterTests.cs
public class SelectionStateToCheckStateConverterTests
{
    private readonly SelectionStateToCheckStateConverter _converter = new();

    [Theory]
    [InlineData(SelectionState.None, false)]
    [InlineData(SelectionState.All, true)]
    public void Convert_ReturnsCorrectBool(SelectionState state, bool? expected)
    {
        var result = _converter.Convert(state, typeof(bool?), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }

    [Fact]
    public void Convert_Some_ReturnsNull()
    {
        var result = _converter.Convert(SelectionState.Some, typeof(bool?), null, CultureInfo.InvariantCulture);
        Assert.Null(result);
    }

    [Theory]
    [InlineData(true, SelectionState.All)]
    [InlineData(false, SelectionState.None)]
    [InlineData(null, SelectionState.Some)]
    public void ConvertBack_ReturnsCorrectState(bool? input, SelectionState expected)
    {
        var result = _converter.ConvertBack(input, typeof(SelectionState), null, CultureInfo.InvariantCulture);
        Assert.Equal(expected, result);
    }
}
```

---

## Acceptance Criteria

### FileTreeProposalPanel

- [ ] Panel displays with proper styling (border, padding, corner radius)
- [ ] Header shows icon, title, description, and stats
- [ ] Description wraps and truncates properly
- [ ] File/folder counts display correctly
- [ ] Error banner visible when HasErrors is true
- [ ] Warning banner visible when HasWarnings is true (no errors)
- [ ] Selection controls visible when no errors
- [ ] Select All/Deselect All buttons work
- [ ] Expand All/Collapse All buttons work
- [ ] Selection summary text updates dynamically
- [ ] Keyboard shortcuts work (Ctrl+A, Ctrl+D, Ctrl+P, Ctrl+Enter, Esc)
- [ ] TreeView displays hierarchical structure
- [ ] TreeView scrolls when content exceeds MaxHeight
- [ ] Backup checkbox toggles CreateBackups
- [ ] Progress bar visible during apply
- [ ] Current file text shows during apply
- [ ] Cancel button visible during apply
- [ ] Apply button shows spinner and "Creating..." text during apply
- [ ] Preview button triggers BatchPreviewDialog
- [ ] UndoToastRequested event raised on success
- [ ] ApplyError event raised on failure

### FileTreeItemControl

- [ ] File items show checkbox, icon, name, language badge
- [ ] Directory items show expand toggle, icon, name
- [ ] Tri-state checkbox for directories reflects child selection
- [ ] Language badge visible for files with language set
- [ ] "exists" badge visible when FileExists is true
- [ ] "new" badge visible for Create operations
- [ ] Warning icon visible for items with warnings
- [ ] Error icon visible for items with errors
- [ ] Tooltip shows path and validation messages
- [ ] Double-click on file triggers preview
- [ ] Double-click on directory toggles expansion

### Value Converters

- [ ] IconNameConverter converts icon names to StreamGeometry
- [ ] IconNameConverter returns null for invalid names
- [ ] BoolToStringConverter correctly parses parameter format
- [ ] BoolToStringConverter returns correct string for true/false
- [ ] SelectionStateToCheckStateConverter maps states correctly
- [ ] SelectionStateToCheckStateConverter round-trips correctly
- [ ] ValidationSeverityToBrushConverter returns correct colors

### Styles and Resources

- [ ] ProposalPanelStyles.axaml loaded in App.axaml
- [ ] All icon geometries defined and accessible
- [ ] Color resources defined for warning, error, success states
- [ ] Badge styles applied correctly
- [ ] Button styles match application theme
- [ ] Animations smooth and performant

---

## Design Decisions

### Decision 1: Routed Events for Parent Communication

**Context:** The panel needs to communicate with parent views (undo toast, error notification).

**Options:**
1. Direct parent reference
2. Event aggregator/messenger
3. Routed events

**Decision:** Option 3 - Routed events

**Rationale:**
- Native Avalonia pattern for control-to-parent communication
- Bubbling allows flexible parent handling
- Type-safe event args
- No dependency injection required for UI events

### Decision 2: Separate FileTreeItemControl

**Context:** Tree item template could be inline DataTemplate or separate UserControl.

**Options:**
1. Inline TreeDataTemplate
2. Separate UserControl

**Decision:** Option 2 - Separate UserControl

**Rationale:**
- Complex item layout benefits from code-behind
- Easier to test independently
- Reusable in other contexts
- Better separation of concerns

### Decision 3: Static Converter Instances

**Context:** Converters can be instantiated per-use or shared as singletons.

**Options:**
1. New instance per XAML usage
2. Static singleton instances
3. DI-injected converters

**Decision:** Option 2 - Static singleton instances

**Rationale:**
- Converters are stateless
- Reduces memory allocation
- Standard Avalonia pattern
- Simple to use in XAML

### Decision 4: Icon Resources as StreamGeometry

**Context:** Icons can be embedded images, SVG, or path geometry.

**Options:**
1. PNG/SVG image resources
2. Icon fonts
3. StreamGeometry path data

**Decision:** Option 3 - StreamGeometry path data

**Rationale:**
- Vector-based, scales perfectly
- Can be colored dynamically
- Small file size
- Works well with PathIcon control
- No external font dependencies

---

## Accessibility Considerations

### Keyboard Navigation

| Key | Action |
|-----|--------|
| Tab | Move focus between controls |
| Shift+Tab | Move focus backwards |
| Arrow Up/Down | Navigate tree items |
| Arrow Left | Collapse directory / Move to parent |
| Arrow Right | Expand directory / Move to first child |
| Space | Toggle selection on focused item |
| Enter | Activate focused button |
| Ctrl+A | Select all files |
| Ctrl+D | Deselect all files |
| Ctrl+P | Open preview dialog |
| Ctrl+Enter | Apply changes |
| Escape | Cancel operation |

### Screen Reader Announcements

- Panel announces role as "group" with label "Multi-File Proposal"
- Tree announces as "tree" with item count
- Tree items announce name, type (file/folder), and selection state
- Expand/collapse state announced for directories
- Validation issues announced with severity
- Progress updates announced periodically
- Button states announced (enabled/disabled)

### Visual Accessibility

- Minimum contrast ratio 4.5:1 for text
- Icons accompany color-coded states
- Focus indicators visible on all interactive elements
- Tooltips provide additional context
- Animation respects reduced-motion preference

---

## Performance Considerations

### Virtualization

- TreeView uses virtualization for large trees
- Only visible items rendered
- Recycling enabled for smooth scrolling

### Binding Optimization

- OneWay bindings where possible
- Compiled bindings for performance
- PropertyChanged only fires on actual changes

### Resource Loading

- Icons loaded once as static resources
- Styles compiled at build time
- Converters are singletons

### Animation

- CSS-based animations where possible
- Hardware-accelerated transforms
- Animations disabled for prefers-reduced-motion

---

## Future Enhancements

### Potential Improvements

1. **Search/Filter** - Add text box to filter tree by file name
2. **Context Menu** - Right-click menu for exclude, preview, properties
3. **Drag and Drop** - Reorder files or move between directories
4. **Inline Editing** - Rename files directly in tree
5. **Compact Mode** - Smaller layout for constrained spaces
6. **Keyboard-only Selection** - Full multi-select via keyboard
7. **Progress Per-File** - Individual progress indicators on items
8. **Conflict Resolution** - Interactive merge for existing files
9. **Template Customization** - User-defined tree item templates
10. **Export Selection** - Save selected files list to clipboard

---

## Dependencies

### Internal Dependencies

| Component | Version | Purpose |
|-----------|---------|---------|
| v0.4.4d Tree ViewModels | v0.4.4 | FileTreeProposalViewModel, FileTreeItemViewModel |
| v0.4.4a Core Models | v0.4.4 | BatchApplyResult, ValidationIssue |
| Existing Theme System | Current | Dark.axaml color resources |

### External Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| Avalonia | 11.x | UI framework |
| Avalonia.Controls.TreeView | 11.x | TreeView control |
| CommunityToolkit.Mvvm | 8.x | ViewModel binding support |

---

## Glossary

| Term | Definition |
|------|------------|
| Proposal Panel | The UI component displaying a multi-file creation proposal |
| Tree Item | A node in the file tree (file or directory) |
| Tri-state Checkbox | Checkbox with three states: unchecked, checked, indeterminate |
| Routed Event | Avalonia event that bubbles up the visual tree |
| StreamGeometry | Avalonia path data for vector graphics |
| Value Converter | Class that transforms values between ViewModel and View |
| Badge | Small label overlay indicating status or type |
