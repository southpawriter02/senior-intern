# Design Specification: AIntern v0.6.5a "Agent Activity Models"

## Overview

**Version**: v0.6.5a
**Parent**: v0.6.5 Agent Loop & Polish
**Focus**: Models for tracking and displaying agent activity during multi-step execution

### Purpose

Define models for tracking and displaying agent activity that:
1. Represent individual activity items during agent execution
2. Categorize activities by type (thinking, tool, approval, etc.)
3. Track comprehensive execution statistics
4. Support chat display of tool results
5. Provide computed properties for UI binding

### Dependencies

**From v0.6.1 (Tool Framework)**:
- `RiskLevel` enum

**From v0.6.4 (Safety & Approval)**:
- Permission source concepts

**From v0.6.2 (Semantic Kernel Integration)**:
- Agent state machine concepts

---

## Architecture

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                    v0.6.5a Agent Activity Models Architecture                 │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Model Relationships:                                                        │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                     AgentExecutionSummary                                │ │
│  │  (One per execution session)                                            │ │
│  │  ├── SessionId, ConversationId                                          │ │
│  │  ├── StartTime, EndTime, Duration                                       │ │
│  │  ├── IterationCount, TotalTokensUsed                                    │ │
│  │  ├── ToolCallsExecuted/Succeeded/Failed                                 │ │
│  │  ├── ToolCallsApproved/Denied/AutoApproved                              │ │
│  │  ├── EndReason (ExecutionEndReason)                                     │ │
│  │  └── ErrorMessage (if failed)                                           │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│                                    │ 1:N                                     │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                      AgentActivityItem                                   │ │
│  │  (Individual activity during execution)                                 │ │
│  │  ├── Id, Timestamp                                                       │ │
│  │  ├── Type (ActivityType)                                                 │ │
│  │  ├── Message, Details                                                    │ │
│  │  ├── ToolId (optional)                                                   │ │
│  │  ├── Duration (optional)                                                 │ │
│  │  ├── Success (optional)                                                  │ │
│  │  └── Icon (computed from Type)                                           │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│                                    │ 1:1 (for Tool type)                     │
│                                    ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                       ToolResultDisplay                                  │ │
│  │  (Display model for tool results in chat)                               │ │
│  │  ├── ToolName, ExecutionId                                               │ │
│  │  ├── Success, Summary, FullContent                                       │ │
│  │  ├── Duration, RiskLevel                                                 │ │
│  │  ├── ApprovalMethod                                                      │ │
│  │  └── IsExpandable (computed)                                             │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Enums:                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  ActivityType               │  ExecutionEndReason    │  ApprovalMethod  │ │
│  │  ├── Thinking              │  ├── InProgress       │  ├── AutoApproved │ │
│  │  ├── Tool                  │  ├── Completed        │  ├── UserApproved │ │
│  │  ├── Approval              │  ├── UserCancelled    │  ├── Session...   │ │
│  │  ├── Success               │  ├── MaxIterations... │  └── Permanently..│ │
│  │  ├── Error                 │  ├── Error            │                    │ │
│  │  ├── Warning               │  ├── ToolDenied       │                    │ │
│  │  ├── Info                  │  ├── RateLimited      │                    │ │
│  │  └── Cancelled             │  └── Timeout          │                    │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Activity Type Icons

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        Activity Type Icon Mapping                             │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ActivityType     │  Icon Resource  │  Color     │  Description              │
│  ─────────────────┼─────────────────┼────────────┼─────────────────────────  │
│  Thinking         │  ThinkingIcon   │  Blue      │  Agent generating response│
│  Tool             │  ToolIcon       │  Purple    │  Tool being executed      │
│  Approval         │  ApprovalIcon   │  Amber     │  Waiting for user         │
│  Success          │  SuccessIcon    │  Green     │  Activity completed OK    │
│  Error            │  ErrorIcon      │  Red       │  Activity failed          │
│  Warning          │  WarningIcon    │  Amber     │  Non-critical issue       │
│  Info             │  InfoIcon       │  Gray      │  Informational message    │
│  Cancelled        │  CancelledIcon  │  Gray      │  Activity cancelled       │
│                                                                              │
│  Icon Shapes:                                                                │
│  ├── Thinking  → Brain/Sparkle                                              │
│  ├── Tool      → Wrench/Gear                                                │
│  ├── Approval  → Question mark                                              │
│  ├── Success   → Checkmark                                                  │
│  ├── Error     → X/Exclamation                                              │
│  ├── Warning   → Triangle with !                                            │
│  ├── Info      → i circle                                                   │
│  └── Cancelled → Slash circle                                               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Execution Statistics Flow

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                    Execution Statistics Tracking                              │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Agent Loop Iteration:                                                       │
│                                                                              │
│  Start Execution                                                             │
│       │                                                                      │
│       ├──→ summary.IterationCount++                                         │
│       │                                                                      │
│       ▼                                                                      │
│  ┌─────────────────┐                                                        │
│  │ LLM Thinking    │──→ Add Activity(Thinking)                              │
│  └────────┬────────┘                                                        │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────┐                                                        │
│  │ Tool Call?      │──No──→ End Iteration                                   │
│  └────────┬────────┘                                                        │
│           │Yes                                                               │
│           ▼                                                                  │
│  ┌─────────────────┐                                                        │
│  │ Permission      │──→ Add Activity(Approval) if needed                    │
│  │ Check           │                                                        │
│  └────────┬────────┘                                                        │
│           │                                                                  │
│   ┌───────┼───────┬───────────┐                                             │
│   ▼       ▼       ▼           ▼                                             │
│ Auto   User    User       Blocked                                           │
│ Approved Approved Denied                                                     │
│   │       │       │           │                                             │
│   │       │       ▼           ▼                                             │
│   │       │   summary.       End                                            │
│   │       │   ToolCalls      (ToolDenied)                                   │
│   │       │   Denied++                                                       │
│   │       │                                                                  │
│   │       ├──→ summary.ToolCallsApproved++                                  │
│   │       │                                                                  │
│   ├───────┴──→ summary.ToolCallsAutoApproved++                              │
│   │                                                                          │
│   ▼                                                                          │
│  ┌─────────────────┐                                                        │
│  │ Tool Execution  │──→ Add Activity(Tool)                                  │
│  └────────┬────────┘    summary.ToolCallsExecuted++                         │
│           │                                                                  │
│   ┌───────┴───────┐                                                         │
│   ▼               ▼                                                         │
│ Success        Failure                                                       │
│   │               │                                                         │
│   ▼               ▼                                                         │
│ summary.       summary.                                                      │
│ ToolCalls      ToolCalls                                                     │
│ Succeeded++    Failed++                                                      │
│   │               │                                                         │
│   └───────┬───────┘                                                         │
│           │                                                                  │
│           ▼                                                                  │
│  Continue Loop or End                                                        │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## File Specifications

### 1. ActivityType.cs

**Location**: `src/SeniorIntern.Core/Models/ActivityType.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Types of agent activities that can occur during execution.
/// </summary>
public enum ActivityType
{
    /// <summary>
    /// Agent is thinking/generating a response from the LLM.
    /// </summary>
    /// <remarks>
    /// This activity starts when the LLM begins generating and ends when streaming completes.
    /// </remarks>
    Thinking,

    /// <summary>
    /// Tool is being executed.
    /// </summary>
    /// <remarks>
    /// This activity starts when tool execution begins and ends when the tool returns.
    /// </remarks>
    Tool,

    /// <summary>
    /// Waiting for user approval of a tool execution.
    /// </summary>
    /// <remarks>
    /// This activity starts when the approval dialog is shown and ends when the user responds.
    /// </remarks>
    Approval,

    /// <summary>
    /// Activity completed successfully.
    /// </summary>
    /// <remarks>
    /// Used to mark successful completion of a sub-operation.
    /// </remarks>
    Success,

    /// <summary>
    /// Activity failed with an error.
    /// </summary>
    /// <remarks>
    /// Used to mark errors that occurred during execution.
    /// </remarks>
    Error,

    /// <summary>
    /// Warning or non-critical issue occurred.
    /// </summary>
    /// <remarks>
    /// Used for things like rate limit warnings, retries, etc.
    /// </remarks>
    Warning,

    /// <summary>
    /// Informational message.
    /// </summary>
    /// <remarks>
    /// Used for general status updates that don't fit other categories.
    /// </remarks>
    Info,

    /// <summary>
    /// Activity was cancelled by user.
    /// </summary>
    /// <remarks>
    /// Used when the user cancels an in-progress operation.
    /// </remarks>
    Cancelled
}

/// <summary>
/// Extension methods for ActivityType.
/// </summary>
public static class ActivityTypeExtensions
{
    /// <summary>
    /// Get the display name for an activity type.
    /// </summary>
    public static string GetDisplayName(this ActivityType type) => type switch
    {
        ActivityType.Thinking => "Thinking",
        ActivityType.Tool => "Tool Execution",
        ActivityType.Approval => "Awaiting Approval",
        ActivityType.Success => "Success",
        ActivityType.Error => "Error",
        ActivityType.Warning => "Warning",
        ActivityType.Info => "Info",
        ActivityType.Cancelled => "Cancelled",
        _ => type.ToString()
    };

    /// <summary>
    /// Get the icon resource key for an activity type.
    /// </summary>
    public static string GetIconKey(this ActivityType type) => type switch
    {
        ActivityType.Thinking => "ThinkingIcon",
        ActivityType.Tool => "ToolIcon",
        ActivityType.Approval => "ApprovalIcon",
        ActivityType.Success => "SuccessIcon",
        ActivityType.Error => "ErrorIcon",
        ActivityType.Warning => "WarningIcon",
        ActivityType.Info => "InfoIcon",
        ActivityType.Cancelled => "CancelledIcon",
        _ => "DefaultIcon"
    };

    /// <summary>
    /// Get whether this activity type represents a terminal state.
    /// </summary>
    public static bool IsTerminal(this ActivityType type) => type
        is ActivityType.Success
        or ActivityType.Error
        or ActivityType.Cancelled;

    /// <summary>
    /// Get whether this activity type represents something in progress.
    /// </summary>
    public static bool IsInProgress(this ActivityType type) => type
        is ActivityType.Thinking
        or ActivityType.Tool
        or ActivityType.Approval;

    /// <summary>
    /// Get whether this activity type represents a problem.
    /// </summary>
    public static bool IsProblem(this ActivityType type) => type
        is ActivityType.Error
        or ActivityType.Warning
        or ActivityType.Cancelled;
}
```

### 2. AgentActivityItem.cs

**Location**: `src/SeniorIntern.Core/Models/AgentActivityItem.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Represents a single activity item during agent execution.
/// </summary>
/// <remarks>
/// <para>
/// Activity items are used to track and display what the agent is doing
/// during multi-step execution. Each item represents a discrete activity
/// such as thinking, tool execution, or waiting for approval.
/// </para>
/// <para>
/// Items are immutable once created, except for Duration and Success
/// which may be updated when the activity completes.
/// </para>
/// </remarks>
public sealed class AgentActivityItem
{
    /// <summary>
    /// Unique identifier for the activity.
    /// </summary>
    public Guid Id { get; init; } = Guid.NewGuid();

    /// <summary>
    /// Timestamp when the activity started.
    /// </summary>
    public DateTime Timestamp { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// Type of activity (thinking, tool execution, approval, etc.).
    /// </summary>
    public ActivityType Type { get; init; }

    /// <summary>
    /// Human-readable message describing the activity.
    /// </summary>
    /// <example>
    /// "Thinking about response..."
    /// "Executing ReadFile tool"
    /// "Waiting for approval to write file"
    /// </example>
    public string Message { get; init; } = string.Empty;

    /// <summary>
    /// Optional detailed information about the activity.
    /// </summary>
    /// <remarks>
    /// This may contain additional context such as parameters, error details, etc.
    /// </remarks>
    public string? Details { get; init; }

    /// <summary>
    /// Associated tool ID, if this activity involves a tool.
    /// </summary>
    public string? ToolId { get; init; }

    /// <summary>
    /// Name of the associated tool for display purposes.
    /// </summary>
    public string? ToolName { get; init; }

    /// <summary>
    /// Duration of the activity, if completed.
    /// </summary>
    /// <remarks>
    /// This is null while the activity is in progress, and set when it completes.
    /// </remarks>
    public TimeSpan? Duration { get; set; }

    /// <summary>
    /// Whether the activity was successful (for completable activities).
    /// </summary>
    /// <remarks>
    /// This is null while the activity is in progress or for activities
    /// that don't have a success/failure outcome.
    /// </remarks>
    public bool? Success { get; set; }

    /// <summary>
    /// Error message if the activity failed.
    /// </summary>
    public string? ErrorMessage { get; set; }

    /// <summary>
    /// Icon resource key for UI display.
    /// </summary>
    public string Icon => Type.GetIconKey();

    /// <summary>
    /// Whether this activity is still in progress.
    /// </summary>
    public bool IsInProgress => !Duration.HasValue && Type.IsInProgress();

    /// <summary>
    /// Creates a new activity item for thinking.
    /// </summary>
    public static AgentActivityItem Thinking(string message = "Generating response...")
        => new()
        {
            Type = ActivityType.Thinking,
            Message = message
        };

    /// <summary>
    /// Creates a new activity item for tool execution start.
    /// </summary>
    public static AgentActivityItem ToolStart(string toolId, string toolName, string? details = null)
        => new()
        {
            Type = ActivityType.Tool,
            Message = $"Executing {toolName}",
            Details = details,
            ToolId = toolId,
            ToolName = toolName
        };

    /// <summary>
    /// Creates a new activity item for approval waiting.
    /// </summary>
    public static AgentActivityItem ApprovalWaiting(string toolId, string toolName, string reason)
        => new()
        {
            Type = ActivityType.Approval,
            Message = $"Awaiting approval for {toolName}",
            Details = reason,
            ToolId = toolId,
            ToolName = toolName
        };

    /// <summary>
    /// Creates a new activity item for success.
    /// </summary>
    public static AgentActivityItem SuccessItem(string message, string? details = null, TimeSpan? duration = null)
        => new()
        {
            Type = ActivityType.Success,
            Message = message,
            Details = details,
            Duration = duration,
            Success = true
        };

    /// <summary>
    /// Creates a new activity item for an error.
    /// </summary>
    public static AgentActivityItem ErrorItem(string message, string? errorDetails = null)
        => new()
        {
            Type = ActivityType.Error,
            Message = message,
            ErrorMessage = errorDetails,
            Details = errorDetails,
            Success = false
        };

    /// <summary>
    /// Creates a new activity item for a warning.
    /// </summary>
    public static AgentActivityItem WarningItem(string message, string? details = null)
        => new()
        {
            Type = ActivityType.Warning,
            Message = message,
            Details = details
        };

    /// <summary>
    /// Creates a new activity item for information.
    /// </summary>
    public static AgentActivityItem InfoItem(string message, string? details = null)
        => new()
        {
            Type = ActivityType.Info,
            Message = message,
            Details = details
        };

    /// <summary>
    /// Creates a new activity item for cancellation.
    /// </summary>
    public static AgentActivityItem CancelledItem(string message = "Operation cancelled by user")
        => new()
        {
            Type = ActivityType.Cancelled,
            Message = message,
            Success = false
        };

    /// <summary>
    /// Mark this activity as completed.
    /// </summary>
    public void Complete(bool success, TimeSpan duration, string? errorMessage = null)
    {
        Success = success;
        Duration = duration;
        ErrorMessage = errorMessage;
    }
}
```

### 3. AgentExecutionSummary.cs

**Location**: `src/SeniorIntern.Core/Models/AgentExecutionSummary.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Summary of an agent execution session.
/// </summary>
/// <remarks>
/// <para>
/// This class tracks comprehensive statistics about an agent execution,
/// including iteration counts, tool call outcomes, and timing information.
/// </para>
/// <para>
/// A new summary is created for each user message that triggers agent execution.
/// </para>
/// </remarks>
public sealed class AgentExecutionSummary
{
    #region Identification

    /// <summary>
    /// Unique identifier for the execution session.
    /// </summary>
    public Guid SessionId { get; init; } = Guid.NewGuid();

    /// <summary>
    /// Associated conversation ID.
    /// </summary>
    public Guid ConversationId { get; init; }

    /// <summary>
    /// The user message that triggered this execution.
    /// </summary>
    public string? UserMessage { get; init; }

    #endregion

    #region Timing

    /// <summary>
    /// Time when execution started.
    /// </summary>
    public DateTime StartTime { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// Time when execution completed.
    /// </summary>
    public DateTime? EndTime { get; set; }

    /// <summary>
    /// Total duration of the execution.
    /// </summary>
    public TimeSpan Duration => EndTime.HasValue
        ? EndTime.Value - StartTime
        : DateTime.UtcNow - StartTime;

    #endregion

    #region Iteration Statistics

    /// <summary>
    /// Number of iterations (LLM calls) made.
    /// </summary>
    public int IterationCount { get; set; }

    /// <summary>
    /// Maximum allowed iterations.
    /// </summary>
    public int MaxIterations { get; init; } = 10;

    /// <summary>
    /// Progress as a percentage (0-100).
    /// </summary>
    public double ProgressPercent => MaxIterations > 0
        ? (double)IterationCount / MaxIterations * 100
        : 0;

    #endregion

    #region Tool Call Statistics

    /// <summary>
    /// Number of tool calls executed.
    /// </summary>
    public int ToolCallsExecuted { get; set; }

    /// <summary>
    /// Number of tool calls that succeeded.
    /// </summary>
    public int ToolCallsSucceeded { get; set; }

    /// <summary>
    /// Number of tool calls that failed.
    /// </summary>
    public int ToolCallsFailed { get; set; }

    /// <summary>
    /// Number of tool calls approved by user.
    /// </summary>
    public int ToolCallsApproved { get; set; }

    /// <summary>
    /// Number of tool calls denied by user.
    /// </summary>
    public int ToolCallsDenied { get; set; }

    /// <summary>
    /// Number of tool calls auto-approved by policy.
    /// </summary>
    public int ToolCallsAutoApproved { get; set; }

    /// <summary>
    /// Number of tool calls blocked by policy.
    /// </summary>
    public int ToolCallsBlocked { get; set; }

    /// <summary>
    /// Total tool calls that were attempted (approved or auto-approved).
    /// </summary>
    public int TotalToolCallsAttempted => ToolCallsApproved + ToolCallsAutoApproved;

    /// <summary>
    /// Tool success rate as a percentage (0-100).
    /// </summary>
    public double ToolSuccessRate => ToolCallsExecuted > 0
        ? (double)ToolCallsSucceeded / ToolCallsExecuted * 100
        : 0;

    #endregion

    #region Token Statistics

    /// <summary>
    /// Total input tokens used during execution.
    /// </summary>
    public int InputTokensUsed { get; set; }

    /// <summary>
    /// Total output tokens used during execution.
    /// </summary>
    public int OutputTokensUsed { get; set; }

    /// <summary>
    /// Total tokens used during execution.
    /// </summary>
    public int TotalTokensUsed => InputTokensUsed + OutputTokensUsed;

    #endregion

    #region End State

    /// <summary>
    /// How the execution ended.
    /// </summary>
    public ExecutionEndReason EndReason { get; set; } = ExecutionEndReason.InProgress;

    /// <summary>
    /// Error message if execution failed.
    /// </summary>
    public string? ErrorMessage { get; set; }

    /// <summary>
    /// Whether execution completed successfully.
    /// </summary>
    public bool IsCompleted => EndReason == ExecutionEndReason.Completed;

    /// <summary>
    /// Whether execution is still in progress.
    /// </summary>
    public bool IsInProgress => EndReason == ExecutionEndReason.InProgress;

    /// <summary>
    /// Whether execution ended due to a problem.
    /// </summary>
    public bool HasError => EndReason is ExecutionEndReason.Error
        or ExecutionEndReason.RateLimited
        or ExecutionEndReason.Timeout;

    #endregion

    #region Factory Methods

    /// <summary>
    /// Create a new execution summary for a conversation.
    /// </summary>
    public static AgentExecutionSummary Start(Guid conversationId, int maxIterations = 10)
        => new()
        {
            ConversationId = conversationId,
            MaxIterations = maxIterations
        };

    #endregion

    #region Completion Methods

    /// <summary>
    /// Mark the execution as completed successfully.
    /// </summary>
    public void Complete()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.Completed;
    }

    /// <summary>
    /// Mark the execution as cancelled by user.
    /// </summary>
    public void Cancel()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.UserCancelled;
    }

    /// <summary>
    /// Mark the execution as failed with an error.
    /// </summary>
    public void Fail(string errorMessage)
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.Error;
        ErrorMessage = errorMessage;
    }

    /// <summary>
    /// Mark the execution as ended due to max iterations.
    /// </summary>
    public void ReachMaxIterations()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.MaxIterationsReached;
    }

    /// <summary>
    /// Mark the execution as ended due to tool denial.
    /// </summary>
    public void ToolDenied()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.ToolDenied;
    }

    /// <summary>
    /// Mark the execution as rate limited.
    /// </summary>
    public void RateLimited()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.RateLimited;
    }

    /// <summary>
    /// Mark the execution as timed out.
    /// </summary>
    public void Timeout()
    {
        EndTime = DateTime.UtcNow;
        EndReason = ExecutionEndReason.Timeout;
    }

    #endregion

    #region Statistics Recording

    /// <summary>
    /// Record a new iteration starting.
    /// </summary>
    public void RecordIteration() => IterationCount++;

    /// <summary>
    /// Record a tool call being executed.
    /// </summary>
    public void RecordToolExecution(bool succeeded)
    {
        ToolCallsExecuted++;
        if (succeeded)
            ToolCallsSucceeded++;
        else
            ToolCallsFailed++;
    }

    /// <summary>
    /// Record a tool call approval outcome.
    /// </summary>
    public void RecordApproval(bool approved, bool wasAutoApproved)
    {
        if (approved)
        {
            if (wasAutoApproved)
                ToolCallsAutoApproved++;
            else
                ToolCallsApproved++;
        }
        else
        {
            ToolCallsDenied++;
        }
    }

    /// <summary>
    /// Record token usage from an LLM call.
    /// </summary>
    public void RecordTokens(int inputTokens, int outputTokens)
    {
        InputTokensUsed += inputTokens;
        OutputTokensUsed += outputTokens;
    }

    #endregion
}

/// <summary>
/// Reasons why an agent execution ended.
/// </summary>
public enum ExecutionEndReason
{
    /// <summary>
    /// Execution is still in progress.
    /// </summary>
    InProgress,

    /// <summary>
    /// Agent completed the task successfully.
    /// </summary>
    Completed,

    /// <summary>
    /// User cancelled the execution.
    /// </summary>
    UserCancelled,

    /// <summary>
    /// Maximum iterations reached.
    /// </summary>
    MaxIterationsReached,

    /// <summary>
    /// An error occurred during execution.
    /// </summary>
    Error,

    /// <summary>
    /// User denied a required tool approval.
    /// </summary>
    ToolDenied,

    /// <summary>
    /// Rate limit exceeded.
    /// </summary>
    RateLimited,

    /// <summary>
    /// Execution timed out.
    /// </summary>
    Timeout
}

/// <summary>
/// Extension methods for ExecutionEndReason.
/// </summary>
public static class ExecutionEndReasonExtensions
{
    /// <summary>
    /// Get the display name for an end reason.
    /// </summary>
    public static string GetDisplayName(this ExecutionEndReason reason) => reason switch
    {
        ExecutionEndReason.InProgress => "In Progress",
        ExecutionEndReason.Completed => "Completed",
        ExecutionEndReason.UserCancelled => "Cancelled",
        ExecutionEndReason.MaxIterationsReached => "Max Iterations Reached",
        ExecutionEndReason.Error => "Error",
        ExecutionEndReason.ToolDenied => "Tool Denied",
        ExecutionEndReason.RateLimited => "Rate Limited",
        ExecutionEndReason.Timeout => "Timed Out",
        _ => reason.ToString()
    };

    /// <summary>
    /// Get whether this is a successful end reason.
    /// </summary>
    public static bool IsSuccess(this ExecutionEndReason reason) =>
        reason == ExecutionEndReason.Completed;

    /// <summary>
    /// Get whether this is an error end reason.
    /// </summary>
    public static bool IsError(this ExecutionEndReason reason) =>
        reason is ExecutionEndReason.Error
        or ExecutionEndReason.RateLimited
        or ExecutionEndReason.Timeout;

    /// <summary>
    /// Get whether this represents a terminated state.
    /// </summary>
    public static bool IsTerminal(this ExecutionEndReason reason) =>
        reason != ExecutionEndReason.InProgress;
}
```

### 4. ToolResultDisplay.cs

**Location**: `src/SeniorIntern.Core/Models/ToolResultDisplay.cs`

```csharp
namespace SeniorIntern.Core.Models;

using SeniorIntern.Core.Tools;

/// <summary>
/// Display model for tool results shown in the chat.
/// </summary>
/// <remarks>
/// <para>
/// This model provides a UI-friendly representation of tool execution results
/// for display in the chat interface. It includes both summary and detailed
/// content, approval information, and risk indicators.
/// </para>
/// </remarks>
public sealed class ToolResultDisplay
{
    #region Tool Information

    /// <summary>
    /// Unique identifier of the tool that was executed.
    /// </summary>
    public string ToolId { get; init; } = string.Empty;

    /// <summary>
    /// Display name of the tool that was executed.
    /// </summary>
    public string ToolName { get; init; } = string.Empty;

    /// <summary>
    /// Unique identifier for this tool execution.
    /// </summary>
    public string ExecutionId { get; init; } = string.Empty;

    /// <summary>
    /// Category of the tool.
    /// </summary>
    public ToolCategory Category { get; init; }

    #endregion

    #region Result Information

    /// <summary>
    /// Whether the tool execution succeeded.
    /// </summary>
    public bool Success { get; init; }

    /// <summary>
    /// Short summary of the result (one line).
    /// </summary>
    public string Summary { get; init; } = string.Empty;

    /// <summary>
    /// Full result content for expansion.
    /// </summary>
    /// <remarks>
    /// This may contain the full output of the tool, which could be very long.
    /// It should only be displayed when the user explicitly expands the result.
    /// </remarks>
    public string? FullContent { get; init; }

    /// <summary>
    /// Error message if the execution failed.
    /// </summary>
    public string? ErrorMessage { get; init; }

    /// <summary>
    /// Whether the content is expandable (has full content).
    /// </summary>
    public bool IsExpandable => !string.IsNullOrEmpty(FullContent)
        && FullContent.Length > Summary.Length;

    /// <summary>
    /// Content type hint for syntax highlighting.
    /// </summary>
    /// <remarks>
    /// May be "json", "xml", "text", "code", etc.
    /// </remarks>
    public string? ContentType { get; init; }

    #endregion

    #region Timing Information

    /// <summary>
    /// Duration of the tool execution.
    /// </summary>
    public TimeSpan Duration { get; init; }

    /// <summary>
    /// Formatted duration string for display.
    /// </summary>
    public string DurationText => Duration.TotalSeconds < 1
        ? $"{Duration.TotalMilliseconds:F0}ms"
        : Duration.TotalSeconds < 60
            ? $"{Duration.TotalSeconds:F1}s"
            : $"{Duration.TotalMinutes:F1}m";

    /// <summary>
    /// Timestamp when the tool started executing.
    /// </summary>
    public DateTime StartedAt { get; init; }

    #endregion

    #region Risk and Approval

    /// <summary>
    /// Risk level of the executed tool.
    /// </summary>
    public RiskLevel RiskLevel { get; init; }

    /// <summary>
    /// How the tool was approved for execution.
    /// </summary>
    public ApprovalMethod ApprovalMethod { get; init; }

    /// <summary>
    /// Display text for the approval method.
    /// </summary>
    public string ApprovalText => ApprovalMethod.GetDisplayName();

    /// <summary>
    /// Icon for the approval method.
    /// </summary>
    public string ApprovalIcon => ApprovalMethod.GetIconKey();

    #endregion

    #region Factory Methods

    /// <summary>
    /// Create a success display from a tool result.
    /// </summary>
    public static ToolResultDisplay FromSuccess(
        string toolId,
        string toolName,
        ToolCategory category,
        string summary,
        string? fullContent,
        TimeSpan duration,
        RiskLevel riskLevel,
        ApprovalMethod approvalMethod,
        string? contentType = null)
    {
        return new ToolResultDisplay
        {
            ToolId = toolId,
            ToolName = toolName,
            ExecutionId = Guid.NewGuid().ToString(),
            Category = category,
            Success = true,
            Summary = summary,
            FullContent = fullContent,
            Duration = duration,
            StartedAt = DateTime.UtcNow - duration,
            RiskLevel = riskLevel,
            ApprovalMethod = approvalMethod,
            ContentType = contentType
        };
    }

    /// <summary>
    /// Create a failure display from a tool error.
    /// </summary>
    public static ToolResultDisplay FromFailure(
        string toolId,
        string toolName,
        ToolCategory category,
        string errorMessage,
        TimeSpan duration,
        RiskLevel riskLevel,
        ApprovalMethod approvalMethod)
    {
        return new ToolResultDisplay
        {
            ToolId = toolId,
            ToolName = toolName,
            ExecutionId = Guid.NewGuid().ToString(),
            Category = category,
            Success = false,
            Summary = $"Error: {errorMessage}",
            ErrorMessage = errorMessage,
            Duration = duration,
            StartedAt = DateTime.UtcNow - duration,
            RiskLevel = riskLevel,
            ApprovalMethod = approvalMethod
        };
    }

    #endregion
}

/// <summary>
/// Methods by which a tool can be approved for execution.
/// </summary>
public enum ApprovalMethod
{
    /// <summary>
    /// Auto-approved based on policy (low risk or auto-approve mode).
    /// </summary>
    AutoApproved,

    /// <summary>
    /// User approved via the approval dialog.
    /// </summary>
    UserApproved,

    /// <summary>
    /// Approved via remembered session decision.
    /// </summary>
    SessionRemembered,

    /// <summary>
    /// Approved via permanent tool allowlist.
    /// </summary>
    PermanentlyAllowed,

    /// <summary>
    /// Tool is trusted in policy.
    /// </summary>
    TrustedTool
}

/// <summary>
/// Extension methods for ApprovalMethod.
/// </summary>
public static class ApprovalMethodExtensions
{
    /// <summary>
    /// Get the display name for an approval method.
    /// </summary>
    public static string GetDisplayName(this ApprovalMethod method) => method switch
    {
        ApprovalMethod.AutoApproved => "Auto-approved",
        ApprovalMethod.UserApproved => "User approved",
        ApprovalMethod.SessionRemembered => "Session remembered",
        ApprovalMethod.PermanentlyAllowed => "Always allowed",
        ApprovalMethod.TrustedTool => "Trusted tool",
        _ => method.ToString()
    };

    /// <summary>
    /// Get the icon key for an approval method.
    /// </summary>
    public static string GetIconKey(this ApprovalMethod method) => method switch
    {
        ApprovalMethod.AutoApproved => "AutoApproveIcon",
        ApprovalMethod.UserApproved => "UserApproveIcon",
        ApprovalMethod.SessionRemembered => "SessionIcon",
        ApprovalMethod.PermanentlyAllowed => "AlwaysAllowIcon",
        ApprovalMethod.TrustedTool => "TrustedIcon",
        _ => "DefaultIcon"
    };

    /// <summary>
    /// Get whether this was an automatic approval (no user interaction).
    /// </summary>
    public static bool IsAutomatic(this ApprovalMethod method) =>
        method is ApprovalMethod.AutoApproved
        or ApprovalMethod.SessionRemembered
        or ApprovalMethod.PermanentlyAllowed
        or ApprovalMethod.TrustedTool;
}
```

---

## File Summary

| File | Location | Purpose | Lines |
|------|----------|---------|-------|
| `ActivityType.cs` | `Core/Models/` | Activity type enum and extensions | ~120 |
| `AgentActivityItem.cs` | `Core/Models/` | Individual activity model | ~200 |
| `AgentExecutionSummary.cs` | `Core/Models/` | Execution statistics | ~310 |
| `ToolResultDisplay.cs` | `Core/Models/` | Chat display model | ~210 |

---

## Unit Test Plan

| Test | Description |
|------|-------------|
| `ActivityType_GetDisplayName_ReturnsCorrect` | Display names |
| `ActivityType_GetIconKey_ReturnsCorrect` | Icon keys |
| `ActivityType_IsTerminal_ReturnsCorrect` | Terminal detection |
| `ActivityType_IsInProgress_ReturnsCorrect` | Progress detection |
| `AgentActivityItem_Thinking_CreatesCorrectly` | Factory method |
| `AgentActivityItem_ToolStart_CreatesCorrectly` | Factory method |
| `AgentActivityItem_Complete_SetsProperties` | Completion |
| `AgentExecutionSummary_Duration_CalculatesCorrectly` | Duration calc |
| `AgentExecutionSummary_ProgressPercent_CalculatesCorrectly` | Progress calc |
| `AgentExecutionSummary_RecordIteration_Increments` | Iteration |
| `AgentExecutionSummary_RecordToolExecution_TracksSuccess` | Success tracking |
| `AgentExecutionSummary_RecordToolExecution_TracksFailure` | Failure tracking |
| `AgentExecutionSummary_Complete_SetsEndReason` | Completion |
| `AgentExecutionSummary_Cancel_SetsEndReason` | Cancellation |
| `ToolResultDisplay_FromSuccess_CreatesCorrectly` | Factory method |
| `ToolResultDisplay_FromFailure_CreatesCorrectly` | Factory method |
| `ToolResultDisplay_IsExpandable_DependsOnContent` | Expandable check |
| `ApprovalMethod_GetDisplayName_ReturnsCorrect` | Display names |
| `ApprovalMethod_IsAutomatic_ReturnsCorrect` | Automatic check |
| `ExecutionEndReason_IsSuccess_ReturnsCorrect` | Success check |
| `ExecutionEndReason_IsError_ReturnsCorrect` | Error check |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | `AgentActivityItem` class created with all properties |
| AC-2 | `ActivityType` enum covers all activity types |
| AC-3 | `AgentExecutionSummary` tracks comprehensive execution statistics |
| AC-4 | `ToolResultDisplay` model supports chat display |
| AC-5 | All models are immutable where appropriate |
| AC-6 | Documentation comments complete |

---

## Changelog Entry

```markdown
## v0.6.5a - Agent Activity Models

### Added
- `ActivityType` enum
  - 8 activity types: Thinking, Tool, Approval, Success, Error, Warning, Info, Cancelled
  - Extension methods for display names, icons, state detection
- `AgentActivityItem` class
  - Properties: Id, Timestamp, Type, Message, Details, ToolId, ToolName, Duration, Success
  - Factory methods: Thinking, ToolStart, ApprovalWaiting, SuccessItem, ErrorItem, WarningItem, InfoItem, CancelledItem
  - Complete() method for marking completion
  - Computed: Icon, IsInProgress
- `AgentExecutionSummary` class
  - Identification: SessionId, ConversationId
  - Timing: StartTime, EndTime, Duration
  - Iteration stats: IterationCount, MaxIterations, ProgressPercent
  - Tool stats: Executed, Succeeded, Failed, Approved, Denied, AutoApproved, Blocked
  - Token stats: InputTokensUsed, OutputTokensUsed, TotalTokensUsed
  - End state: EndReason, ErrorMessage
  - Recording methods: RecordIteration, RecordToolExecution, RecordApproval, RecordTokens
  - Completion methods: Complete, Cancel, Fail, ReachMaxIterations, ToolDenied, RateLimited, Timeout
- `ExecutionEndReason` enum with 8 reasons
  - Extension methods for display names, success/error detection
- `ToolResultDisplay` class
  - Tool info: ToolId, ToolName, ExecutionId, Category
  - Result info: Success, Summary, FullContent, ErrorMessage, ContentType
  - Timing: Duration, DurationText, StartedAt
  - Approval info: RiskLevel, ApprovalMethod, ApprovalText
  - Factory methods: FromSuccess, FromFailure
  - Computed: IsExpandable
- `ApprovalMethod` enum with 5 methods
  - Extension methods for display names, icons, automatic detection
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.6.5a | 0.5 day |
