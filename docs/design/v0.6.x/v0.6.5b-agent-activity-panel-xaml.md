# Design Specification: AIntern v0.6.5b "Agent Activity Panel XAML"

## Overview

**Version**: v0.6.5b
**Parent**: v0.6.5 Agent Loop & Polish
**Focus**: Visual UI component for displaying agent activity during execution

### Purpose

Create the agent activity panel that:
1. Displays real-time agent activity during multi-step execution
2. Shows progress with iteration counter and progress bar
3. Provides a scrollable activity log with timestamped entries
4. Includes a cancel button for user control
5. Uses color-coded icons for different activity types
6. Displays duration badges for completed activities

### Dependencies

**From v0.6.5a (Agent Activity Models)**:
- `AgentActivityItem`, `ActivityType`
- `AgentExecutionSummary`

**From Existing UI Layer**:
- Avalonia UserControl infrastructure
- Theme resources and dynamic resources
- ViewModelBase pattern

---

## Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    v0.6.5b Agent Activity Panel Architecture                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                              โ
โ  Panel Layout:                                                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                      AgentActivityPanel                                  โ โ
โ  โ  (UserControl, visible when IsAgentActive)                              โ โ
โ  โ                                                                          โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ  โ                    Header (Row 0)                                  โ  โ โ
โ  โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โ  โ โ
โ  โ  โ  โ [โ] State    โ  โ Iteration 3/10      โ  โ  [Cancel]       โ   โ  โ โ
โ  โ  โ  โ    Text      โ  โ                     โ  โ                 โ   โ  โ โ
โ  โ  โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โ  โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ                                                                          โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ  โ                 Progress Bar (Row 1)                               โ  โ โ
โ  โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ         โ  โ โ
โ  โ  โ  (Determinate or indeterminate based on state)                    โ  โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ                                                                          โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ  โ               Activity Log (Row 2, ScrollViewer)                   โ  โ โ
โ  โ  โ                                                                    โ  โ โ
โ  โ  โ  09:23:45  ๐ต Generating response...                              โ  โ โ
โ  โ  โ  09:23:47  ๐ฃ Executing ReadFile                      [1.2s]      โ  โ โ
โ  โ  โ  09:23:48  โ File read successfully                              โ  โ โ
โ  โ  โ  09:23:49  ๐ต Analyzing content...                                โ  โ โ
โ  โ  โ  09:23:52  ๐ก Awaiting approval for WriteFile                     โ  โ โ
โ  โ  โ                                                                    โ  โ โ
โ  โ  โ  (MaxHeight: 200px, scrollable)                                   โ  โ โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ                                                                          โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Visual Design

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Visual Design Specifications                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                              โ
โ  Header Section:                                                             โ
โ  โโโ Progress Ring: 16x16, visible during processing                        โ
โ  โโโ Pause Icon: 16x16, visible when paused                                 โ
โ  โโโ State Text: SemiBold, dynamic based on state                           โ
โ  โโโ Iteration Counter: "Iteration X / Y" format                            โ
โ  โโโ Cancel Button: Secondary style, "Cancel" text                          โ
โ                                                                              โ
โ  Progress Bar:                                                               โ
โ  โโโ Height: 3px                                                            โ
โ  โโโ Mode: Determinate when iteration count known, indeterminate otherwise  โ
โ  โโโ Color: Accent color from theme                                         โ
โ                                                                              โ
โ  Activity Log Item:                                                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  [Timestamp] [Icon Badge] [Message]                    [Duration Badge] โโ
โ  โ   60px        36px        Flexible                     Optional         โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ  Activity Icon Colors:                                                       โ
โ  โโโ Thinking:  Blue (#3B82F6)                                              โ
โ  โโโ Tool:      Purple (#8B5CF6)                                            โ
โ  โโโ Approval:  Amber (#F59E0B)                                             โ
โ  โโโ Success:   Green (#10B981)                                             โ
โ  โโโ Error:     Red (#EF4444)                                               โ
โ  โโโ Warning:   Amber (#F59E0B)                                             โ
โ  โโโ Info:      Gray (#6B7280)                                              โ
โ  โโโ Cancelled: Gray (#6B7280)                                              โ
โ                                                                              โ
โ  Duration Badge:                                                             โ
โ  โโโ Background: SurfaceBackgroundAlt                                       โ
โ  โโโ Corner Radius: 4px                                                     โ
โ  โโโ Padding: 4px horizontal, 2px vertical                                  โ
โ  โโโ Font Size: 10px                                                        โ
โ  โโโ Format: "X.Xs" (e.g., "1.2s")                                          โ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## State Transitions

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       Panel State Transitions                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                              โ
โ  Visibility States:                                                          โ
โ                                                                              โ
โ  IsAgentActive = false                                                       โ
โ       โ                                                                      โ
โ       โโโโ Panel Hidden                                                     โ
โ       โ                                                                      โ
โ  IsAgentActive = true                                                        โ
โ       โ                                                                      โ
โ       โโโโ Panel Visible                                                    โ
โ       โ                                                                      โ
โ       โผ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ                     Processing States                                    โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโคโ
โ  โ                                                                          โโ
โ  โ  IsProcessing = true                                                     โโ
โ  โ  โโโ Progress Ring: Visible & Active                                    โโ
โ  โ  โโโ State Text: "Thinking..." or "Executing..."                        โโ
โ  โ  โโโ Progress Bar: Indeterminate or determinate                         โโ
โ  โ                                                                          โโ
โ  โ  IsPaused = true (waiting for approval)                                 โโ
โ  โ  โโโ Progress Ring: Hidden                                              โโ
โ  โ  โโโ Pause Icon: Visible                                                โโ
โ  โ  โโโ State Text: "Awaiting approval..."                                 โโ
โ  โ  โโโ Progress Bar: Determinate (frozen)                                 โโ
โ  โ                                                                          โโ
โ  โ  Completed/Cancelled/Error                                               โโ
โ  โ  โโโ Progress Ring: Hidden                                              โโ
โ  โ  โโโ State Icon: โ/โ/โ                                                  โโ
โ  โ  โโโ State Text: "Completed"/"Cancelled"/"Error"                        โโ
โ  โ  โโโ Progress Bar: 100% or frozen                                       โโ
โ  โ                                                                          โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ  Progress Bar Modes:                                                         โ
โ  โโโ Indeterminate: Unknown iterations or streaming                         โ
โ  โโโ Determinate: Known max iterations, shows CurrentIteration/Max         โ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## File Specifications

### 1. AgentActivityPanel.axaml

**Location**: `src/SeniorIntern.Desktop/Views/AgentActivityPanel.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
             xmlns:models="using:SeniorIntern.Core.Models"
             xmlns:converters="using:SeniorIntern.Desktop.Converters"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="250"
             x:Class="SeniorIntern.Desktop.Views.AgentActivityPanel"
             x:DataType="vm:AgentActivityViewModel">

    <UserControl.Resources>
        <converters:EnumToBoolConverter x:Key="EnumConverter" />
        <converters:ActivityTypeToIconConverter x:Key="ActivityIconConverter" />
        <converters:ActivityTypeToBrushConverter x:Key="ActivityBrushConverter" />
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:TimeSpanToStringConverter x:Key="TimeSpanConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Agent Activity Container -->
        <Style Selector="Border.agent-activity-container">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="BorderThickness" Value="0,1,0,0" />
            <Setter Property="CornerRadius" Value="0" />
        </Style>

        <!-- Activity Icon Badge Base -->
        <Style Selector="Border.activity-icon">
            <Setter Property="Width" Value="20" />
            <Setter Property="Height" Value="20" />
            <Setter Property="CornerRadius" Value="10" />
        </Style>

        <!-- Activity Icon Color Variants -->
        <Style Selector="Border.activity-icon.thinking">
            <Setter Property="Background" Value="#3B82F6" />
        </Style>
        <Style Selector="Border.activity-icon.tool">
            <Setter Property="Background" Value="#8B5CF6" />
        </Style>
        <Style Selector="Border.activity-icon.approval">
            <Setter Property="Background" Value="#F59E0B" />
        </Style>
        <Style Selector="Border.activity-icon.success">
            <Setter Property="Background" Value="#10B981" />
        </Style>
        <Style Selector="Border.activity-icon.error">
            <Setter Property="Background" Value="#EF4444" />
        </Style>
        <Style Selector="Border.activity-icon.warning">
            <Setter Property="Background" Value="#F59E0B" />
        </Style>
        <Style Selector="Border.activity-icon.info">
            <Setter Property="Background" Value="#6B7280" />
        </Style>
        <Style Selector="Border.activity-icon.cancelled">
            <Setter Property="Background" Value="#6B7280" />
        </Style>

        <!-- Duration Badge -->
        <Style Selector="Border.duration-badge">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackgroundAlt}" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="6,2" />
        </Style>

        <!-- Iteration Counter Text -->
        <Style Selector="TextBlock.iteration-label">
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="FontSize" Value="12" />
        </Style>
        <Style Selector="TextBlock.iteration-value">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <!-- Activity Log Item -->
        <Style Selector="Border.activity-item">
            <Setter Property="Padding" Value="12,4" />
        </Style>
        <Style Selector="Border.activity-item:pointerover">
            <Setter Property="Background" Value="{DynamicResource SurfaceBackgroundAlt}" />
        </Style>

        <!-- Timestamp Text -->
        <Style Selector="TextBlock.timestamp">
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontFamily" Value="{StaticResource MonoFont}" />
            <Setter Property="Width" Value="60" />
        </Style>
    </UserControl.Styles>

    <!-- Main Panel Container - Only visible when agent is active -->
    <Border Classes="agent-activity-container"
            IsVisible="{Binding IsAgentActive}">
        <Grid RowDefinitions="Auto, Auto, *">

            <!-- ============================================ -->
            <!-- Row 0: Header with State and Controls        -->
            <!-- ============================================ -->
            <Grid ColumnDefinitions="Auto, *, Auto" Margin="12,8">

                <!-- Left: Activity Indicator and State Text -->
                <StackPanel Orientation="Horizontal" Spacing="8">

                    <!-- Progress Ring - visible when processing -->
                    <ProgressRing Width="16" Height="16"
                                  IsActive="{Binding IsProcessing}"
                                  IsVisible="{Binding IsProcessing}" />

                    <!-- Pause Icon - visible when paused/waiting -->
                    <PathIcon Data="{StaticResource PauseGeometry}"
                              Width="16" Height="16"
                              IsVisible="{Binding IsPaused}"
                              Foreground="{DynamicResource WarningBrush}" />

                    <!-- Completed Icon - visible when completed -->
                    <PathIcon Data="{StaticResource CheckGeometry}"
                              Width="16" Height="16"
                              IsVisible="{Binding IsCompleted}"
                              Foreground="{DynamicResource SuccessBrush}" />

                    <!-- Error Icon - visible when errored -->
                    <PathIcon Data="{StaticResource ErrorGeometry}"
                              Width="16" Height="16"
                              IsVisible="{Binding HasError}"
                              Foreground="{DynamicResource ErrorBrush}" />

                    <!-- State Text -->
                    <TextBlock Text="{Binding AgentStateText}"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- Center: Iteration Counter -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Spacing="4"
                            IsVisible="{Binding ShowIterationCounter}">
                    <TextBlock Text="Iteration" Classes="iteration-label" />
                    <TextBlock Text="{Binding CurrentIteration}" Classes="iteration-value" />
                    <TextBlock Text="/" Classes="iteration-label" />
                    <TextBlock Text="{Binding MaxIterations}" Classes="iteration-label" />
                </StackPanel>

                <!-- Right: Cancel Button -->
                <Button Grid.Column="2"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Classes="secondary"
                        ToolTip.Tip="Cancel agent execution (Escape)"
                        IsEnabled="{Binding CanCancel}"
                        IsVisible="{Binding CanCancel}"
                        MinWidth="80" />
            </Grid>

            <!-- ============================================ -->
            <!-- Row 1: Progress Bar                          -->
            <!-- ============================================ -->
            <Grid Grid.Row="1">
                <ProgressBar Value="{Binding ProgressPercent}"
                             IsIndeterminate="{Binding IsIndeterminate}"
                             Height="3"
                             Minimum="0"
                             Maximum="100"
                             Foreground="{DynamicResource AccentBrush}" />
            </Grid>

            <!-- ============================================ -->
            <!-- Row 2: Activity Log (Scrollable)             -->
            <!-- ============================================ -->
            <ScrollViewer Grid.Row="2"
                          MaxHeight="200"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding Activities}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:AgentActivityItem}">
                            <Border Classes="activity-item">
                                <Grid ColumnDefinitions="60, Auto, *, Auto">

                                    <!-- Timestamp -->
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss}'}"
                                               Classes="timestamp"
                                               VerticalAlignment="Center" />

                                    <!-- Activity Icon Badge -->
                                    <Border Grid.Column="1"
                                            Classes="activity-icon"
                                            Classes.thinking="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Thinking}"
                                            Classes.tool="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Tool}"
                                            Classes.approval="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Approval}"
                                            Classes.success="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Success}"
                                            Classes.error="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Error}"
                                            Classes.warning="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Warning}"
                                            Classes.info="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Info}"
                                            Classes.cancelled="{Binding Type, Converter={StaticResource EnumConverter}, ConverterParameter=Cancelled}"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center">
                                        <PathIcon Data="{Binding Type, Converter={StaticResource ActivityIconConverter}}"
                                                  Width="12" Height="12"
                                                  Foreground="White"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center" />
                                    </Border>

                                    <!-- Message Text -->
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding Message}"
                                               TextTrimming="CharacterEllipsis"
                                               VerticalAlignment="Center"
                                               ToolTip.Tip="{Binding Details}" />

                                    <!-- Duration Badge (conditional) -->
                                    <Border Grid.Column="3"
                                            Classes="duration-badge"
                                            IsVisible="{Binding Duration, Converter={StaticResource NullToBoolConverter}}"
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Duration, Converter={StaticResource TimeSpanConverter}}"
                                                   FontSize="10"
                                                   Foreground="{DynamicResource TextMuted}" />
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Border>
</UserControl>
```

### 2. AgentActivityPanel.axaml.cs

**Location**: `src/SeniorIntern.Desktop/Views/AgentActivityPanel.axaml.cs`

```csharp
namespace SeniorIntern.Desktop.Views;

using Avalonia.Controls;

/// <summary>
/// Panel displaying agent activity during execution.
/// </summary>
/// <remarks>
/// <para>
/// This panel is displayed at the bottom of the chat view when the agent is
/// actively processing a request. It shows real-time activity updates,
/// progress information, and provides a cancel button for user control.
/// </para>
/// <para>
/// The panel visibility is controlled by the <c>IsAgentActive</c> property
/// on the associated <see cref="ViewModels.AgentActivityViewModel"/>.
/// </para>
/// </remarks>
public partial class AgentActivityPanel : UserControl
{
    /// <summary>
    /// Initializes a new instance of the AgentActivityPanel.
    /// </summary>
    public AgentActivityPanel()
    {
        InitializeComponent();
    }
}
```

### 3. ActivityTypeConverters.cs

**Location**: `src/SeniorIntern.Desktop/Converters/ActivityTypeConverters.cs`

```csharp
namespace SeniorIntern.Desktop.Converters;

using System;
using System.Globalization;
using Avalonia;
using Avalonia.Data.Converters;
using Avalonia.Media;
using SeniorIntern.Core.Models;

/// <summary>
/// Converts ActivityType to corresponding icon geometry.
/// </summary>
public class ActivityTypeToIconConverter : IValueConverter
{
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not ActivityType type)
            return null;

        // Get icon geometry from application resources
        var resourceKey = type switch
        {
            ActivityType.Thinking => "ThinkingGeometry",
            ActivityType.Tool => "ToolGeometry",
            ActivityType.Approval => "QuestionGeometry",
            ActivityType.Success => "CheckGeometry",
            ActivityType.Error => "ErrorGeometry",
            ActivityType.Warning => "WarningGeometry",
            ActivityType.Info => "InfoGeometry",
            ActivityType.Cancelled => "CancelGeometry",
            _ => "DefaultGeometry"
        };

        if (Application.Current?.TryGetResource(resourceKey, Application.Current.ActualThemeVariant, out var resource) == true)
        {
            return resource as StreamGeometry;
        }

        return null;
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("ActivityTypeToIconConverter only supports one-way conversion.");
    }
}

/// <summary>
/// Converts ActivityType to corresponding brush color.
/// </summary>
public class ActivityTypeToBrushConverter : IValueConverter
{
    /// <summary>
    /// Activity type color palette.
    /// </summary>
    private static readonly Dictionary<ActivityType, SolidColorBrush> ActivityBrushes = new()
    {
        [ActivityType.Thinking] = new SolidColorBrush(Color.Parse("#3B82F6")),   // Blue
        [ActivityType.Tool] = new SolidColorBrush(Color.Parse("#8B5CF6")),       // Purple
        [ActivityType.Approval] = new SolidColorBrush(Color.Parse("#F59E0B")),   // Amber
        [ActivityType.Success] = new SolidColorBrush(Color.Parse("#10B981")),    // Green
        [ActivityType.Error] = new SolidColorBrush(Color.Parse("#EF4444")),      // Red
        [ActivityType.Warning] = new SolidColorBrush(Color.Parse("#F59E0B")),    // Amber
        [ActivityType.Info] = new SolidColorBrush(Color.Parse("#6B7280")),       // Gray
        [ActivityType.Cancelled] = new SolidColorBrush(Color.Parse("#6B7280"))   // Gray
    };

    private static readonly SolidColorBrush DefaultBrush = new(Color.Parse("#6B7280"));

    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not ActivityType type)
            return DefaultBrush;

        return ActivityBrushes.GetValueOrDefault(type, DefaultBrush);
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("ActivityTypeToBrushConverter only supports one-way conversion.");
    }
}

/// <summary>
/// Converts enum values to bool for XAML class binding.
/// </summary>
public class EnumToBoolConverter : IValueConverter
{
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value == null || parameter == null)
            return false;

        var enumValue = value.ToString();
        var targetValue = parameter.ToString();

        return string.Equals(enumValue, targetValue, StringComparison.OrdinalIgnoreCase);
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("EnumToBoolConverter only supports one-way conversion.");
    }
}

/// <summary>
/// Converts null values to bool (not null = true).
/// </summary>
public class NullToBoolConverter : IValueConverter
{
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        return value != null;
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("NullToBoolConverter only supports one-way conversion.");
    }
}

/// <summary>
/// Converts TimeSpan to a formatted string for display.
/// </summary>
public class TimeSpanToStringConverter : IValueConverter
{
    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not TimeSpan timeSpan)
            return string.Empty;

        // Format based on duration
        if (timeSpan.TotalMilliseconds < 1000)
        {
            return $"{timeSpan.TotalMilliseconds:F0}ms";
        }
        else if (timeSpan.TotalSeconds < 60)
        {
            return $"{timeSpan.TotalSeconds:F1}s";
        }
        else if (timeSpan.TotalMinutes < 60)
        {
            return $"{timeSpan.TotalMinutes:F1}m";
        }
        else
        {
            return $"{timeSpan.TotalHours:F1}h";
        }
    }

    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        throw new NotSupportedException("TimeSpanToStringConverter only supports one-way conversion.");
    }
}
```

### 4. ActivityIconGeometries.axaml

**Location**: `src/SeniorIntern.Desktop/Resources/ActivityIconGeometries.axaml`

```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- ============================================== -->
    <!-- Activity Type Icon Geometries                  -->
    <!-- ============================================== -->

    <!-- Thinking Icon (Brain/Sparkle) -->
    <StreamGeometry x:Key="ThinkingGeometry">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-9.5c.83 0 1.5-.67 1.5-1.5S10.83 7.5 10 7.5 8.5 8.17 8.5 9s.67 1.5 1.5 1.5zm4 0c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5zm-2 5.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z
    </StreamGeometry>

    <!-- Tool Icon (Wrench/Gear) -->
    <StreamGeometry x:Key="ToolGeometry">
        M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z
    </StreamGeometry>

    <!-- Question Icon (for Approval) -->
    <StreamGeometry x:Key="QuestionGeometry">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z
    </StreamGeometry>

    <!-- Check Icon (Success) -->
    <StreamGeometry x:Key="CheckGeometry">
        M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z
    </StreamGeometry>

    <!-- Error Icon (X) -->
    <StreamGeometry x:Key="ErrorGeometry">
        M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z
    </StreamGeometry>

    <!-- Warning Icon (Triangle) -->
    <StreamGeometry x:Key="WarningGeometry">
        M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z
    </StreamGeometry>

    <!-- Info Icon (i circle) -->
    <StreamGeometry x:Key="InfoGeometry">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z
    </StreamGeometry>

    <!-- Cancel Icon (slash circle) -->
    <StreamGeometry x:Key="CancelGeometry">
        M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z
    </StreamGeometry>

    <!-- Pause Icon -->
    <StreamGeometry x:Key="PauseGeometry">
        M6 19h4V5H6v14zm8-14v14h4V5h-4z
    </StreamGeometry>

    <!-- Default/Fallback Icon -->
    <StreamGeometry x:Key="DefaultGeometry">
        M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z
    </StreamGeometry>

</ResourceDictionary>
```

---

## File Summary

| File | Location | Purpose | Lines |
|------|----------|---------|-------|
| `AgentActivityPanel.axaml` | `Views/` | Main panel XAML | ~230 |
| `AgentActivityPanel.axaml.cs` | `Views/` | Code-behind | ~25 |
| `ActivityTypeConverters.cs` | `Converters/` | Value converters | ~160 |
| `ActivityIconGeometries.axaml` | `Resources/` | Icon geometries | ~55 |

---

## Integration Points

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        Integration Points                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                              โ
โ  ChatView Integration:                                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  ChatView.axaml                                                          โโ
โ  โ  โโโ Message List                                                       โโ
โ  โ  โโโ ... other content ...                                              โโ
โ  โ  โโโ <views:AgentActivityPanel DataContext="{Binding ActivityVM}" />    โโ
โ  โ                                                                          โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ  Resource Dictionary Registration:                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  App.axaml                                                               โโ
โ  โ  <Application.Resources>                                                 โโ
โ  โ    <ResourceDictionary>                                                  โโ
โ  โ      <ResourceDictionary.MergedDictionaries>                             โโ
โ  โ        <ResourceInclude Source="/Resources/ActivityIconGeometries.axaml"/>โโ
โ  โ        <!-- other resources -->                                          โโ
โ  โ      </ResourceDictionary.MergedDictionaries>                            โโ
โ  โ    </ResourceDictionary>                                                 โโ
โ  โ  </Application.Resources>                                                โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ  ViewModel Binding:                                                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  ChatViewModel                                                           โโ
โ  โ  โโโ AgentActivityViewModel ActivityVM { get; } (from v0.6.5c)          โโ
โ  โ  โโโ Exposes activity state for panel binding                           โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Agent activity panel XAML created with all elements |
| AC-2 | Progress ring shows during processing |
| AC-3 | Iteration counter displays current/max iterations |
| AC-4 | Cancel button functional with tooltip |
| AC-5 | Progress bar shows determinate/indeterminate progress |
| AC-6 | Activity log scrolls and displays items correctly |
| AC-7 | Activity icons colored by type |
| AC-8 | Duration badges display when available |
| AC-9 | Converters handle all ActivityType values |

---

## Changelog Entry

```markdown
## v0.6.5b - Agent Activity Panel XAML

### Added
- `AgentActivityPanel.axaml` UserControl
  - Header with progress ring, state text, iteration counter, cancel button
  - Determinate/indeterminate progress bar
  - Scrollable activity log (max height 200px)
  - Activity items with timestamp, icon, message, duration badge
  - Visibility controlled by IsAgentActive binding
- `AgentActivityPanel.axaml.cs` code-behind
- Activity icon styles with 8 color variants
  - Thinking: Blue (#3B82F6)
  - Tool: Purple (#8B5CF6)
  - Approval: Amber (#F59E0B)
  - Success: Green (#10B981)
  - Error: Red (#EF4444)
  - Warning: Amber (#F59E0B)
  - Info/Cancelled: Gray (#6B7280)
- Value converters
  - `ActivityTypeToIconConverter` - maps type to geometry
  - `ActivityTypeToBrushConverter` - maps type to color
  - `EnumToBoolConverter` - for class bindings
  - `NullToBoolConverter` - for conditional visibility
  - `TimeSpanToStringConverter` - formats durations
- `ActivityIconGeometries.axaml` resource dictionary
  - 9 icon geometries: Thinking, Tool, Question, Check, Error, Warning, Info, Cancel, Pause
  - Default/fallback geometry
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.6.5b | 0.5 day |
