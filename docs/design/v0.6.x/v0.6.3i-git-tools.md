# Design Specification: AIntern v0.6.3i "Git Tools"

## Overview

**Version**: v0.6.3i
**Parent**: v0.6.3 Built-in Tools
**Focus**: Git repository tools for status, diffs, and commit history

### Purpose

Implement Git tools that enable the AI agent to:
1. View repository status (staged, modified, untracked files)
2. View file diffs (unstaged, staged, or between commits)
3. View commit history with filtering options
4. Format output in both short and detailed formats
5. Support file/path-specific operations
6. Provide statistics for diffs (insertions, deletions)

### Dependencies

**From v0.6.3h (Workspace Tools)**:
- `IGitService` interface (optional dependency)

**From v0.6.3a (File Read Tools)**:
- `ToolPathHelper` for path validation

**From v0.6.1 (Tool Framework)**:
- `ToolBase`, `ToolResult`
- `JsonSchemaBuilder`, `RiskLevel`

**From v0.3.x (Workspace Awareness)**:
- `IWorkspaceService` for workspace access

---

## Architecture

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                       v0.6.3i Git Tools Architecture                          │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  src/SeniorIntern.Services/Tools/Git/                                        │
│  ├─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  GitStatusTool : ToolBase                                                │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│ │
│  │  │  Id: "git-status"                                                    ││ │
│  │  │  DefaultRiskLevel: Safe                                              ││ │
│  │  │                                                                      ││ │
│  │  │  Parameters                                                           ││ │
│  │  │  └── short: bool (default: false) - Use short format                 ││ │
│  │  │                                                                      ││ │
│  │  │  Returns                                                              ││ │
│  │  │  ├── Branch name                                                     ││ │
│  │  │  ├── Staged files                                                    ││ │
│  │  │  ├── Modified files                                                  ││ │
│  │  │  ├── Deleted files                                                   ││ │
│  │  │  └── Untracked files                                                 ││ │
│  │  └─────────────────────────────────────────────────────────────────────┘│ │
│  │                                                                          │ │
│  │  GitDiffTool : ToolBase                                                  │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│ │
│  │  │  Id: "git-diff"                                                      ││ │
│  │  │  DefaultRiskLevel: Safe                                              ││ │
│  │  │                                                                      ││ │
│  │  │  Parameters                                                           ││ │
│  │  │  ├── path: string (optional) - Specific file/directory              ││ │
│  │  │  ├── staged: bool (default: false) - Show staged only               ││ │
│  │  │  ├── commit: string (optional) - Compare against commit             ││ │
│  │  │  └── context_lines: int (default: 3)                                 ││ │
│  │  │                                                                      ││ │
│  │  │  Constants                                                            ││ │
│  │  │  └── MaxDiffLength = 50,000 chars                                    ││ │
│  │  └─────────────────────────────────────────────────────────────────────┘│ │
│  │                                                                          │ │
│  │  GitLogTool : ToolBase                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐│ │
│  │  │  Id: "git-log"                                                       ││ │
│  │  │  DefaultRiskLevel: Safe                                              ││ │
│  │  │                                                                      ││ │
│  │  │  Parameters                                                           ││ │
│  │  │  ├── count: int (default: 10, max: 100)                              ││ │
│  │  │  ├── path: string (optional) - Filter by path                       ││ │
│  │  │  ├── author: string (optional) - Filter by author                   ││ │
│  │  │  ├── since: string (optional) - Date filter                         ││ │
│  │  │  └── oneline: bool (default: false) - Short format                  ││ │
│  │  └─────────────────────────────────────────────────────────────────────┘│ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  src/SeniorIntern.Core/Interfaces/IGitService.cs                             │
│  ├─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  IGitService                                                             │ │
│  │  ├── IsGitRepositoryAsync(path) → bool                                  │ │
│  │  ├── GetCurrentBranchAsync(path) → string                               │ │
│  │  ├── GetStatusAsync(path) → GitStatus                                   │ │
│  │  ├── GetDetailedStatusAsync(path) → DetailedGitStatus                   │ │
│  │  ├── GetDiffAsync(path, options) → string                               │ │
│  │  └── GetLogAsync(path, options) → List<GitCommit>                       │ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Data Models                                                                 │
│  ├─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  GitStatus              DetailedGitStatus                                │ │
│  │  ├── HasChanges         ├── HasChanges                                   │ │
│  │  ├── ModifiedCount      ├── StagedFiles: List<string>                   │ │
│  │  └── UntrackedCount     ├── ModifiedFiles: List<string>                 │ │
│  │                         ├── DeletedFiles: List<string>                  │ │
│  │                         └── UntrackedFiles: List<string>                │ │
│  │                                                                          │ │
│  │  GitCommit              GitDiffOptions                                   │ │
│  │  ├── Hash               ├── Path: string?                               │ │
│  │  ├── ShortHash          ├── Staged: bool                                │ │
│  │  ├── Author             ├── Commit: string?                             │ │
│  │  ├── AuthorEmail        └── ContextLines: int                           │ │
│  │  ├── Date                                                                │ │
│  │  ├── Subject            GitLogOptions                                    │ │
│  │  └── Body               ├── Count: int                                   │ │
│  │                         ├── Path: string?                                │ │
│  │                         ├── Author: string?                              │ │
│  │                         └── Since: string?                               │ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Output Formats

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          Git Status Output Formats                            │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Short Format (short=true):                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  ## main                                                                │ │
│  │  A  src/NewFile.cs                                                      │ │
│  │   M src/Services/UserService.cs                                         │ │
│  │   D src/OldFile.cs                                                      │ │
│  │  ?? docs/notes.txt                                                      │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Long Format (default):                                                      │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  On branch main                                                         │ │
│  │                                                                          │ │
│  │  Changes to be committed:                                               │ │
│  │    new file:   src/NewFile.cs                                           │ │
│  │                                                                          │ │
│  │  Changes not staged for commit:                                         │ │
│  │    modified:   src/Services/UserService.cs                              │ │
│  │                                                                          │ │
│  │  Deleted files:                                                          │ │
│  │    deleted:    src/OldFile.cs                                           │ │
│  │                                                                          │ │
│  │  Untracked files:                                                       │ │
│  │    docs/notes.txt                                                       │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           Git Log Output Formats                              │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Oneline Format (oneline=true):                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  abc1234 Add user authentication                                        │ │
│  │  def5678 Fix null reference in OrderService                             │ │
│  │  789abcd Update README.md                                               │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Full Format (default):                                                      │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  commit abc123456789def0123456789abcdef0123456789                       │ │
│  │  Author: John Doe <john@example.com>                                    │ │
│  │  Date:   Fri Jan 17 08:00:00 2026                                       │ │
│  │                                                                          │ │
│  │      Add user authentication                                            │ │
│  │                                                                          │ │
│  │      Implements JWT-based authentication with refresh tokens.            │ │
│  │                                                                          │ │
│  │  commit def567890123abc456789def0123456789abcdef01                       │ │
│  │  Author: Jane Smith <jane@example.com>                                  │ │
│  │  Date:   Thu Jan 16 15:30:00 2026                                       │ │
│  │                                                                          │ │
│  │      Fix null reference in OrderService                                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Execution Flows

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                       GitStatusTool Execution Flow                            │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ExecuteAsync(context)                                                       │
│      │                                                                       │
│      ▼                                                                       │
│  ┌─────────────────────────────┐                                             │
│  │  1. Extract Parameters      │                                             │
│  │  └── short: bool            │                                             │
│  └─────────────┬───────────────┘                                             │
│                │                                                             │
│                ▼                                                             │
│  ┌─────────────────────────────┐                                             │
│  │  2. Check Git Repository    │                                             │
│  │  IsGitRepositoryAsync()     │                                             │
│  └─────────────┬───────────────┘                                             │
│                │                                                             │
│       ┌────────┴────────┐                                                    │
│       │ Not Git repo    │ Is Git repo                                        │
│       ▼                 ▼                                                    │
│  ┌──────────┐    ┌─────────────────────────────┐                             │
│  │  RETURN  │    │  3. Get Branch              │                             │
│  │  Failed  │    │  GetCurrentBranchAsync()    │                             │
│  └──────────┘    └─────────────┬───────────────┘                             │
│                                │                                             │
│                                ▼                                             │
│                  ┌─────────────────────────────┐                             │
│                  │  4. Get Detailed Status     │                             │
│                  │  GetDetailedStatusAsync()   │                             │
│                  └─────────────┬───────────────┘                             │
│                                │                                             │
│                                ▼                                             │
│                  ┌─────────────────────────────┐                             │
│                  │  5. Format Output           │                             │
│                  │  ├── Short: git-style codes │                             │
│                  │  └── Long: detailed format  │                             │
│                  └─────────────┬───────────────┘                             │
│                                │                                             │
│                                ▼                                             │
│                  ┌─────────────────────────────┐                             │
│                  │  6. Build Result            │                             │
│                  │  ├── Formatted output       │                             │
│                  │  ├── GitStatusData          │                             │
│                  │  └── Summary message        │                             │
│                  └─────────────────────────────┘                             │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## File Specifications

### 1. GitStatusTool.cs

**Location**: `src/SeniorIntern.Services/Tools/Git/GitStatusTool.cs`

```csharp
namespace SeniorIntern.Services.Tools.Git;

using System.Text;
using System.Text.Json;
using Microsoft.Extensions.Logging;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;
using SeniorIntern.Core.Tools;
using SeniorIntern.Services.Tools;

/// <summary>
/// Tool for getting Git repository status.
/// </summary>
/// <remarks>
/// <para>
/// GitStatusTool provides repository status information:
/// </para>
/// <list type="bullet">
/// <item>Current branch</item>
/// <item>Staged changes</item>
/// <item>Unstaged modifications</item>
/// <item>Deleted files</item>
/// <item>Untracked files</item>
/// </list>
/// </remarks>
public sealed class GitStatusTool : ToolBase
{
    #region Tool Metadata

    public override string Id => "git-status";

    public override string Name => "Git Status";

    public override string Description => """
        Get the status of the Git repository.
        Shows staged changes, unstaged changes, and untracked files.

        Use this to understand what changes exist before committing.
        """;

    public override ToolCategory Category => ToolCategory.Git;

    public override RiskLevel DefaultRiskLevel => RiskLevel.Safe;

    public override IReadOnlyList<string> Tags => new[] { "git", "status", "changes" };

    public override JsonSchema InputSchema => JsonSchemaBuilder.Create()
        .WithDescription("Parameters for git status")
        .AddBoolean("short", "Use short format output (default: false)", required: false)
        .Build();

    #endregion

    #region Dependencies

    private readonly IGitService _gitService;
    private readonly IWorkspaceService _workspace;
    private readonly ILogger<GitStatusTool> _logger;

    #endregion

    public GitStatusTool(
        IGitService gitService,
        IWorkspaceService workspace,
        ILogger<GitStatusTool> logger)
    {
        _gitService = gitService ?? throw new ArgumentNullException(nameof(gitService));
        _workspace = workspace ?? throw new ArgumentNullException(nameof(workspace));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public override bool IsAvailable => _workspace.CurrentWorkspace != null;

    #region ExecuteAsync

    public override async Task<ToolResult> ExecuteAsync(
        ToolExecutionContext context,
        CancellationToken ct = default)
    {
        var shortFormat = GetOptionalParameter(context.Parameters, "short", false);

        var rootPath = context.WorkspacePath;

        _logger.LogDebug("GitStatusTool executing: path={Path}, short={Short}", rootPath, shortFormat);

        // Check if Git repository
        if (!await _gitService.IsGitRepositoryAsync(rootPath!, ct))
        {
            return ToolResult.Failed("Not a Git repository");
        }

        try
        {
            var status = await _gitService.GetDetailedStatusAsync(rootPath!, ct);
            var branch = await _gitService.GetCurrentBranchAsync(rootPath!, ct);

            var output = shortFormat
                ? FormatShortStatus(status, branch)
                : FormatLongStatus(status, branch);

            var resultData = new GitStatusData
            {
                Branch = branch,
                HasChanges = status.HasChanges,
                StagedCount = status.StagedFiles.Count,
                ModifiedCount = status.ModifiedFiles.Count,
                DeletedCount = status.DeletedFiles.Count,
                UntrackedCount = status.UntrackedFiles.Count
            };

            var message = status.HasChanges
                ? $"On branch {branch}: {status.StagedFiles.Count} staged, {status.ModifiedFiles.Count} modified, {status.UntrackedFiles.Count} untracked"
                : $"On branch {branch}: working tree clean";

            _logger.LogInformation(
                "GitStatusTool success: branch={Branch}, hasChanges={HasChanges}",
                branch, status.HasChanges);

            return ToolResult.Success(output, resultData, message);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Git status failed");
            return ToolResult.Failed($"Git status failed: {ex.Message}");
        }
    }

    #endregion

    #region Output Formatting

    /// <summary>
    /// Format status in short (git status -s) format.
    /// </summary>
    private static string FormatShortStatus(DetailedGitStatus status, string branch)
    {
        var sb = new StringBuilder();
        sb.AppendLine($"## {branch}");

        foreach (var file in status.StagedFiles)
            sb.AppendLine($"A  {file}");
        foreach (var file in status.ModifiedFiles)
            sb.AppendLine($" M {file}");
        foreach (var file in status.DeletedFiles)
            sb.AppendLine($" D {file}");
        foreach (var file in status.UntrackedFiles)
            sb.AppendLine($"?? {file}");

        return sb.ToString().TrimEnd();
    }

    /// <summary>
    /// Format status in long (git status) format.
    /// </summary>
    private static string FormatLongStatus(DetailedGitStatus status, string branch)
    {
        var sb = new StringBuilder();
        sb.AppendLine($"On branch {branch}");
        sb.AppendLine();

        if (status.StagedFiles.Count > 0)
        {
            sb.AppendLine("Changes to be committed:");
            foreach (var file in status.StagedFiles)
                sb.AppendLine($"  new file:   {file}");
            sb.AppendLine();
        }

        if (status.ModifiedFiles.Count > 0)
        {
            sb.AppendLine("Changes not staged for commit:");
            foreach (var file in status.ModifiedFiles)
                sb.AppendLine($"  modified:   {file}");
            sb.AppendLine();
        }

        if (status.DeletedFiles.Count > 0)
        {
            sb.AppendLine("Deleted files:");
            foreach (var file in status.DeletedFiles)
                sb.AppendLine($"  deleted:    {file}");
            sb.AppendLine();
        }

        if (status.UntrackedFiles.Count > 0)
        {
            sb.AppendLine("Untracked files:");
            foreach (var file in status.UntrackedFiles)
                sb.AppendLine($"  {file}");
            sb.AppendLine();
        }

        if (!status.HasChanges)
        {
            sb.AppendLine("nothing to commit, working tree clean");
        }

        return sb.ToString().TrimEnd();
    }

    #endregion

    #region Overrides

    public override string GetExecutionSummary(JsonElement parameters) =>
        "Get git status";

    #endregion
}
```

### 2. GitDiffTool.cs

**Location**: `src/SeniorIntern.Services/Tools/Git/GitDiffTool.cs`

```csharp
namespace SeniorIntern.Services.Tools.Git;

using System.Text.Json;
using System.Text.RegularExpressions;
using Microsoft.Extensions.Logging;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;
using SeniorIntern.Core.Tools;
using SeniorIntern.Services.Tools;

/// <summary>
/// Tool for getting Git diffs.
/// </summary>
/// <remarks>
/// <para>
/// GitDiffTool shows file changes:
/// </para>
/// <list type="bullet">
/// <item>Unstaged changes (default)</item>
/// <item>Staged changes (--staged)</item>
/// <item>Comparison against specific commits</item>
/// <item>File-specific diffs</item>
/// </list>
/// </remarks>
public sealed class GitDiffTool : ToolBase
{
    #region Tool Metadata

    public override string Id => "git-diff";

    public override string Name => "Git Diff";

    public override string Description => """
        Get the diff of changes in the Git repository.
        Can show unstaged changes, staged changes, or compare commits.

        Use this to review changes before committing or to understand what was changed.
        """;

    public override ToolCategory Category => ToolCategory.Git;

    public override RiskLevel DefaultRiskLevel => RiskLevel.Safe;

    public override IReadOnlyList<string> Tags => new[] { "git", "diff", "changes" };

    public override JsonSchema InputSchema => JsonSchemaBuilder.Create()
        .WithDescription("Parameters for git diff")
        .AddString("path", "Specific file or directory to diff", required: false)
        .AddBoolean("staged", "Show staged changes only (default: false)", required: false)
        .AddString("commit", "Compare against a specific commit", required: false)
        .AddInteger("context_lines", "Lines of context (default: 3)", required: false)
        .Build();

    #endregion

    #region Dependencies

    private readonly IGitService _gitService;
    private readonly IWorkspaceService _workspace;
    private readonly ILogger<GitDiffTool> _logger;

    #endregion

    #region Constants

    /// <summary>
    /// Maximum diff output length before truncation.
    /// </summary>
    public const int MaxDiffLength = 50_000;

    #endregion

    public GitDiffTool(
        IGitService gitService,
        IWorkspaceService workspace,
        ILogger<GitDiffTool> logger)
    {
        _gitService = gitService ?? throw new ArgumentNullException(nameof(gitService));
        _workspace = workspace ?? throw new ArgumentNullException(nameof(workspace));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public override bool IsAvailable => _workspace.CurrentWorkspace != null;

    #region ExecuteAsync

    public override async Task<ToolResult> ExecuteAsync(
        ToolExecutionContext context,
        CancellationToken ct = default)
    {
        var path = GetOptionalParameter<string?>(context.Parameters, "path", null);
        var staged = GetOptionalParameter(context.Parameters, "staged", false);
        var commit = GetOptionalParameter<string?>(context.Parameters, "commit", null);
        var contextLines = GetOptionalParameter(context.Parameters, "context_lines", 3);

        var rootPath = context.WorkspacePath;

        _logger.LogDebug(
            "GitDiffTool executing: path={Path}, staged={Staged}, commit={Commit}",
            path ?? "*", staged, commit ?? "HEAD");

        // Check if Git repository
        if (!await _gitService.IsGitRepositoryAsync(rootPath!, ct))
        {
            return ToolResult.Failed("Not a Git repository");
        }

        try
        {
            var diff = await _gitService.GetDiffAsync(rootPath!, new GitDiffOptions
            {
                Path = path,
                Staged = staged,
                Commit = commit,
                ContextLines = contextLines
            }, ct);

            // Handle no changes
            if (string.IsNullOrEmpty(diff))
            {
                var message = staged ? "No staged changes" : "No changes";
                return ToolResult.Success(
                    "(no changes)",
                    new GitDiffData { HasChanges = false },
                    message);
            }

            // Truncate if too long
            var truncated = false;
            if (diff.Length > MaxDiffLength)
            {
                diff = diff[..MaxDiffLength] + "\n\n[Diff truncated...]";
                truncated = true;
                _logger.LogDebug("Diff truncated to {Max} chars", MaxDiffLength);
            }

            // Parse statistics
            var stats = ParseDiffStats(diff);

            var resultData = new GitDiffData
            {
                HasChanges = true,
                FilesChanged = stats.FilesChanged,
                Insertions = stats.Insertions,
                Deletions = stats.Deletions,
                WasTruncated = truncated
            };

            var message = $"{stats.FilesChanged} files changed, +{stats.Insertions}/-{stats.Deletions}";

            _logger.LogInformation(
                "GitDiffTool success: files={Files}, +{Ins}/-{Del}",
                stats.FilesChanged, stats.Insertions, stats.Deletions);

            return ToolResult.Success(diff, resultData, message);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Git diff failed");
            return ToolResult.Failed($"Git diff failed: {ex.Message}");
        }
    }

    #endregion

    #region Statistics

    /// <summary>
    /// Parse diff statistics from output.
    /// </summary>
    private static (int FilesChanged, int Insertions, int Deletions) ParseDiffStats(string diff)
    {
        var files = Regex.Matches(diff, @"^diff --git", RegexOptions.Multiline).Count;
        var insertions = Regex.Matches(diff, @"^\+[^+]", RegexOptions.Multiline).Count;
        var deletions = Regex.Matches(diff, @"^-[^-]", RegexOptions.Multiline).Count;

        return (files, insertions, deletions);
    }

    #endregion

    #region Overrides

    public override string GetExecutionSummary(JsonElement parameters)
    {
        var path = parameters.TryGetProperty("path", out var p) ? p.GetString() : null;
        var staged = parameters.TryGetProperty("staged", out var s) && s.GetBoolean();

        if (path != null)
            return $"Git diff: {Path.GetFileName(path)}";
        return staged ? "Git diff (staged)" : "Git diff";
    }

    #endregion
}
```

### 3. GitLogTool.cs

**Location**: `src/SeniorIntern.Services/Tools/Git/GitLogTool.cs`

```csharp
namespace SeniorIntern.Services.Tools.Git;

using System.Text;
using System.Text.Json;
using Microsoft.Extensions.Logging;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;
using SeniorIntern.Core.Tools;
using SeniorIntern.Services.Tools;

/// <summary>
/// Tool for viewing Git commit history.
/// </summary>
/// <remarks>
/// <para>
/// GitLogTool provides commit history with filtering:
/// </para>
/// <list type="bullet">
/// <item>Limit commit count</item>
/// <item>Filter by file path</item>
/// <item>Filter by author</item>
/// <item>Filter by date range</item>
/// </list>
/// </remarks>
public sealed class GitLogTool : ToolBase
{
    #region Tool Metadata

    public override string Id => "git-log";

    public override string Name => "Git Log";

    public override string Description => """
        View the Git commit history.
        Shows commit messages, authors, and dates.

        Use this to understand the history of changes and find specific commits.
        """;

    public override ToolCategory Category => ToolCategory.Git;

    public override RiskLevel DefaultRiskLevel => RiskLevel.Safe;

    public override IReadOnlyList<string> Tags => new[] { "git", "log", "history", "commits" };

    public override JsonSchema InputSchema => JsonSchemaBuilder.Create()
        .WithDescription("Parameters for git log")
        .AddInteger("count", "Number of commits to show (default: 10)", required: false)
        .AddString("path", "Show commits for a specific file or directory", required: false)
        .AddString("author", "Filter by author", required: false)
        .AddString("since", "Show commits since date (e.g., '2024-01-01', '1 week ago')", required: false)
        .AddBoolean("oneline", "Use one-line format (default: false)", required: false)
        .Build();

    #endregion

    #region Dependencies

    private readonly IGitService _gitService;
    private readonly IWorkspaceService _workspace;
    private readonly ILogger<GitLogTool> _logger;

    #endregion

    #region Constants

    /// <summary>
    /// Maximum commits to return.
    /// </summary>
    public const int MaxCommits = 100;

    /// <summary>
    /// Default number of commits.
    /// </summary>
    public const int DefaultCount = 10;

    #endregion

    public GitLogTool(
        IGitService gitService,
        IWorkspaceService workspace,
        ILogger<GitLogTool> logger)
    {
        _gitService = gitService ?? throw new ArgumentNullException(nameof(gitService));
        _workspace = workspace ?? throw new ArgumentNullException(nameof(workspace));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public override bool IsAvailable => _workspace.CurrentWorkspace != null;

    #region ExecuteAsync

    public override async Task<ToolResult> ExecuteAsync(
        ToolExecutionContext context,
        CancellationToken ct = default)
    {
        var count = Math.Min(
            GetOptionalParameter(context.Parameters, "count", DefaultCount),
            MaxCommits);
        var path = GetOptionalParameter<string?>(context.Parameters, "path", null);
        var author = GetOptionalParameter<string?>(context.Parameters, "author", null);
        var since = GetOptionalParameter<string?>(context.Parameters, "since", null);
        var oneline = GetOptionalParameter(context.Parameters, "oneline", false);

        var rootPath = context.WorkspacePath;

        _logger.LogDebug(
            "GitLogTool executing: count={Count}, path={Path}, author={Author}",
            count, path ?? "*", author ?? "*");

        // Check if Git repository
        if (!await _gitService.IsGitRepositoryAsync(rootPath!, ct))
        {
            return ToolResult.Failed("Not a Git repository");
        }

        try
        {
            var commits = await _gitService.GetLogAsync(rootPath!, new GitLogOptions
            {
                Count = count,
                Path = path,
                Author = author,
                Since = since
            }, ct);

            if (commits.Count == 0)
            {
                return ToolResult.Success(
                    "(no commits found)",
                    new GitLogData { CommitCount = 0 },
                    "No commits match the specified criteria");
            }

            var output = oneline
                ? FormatOneline(commits)
                : FormatFull(commits);

            var resultData = new GitLogData
            {
                CommitCount = commits.Count,
                OldestCommit = commits.Last().ShortHash,
                NewestCommit = commits.First().ShortHash
            };

            _logger.LogInformation(
                "GitLogTool success: {Count} commits",
                commits.Count);

            return ToolResult.Success(output, resultData, $"Showing {commits.Count} commits");
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Git log failed");
            return ToolResult.Failed($"Git log failed: {ex.Message}");
        }
    }

    #endregion

    #region Output Formatting

    /// <summary>
    /// Format commits in one-line format.
    /// </summary>
    private static string FormatOneline(List<GitCommit> commits)
    {
        var sb = new StringBuilder();
        foreach (var commit in commits)
        {
            sb.AppendLine($"{commit.ShortHash} {commit.Subject}");
        }
        return sb.ToString().TrimEnd();
    }

    /// <summary>
    /// Format commits in full format.
    /// </summary>
    private static string FormatFull(List<GitCommit> commits)
    {
        var sb = new StringBuilder();
        foreach (var commit in commits)
        {
            sb.AppendLine($"commit {commit.Hash}");
            sb.AppendLine($"Author: {commit.Author} <{commit.AuthorEmail}>");
            sb.AppendLine($"Date:   {commit.Date:ddd MMM d HH:mm:ss yyyy}");
            sb.AppendLine();
            sb.AppendLine($"    {commit.Subject}");

            if (!string.IsNullOrEmpty(commit.Body))
            {
                sb.AppendLine();
                foreach (var line in commit.Body.Split('\n'))
                {
                    sb.AppendLine($"    {line}");
                }
            }
            sb.AppendLine();
        }
        return sb.ToString().TrimEnd();
    }

    #endregion

    #region Overrides

    public override string GetExecutionSummary(JsonElement parameters)
    {
        var count = parameters.TryGetProperty("count", out var c) ? c.GetInt32() : DefaultCount;
        return $"Git log ({count} commits)";
    }

    #endregion
}
```

### 4. GitToolModels.cs

**Location**: `src/SeniorIntern.Services/Tools/Git/GitToolModels.cs`

```csharp
namespace SeniorIntern.Services.Tools.Git;

/// <summary>
/// Result data for git status.
/// </summary>
public sealed class GitStatusData
{
    /// <summary>Current branch name.</summary>
    public string Branch { get; init; } = string.Empty;

    /// <summary>Whether there are any changes.</summary>
    public bool HasChanges { get; init; }

    /// <summary>Number of staged files.</summary>
    public int StagedCount { get; init; }

    /// <summary>Number of modified files.</summary>
    public int ModifiedCount { get; init; }

    /// <summary>Number of deleted files.</summary>
    public int DeletedCount { get; init; }

    /// <summary>Number of untracked files.</summary>
    public int UntrackedCount { get; init; }

    /// <summary>Total changes count.</summary>
    public int TotalChanges => StagedCount + ModifiedCount + DeletedCount + UntrackedCount;
}

/// <summary>
/// Result data for git diff.
/// </summary>
public sealed class GitDiffData
{
    /// <summary>Whether there are changes.</summary>
    public bool HasChanges { get; init; }

    /// <summary>Number of files changed.</summary>
    public int FilesChanged { get; init; }

    /// <summary>Number of insertions.</summary>
    public int Insertions { get; init; }

    /// <summary>Number of deletions.</summary>
    public int Deletions { get; init; }

    /// <summary>Whether output was truncated.</summary>
    public bool WasTruncated { get; init; }

    /// <summary>Net lines changed.</summary>
    public int NetChange => Insertions - Deletions;
}

/// <summary>
/// Result data for git log.
/// </summary>
public sealed class GitLogData
{
    /// <summary>Number of commits returned.</summary>
    public int CommitCount { get; init; }

    /// <summary>Short hash of oldest commit.</summary>
    public string? OldestCommit { get; init; }

    /// <summary>Short hash of newest commit.</summary>
    public string? NewestCommit { get; init; }
}
```

### 5. IGitService.cs

**Location**: `src/SeniorIntern.Core/Interfaces/IGitService.cs`

```csharp
namespace SeniorIntern.Core.Interfaces;

using SeniorIntern.Core.Models;

/// <summary>
/// Service for Git operations.
/// </summary>
public interface IGitService
{
    /// <summary>
    /// Check if path is a Git repository.
    /// </summary>
    Task<bool> IsGitRepositoryAsync(string path, CancellationToken ct = default);

    /// <summary>
    /// Get current branch name.
    /// </summary>
    Task<string> GetCurrentBranchAsync(string path, CancellationToken ct = default);

    /// <summary>
    /// Get basic status (for workspace info).
    /// </summary>
    Task<GitStatus> GetStatusAsync(string path, CancellationToken ct = default);

    /// <summary>
    /// Get detailed status with file lists.
    /// </summary>
    Task<DetailedGitStatus> GetDetailedStatusAsync(string path, CancellationToken ct = default);

    /// <summary>
    /// Get diff output.
    /// </summary>
    Task<string> GetDiffAsync(string path, GitDiffOptions options, CancellationToken ct = default);

    /// <summary>
    /// Get commit history.
    /// </summary>
    Task<List<GitCommit>> GetLogAsync(string path, GitLogOptions options, CancellationToken ct = default);
}

/// <summary>
/// Basic git status.
/// </summary>
public sealed class GitStatus
{
    public bool HasChanges { get; init; }
    public int ModifiedCount { get; init; }
    public int UntrackedCount { get; init; }
}

/// <summary>
/// Detailed git status with file lists.
/// </summary>
public sealed class DetailedGitStatus
{
    public bool HasChanges => StagedFiles.Count + ModifiedFiles.Count +
                              DeletedFiles.Count + UntrackedFiles.Count > 0;
    public List<string> StagedFiles { get; init; } = new();
    public List<string> ModifiedFiles { get; init; } = new();
    public List<string> DeletedFiles { get; init; } = new();
    public List<string> UntrackedFiles { get; init; } = new();
}

/// <summary>
/// Options for git diff.
/// </summary>
public sealed class GitDiffOptions
{
    public string? Path { get; init; }
    public bool Staged { get; init; }
    public string? Commit { get; init; }
    public int ContextLines { get; init; } = 3;
}

/// <summary>
/// Options for git log.
/// </summary>
public sealed class GitLogOptions
{
    public int Count { get; init; } = 10;
    public string? Path { get; init; }
    public string? Author { get; init; }
    public string? Since { get; init; }
}

/// <summary>
/// A git commit.
/// </summary>
public sealed class GitCommit
{
    public string Hash { get; init; } = string.Empty;
    public string ShortHash => Hash.Length >= 7 ? Hash[..7] : Hash;
    public string Author { get; init; } = string.Empty;
    public string AuthorEmail { get; init; } = string.Empty;
    public DateTime Date { get; init; }
    public string Subject { get; init; } = string.Empty;
    public string? Body { get; init; }
}
```

---

## File Summary

| File | Location | Purpose | Lines |
|------|----------|---------|-------|
| `GitStatusTool.cs` | `Services/Tools/Git/` | Repository status | ~180 |
| `GitDiffTool.cs` | `Services/Tools/Git/` | File diffs | ~180 |
| `GitLogTool.cs` | `Services/Tools/Git/` | Commit history | ~180 |
| `GitToolModels.cs` | `Services/Tools/Git/` | Tool result models | ~70 |
| `IGitService.cs` | `Core/Interfaces/` | Git service interface | ~100 |
| `GitService.cs` | `Services/Git/` | Git service impl | ~200 |

---

## Unit Test Plan

| Test | Description |
|------|-------------|
| `GitStatusTool_CleanRepo_ShowsNoChanges` | Clean working tree |
| `GitStatusTool_ModifiedFiles_ShowsChanges` | Modified files listed |
| `GitStatusTool_ShortFormat_UsesGitCodes` | Short format output |
| `GitStatusTool_NotGitRepo_ReturnsFailed` | Non-Git directory |
| `GitDiffTool_UnstagedChanges_ShowsDiff` | Unstaged diff |
| `GitDiffTool_StagedChanges_ShowsDiff` | Staged diff |
| `GitDiffTool_NoChanges_ReturnsEmpty` | No changes |
| `GitDiffTool_LargeDiff_Truncates` | Truncation at 50KB |
| `GitLogTool_DefaultCount_Returns10` | Default commit count |
| `GitLogTool_AuthorFilter_FiltersCorrectly` | Author filtering |
| `GitLogTool_OnelineFormat_Compact` | Oneline format |
| `GitLogTool_PathFilter_ShowsFileHistory` | File-specific history |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | GitStatusTool shows repository status |
| AC-2 | GitDiffTool shows file changes |
| AC-3 | GitLogTool shows commit history |
| AC-4 | Filters work correctly (author, path, date) |
| AC-5 | Output is properly formatted |

---

## Changelog Entry

```markdown
## v0.6.3i - Git Tools

### Added
- `GitStatusTool` for repository status
  - Short and long format output
  - Staged, modified, deleted, untracked files
  - Current branch display
- `GitDiffTool` for viewing file changes
  - Unstaged and staged diffs
  - Commit comparison
  - Configurable context lines
  - Truncation at 50KB
  - Diff statistics (files, insertions, deletions)
- `GitLogTool` for commit history
  - Configurable commit count (max: 100)
  - Filter by path, author, date
  - Oneline and full formats
- `IGitService` interface for Git operations
- Git data models
  - `GitStatus`, `DetailedGitStatus`
  - `GitCommit`, `GitDiffOptions`, `GitLogOptions`
  - `GitStatusData`, `GitDiffData`, `GitLogData`
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.6.3i | 0.75 day |
