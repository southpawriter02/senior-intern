# Design Specification: AIntern v0.5.1a "Project Setup & Dependencies"

**Status**: _PLANNED_

## Executive Summary

This document provides a detailed implementation specification for v0.5.1a, which establishes the project infrastructure required for the terminal subsystem. This sub-part focuses on adding the Pty.Net NuGet package for cross-platform pseudo-terminal support, creating the folder structure for terminal-related code, and configuring project references. This is a prerequisite for all subsequent v0.5.1 parts (b through f).

### v0.5.1a Scope (from v0.5.1-terminal-foundation.md)

- Add **Pty.Net** package for cross-platform PTY support
- Add **System.IO.Pipelines** package for high-performance stream handling
- Create folder structure for terminal-related code in Core and Services projects
- Update project references to include new packages

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| Directory.Packages.props Update | Add Pty.Net 1.0.0 and System.IO.Pipelines 8.0.0 packages |
| AIntern.Services.csproj Update | Add PackageReference entries for terminal packages |
| Models/Terminal Folder | New folder in AIntern.Core for terminal model classes |
| Terminal Folder | New folder in AIntern.Core for terminal parsing logic |
| Services/Terminal Folder | New folder in AIntern.Services for terminal service implementations |

### Related Documents

- @v0.5.0-integrated-terminal.md - Parent design specification
- @v0.5.1-terminal-foundation.md - Sub-version specification with all parts (a-f)

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.5.1a Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  Package Management                                               │
│  ├── Directory.Packages.props                                     │
│  │   ├── Pty.Net 1.0.0                                           │
│  │   │   └── Cross-platform pseudo-terminal library              │
│  │   └── System.IO.Pipelines 8.0.0                               │
│  │       └── High-performance I/O for stream handling            │
│  │                                                                │
│  └── AIntern.Services.csproj                                      │
│      ├── PackageReference: Pty.Net                               │
│      └── PackageReference: System.IO.Pipelines                   │
│                                                                   │
│  Folder Structure                                                 │
│  ├── src/AIntern.Core/                                            │
│  │   ├── Models/Terminal/     (NEW)                              │
│  │   │   └── (placeholder for v0.5.1b models)                    │
│  │   └── Terminal/            (NEW)                              │
│  │       └── (placeholder for v0.5.1c parser)                    │
│  │                                                                │
│  └── src/AIntern.Services/                                        │
│      └── Terminal/            (NEW)                              │
│          └── (placeholder for v0.5.1d services)                  │
│                                                                   │
│  Verification                                                     │
│  ├── dotnet restore (package resolution)                         │
│  └── dotnet build (compilation success)                          │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Architecture Diagrams

### Package Dependency Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Package Dependency Flow                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              Directory.Packages.props                     │   │
│  │          (Central Package Version Management)             │   │
│  │                                                           │   │
│  │  <!-- Terminal Support (v0.5.1a) -->                      │   │
│  │  <PackageVersion Include="Pty.Net"                        │   │
│  │                  Version="1.0.0" />                       │   │
│  │  <PackageVersion Include="System.IO.Pipelines"            │   │
│  │                  Version="8.0.0" />                       │   │
│  └───────────────────────────┬──────────────────────────────┘   │
│                              │                                   │
│                              │ version lookup                    │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              AIntern.Services.csproj                      │   │
│  │                                                           │   │
│  │  <ItemGroup>                                              │   │
│  │    <!-- Existing references -->                           │   │
│  │    <PackageReference Include="LLamaSharp" />              │   │
│  │    <PackageReference Include="DiffPlex" />                │   │
│  │    ...                                                    │   │
│  │                                                           │   │
│  │    <!-- Terminal Support (v0.5.1a) -->                    │   │
│  │    <PackageReference Include="Pty.Net" />                 │   │
│  │    <PackageReference Include="System.IO.Pipelines" />     │   │
│  │  </ItemGroup>                                             │   │
│  └───────────────────────────┬──────────────────────────────┘   │
│                              │                                   │
│                              │ references                        │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    NuGet Packages                         │   │
│  │                                                           │   │
│  │  ┌─────────────────────┐   ┌──────────────────────────┐  │   │
│  │  │      Pty.Net        │   │  System.IO.Pipelines     │  │   │
│  │  │      1.0.0          │   │        8.0.0             │  │   │
│  │  │                     │   │                          │  │   │
│  │  │  Cross-platform     │   │  High-performance        │  │   │
│  │  │  pseudo-terminal    │   │  stream handling         │  │   │
│  │  │  - WinPTY (Windows) │   │  - PipeReader            │  │   │
│  │  │  - Native (Unix)    │   │  - PipeWriter            │  │   │
│  │  └─────────────────────┘   └──────────────────────────┘  │   │
│  │                                                           │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Folder Structure Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                    New Folder Structure                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  aintern/                                                        │
│  └── src/                                                        │
│      │                                                           │
│      ├── AIntern.Core/                                           │
│      │   ├── AIntern.Core.csproj                                 │
│      │   ├── Configuration/                                      │
│      │   ├── Entities/                                           │
│      │   ├── Enums/                                              │
│      │   ├── Events/                                             │
│      │   ├── Exceptions/                                         │
│      │   ├── Interfaces/                                         │
│      │   │   └── ITerminalService.cs          (v0.5.1d)          │
│      │   ├── Models/                                             │
│      │   │   ├── (existing models...)                            │
│      │   │   └── Terminal/                    ◄── NEW (v0.5.1a)  │
│      │   │       ├── TerminalSize.cs          (v0.5.1b)          │
│      │   │       ├── TerminalColor.cs         (v0.5.1b)          │
│      │   │       ├── TerminalAttributes.cs    (v0.5.1b)          │
│      │   │       ├── TerminalCell.cs          (v0.5.1b)          │
│      │   │       ├── TerminalLine.cs          (v0.5.1b)          │
│      │   │       ├── TerminalSelection.cs     (v0.5.1b)          │
│      │   │       ├── TerminalSessionState.cs  (v0.5.1b)          │
│      │   │       ├── TerminalSession.cs       (v0.5.1b)          │
│      │   │       └── TerminalBuffer.cs        (v0.5.1b)          │
│      │   ├── Terminal/                        ◄── NEW (v0.5.1a)  │
│      │   │   ├── AnsiParserState.cs           (v0.5.1c)          │
│      │   │   └── AnsiParser.cs                (v0.5.1c)          │
│      │   ├── Templates/                                          │
│      │   ├── Utilities/                                          │
│      │   └── Validation/                                         │
│      │                                                           │
│      └── AIntern.Services/                                       │
│          ├── AIntern.Services.csproj          ◄── MODIFIED       │
│          ├── Factories/                                          │
│          ├── Helpers/                                            │
│          ├── Streaming/                                          │
│          ├── (existing services...)                              │
│          └── Terminal/                        ◄── NEW (v0.5.1a)  │
│              ├── TerminalService.cs           (v0.5.1d)          │
│              └── ShellDetectionService.cs     (v0.5.1e)          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Project Reference Graph (After v0.5.1a)

```
┌─────────────────────────────────────────────────────────────────┐
│                Project Reference Graph                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────┐                                          │
│  │  AIntern.Desktop   │                                          │
│  └─────────┬──────────┘                                          │
│            │                                                     │
│            ▼                                                     │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    AIntern.Services                         │ │
│  │                                                             │ │
│  │  Package References:                                        │ │
│  │  ├── LLamaSharp                                             │ │
│  │  ├── LLamaSharp.Backend.Cpu                                 │ │
│  │  ├── System.Text.Json                                       │ │
│  │  ├── Microsoft.Extensions.Logging.Abstractions              │ │
│  │  ├── Serilog.Extensions.Logging                             │ │
│  │  ├── DiffPlex                                               │ │
│  │  ├── Pty.Net                    ◄── NEW (v0.5.1a)           │ │
│  │  └── System.IO.Pipelines        ◄── NEW (v0.5.1a)           │ │
│  │                                                             │ │
│  │  Project References:                                        │ │
│  │  ├── AIntern.Core                                           │ │
│  │  └── AIntern.Data                                           │ │
│  └───────────┬────────────────────────────────┬────────────────┘ │
│              │                                │                  │
│              ▼                                ▼                  │
│  ┌────────────────────┐          ┌────────────────────┐         │
│  │    AIntern.Core    │          │    AIntern.Data    │         │
│  │                    │◄─────────│                    │         │
│  │  (no external      │          │  (EF Core)         │         │
│  │   packages)        │          │                    │         │
│  └────────────────────┘          └────────────────────┘         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Detailed Design

### 1. Package Selection Rationale

#### 1.1 Pty.Net

**Package**: `Pty.Net` v1.0.0
**Source**: NuGet.org
**Purpose**: Cross-platform pseudo-terminal library

```
┌─────────────────────────────────────────────────────────────────┐
│                    Pty.Net Capabilities                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Platform Support:                                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │    Windows      │  │     macOS       │  │     Linux       │  │
│  │                 │  │                 │  │                 │  │
│  │  Uses WinPTY    │  │  Uses native    │  │  Uses native    │  │
│  │  or ConPTY      │  │  /dev/pty*      │  │  /dev/pty*      │  │
│  │  (Win10 1809+)  │  │                 │  │                 │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
│  Key Features:                                                   │
│  • PtyProvider.SpawnAsync() - Creates PTY processes             │
│  • IPtyConnection interface - Unified cross-platform API        │
│  • ReaderStream / WriterStream - Bidirectional I/O              │
│  • Resize() - Dynamic terminal dimension changes                │
│  • ExitCode - Process termination status                        │
│                                                                  │
│  Dependencies (transitive):                                      │
│  • System.Runtime.InteropServices                                │
│  • Microsoft.Win32.Registry (Windows only)                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**Why Pty.Net?**

| Consideration | Pty.Net | Alternative (Process + stdin/stdout) |
|--------------|---------|-------------------------------------|
| TTY emulation | Full PTY semantics | No TTY (piped I/O) |
| Signal handling | SIGINT, SIGTSTP, etc. | Limited |
| Resize support | Native TIOCSWINSZ | Not available |
| Interactive shells | Full support | May not work correctly |
| Cross-platform | Windows, macOS, Linux | Yes, but different behavior |
| Color/ANSI | Full support | May be disabled by shell |

#### 1.2 System.IO.Pipelines

**Package**: `System.IO.Pipelines` v8.0.0
**Source**: NuGet.org (Microsoft)
**Purpose**: High-performance asynchronous I/O

```
┌─────────────────────────────────────────────────────────────────┐
│                System.IO.Pipelines Benefits                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Traditional Stream-based I/O:                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  byte[] buffer = new byte[4096];                          │  │
│  │  while (true)                                             │  │
│  │  {                                                        │  │
│  │      int bytesRead = await stream.ReadAsync(buffer);      │  │
│  │      if (bytesRead == 0) break;                           │  │
│  │      // Process buffer[0..bytesRead]                      │  │
│  │      // Problem: What if data spans buffer boundaries?    │  │
│  │  }                                                        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  Pipeline-based I/O:                                             │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  while (true)                                             │  │
│  │  {                                                        │  │
│  │      ReadResult result = await reader.ReadAsync();        │  │
│  │      ReadOnlySequence<byte> buffer = result.Buffer;       │  │
│  │      // Examine buffer, consume what you can              │  │
│  │      // Unconsumed data remains for next read             │  │
│  │      reader.AdvanceTo(consumed, examined);                │  │
│  │  }                                                        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  Advantages:                                                     │
│  • Zero-copy data handling                                       │
│  • Back-pressure support                                         │
│  • Efficient memory management                                   │
│  • Handles fragmented data gracefully                            │
│  • Ideal for parsing ANSI escape sequences                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**Note**: While v0.5.1a adds this package, the actual usage will be implemented in v0.5.1d (TerminalService). Adding it now ensures dependencies are resolved before implementation begins.

---

### 2. Directory.Packages.props Modifications

#### 2.1 Current State

```xml
<Project>
  <PropertyGroup>
    <ManagePackageVersionsCentrally>true</ManagePackageVersionsCentrally>
  </PropertyGroup>

  <ItemGroup>
    <!-- Avalonia -->
    <PackageVersion Include="Avalonia" Version="11.2.1" />
    <!-- ... existing packages ... -->

    <!-- Diff (v0.4.2b) -->
    <PackageVersion Include="DiffPlex" Version="1.7.2" />

    <!-- Testing -->
    <PackageVersion Include="Microsoft.NET.Test.Sdk" Version="17.11.1" />
    <!-- ... -->
  </ItemGroup>
</Project>
```

#### 2.2 Required Changes

**Location**: Insert after the `<!-- Diff (v0.4.2b) -->` section, before `<!-- Testing -->`

```xml
    <!-- Diff (v0.4.2b) -->
    <PackageVersion Include="DiffPlex" Version="1.7.2" />

    <!-- Terminal Support (v0.5.1a) -->
    <PackageVersion Include="Pty.Net" Version="1.0.0" />
    <PackageVersion Include="System.IO.Pipelines" Version="8.0.0" />

    <!-- Testing -->
```

#### 2.3 Complete Updated File

```xml
<Project>
  <PropertyGroup>
    <ManagePackageVersionsCentrally>true</ManagePackageVersionsCentrally>
  </PropertyGroup>

  <ItemGroup>
    <!-- Avalonia -->
    <PackageVersion Include="Avalonia" Version="11.2.1" />
    <PackageVersion Include="Avalonia.Desktop" Version="11.2.1" />
    <PackageVersion Include="Avalonia.Themes.Fluent" Version="11.2.1" />
    <PackageVersion Include="Avalonia.Fonts.Inter" Version="11.2.1" />
    <PackageVersion Include="Avalonia.Diagnostics" Version="11.2.1" />

    <!-- Code Editor (v0.3.3) -->
    <PackageVersion Include="Avalonia.AvaloniaEdit" Version="11.3.0" />
    <PackageVersion Include="AvaloniaEdit.TextMate" Version="11.3.0" />

    <!-- MVVM -->
    <PackageVersion Include="CommunityToolkit.Mvvm" Version="8.3.2" />

    <!-- DI -->
    <PackageVersion Include="Microsoft.Extensions.DependencyInjection" Version="8.0.1" />
    <PackageVersion Include="Microsoft.Extensions.Logging.Abstractions" Version="8.0.2" />

    <!-- LLamaSharp -->
    <PackageVersion Include="LLamaSharp" Version="0.18.0" />
    <PackageVersion Include="LLamaSharp.Backend.Cpu" Version="0.18.0" />

    <!-- Markdown -->
    <PackageVersion Include="Markdown.Avalonia" Version="11.0.2" />

    <!-- JSON -->
    <PackageVersion Include="System.Text.Json" Version="8.0.5" />

    <!-- Entity Framework Core -->
    <PackageVersion Include="Microsoft.EntityFrameworkCore" Version="8.0.11" />
    <PackageVersion Include="Microsoft.EntityFrameworkCore.Sqlite" Version="8.0.11" />
    <PackageVersion Include="Microsoft.EntityFrameworkCore.Design" Version="8.0.11" />

    <!-- Logging -->
    <PackageVersion Include="Serilog" Version="4.0.2" />
    <PackageVersion Include="Serilog.Extensions.Logging" Version="8.0.0" />
    <PackageVersion Include="Serilog.Sinks.Console" Version="6.0.0" />
    <PackageVersion Include="Serilog.Sinks.File" Version="6.0.0" />

    <!-- Diff (v0.4.2b) -->
    <PackageVersion Include="DiffPlex" Version="1.7.2" />

    <!-- Terminal Support (v0.5.1a) -->
    <PackageVersion Include="Pty.Net" Version="1.0.0" />
    <PackageVersion Include="System.IO.Pipelines" Version="8.0.0" />

    <!-- Testing -->
    <PackageVersion Include="Microsoft.NET.Test.Sdk" Version="17.11.1" />
    <PackageVersion Include="Moq" Version="4.20.72" />
    <PackageVersion Include="xunit" Version="2.9.2" />
    <PackageVersion Include="xunit.runner.visualstudio" Version="2.8.2" />
  </ItemGroup>
</Project>
```

---

### 3. AIntern.Services.csproj Modifications

#### 3.1 Current State

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <RootNamespace>AIntern.Services</RootNamespace>
  </PropertyGroup>

  <!-- Allow internal members to be visible to test assembly -->
  <ItemGroup>
    <InternalsVisibleTo Include="AIntern.Services.Tests" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\AIntern.Core\AIntern.Core.csproj" />
    <ProjectReference Include="..\AIntern.Data\AIntern.Data.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="LLamaSharp" />
    <PackageReference Include="LLamaSharp.Backend.Cpu" />
    <PackageReference Include="System.Text.Json" />
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" />
    <PackageReference Include="Serilog.Extensions.Logging" />
    <PackageReference Include="DiffPlex" />
  </ItemGroup>

</Project>
```

#### 3.2 Required Changes

Add two PackageReference entries to the existing ItemGroup:

```xml
    <!-- Terminal Support (v0.5.1a) -->
    <PackageReference Include="Pty.Net" />
    <PackageReference Include="System.IO.Pipelines" />
```

#### 3.3 Complete Updated File

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <RootNamespace>AIntern.Services</RootNamespace>
  </PropertyGroup>

  <!-- Allow internal members to be visible to test assembly -->
  <ItemGroup>
    <InternalsVisibleTo Include="AIntern.Services.Tests" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\AIntern.Core\AIntern.Core.csproj" />
    <ProjectReference Include="..\AIntern.Data\AIntern.Data.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="LLamaSharp" />
    <PackageReference Include="LLamaSharp.Backend.Cpu" />
    <PackageReference Include="System.Text.Json" />
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" />
    <PackageReference Include="Serilog.Extensions.Logging" />
    <PackageReference Include="DiffPlex" />

    <!-- Terminal Support (v0.5.1a) -->
    <PackageReference Include="Pty.Net" />
    <PackageReference Include="System.IO.Pipelines" />
  </ItemGroup>

</Project>
```

---

### 4. Folder Structure Creation

#### 4.1 New Directories

The following directories must be created:

| Directory Path | Purpose | Contents (Future) |
|----------------|---------|-------------------|
| `src/AIntern.Core/Models/Terminal/` | Terminal model classes | TerminalSession, TerminalBuffer, etc. (v0.5.1b) |
| `src/AIntern.Core/Terminal/` | Terminal parsing logic | AnsiParser, AnsiParserState (v0.5.1c) |
| `src/AIntern.Services/Terminal/` | Terminal service implementations | TerminalService, ShellDetectionService (v0.5.1d-e) |

#### 4.2 Placeholder Files

To ensure the directories are tracked by git (git does not track empty directories), create minimal placeholder files:

##### 4.2.1 src/AIntern.Core/Models/Terminal/.gitkeep

```
# Terminal Models (v0.5.1b)
# This folder will contain terminal-related model classes:
# - TerminalSize.cs
# - TerminalColor.cs
# - TerminalAttributes.cs
# - TerminalCell.cs
# - TerminalLine.cs
# - TerminalSelection.cs
# - TerminalSessionState.cs
# - TerminalSession.cs
# - TerminalBuffer.cs
```

##### 4.2.2 src/AIntern.Core/Terminal/.gitkeep

```
# Terminal Parsing (v0.5.1c)
# This folder will contain ANSI/VT100 escape sequence parsing:
# - AnsiParserState.cs
# - AnsiParser.cs
```

##### 4.2.3 src/AIntern.Services/Terminal/.gitkeep

```
# Terminal Services (v0.5.1d-e)
# This folder will contain terminal service implementations:
# - TerminalService.cs
# - ShellDetectionService.cs
```

**Alternative**: Instead of .gitkeep files, create README.md files in each directory with documentation about the intended contents.

---

### 5. Namespace Conventions

The following namespace conventions will be used for terminal code:

| Location | Namespace | Example Types |
|----------|-----------|---------------|
| Core/Models/Terminal/ | `AIntern.Core.Models.Terminal` | TerminalSession, TerminalBuffer |
| Core/Terminal/ | `AIntern.Core.Terminal` | AnsiParser, AnsiParserState |
| Core/Interfaces/ | `AIntern.Core.Interfaces` | ITerminalService |
| Services/Terminal/ | `AIntern.Services.Terminal` | TerminalService, ShellDetectionService |

This follows the existing project conventions where:
- Models are namespaced under `AIntern.Core.Models.*`
- Interfaces are namespaced under `AIntern.Core.Interfaces`
- Service implementations are namespaced under `AIntern.Services.*`

---

## Implementation Checklist

### Files to Modify

| File | Changes | Verification |
|------|---------|--------------|
| `Directory.Packages.props` | Add Pty.Net and System.IO.Pipelines package versions | Package restore succeeds |
| `src/AIntern.Services/AIntern.Services.csproj` | Add PackageReference entries | Project compiles |

### Directories to Create

| Directory | Purpose |
|-----------|---------|
| `src/AIntern.Core/Models/Terminal/` | Terminal model classes |
| `src/AIntern.Core/Terminal/` | ANSI parser logic |
| `src/AIntern.Services/Terminal/` | Terminal services |

### Files to Create

| File | Purpose |
|------|---------|
| `src/AIntern.Core/Models/Terminal/.gitkeep` | Git tracking placeholder |
| `src/AIntern.Core/Terminal/.gitkeep` | Git tracking placeholder |
| `src/AIntern.Services/Terminal/.gitkeep` | Git tracking placeholder |

---

## Verification Commands

### Step 1: Package Restoration

```bash
# Restore all packages to verify Directory.Packages.props is valid
dotnet restore AIntern.sln
```

**Expected Output**:
- No errors
- Pty.Net 1.0.0 and System.IO.Pipelines 8.0.0 resolved

### Step 2: Services Project Build

```bash
# Build Services project to verify package references work
dotnet build src/AIntern.Services/AIntern.Services.csproj
```

**Expected Output**:
- Build succeeded
- 0 errors, 0 warnings (or only pre-existing warnings)

### Step 3: Full Solution Build

```bash
# Build entire solution to ensure no regressions
dotnet build AIntern.sln
```

**Expected Output**:
- Build succeeded for all projects

### Step 4: Directory Verification

```bash
# Verify new directories exist
ls -la src/AIntern.Core/Models/Terminal/
ls -la src/AIntern.Core/Terminal/
ls -la src/AIntern.Services/Terminal/
```

**Expected Output**:
- Each directory exists and contains .gitkeep (or README.md)

---

## Post-Implementation Notes

### Next Steps (v0.5.1b)

After v0.5.1a is complete, v0.5.1b will implement the terminal models in `src/AIntern.Core/Models/Terminal/`:

- TerminalSize.cs
- TerminalColor.cs
- TerminalAttributes.cs
- TerminalCell.cs
- TerminalLine.cs
- TerminalSelection.cs
- TerminalSessionState.cs
- TerminalSession.cs
- TerminalBuffer.cs

### Rollback Procedure

If v0.5.1a needs to be rolled back:

1. Remove PackageReference entries from `AIntern.Services.csproj`
2. Remove PackageVersion entries from `Directory.Packages.props`
3. Delete the three new directories (if no other content has been added)
4. Run `dotnet restore` to update lock files

---

## Appendix A: Pty.Net API Overview

For reference during v0.5.1d implementation:

```csharp
// Key types from Pty.Net
namespace Pty.Net
{
    public static class PtyProvider
    {
        public static Task<IPtyConnection> SpawnAsync(
            PtyOptions options,
            CancellationToken cancellationToken = default);
    }

    public class PtyOptions
    {
        public string Name { get; set; }
        public int Cols { get; set; }
        public int Rows { get; set; }
        public string Cwd { get; set; }
        public string App { get; set; }
        public string[] CommandLine { get; set; }
        public IDictionary<string, string> Environment { get; set; }
    }

    public interface IPtyConnection : IDisposable
    {
        Stream ReaderStream { get; }
        Stream WriterStream { get; }
        int Pid { get; }
        int ExitCode { get; }
        void Resize(int cols, int rows);
        void Kill();
        bool WaitForExit(int milliseconds);
        event EventHandler<PtyExitedEventArgs> ProcessExited;
    }
}
```

---

## Appendix B: Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-17 | Initial specification |
