# Design Specification: AIntern v0.5.3f "File Explorer Integration"

## Overview

**Version**: v0.5.3f
**Parent**: v0.5.3 Shell Integration
**Focus**: Context menu integration, shell selector UI, terminal settings panel

### Purpose

This sub-version integrates the terminal with the file explorer and settings:
1. "Open in Integrated Terminal" context menu in file explorer
2. Shell profile selector dialog for choosing terminal profile
3. Terminal settings section in the application settings view
4. Messenger-based communication for showing terminal panel
5. Dynamic profile sub-menu in context menu

### Dependencies

**From v0.5.3d (Profile Management)**:
- `IShellProfileService` - GetVisibleProfilesAsync, CreateProfileAsync, SetDefaultProfileAsync

**From v0.5.3e (Working Directory Sync)**:
- `IWorkingDirectorySyncService` - LinkToWorkspace

**From v0.5.1 (Terminal Foundation)**:
- `ITerminalService` - CreateSessionAsync

**From Existing Codebase**:
- `FileExplorerViewModel` - Extended with terminal commands
- `SettingsViewModel` - Extended with terminal settings
- CommunityToolkit.Mvvm - Messenger for panel communication

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  v0.5.3f File Explorer Integration Architecture               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Presentation Layer                                   â”‚ â”‚
â”‚  â”‚  src/AIntern.Desktop/                                                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Context Menu Integration                                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  FileExplorerView.axaml                                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€ TreeView.ContextMenu                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      â”œâ”€â”€ "Open in Integrated Terminal" (default profile)       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚      â””â”€â”€ "Open in Terminal..." (profile sub-menu)              â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Shell Selector Dialog                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  ShellSelectorViewModel                                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Profiles: ObservableCollection<ShellProfile>              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ SelectedProfile: ShellProfile?                            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ ShowNewProfileForm: bool                                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ NewProfile fields (Name, Path, Arguments)                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€ Commands: Load, Select, Create, Delete, SetDefault        â”‚    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ â”‚
â”‚  â”‚  â”‚  ShellSelectorView.axaml                                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Profile list with selection                               â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ New profile form (toggle visibility)                      â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€ Action buttons (New Profile, Create, Cancel)              â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  Terminal Settings Section                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚  SettingsView.axaml (Terminal Expander)                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Default Profile selector                                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Font Family + Size                                         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Color Theme                                                â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Cursor Style + Blink                                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Scrollback Lines                                           â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Directory Synchronization toggle + mode                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ Keyboard Shortcuts (Toggle, New)                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€ "Manage Profiles..." button                               â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Messaging Layer                                      â”‚ â”‚
â”‚  â”‚  src/AIntern.Desktop/Messages/                                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  ShowTerminalPanelMessage                                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Purpose: Signal MainWindow to show/focus terminal panel           â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Usage: Messenger.Send(new ShowTerminalPanelMessage())             â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  OpenTerminalMessage                                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ProfileId: Guid                                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ WorkingDirectory: string                                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Purpose: Request terminal creation with specific profile          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Context Menu Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    File Explorer Context Menu Structure                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Right-click on FOLDER:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚  â”‚
â”‚  â”‚  â”‚  Open                       â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  Open in New Tab            â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  Copy                       â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  Cut                        â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  Delete                     â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  Rename                     â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                       â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ–¥ï¸ Open in Integrated Terminal  â† Uses default profile            â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ–¥ï¸ Open in Terminal...     â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚                               â”‚  PowerShell      â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚                               â”‚  Zsh             â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚                               â”‚  Git Bash        â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚                               â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚                               â”‚  Select Profile... â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Right-click on FILE:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Same menu but opens terminal at FILE'S PARENT DIRECTORY               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Shell Selector Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Shell Selector Dialog Layout                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                 Select Terminal Profile                 â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚  â”‚  â”‚ [P] PowerShell (Default)                      â—  â”‚  â”‚ â† Selected      â”‚
â”‚  â”‚  â”‚     C:\Program Files\PowerShell\7\pwsh.exe       â”‚  â”‚                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚  â”‚  â”‚ [Z] Zsh                                           â”‚  â”‚                  â”‚
â”‚  â”‚  â”‚     /bin/zsh                                      â”‚  â”‚                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
â”‚  â”‚  â”‚ [G] Git Bash                                      â”‚  â”‚                  â”‚
â”‚  â”‚  â”‚     C:\Program Files\Git\bin\bash.exe             â”‚  â”‚                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚                                    [New Profile]       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                              â”‚
â”‚  New Profile Form (when ShowNewProfileForm = true):                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Profile Name: [____________________________]          â”‚                  â”‚
â”‚  â”‚  Shell Path:   [____________________________] [...]    â”‚                  â”‚
â”‚  â”‚  Arguments:    [____________________________]          â”‚                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”‚  âš ï¸ Invalid shell path (validation error)              â”‚                  â”‚
â”‚  â”‚                                                         â”‚                  â”‚
â”‚  â”‚                              [Cancel]  [Create]         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Specifications

### 1. ShowTerminalPanelMessage.cs

**Location**: `src/AIntern.Desktop/Messages/ShowTerminalPanelMessage.cs`

```csharp
namespace AIntern.Desktop.Messages;

using CommunityToolkit.Mvvm.Messaging.Messages;

/// <summary>
/// Message to request showing/focusing the terminal panel.
/// </summary>
public sealed class ShowTerminalPanelMessage : ValueChangedMessage<bool>
{
    public ShowTerminalPanelMessage() : base(true) { }
}
```

### 2. OpenTerminalMessage.cs

**Location**: `src/AIntern.Desktop/Messages/OpenTerminalMessage.cs`

```csharp
namespace AIntern.Desktop.Messages;

/// <summary>
/// Message to request opening a new terminal with a specific profile.
/// </summary>
public sealed class OpenTerminalMessage
{
    /// <summary>Profile ID to use (null for default).</summary>
    public Guid? ProfileId { get; init; }

    /// <summary>Working directory for the new terminal.</summary>
    public string WorkingDirectory { get; init; } = string.Empty;

    /// <summary>Optional workspace ID to link the terminal to.</summary>
    public Guid? WorkspaceId { get; init; }
}
```

### 3. ShellSelectorViewModel.cs

**Location**: `src/AIntern.Desktop/ViewModels/ShellSelectorViewModel.cs`

```csharp
namespace AIntern.Desktop.ViewModels;

using System.Collections.ObjectModel;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using AIntern.Core.Interfaces;
using AIntern.Core.Models.Terminal;

/// <summary>
/// ViewModel for the shell profile selector dialog.
/// </summary>
public partial class ShellSelectorViewModel : ViewModelBase
{
    private readonly IShellProfileService _profileService;
    private readonly IShellDetectionService _shellDetection;

    [ObservableProperty]
    private ObservableCollection<ShellProfile> _profiles = new();

    [ObservableProperty]
    private ShellProfile? _selectedProfile;

    [ObservableProperty]
    private bool _showNewProfileForm;

    [ObservableProperty]
    private string _newProfileName = string.Empty;

    [ObservableProperty]
    private string _newProfilePath = string.Empty;

    [ObservableProperty]
    private string _newProfileArguments = string.Empty;

    [ObservableProperty]
    private string? _validationError;

    /// <summary>
    /// Result of dialog: the selected profile (null if cancelled).
    /// </summary>
    public ShellProfile? Result { get; private set; }

    /// <summary>
    /// Indicates whether dialog was confirmed.
    /// </summary>
    public bool IsConfirmed { get; private set; }

    public ShellSelectorViewModel(
        IShellProfileService profileService,
        IShellDetectionService shellDetection)
    {
        _profileService = profileService;
        _shellDetection = shellDetection;
    }

    [RelayCommand]
    public async Task LoadProfilesAsync()
    {
        var profiles = await _profileService.GetVisibleProfilesAsync();
        Profiles = new ObservableCollection<ShellProfile>(profiles);

        SelectedProfile = Profiles.FirstOrDefault(p => p.IsDefault)
                          ?? Profiles.FirstOrDefault();
    }

    [RelayCommand]
    private void SelectProfile(ShellProfile profile)
    {
        SelectedProfile = profile;
    }

    [RelayCommand]
    private void ConfirmSelection()
    {
        Result = SelectedProfile;
        IsConfirmed = true;
    }

    [RelayCommand]
    private void ShowNewProfile()
    {
        ShowNewProfileForm = true;
        NewProfileName = string.Empty;
        NewProfilePath = string.Empty;
        NewProfileArguments = string.Empty;
        ValidationError = null;
    }

    [RelayCommand]
    private void CancelNewProfile()
    {
        ShowNewProfileForm = false;
        ValidationError = null;
    }

    [RelayCommand]
    private async Task CreateProfileAsync()
    {
        ValidationError = null;

        if (string.IsNullOrWhiteSpace(NewProfileName))
        {
            ValidationError = "Profile name is required";
            return;
        }

        if (string.IsNullOrWhiteSpace(NewProfilePath))
        {
            ValidationError = "Shell path is required";
            return;
        }

        if (!_shellDetection.ValidateShellPath(NewProfilePath))
        {
            ValidationError = "Invalid shell path - file does not exist or is not executable";
            return;
        }

        try
        {
            var profile = new ShellProfile
            {
                Name = NewProfileName.Trim(),
                ShellPath = NewProfilePath.Trim(),
                Arguments = string.IsNullOrWhiteSpace(NewProfileArguments)
                    ? null
                    : NewProfileArguments.Trim(),
                ShellType = _shellDetection.DetectShellType(NewProfilePath)
            };

            var created = await _profileService.CreateProfileAsync(profile);
            await LoadProfilesAsync();

            ShowNewProfileForm = false;
            SelectedProfile = Profiles.FirstOrDefault(p => p.Id == created.Id);
        }
        catch (Exception ex)
        {
            ValidationError = ex.Message;
        }
    }

    [RelayCommand]
    private async Task SetAsDefaultAsync(ShellProfile profile)
    {
        await _profileService.SetDefaultProfileAsync(profile.Id);
        await LoadProfilesAsync();
    }

    [RelayCommand]
    private async Task DeleteProfileAsync(ShellProfile profile)
    {
        if (profile.IsBuiltIn)
            return;

        await _profileService.DeleteProfileAsync(profile.Id);
        await LoadProfilesAsync();
    }

    [RelayCommand]
    private async Task DuplicateProfileAsync(ShellProfile profile)
    {
        var duplicate = await _profileService.DuplicateProfileAsync(profile.Id);
        await LoadProfilesAsync();
        SelectedProfile = Profiles.FirstOrDefault(p => p.Id == duplicate.Id);
    }
}
```

### 4. ShellSelectorView.axaml

**Location**: `src/AIntern.Desktop/Views/ShellSelectorView.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AIntern.Desktop.ViewModels"
             xmlns:models="using:AIntern.Core.Models.Terminal"
             x:Class="AIntern.Desktop.Views.ShellSelectorView"
             x:DataType="vm:ShellSelectorViewModel">

    <Border Background="{DynamicResource BackgroundBrush}"
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8"
            Padding="16"
            Width="420"
            MaxHeight="500">
        <Grid RowDefinitions="Auto,*,Auto">
            <!-- Header -->
            <TextBlock Grid.Row="0"
                       Text="Select Terminal Profile"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Margin="0,0,0,16" />

            <!-- Content Area -->
            <Panel Grid.Row="1">
                <!-- Profile List -->
                <ScrollViewer IsVisible="{Binding !ShowNewProfileForm}">
                    <ItemsControl ItemsSource="{Binding Profiles}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:ShellProfile">
                                <Button HorizontalAlignment="Stretch"
                                        Padding="12,10"
                                        Margin="0,0,0,6"
                                        Background="Transparent"
                                        BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        CornerRadius="6"
                                        Command="{Binding $parent[UserControl].((vm:ShellSelectorViewModel)DataContext).SelectProfileCommand}"
                                        CommandParameter="{Binding}">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Profile Icon -->
                                        <Border Grid.Column="0"
                                                Width="40"
                                                Height="40"
                                                Background="{DynamicResource AccentBrush}"
                                                CornerRadius="6"
                                                Margin="0,0,12,0">
                                            <TextBlock Text="{Binding Name[0]}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Foreground="White"
                                                       FontSize="18"
                                                       FontWeight="Bold" />
                                        </Border>

                                        <!-- Name and Path -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Name}"
                                                           FontWeight="Medium"
                                                           FontSize="14" />
                                                <Border IsVisible="{Binding IsDefault}"
                                                        Background="{DynamicResource AccentBrush}"
                                                        CornerRadius="4"
                                                        Padding="6,2">
                                                    <TextBlock Text="Default"
                                                               Foreground="White"
                                                               FontSize="10" />
                                                </Border>
                                                <Border IsVisible="{Binding IsBuiltIn}"
                                                        Background="{DynamicResource SecondaryBrush}"
                                                        CornerRadius="4"
                                                        Padding="6,2">
                                                    <TextBlock Text="Built-in"
                                                               FontSize="10"
                                                               Opacity="0.7" />
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{Binding ShellPath}"
                                                       FontSize="11"
                                                       Opacity="0.6"
                                                       TextTrimming="CharacterEllipsis"
                                                       MaxWidth="280" />
                                        </StackPanel>

                                        <!-- Context Menu Button -->
                                        <Button Grid.Column="2"
                                                Content="â‹®"
                                                Background="Transparent"
                                                Padding="8,4"
                                                VerticalAlignment="Center">
                                            <Button.Flyout>
                                                <MenuFlyout>
                                                    <MenuItem Header="Set as Default"
                                                              Command="{Binding $parent[UserControl].((vm:ShellSelectorViewModel)DataContext).SetAsDefaultCommand}"
                                                              CommandParameter="{Binding}" />
                                                    <MenuItem Header="Duplicate"
                                                              Command="{Binding $parent[UserControl].((vm:ShellSelectorViewModel)DataContext).DuplicateProfileCommand}"
                                                              CommandParameter="{Binding}" />
                                                    <Separator />
                                                    <MenuItem Header="Delete"
                                                              Command="{Binding $parent[UserControl].((vm:ShellSelectorViewModel)DataContext).DeleteProfileCommand}"
                                                              CommandParameter="{Binding}"
                                                              IsEnabled="{Binding !IsBuiltIn}" />
                                                </MenuFlyout>
                                            </Button.Flyout>
                                        </Button>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- New Profile Form -->
                <StackPanel IsVisible="{Binding ShowNewProfileForm}" Spacing="16">
                    <StackPanel Spacing="4">
                        <TextBlock Text="Profile Name" FontWeight="Medium" FontSize="12" />
                        <TextBox Text="{Binding NewProfileName}"
                                 Watermark="e.g., My PowerShell" />
                    </StackPanel>

                    <StackPanel Spacing="4">
                        <TextBlock Text="Shell Path" FontWeight="Medium" FontSize="12" />
                        <TextBox Text="{Binding NewProfilePath}"
                                 Watermark="e.g., /bin/zsh or C:\Windows\System32\cmd.exe" />
                    </StackPanel>

                    <StackPanel Spacing="4">
                        <TextBlock Text="Arguments (optional)" FontWeight="Medium" FontSize="12" />
                        <TextBox Text="{Binding NewProfileArguments}"
                                 Watermark="e.g., --login" />
                    </StackPanel>

                    <TextBlock Text="{Binding ValidationError}"
                               Foreground="{DynamicResource ErrorBrush}"
                               IsVisible="{Binding ValidationError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               FontSize="12" />
                </StackPanel>
            </Panel>

            <!-- Footer -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,16,0,0"
                        Spacing="8">
                <Button Content="New Profile"
                        Command="{Binding ShowNewProfileCommand}"
                        IsVisible="{Binding !ShowNewProfileForm}" />

                <Button Content="Cancel"
                        Command="{Binding CancelNewProfileCommand}"
                        IsVisible="{Binding ShowNewProfileForm}" />

                <Button Content="Create"
                        Command="{Binding CreateProfileCommand}"
                        IsVisible="{Binding ShowNewProfileForm}"
                        Classes="primary" />

                <Button Content="Open"
                        Command="{Binding ConfirmSelectionCommand}"
                        IsVisible="{Binding !ShowNewProfileForm}"
                        Classes="primary" />
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
```

### 5. ShellSelectorView.axaml.cs

**Location**: `src/AIntern.Desktop/Views/ShellSelectorView.axaml.cs`

```csharp
namespace AIntern.Desktop.Views;

using Avalonia.Controls;

public partial class ShellSelectorView : UserControl
{
    public ShellSelectorView()
    {
        InitializeComponent();
    }
}
```

### 6. FileExplorerViewModel Extensions

**File to Modify**: `src/AIntern.Desktop/ViewModels/FileExplorerViewModel.cs`

Add the following members and commands:

```csharp
// === Dependencies (add to constructor) ===
private readonly IShellProfileService _shellProfileService;
private readonly ITerminalService _terminalService;
private readonly IWorkingDirectorySyncService _directorySyncService;

// === Observable Properties ===

[ObservableProperty]
private ObservableCollection<ShellProfile> _availableProfiles = new();

// === Commands ===

/// <summary>
/// Open the selected item's directory in terminal with default profile.
/// </summary>
[RelayCommand]
private async Task OpenInTerminalAsync(FileSystemItem? item)
{
    var path = GetTerminalPath(item);
    if (string.IsNullOrEmpty(path))
        return;

    var profile = await _shellProfileService.GetDefaultProfileAsync();
    await OpenTerminalWithProfileAsync(profile, path);
}

/// <summary>
/// Open terminal with a specific profile.
/// </summary>
[RelayCommand]
private async Task OpenInTerminalWithProfileAsync(ShellProfile profile)
{
    var path = GetTerminalPath(SelectedItem);
    if (string.IsNullOrEmpty(path))
        return;

    await OpenTerminalWithProfileAsync(profile, path);
}

/// <summary>
/// Show shell selector dialog.
/// </summary>
[RelayCommand]
private async Task ShowShellSelectorAsync()
{
    // This would show the ShellSelectorView as a dialog
    // Implementation depends on dialog service
}

// === Helper Methods ===

private string? GetTerminalPath(FileSystemItem? item)
{
    if (item == null)
        return CurrentDirectory;

    return item.IsDirectory
        ? item.FullPath
        : Path.GetDirectoryName(item.FullPath) ?? CurrentDirectory;
}

private async Task OpenTerminalWithProfileAsync(ShellProfile profile, string directory)
{
    var session = await _terminalService.CreateSessionAsync(new TerminalSessionOptions
    {
        ShellPath = profile.ShellPath,
        Arguments = profile.Arguments,
        WorkingDirectory = directory,
        Environment = profile.Environment,
        Name = profile.Name
    });

    // Link to current workspace if available
    if (CurrentWorkspace != null)
    {
        _directorySyncService.LinkToWorkspace(session.Id, CurrentWorkspace.Id);
    }

    // Show terminal panel
    WeakReferenceMessenger.Default.Send(new ShowTerminalPanelMessage());
}

/// <summary>
/// Refresh available profiles for context menu.
/// </summary>
public async Task RefreshProfilesAsync()
{
    var profiles = await _shellProfileService.GetVisibleProfilesAsync();
    AvailableProfiles = new ObservableCollection<ShellProfile>(profiles);
}
```

### 7. SettingsViewModel Extensions

**File to Modify**: `src/AIntern.Desktop/ViewModels/SettingsViewModel.cs`

Add the following members:

```csharp
// === Dependencies ===
private readonly IShellProfileService _shellProfileService;

// === Observable Properties for Terminal Settings ===

[ObservableProperty]
private ObservableCollection<ShellProfile> _shellProfiles = new();

[ObservableProperty]
private ShellProfile? _selectedDefaultProfile;

[ObservableProperty]
private string _terminalFontFamily = "Cascadia Mono, Consolas, monospace";

[ObservableProperty]
private double _terminalFontSize = 14;

[ObservableProperty]
private string _terminalTheme = "Dark";

[ObservableProperty]
private TerminalCursorStyle _terminalCursorStyle = TerminalCursorStyle.Block;

[ObservableProperty]
private bool _terminalCursorBlink = true;

[ObservableProperty]
private int _terminalScrollbackLines = 10000;

[ObservableProperty]
private bool _syncTerminalWithWorkspace = true;

[ObservableProperty]
private DirectorySyncMode _terminalSyncMode = DirectorySyncMode.ActiveTerminalOnly;

[ObservableProperty]
private string _terminalToggleShortcut = "Ctrl+`";

[ObservableProperty]
private string _terminalNewShortcut = "Ctrl+Shift+`";

// === Enum Sources for ComboBoxes ===

public IEnumerable<TerminalCursorStyle> CursorStyles =>
    Enum.GetValues<TerminalCursorStyle>();

public IEnumerable<DirectorySyncMode> DirectorySyncModes =>
    Enum.GetValues<DirectorySyncMode>();

public IEnumerable<string> TerminalThemes => new[]
{
    "Dark", "Light", "Solarized Dark", "Solarized Light",
    "Monokai", "One Dark", "Dracula", "Nord"
};

public IEnumerable<string> AvailableFonts => new[]
{
    "Cascadia Mono", "Consolas", "Fira Code", "JetBrains Mono",
    "SF Mono", "Source Code Pro", "Ubuntu Mono", "Monaco"
};

// === Commands ===

[RelayCommand]
private async Task LoadTerminalSettingsAsync()
{
    var settings = await _settingsService.GetSettingsAsync();

    TerminalFontFamily = settings.TerminalFontFamily;
    TerminalFontSize = settings.TerminalFontSize;
    TerminalTheme = settings.TerminalTheme;
    TerminalCursorStyle = settings.TerminalCursorStyle;
    TerminalCursorBlink = settings.TerminalCursorBlink;
    TerminalScrollbackLines = settings.TerminalScrollbackLines;
    SyncTerminalWithWorkspace = settings.SyncTerminalWithWorkspace;
    TerminalSyncMode = settings.TerminalSyncMode;
    TerminalToggleShortcut = settings.TerminalToggleShortcut;
    TerminalNewShortcut = settings.TerminalNewShortcut;

    var profiles = await _shellProfileService.GetVisibleProfilesAsync();
    ShellProfiles = new ObservableCollection<ShellProfile>(profiles);

    SelectedDefaultProfile = profiles.FirstOrDefault(p => p.Id == settings.DefaultShellProfileId)
                             ?? profiles.FirstOrDefault(p => p.IsDefault);
}

[RelayCommand]
private async Task SaveTerminalSettingsAsync()
{
    var settings = await _settingsService.GetSettingsAsync();

    settings.TerminalFontFamily = TerminalFontFamily;
    settings.TerminalFontSize = TerminalFontSize;
    settings.TerminalTheme = TerminalTheme;
    settings.TerminalCursorStyle = TerminalCursorStyle;
    settings.TerminalCursorBlink = TerminalCursorBlink;
    settings.TerminalScrollbackLines = TerminalScrollbackLines;
    settings.SyncTerminalWithWorkspace = SyncTerminalWithWorkspace;
    settings.TerminalSyncMode = TerminalSyncMode;
    settings.TerminalToggleShortcut = TerminalToggleShortcut;
    settings.TerminalNewShortcut = TerminalNewShortcut;

    if (SelectedDefaultProfile != null)
    {
        settings.DefaultShellProfileId = SelectedDefaultProfile.Id;
        await _shellProfileService.SetDefaultProfileAsync(SelectedDefaultProfile.Id);
    }

    await _settingsService.SaveSettingsAsync(settings);
}

[RelayCommand]
private async Task OpenProfileManagerAsync()
{
    // Show profile management dialog
}

// === Property Changed Handlers ===

partial void OnSelectedDefaultProfileChanged(ShellProfile? value)
{
    if (value != null)
    {
        _ = SaveTerminalSettingsAsync();
    }
}
```

---

## File Summary

| File | Location | Purpose |
|------|----------|---------|
| `ShowTerminalPanelMessage.cs` | `src/AIntern.Desktop/Messages/` | Panel visibility message |
| `OpenTerminalMessage.cs` | `src/AIntern.Desktop/Messages/` | Terminal creation request |
| `ShellSelectorViewModel.cs` | `src/AIntern.Desktop/ViewModels/` | Shell selector ViewModel |
| `ShellSelectorView.axaml` | `src/AIntern.Desktop/Views/` | Shell selector UI |
| `ShellSelectorView.axaml.cs` | `src/AIntern.Desktop/Views/` | Code-behind |

### Files to Modify

| File | Changes |
|------|---------|
| `FileExplorerViewModel.cs` | Add terminal commands, profile loading |
| `FileExplorerView.axaml` | Add context menu items for terminal |
| `SettingsViewModel.cs` | Add terminal settings properties and commands |
| `SettingsView.axaml` | Add terminal settings section |
| `Assets/Icons.axaml` | Add terminal icon PathGeometry |

---

## Unit Test Plan

| Test | Description |
|------|-------------|
| `ShellSelectorViewModel_LoadProfiles_PopulatesCollection` | Profiles loaded |
| `ShellSelectorViewModel_SelectProfile_SetsSelected` | Selection works |
| `ShellSelectorViewModel_CreateProfile_ValidatesName` | Empty name rejected |
| `ShellSelectorViewModel_CreateProfile_ValidatesPath` | Invalid path rejected |
| `ShellSelectorViewModel_CreateProfile_AddsToCollection` | New profile appears |
| `ShellSelectorViewModel_DeleteProfile_RemovesFromCollection` | Profile removed |
| `ShellSelectorViewModel_DeleteProfile_RejectsBuiltIn` | Built-in protected |
| `ShellSelectorViewModel_SetAsDefault_UpdatesProfiles` | Default flag updated |
| `FileExplorerViewModel_OpenInTerminal_UsesDefaultProfile` | Default profile used |
| `FileExplorerViewModel_OpenInTerminal_UsesCorrectPath` | Path resolved correctly |
| `FileExplorerViewModel_GetTerminalPath_UsesParentForFiles` | File â†’ parent dir |
| `SettingsViewModel_LoadTerminalSettings_PopulatesProperties` | Settings loaded |
| `SettingsViewModel_SaveTerminalSettings_PersistsChanges` | Settings saved |
| `ShowTerminalPanelMessage_SendsCorrectly` | Messenger integration |

**Total Tests**: 14

---

## Verification

```bash
# Verify UI builds
dotnet build src/AIntern.Desktop

# Run ViewModel tests
dotnet test --filter "ShellSelector"
dotnet test --filter "FileExplorerViewModel"

# Manual testing checklist:
# 1. Right-click folder â†’ "Open in Integrated Terminal"
# 2. Right-click folder â†’ "Open in Terminal..." â†’ Select profile
# 3. Open Settings â†’ Terminal section displays
# 4. Change default profile in settings
# 5. Verify keyboard shortcuts
```

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | "Open in Terminal" context menu appears for directories |
| AC-2 | "Open in Terminal..." shows profile sub-menu |
| AC-3 | Shell selector dialog displays all visible profiles |
| AC-4 | New profiles can be created from shell selector |
| AC-5 | Built-in profiles cannot be deleted |
| AC-6 | Terminal settings section displays in Settings view |
| AC-7 | Default profile can be changed from settings |
| AC-8 | Cursor style, blink, scrollback settings are configurable |
| AC-9 | Directory sync mode is configurable |
| AC-10 | Keyboard shortcuts are configurable |
| AC-11 | Settings changes persist across app restarts |

---

## Changelog Entry

```markdown
## v0.5.3f - File Explorer Integration

### Added
- `ShowTerminalPanelMessage` for panel visibility communication
- `OpenTerminalMessage` for terminal creation requests
- `ShellSelectorViewModel` with:
  - Profile list display and selection
  - New profile creation form with validation
  - Profile deletion (non-built-in only)
  - Set as default functionality
  - Profile duplication

- `ShellSelectorView.axaml` with:
  - Scrollable profile list with icons
  - Default and built-in badges
  - Context menu (Set Default, Duplicate, Delete)
  - New profile form with validation errors

### Changed
- Extended `FileExplorerViewModel` with:
  - OpenInTerminalCommand (uses default profile)
  - OpenInTerminalWithProfileCommand
  - ShowShellSelectorCommand
  - Profile loading for context menu

- Extended `FileExplorerView.axaml` with:
  - "Open in Integrated Terminal" context menu item
  - "Open in Terminal..." sub-menu with profiles

- Extended `SettingsViewModel` with:
  - Terminal font, theme, cursor settings
  - Scrollback lines configuration
  - Directory sync toggle and mode
  - Keyboard shortcut configuration
  - Profile manager access

- Extended `SettingsView.axaml` with:
  - Complete terminal settings section
  - Default profile selector
  - "Manage Profiles..." button
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.5.3f | 1.0 day |
