# Design Specification: The Senior Intern v0.2.4d "Editor Window UI"

## Executive Summary

This document provides a detailed implementation specification for v0.2.4d, which creates the full `SystemPromptEditorWindow` UI. The window features a split-pane layout with a prompt list on the left and a text editor on the right, along with action buttons, stats display, and keyboard shortcuts.

### v0.2.4d Scope (from v0.2.4 Design Document)

- Create `SystemPromptEditorWindow.axaml` with split-pane layout
- Create item templates for user prompts and templates
- Create editor panel with name, description, and content fields
- Add character/token count display
- Add action bar with Delete, Duplicate, Set Default, Discard, Save
- Implement keyboard shortcuts (Ctrl+S, Ctrl+N, Escape)
- Handle unsaved changes on close
- Add editor styles

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| SystemPromptEditorWindow.axaml | Complete editor window layout |
| SystemPromptEditorWindow.axaml.cs | Code-behind with keyboard handling |
| Editor Styles | Styles for prompt items and editor |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.2.4d Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  SystemPromptEditorWindow (900x650, min 700x500)                  â”‚
â”‚  â”œâ”€â”€ Window Resources                                             â”‚
â”‚  â”‚   â”œâ”€â”€ UserPromptItemTemplate (name, preview, default star)     â”‚
â”‚  â”‚   â””â”€â”€ TemplateItemTemplate (icon, name, category, description) â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Left Panel (260px, SidebarBackgroundColor)                   â”‚
â”‚  â”‚   â”œâ”€â”€ My Prompts Header + New button                           â”‚
â”‚  â”‚   â”œâ”€â”€ User Prompts List (scrollable)                           â”‚
â”‚  â”‚   â”œâ”€â”€ Templates Header                                         â”‚
â”‚  â”‚   â””â”€â”€ Templates List (max 200px height)                        â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Right Panel (Editor)                                         â”‚
â”‚  â”‚   â”œâ”€â”€ Name Field (TextBox, MaxLength=100)                      â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Validation error display                             â”‚
â”‚  â”‚   â”œâ”€â”€ Description Field (TextBox, MaxLength=500)               â”‚
â”‚  â”‚   â”œâ”€â”€ Content Editor (multiline TextBox, monospace)            â”‚
â”‚  â”‚   â”‚   â””â”€â”€ "Create Copy to Edit" link for built-in              â”‚
â”‚  â”‚   â””â”€â”€ Stats Footer                                             â”‚
â”‚  â”‚       â”œâ”€â”€ Character count, Token count                         â”‚
â”‚  â”‚       â”œâ”€â”€ "â€¢ Modified" indicator                               â”‚
â”‚  â”‚       â””â”€â”€ "Read-only Template" badge                           â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Bottom Action Bar                                            â”‚
â”‚  â”‚   â”œâ”€â”€ Left: Delete, Duplicate, Set as Default                  â”‚
â”‚  â”‚   â””â”€â”€ Right: Discard, Save                                     â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Loading Overlay (ProgressRing)                               â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Error Message Banner (closable)                              â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Keyboard Shortcuts                                           â”‚
â”‚      â”œâ”€â”€ Ctrl+S â†’ Save                                            â”‚
â”‚      â”œâ”€â”€ Ctrl+N â†’ New prompt                                      â”‚
â”‚      â””â”€â”€ Escape â†’ Discard or Close                                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Window Layout Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SystemPromptEditorWindow Layout                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Main Content (Grid Row 0)                    â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
â”‚  â”‚ â”‚   Left Panel     â”‚         Right Panel (Editor)         â”‚â”‚  â”‚
â”‚  â”‚ â”‚   (260px)        â”‚                                       â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ My Prompts [+]â”‚ â”‚ â”‚ Name: [____________________]    â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ Description: [_______________]   â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ â˜… Default    â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚   Custom 1   â”‚ â”‚ â”‚                                   â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚   Custom 2   â”‚ â”‚ â”‚     System Prompt Content         â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚         (monospace font)          â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ Templates    â”‚ â”‚ â”‚                                   â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚                                   â”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ ğŸ’¬ Default...â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ ğŸ˜ˆ Snarky... â”‚ â”‚ â”‚ 847 chars â”‚ ~212 tokens â”‚Modifiedâ”‚ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â”‚ ğŸ’» Code Ex.. â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚  â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                       â”‚â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Bottom Action Bar (Grid Row 1)                 â”‚  â”‚
â”‚  â”‚ [Delete] [Duplicate] [Set as Default]      [Discard] [Save]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Closing Flow with Unsaved Changes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Unsaved Changes on Close Flow                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User clicks close button or Escape                              â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OnClosing(WindowClosingEventArgs e)                       â”‚    â”‚
â”‚  â”‚   if (ViewModel?.IsDirty == true)                         â”‚    â”‚
â”‚  â”‚     e.Cancel = true                                       â”‚    â”‚
â”‚  â”‚     result = await ShowUnsavedChangesDialogAsync()        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â–¼                    â–¼                    â–¼              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚   Save    â”‚        â”‚ Don't Saveâ”‚        â”‚  Cancel   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                    â”‚                    â”‚              â”‚
â”‚         â–¼                    â–¼                    â–¼              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ Execute   â”‚        â”‚  Close()  â”‚        â”‚ Stay open â”‚        â”‚
â”‚   â”‚SaveCommandâ”‚        â”‚ (discard) â”‚        â”‚           â”‚        â”‚
â”‚   â”‚ + Close() â”‚        â”‚           â”‚        â”‚           â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ SystemPromptEditorWindow.axaml                (NEW)
â”‚   â””â”€â”€ SystemPromptEditorWindow.axaml.cs             (NEW)
â””â”€â”€ Themes/
    â””â”€â”€ Dark.axaml                                    (UPDATE - add styles)
```

---

## Implementation Details

### Task 1: Create SystemPromptEditorWindow.axaml

**File:** `src/SeniorIntern.Desktop/Views/SystemPromptEditorWindow.axaml`

Key sections:

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
        x:Class="SeniorIntern.Desktop.Views.SystemPromptEditorWindow"
        x:DataType="vm:SystemPromptEditorViewModel"
        Title="System Prompt Editor"
        Width="900" Height="650" MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <!-- User Prompt Item Template -->
        <DataTemplate x:Key="UserPromptItemTemplate" x:DataType="vm:SystemPromptViewModel">
            <Border Classes="prompt-item" Classes.selected="{Binding IsSelected}" 
                    Padding="12,8" Margin="2" CornerRadius="4">
                <Grid RowDefinitions="Auto,Auto">
                    <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
                        <TextBlock Text="â˜…" IsVisible="{Binding IsDefault}" 
                                   Foreground="{DynamicResource AccentColor}" Margin="0,0,6,0" />
                        <TextBlock Grid.Column="1" Text="{Binding Name}" FontWeight="SemiBold" 
                                   TextTrimming="CharacterEllipsis" />
                        <TextBlock Grid.Column="2" Text="{Binding UsageCount, StringFormat='Used {0}x'}" 
                                   FontSize="10" IsVisible="{Binding UsageCount}" />
                    </Grid>
                    <TextBlock Grid.Row="1" Text="{Binding ContentPreview}" FontSize="11" 
                               Foreground="{DynamicResource TextSecondaryColor}" Margin="0,4,0,0" />
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Template Item Template -->
        <DataTemplate x:Key="TemplateItemTemplate" x:DataType="vm:SystemPromptViewModel">
            <Border Classes="template-item" Padding="12,8" Margin="2" CornerRadius="4">
                <Grid ColumnDefinitions="Auto,*">
                    <Border Background="{DynamicResource AccentBackgroundColor}" 
                            CornerRadius="4" Padding="6" Margin="0,0,10,0">
                        <PathIcon Data="{DynamicResource PromptIcon}" Width="16" Height="16" />
                    </Border>
                    <StackPanel Grid.Column="1">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                            <Border Background="{DynamicResource ControlBackgroundColor}" 
                                    CornerRadius="2" Padding="4,1">
                                <TextBlock Text="{Binding Category}" FontSize="10" />
                            </Border>
                        </StackPanel>
                        <TextBlock Text="{Binding Description}" FontSize="11" 
                                   Foreground="{DynamicResource TextSecondaryColor}" />
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid RowDefinitions="*,Auto">
        <!-- Main Content -->
        <Grid Grid.Row="0" ColumnDefinitions="260,*">
            <!-- Left Panel: Prompt Lists -->
            <Border Grid.Column="0" Background="{DynamicResource SidebarBackgroundColor}" 
                    BorderThickness="0,0,1,0">
                <Grid RowDefinitions="Auto,*,Auto,Auto">
                    <!-- My Prompts Header + New Button -->
                    <!-- User Prompts ScrollViewer -->
                    <!-- Templates Header -->
                    <!-- Templates ScrollViewer (MaxHeight=200) -->
                </Grid>
            </Border>

            <!-- Right Panel: Editor -->
            <Grid Grid.Column="1" RowDefinitions="Auto,Auto,*,Auto" Margin="16">
                <!-- Name Field with Validation -->
                <!-- Description Field (optional) -->
                <!-- Content Editor (TextBox, AcceptsReturn, monospace) -->
                <!-- Stats Footer (chars, tokens, modified, read-only badge) -->
            </Grid>
        </Grid>

        <!-- Bottom Action Bar -->
        <Border Grid.Row="1" Background="{DynamicResource PanelBackgroundColor}" 
                BorderThickness="0,1,0,0" Padding="16,12">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <Button Content="Delete" Command="{Binding DeletePromptCommand}" Classes="destructive" />
                    <Button Content="Duplicate" Command="{Binding DuplicatePromptCommand}" />
                    <Button Content="Set as Default" Command="{Binding SetAsDefaultCommand}" />
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button Content="Discard" Command="{Binding DiscardChangesCommand}" IsVisible="{Binding IsDirty}" />
                    <Button Content="Save" Command="{Binding SavePromptCommand}" Classes="accent" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <!-- Error Message Banner -->
    </Grid>
</Window>
```

---

### Task 2: Create Code-Behind

**File:** `src/SeniorIntern.Desktop/Views/SystemPromptEditorWindow.axaml.cs`

```csharp
namespace SeniorIntern.Desktop.Views;

using Avalonia.Controls;
using Avalonia.Input;
using Avalonia.Interactivity;
using SeniorIntern.Desktop.ViewModels;

public partial class SystemPromptEditorWindow : Window
{
    public SystemPromptEditorWindow()
    {
        InitializeComponent();
    }

    private SystemPromptEditorViewModel? ViewModel => DataContext as SystemPromptEditorViewModel;

    protected override void OnLoaded(RoutedEventArgs e)
    {
        base.OnLoaded(e);
        _ = ViewModel?.InitializeAsync();
    }

    protected override async void OnClosing(WindowClosingEventArgs e)
    {
        if (ViewModel?.IsDirty == true)
        {
            e.Cancel = true;
            var result = await ShowUnsavedChangesDialogAsync();
            switch (result)
            {
                case UnsavedChangesResult.Save:
                    if (ViewModel.SavePromptCommand.CanExecute(null))
                        await ViewModel.SavePromptCommand.ExecuteAsync(null);
                    Close();
                    break;
                case UnsavedChangesResult.DontSave:
                    Close();
                    break;
                case UnsavedChangesResult.Cancel:
                    break; // Stay open
            }
        }
        base.OnClosing(e);
    }

    protected override void OnKeyDown(KeyEventArgs e)
    {
        base.OnKeyDown(e);
        if (e.KeyModifiers == KeyModifiers.Control)
        {
            switch (e.Key)
            {
                case Key.S:
                    if (ViewModel?.SavePromptCommand.CanExecute(null) == true)
                        _ = ViewModel.SavePromptCommand.ExecuteAsync(null);
                    e.Handled = true;
                    break;
                case Key.N:
                    if (ViewModel?.CreateNewPromptCommand.CanExecute(null) == true)
                        _ = ViewModel.CreateNewPromptCommand.ExecuteAsync(null);
                    e.Handled = true;
                    break;
            }
        }
        else if (e.Key == Key.Escape)
        {
            if (ViewModel?.IsDirty == true)
                ViewModel.DiscardChangesCommand.Execute(null);
            else
                Close();
            e.Handled = true;
        }
    }

    private Task<UnsavedChangesResult> ShowUnsavedChangesDialogAsync()
    {
        // TODO: Implement dialog
        return Task.FromResult(UnsavedChangesResult.DontSave);
    }

    private enum UnsavedChangesResult { Save, DontSave, Cancel }
}
```

---

### Task 3: Add Editor Styles

**File:** `src/SeniorIntern.Desktop/Themes/Dark.axaml` (additions)

```xml
<!-- Prompt Item Styles -->
<Style Selector="Border.prompt-item">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Cursor" Value="Hand" />
</Style>
<Style Selector="Border.prompt-item:pointerover">
    <Setter Property="Background" Value="{DynamicResource ControlHoverBackgroundColor}" />
</Style>
<Style Selector="Border.prompt-item.selected">
    <Setter Property="Background" Value="{DynamicResource AccentBackgroundColor}" />
</Style>

<!-- Template Item Styles -->
<Style Selector="Border.template-item">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Cursor" Value="Hand" />
</Style>
<Style Selector="Border.template-item:pointerover">
    <Setter Property="Background" Value="{DynamicResource ControlHoverBackgroundColor}" />
</Style>

<!-- Code Editor TextBox -->
<Style Selector="TextBox.code-editor">
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}" />
    <Setter Property="CornerRadius" Value="4" />
</Style>

<!-- Link Button -->
<Style Selector="Button.link-button">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="BorderThickness" Value="0" />
    <Setter Property="Foreground" Value="{DynamicResource AccentColor}" />
    <Setter Property="Padding" Value="0" />
</Style>
<Style Selector="Button.link-button:pointerover">
    <Setter Property="Foreground" Value="{DynamicResource AccentHoverColor}" />
</Style>

<!-- Destructive Button -->
<Style Selector="Button.destructive">
    <Setter Property="Background" Value="{DynamicResource ErrorBackgroundColor}" />
    <Setter Property="Foreground" Value="{DynamicResource ErrorForegroundColor}" />
</Style>
```

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| Window Initialization | 2 | ViewModel wiring, InitializeAsync called |
| Keyboard Shortcuts | 3 | Ctrl+S, Ctrl+N, Escape |
| Close Handling | 3 | Dirty state, dialog results |
| **Total** | **8** | |

### Key Test Scenarios

```csharp
[AvaloniaFact]
public void Ctrl_S_ExecutesSaveCommand()
{
    var window = CreateWindow();
    var saveExecuted = false;
    window.ViewModel.SavePromptCommand = new RelayCommand(() => saveExecuted = true);
    
    RaiseKeyDown(window, Key.S, KeyModifiers.Control);
    
    Assert.True(saveExecuted);
}

[AvaloniaFact]
public void Escape_WhenDirty_DiscardsChanges()
{
    var window = CreateWindow();
    window.ViewModel.IsDirty = true;
    
    RaiseKeyDown(window, Key.Escape);
    
    Assert.False(window.ViewModel.IsDirty);
}

[AvaloniaFact]
public void Escape_WhenNotDirty_ClosesWindow()
{
    var window = CreateWindow();
    window.ViewModel.IsDirty = false;
    
    RaiseKeyDown(window, Key.Escape);
    
    // Window should attempt to close
}
```

---

## Files Summary

### Files to Create (2)

| File | Lines (approx) |
|------|----------------|
| `Views/SystemPromptEditorWindow.axaml` | 350 |
| `Views/SystemPromptEditorWindow.axaml.cs` | 80 |

### Files to Modify (1)

| File | Changes |
|------|---------|
| `Themes/Dark.axaml` | Add ~50 lines of styles |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Window opens at 900x650, resizable to min 700x500 |
| AC-2 | Left panel shows user prompts and templates |
| AC-3 | User prompts show default star and usage count |
| AC-4 | Templates show category icon and description |
| AC-5 | Editor shows name, description, content fields |
| AC-6 | Content editor uses monospace font |
| AC-7 | Stats footer shows character and token counts |
| AC-8 | Built-in prompts show "Read-only Template" badge |
| AC-9 | Ctrl+S saves, Ctrl+N creates new, Escape discards/closes |
| AC-10 | Unsaved changes dialog on close |

---

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| 260px left panel | Enough for prompt names without wasting space |
| Templates max 200px | Focus on user prompts, templates secondary |
| Monospace for content | Clear formatting, code-like feel |
| Unsaved changes on close | Prevent accidental data loss |
| Link button for "Create Copy" | Non-intrusive action for templates |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.2.4d | 1 day |
