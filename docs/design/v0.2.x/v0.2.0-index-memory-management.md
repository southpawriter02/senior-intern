# Design Specification: The Senior Intern v0.2.0 "Memory Management"

## Executive Summary

This document provides a comprehensive design specification for v0.2.0, which introduces persistent storage for chat histories, user-configurable inference parameters, and system prompt management. This phase transforms the application from a stateless chat interface into a full-featured assistant with memory.

### v0.2.0 Scope (from ROADMAP.md)
- Implementation of **SQLite** (via Entity Framework Core) to save chat histories
- Parameter controls: Slide bars for Temperature, Top-P, and Context Window size
- "System Prompt" editor: Define exactly how "snarky" or "helpful" the Intern should be

---

## Sub-Version Breakdown

| Version | Name | Focus |
|---------|------|-------|
| v0.2.1 | Database Foundation | SQLite setup, EF Core entities, migrations, repository pattern |
| v0.2.2 | Conversation Persistence | Save/load conversations, conversation list UI, auto-save |
| v0.2.3 | Parameter Controls | Inference sliders (Temperature, Top-P, Context Size), real-time preview |
| v0.2.4 | System Prompt Editor | Prompt CRUD, prompt library, prompt templates |
| v0.2.5 | Polish & Integration | Search, export, settings migration, final testing |

---

## v0.2.1: Database Foundation

### Objective
Establish the SQLite database layer using Entity Framework Core with a clean repository pattern that can be extended for future features (RAG vectors in v0.7.0).

### New NuGet Packages

| Package | Version | Purpose |
|---------|---------|---------|
| Microsoft.EntityFrameworkCore.Sqlite | 8.0.x | SQLite provider |
| Microsoft.EntityFrameworkCore.Design | 8.0.x | Migrations tooling |
| Microsoft.EntityFrameworkCore.Tools | 8.0.x | CLI tools |

### Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Conversations                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id              GUID PRIMARY KEY                                 â”‚
â”‚ Title           TEXT NOT NULL                                    â”‚
â”‚ CreatedAt       DATETIME NOT NULL                                â”‚
â”‚ UpdatedAt       DATETIME NOT NULL                                â”‚
â”‚ SystemPromptId  GUID NULLABLE (FK â†’ SystemPrompts.Id)           â”‚
â”‚ ModelPath       TEXT NULLABLE                                    â”‚
â”‚ IsArchived      BOOLEAN NOT NULL DEFAULT 0                       â”‚
â”‚ MessageCount    INTEGER NOT NULL DEFAULT 0 (denormalized)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Messages                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id              GUID PRIMARY KEY                                 â”‚
â”‚ ConversationId  GUID NOT NULL (FK â†’ Conversations.Id)           â”‚
â”‚ Role            INTEGER NOT NULL (enum: System=0, User=1, Asst=2)â”‚
â”‚ Content         TEXT NOT NULL                                    â”‚
â”‚ Timestamp       DATETIME NOT NULL                                â”‚
â”‚ TokenCount      INTEGER NULLABLE                                 â”‚
â”‚ GenerationTimeMs INTEGER NULLABLE                                â”‚
â”‚ SequenceNumber  INTEGER NOT NULL (ordering within conversation)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SystemPrompts                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id              GUID PRIMARY KEY                                 â”‚
â”‚ Name            TEXT NOT NULL UNIQUE                             â”‚
â”‚ Content         TEXT NOT NULL                                    â”‚
â”‚ Description     TEXT NULLABLE                                    â”‚
â”‚ CreatedAt       DATETIME NOT NULL                                â”‚
â”‚ UpdatedAt       DATETIME NOT NULL                                â”‚
â”‚ IsDefault       BOOLEAN NOT NULL DEFAULT 0                       â”‚
â”‚ UsageCount      INTEGER NOT NULL DEFAULT 0                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      InferencePresets                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Id              GUID PRIMARY KEY                                 â”‚
â”‚ Name            TEXT NOT NULL UNIQUE                             â”‚
â”‚ Temperature     REAL NOT NULL                                    â”‚
â”‚ TopP            REAL NOT NULL                                    â”‚
â”‚ MaxTokens       INTEGER NOT NULL                                 â”‚
â”‚ ContextSize     INTEGER NOT NULL                                 â”‚
â”‚ IsDefault       BOOLEAN NOT NULL DEFAULT 0                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Entity Classes

```
src/SeniorIntern.Core/
â”œâ”€â”€ Entities/
â”‚   â”œâ”€â”€ ConversationEntity.cs
â”‚   â”œâ”€â”€ MessageEntity.cs
â”‚   â”œâ”€â”€ SystemPromptEntity.cs
â”‚   â””â”€â”€ InferencePresetEntity.cs
```

#### ConversationEntity.cs
```csharp
public sealed class ConversationEntity
{
    public Guid Id { get; set; }
    public string Title { get; set; } = "New Conversation";
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    public Guid? SystemPromptId { get; set; }
    public string? ModelPath { get; set; }
    public bool IsArchived { get; set; }
    public int MessageCount { get; set; }

    // Navigation properties
    public SystemPromptEntity? SystemPrompt { get; set; }
    public ICollection<MessageEntity> Messages { get; set; } = new List<MessageEntity>();
}
```

### DbContext

```
src/SeniorIntern.Data/
â”œâ”€â”€ SeniorIntern.Data.csproj
â”œâ”€â”€ SeniorInternDbContext.cs
â”œâ”€â”€ Configurations/
â”‚   â”œâ”€â”€ ConversationConfiguration.cs
â”‚   â”œâ”€â”€ MessageConfiguration.cs
â”‚   â”œâ”€â”€ SystemPromptConfiguration.cs
â”‚   â””â”€â”€ InferencePresetConfiguration.cs
â”œâ”€â”€ Migrations/
â”‚   â””â”€â”€ (auto-generated)
â””â”€â”€ Repositories/
    â”œâ”€â”€ IConversationRepository.cs
    â”œâ”€â”€ ConversationRepository.cs
    â”œâ”€â”€ ISystemPromptRepository.cs
    â”œâ”€â”€ SystemPromptRepository.cs
    â”œâ”€â”€ IInferencePresetRepository.cs
    â””â”€â”€ InferencePresetRepository.cs
```

#### SeniorInternDbContext.cs
```csharp
public class SeniorInternDbContext : DbContext
{
    public DbSet<ConversationEntity> Conversations => Set<ConversationEntity>();
    public DbSet<MessageEntity> Messages => Set<MessageEntity>();
    public DbSet<SystemPromptEntity> SystemPrompts => Set<SystemPromptEntity>();
    public DbSet<InferencePresetEntity> InferencePresets => Set<InferencePresetEntity>();

    public SeniorInternDbContext(DbContextOptions<SeniorInternDbContext> options)
        : base(options) { }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.ApplyConfigurationsFromAssembly(typeof(SeniorInternDbContext).Assembly);
    }
}
```

### Database Location
```
Windows: %AppData%/SeniorIntern/seniorintern.db
macOS:   ~/Library/Application Support/SeniorIntern/seniorintern.db
Linux:   ~/.config/SeniorIntern/seniorintern.db
```

### Repository Interface Pattern

```csharp
public interface IConversationRepository
{
    Task<ConversationEntity?> GetByIdAsync(Guid id, CancellationToken ct = default);
    Task<ConversationEntity?> GetByIdWithMessagesAsync(Guid id, CancellationToken ct = default);
    Task<IReadOnlyList<ConversationEntity>> GetRecentAsync(int count = 50, CancellationToken ct = default);
    Task<IReadOnlyList<ConversationEntity>> SearchAsync(string query, CancellationToken ct = default);
    Task<ConversationEntity> CreateAsync(ConversationEntity conversation, CancellationToken ct = default);
    Task UpdateAsync(ConversationEntity conversation, CancellationToken ct = default);
    Task DeleteAsync(Guid id, CancellationToken ct = default);
    Task ArchiveAsync(Guid id, CancellationToken ct = default);
    Task AddMessageAsync(Guid conversationId, MessageEntity message, CancellationToken ct = default);
}
```

### Migration Strategy
1. Database created on first run if not exists
2. Auto-migration on startup (development mode)
3. Manual migration scripts for production releases
4. Backup before migration with rollback capability

### Files to Create (v0.2.1)
| File | Purpose |
|------|---------|
| `src/SeniorIntern.Data/SeniorIntern.Data.csproj` | New project for data layer |
| `src/SeniorIntern.Data/SeniorInternDbContext.cs` | EF Core DbContext |
| `src/SeniorIntern.Core/Entities/ConversationEntity.cs` | Conversation entity |
| `src/SeniorIntern.Core/Entities/MessageEntity.cs` | Message entity |
| `src/SeniorIntern.Core/Entities/SystemPromptEntity.cs` | System prompt entity |
| `src/SeniorIntern.Core/Entities/InferencePresetEntity.cs` | Inference preset entity |
| `src/SeniorIntern.Data/Configurations/*.cs` | EF configurations (4 files) |
| `src/SeniorIntern.Data/Repositories/*.cs` | Repository interfaces and implementations (6 files) |

### Testing Strategy (v0.2.1)
- Unit tests for repositories using in-memory SQLite
- Integration tests for migration scenarios
- Verify FK constraints and cascading deletes

---

## v0.2.2: Conversation Persistence

### Objective
Enable saving and loading of conversations, implement conversation list UI in the sidebar, and add auto-save functionality.

### Service Layer Changes

#### Updated IConversationService Interface
```csharp
public interface IConversationService
{
    // Existing
    Conversation CurrentConversation { get; }
    void AddMessage(ChatMessage message);
    void UpdateMessage(Guid messageId, Action<ChatMessage> updateAction);
    IEnumerable<ChatMessage> GetMessages();

    // New in v0.2.2
    Task<IReadOnlyList<ConversationSummary>> GetRecentConversationsAsync(int count = 50);
    Task<Conversation> LoadConversationAsync(Guid conversationId);
    Task SaveCurrentConversationAsync();
    Task<Conversation> CreateNewConversationAsync(string? title = null, Guid? systemPromptId = null);
    Task DeleteConversationAsync(Guid conversationId);
    Task RenameConversationAsync(Guid conversationId, string newTitle);
    Task ArchiveConversationAsync(Guid conversationId);
    Task<IReadOnlyList<ConversationSummary>> SearchConversationsAsync(string query);

    // Events
    event EventHandler? ConversationChanged;
    event EventHandler<ConversationListChangedEventArgs>? ConversationListChanged;
}

public record ConversationSummary(
    Guid Id,
    string Title,
    DateTime UpdatedAt,
    int MessageCount,
    string? FirstMessagePreview
);
```

#### DatabaseConversationService Implementation
```csharp
public sealed class DatabaseConversationService : IConversationService
{
    private readonly IConversationRepository _repository;
    private readonly IMapper _mapper; // AutoMapper or manual mapping
    private Conversation _currentConversation = new();
    private bool _hasUnsavedChanges;

    // Auto-save on message add (debounced)
    // Load conversation with lazy message loading for large histories
    // Title auto-generation from first user message
}
```

### ViewModel Changes

#### New: ConversationListViewModel
```csharp
public partial class ConversationListViewModel : ViewModelBase
{
    [ObservableProperty]
    private ObservableCollection<ConversationSummaryViewModel> _conversations = new();

    [ObservableProperty]
    private ConversationSummaryViewModel? _selectedConversation;

    [ObservableProperty]
    private string _searchQuery = string.Empty;

    [ObservableProperty]
    private bool _isLoading;

    [RelayCommand]
    private Task CreateNewConversationAsync();

    [RelayCommand]
    private Task LoadConversationAsync(Guid conversationId);

    [RelayCommand]
    private Task DeleteConversationAsync(Guid conversationId);

    [RelayCommand]
    private Task RenameConversationAsync(Guid conversationId);

    [RelayCommand]
    private Task SearchAsync();
}
```

#### New: ConversationSummaryViewModel
```csharp
public partial class ConversationSummaryViewModel : ViewModelBase
{
    public Guid Id { get; init; }

    [ObservableProperty]
    private string _title = string.Empty;

    [ObservableProperty]
    private DateTime _updatedAt;

    [ObservableProperty]
    private int _messageCount;

    [ObservableProperty]
    private string? _preview;

    [ObservableProperty]
    private bool _isSelected;

    public string RelativeTime => GetRelativeTime(UpdatedAt);
}
```

### UI Changes

#### Sidebar Update (MainWindow.axaml)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Sidebar (280px)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                   Model Selector                             â”‚ â”‚
â”‚ â”‚  [Load GGUF Model...]                                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Conversations              [+] New                          â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚  [ğŸ” Search conversations...]                                â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚  â–¸ Today                                                     â”‚ â”‚
â”‚ â”‚    â”œâ”€ API refactoring help          2m ago                  â”‚ â”‚
â”‚ â”‚    â””â”€ Debug memory leak             1h ago                  â”‚ â”‚
â”‚ â”‚  â–¸ Yesterday                                                 â”‚ â”‚
â”‚ â”‚    â””â”€ Project setup questions       23h ago                 â”‚ â”‚
â”‚ â”‚  â–¸ Previous 7 Days                                           â”‚ â”‚
â”‚ â”‚    â”œâ”€ Architecture discussion       3d ago                  â”‚ â”‚
â”‚ â”‚    â””â”€ Code review feedback          5d ago                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### New: ConversationListView.axaml
- Grouped by date (Today, Yesterday, Previous 7 Days, Older)
- Each item shows: Title, relative timestamp, message count badge
- Context menu: Rename, Delete, Archive
- Search filter with debouncing (300ms)
- Keyboard navigation (Up/Down arrows, Enter to select)

### Auto-Save Behavior
1. **Trigger**: After each assistant response completes
2. **Debounce**: 500ms delay to batch rapid changes
3. **Background**: Save on background thread, no UI blocking
4. **Indicator**: Subtle "Saved" indicator in status bar
5. **Conflict**: Last-write-wins (single-user application)

### Title Generation
- Default: "New Conversation"
- Auto-generated from first user message (first 50 chars + "...")
- User can rename at any time via context menu

### Files to Create (v0.2.2)
| File | Purpose |
|------|---------|
| `src/SeniorIntern.Services/DatabaseConversationService.cs` | New conversation service implementation |
| `src/SeniorIntern.Desktop/ViewModels/ConversationListViewModel.cs` | Conversation list ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/ConversationSummaryViewModel.cs` | Summary item ViewModel |
| `src/SeniorIntern.Desktop/Views/ConversationListView.axaml` | Conversation list UI |
| `src/SeniorIntern.Desktop/Views/ConversationListView.axaml.cs` | Code-behind |
| `src/SeniorIntern.Core/Events/ConversationListChangedEventArgs.cs` | New event args |

### Files to Modify (v0.2.2)
| File | Changes |
|------|---------|
| `src/SeniorIntern.Core/Interfaces/IConversationService.cs` | Add new methods |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add conversation list to sidebar |
| `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` | Add ConversationListViewModel |
| `src/SeniorIntern.Desktop/Extensions/ServiceCollectionExtensions.cs` | Register new services |

### Testing Strategy (v0.2.2)
- Test auto-save timing and debouncing
- Test conversation loading with 1000+ messages
- Test search functionality with special characters
- Test concurrent save operations

---

## v0.2.3: Parameter Controls

### Objective
Add UI controls for inference parameters (Temperature, Top-P, Max Tokens, Context Size) with real-time feedback and preset management.

### Parameter Definitions

| Parameter | Range | Default | Step | Description |
|-----------|-------|---------|------|-------------|
| Temperature | 0.0 - 2.0 | 0.7 | 0.1 | Creativity/randomness |
| Top-P | 0.0 - 1.0 | 0.9 | 0.05 | Nucleus sampling threshold |
| Max Tokens | 64 - 8192 | 2048 | 64 | Maximum response length |
| Context Size | 512 - 32768 | 4096 | 512 | Context window size |

### ViewModel Changes

#### New: InferenceSettingsViewModel
```csharp
public partial class InferenceSettingsViewModel : ViewModelBase
{
    private readonly ISettingsService _settingsService;
    private readonly IInferencePresetRepository _presetRepository;

    // Current values (bound to sliders)
    [ObservableProperty]
    private float _temperature = 0.7f;

    [ObservableProperty]
    private float _topP = 0.9f;

    [ObservableProperty]
    private int _maxTokens = 2048;

    [ObservableProperty]
    private uint _contextSize = 4096;

    // Preset management
    [ObservableProperty]
    private ObservableCollection<InferencePresetViewModel> _presets = new();

    [ObservableProperty]
    private InferencePresetViewModel? _selectedPreset;

    // Descriptions for tooltips
    public string TemperatureDescription => Temperature switch
    {
        < 0.3f => "Very focused and deterministic",
        < 0.7f => "Balanced creativity and consistency",
        < 1.2f => "Creative and varied responses",
        _ => "Highly random and experimental"
    };

    // Commands
    [RelayCommand]
    private Task SaveAsPresetAsync();

    [RelayCommand]
    private Task ApplyPresetAsync(InferencePresetViewModel preset);

    [RelayCommand]
    private Task DeletePresetAsync(InferencePresetViewModel preset);

    [RelayCommand]
    private void ResetToDefaults();

    // Auto-save on change (debounced)
    partial void OnTemperatureChanged(float value) => QueueSettingsSave();
}
```

### UI Layout

#### New: InferenceSettingsPanel.axaml
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Inference Settings                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Preset: [â–¾ Default                    ] [Save] [Reset]          â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  Temperature                                         0.7         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  Balanced creativity and consistency                             â”‚
â”‚                                                                  â”‚
â”‚  Top-P (Nucleus Sampling)                            0.90        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  Considers top 90% probability mass                              â”‚
â”‚                                                                  â”‚
â”‚  Max Response Tokens                                 2048        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  ~1500 words maximum                                             â”‚
â”‚                                                                  â”‚
â”‚  Context Window Size                                 4096        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  ~3000 words of conversation history                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Slider Component Behavior
1. **Drag**: Real-time value update
2. **Click track**: Jump to clicked position
3. **Keyboard**: Arrow keys for fine adjustment
4. **Double-click value**: Open text input for precise entry
5. **Visual feedback**: Colored gradient (blue=low, green=mid, orange=high)

### Settings Integration

#### Updated AppSettings
```csharp
public sealed class AppSettings
{
    // ... existing properties ...

    // New: Active inference parameters
    public Guid? ActiveInferencePresetId { get; set; }

    // Override values (when not using preset)
    public float? TemperatureOverride { get; set; }
    public float? TopPOverride { get; set; }
    public int? MaxTokensOverride { get; set; }
    public uint? ContextSizeOverride { get; set; }
}
```

### Built-in Presets (Seeded Data)

| Name | Temp | Top-P | Max Tokens | Context | Use Case |
|------|------|-------|------------|---------|----------|
| Precise | 0.2 | 0.8 | 1024 | 4096 | Code generation, factual queries |
| Balanced | 0.7 | 0.9 | 2048 | 4096 | General conversation |
| Creative | 1.2 | 0.95 | 4096 | 8192 | Brainstorming, creative writing |
| Long-form | 0.7 | 0.9 | 8192 | 16384 | Documentation, detailed explanations |

### Panel Placement Options
1. **Collapsible panel** in sidebar (below model selector)
2. **Modal dialog** via Settings menu
3. **Flyout panel** triggered by status bar icon

**Recommendation**: Collapsible panel in sidebar for quick access, with "Advanced" button opening full modal.

### Files to Create (v0.2.3)
| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/ViewModels/InferenceSettingsViewModel.cs` | Settings ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/InferencePresetViewModel.cs` | Preset item ViewModel |
| `src/SeniorIntern.Desktop/Views/InferenceSettingsPanel.axaml` | Settings panel UI |
| `src/SeniorIntern.Desktop/Views/InferenceSettingsPanel.axaml.cs` | Code-behind |
| `src/SeniorIntern.Desktop/Controls/ParameterSlider.axaml` | Custom slider control |
| `src/SeniorIntern.Desktop/Controls/ParameterSlider.axaml.cs` | Slider code-behind |

### Files to Modify (v0.2.3)
| File | Changes |
|------|---------|
| `src/SeniorIntern.Core/Models/AppSettings.cs` | Add preset/override properties |
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add settings panel |
| `src/SeniorIntern.Desktop/ViewModels/ChatViewModel.cs` | Use dynamic inference options |
| `src/SeniorIntern.Data/SeniorInternDbContext.cs` | Seed built-in presets |

### Testing Strategy (v0.2.3)
- Test slider value bounds (no out-of-range)
- Test preset save/load cycle
- Test settings persistence across app restart
- Test inference uses correct parameter values

---

## v0.2.4: System Prompt Editor

### Objective
Create a system prompt editor allowing users to create, edit, and manage multiple system prompts with a library of templates.

### System Prompt Model

```csharp
public record SystemPromptTemplate(
    string Name,
    string Content,
    string Description,
    string Category, // "General", "Code", "Creative", "Technical"
    IReadOnlyList<string> Tags
);
```

### Built-in Templates

| Name | Category | Description |
|------|----------|-------------|
| Default Assistant | General | Balanced, helpful assistant |
| Code Expert | Code | Focused on programming tasks |
| Snarky Intern | Creative | The "Senior Intern" personality |
| Technical Writer | Technical | Documentation and explanations |
| Rubber Duck | Code | Asks clarifying questions, helps debug |
| Socratic Tutor | General | Teaches through questions |

#### Example: "Snarky Intern" Template
```
You are "The Senior Intern" - an AI assistant with the knowledge of a senior
developer but the enthusiasm of a new hire. You're technically brilliant but
sometimes make sarcastic observations about code quality or architecture
decisions. You help users with coding tasks while occasionally dropping witty
remarks about the state of the codebase or industry trends.

Key traits:
- Technically accurate and thorough
- Occasionally sarcastic but never mean
- Enthusiastic about good practices
- Mildly judgmental about bad practices
- Uses programming humor when appropriate

Always prioritize being helpful over being funny. If the user seems frustrated
or the task is urgent, dial back the personality and focus on solutions.
```

### ViewModel Changes

#### New: SystemPromptEditorViewModel
```csharp
public partial class SystemPromptEditorViewModel : ViewModelBase
{
    [ObservableProperty]
    private ObservableCollection<SystemPromptViewModel> _prompts = new();

    [ObservableProperty]
    private SystemPromptViewModel? _selectedPrompt;

    [ObservableProperty]
    private ObservableCollection<SystemPromptTemplate> _templates = new();

    [ObservableProperty]
    private string _editorContent = string.Empty;

    [ObservableProperty]
    private string _promptName = string.Empty;

    [ObservableProperty]
    private string _promptDescription = string.Empty;

    [ObservableProperty]
    private bool _isDirty;

    [ObservableProperty]
    private bool _isEditing;

    // Commands
    [RelayCommand]
    private Task CreateNewPromptAsync();

    [RelayCommand]
    private Task SavePromptAsync();

    [RelayCommand]
    private Task DeletePromptAsync();

    [RelayCommand]
    private Task DuplicatePromptAsync();

    [RelayCommand]
    private Task SetAsDefaultAsync();

    [RelayCommand]
    private void LoadTemplate(SystemPromptTemplate template);

    [RelayCommand]
    private void DiscardChanges();

    // Character/token count
    public int CharacterCount => EditorContent?.Length ?? 0;
    public int EstimatedTokenCount => CharacterCount / 4; // Rough estimate
}
```

### UI Layout

#### SystemPromptEditorWindow.axaml (Modal Dialog)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  System Prompt Editor                                              [X]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   My Prompts       â”‚  â”‚  Name: [Snarky Intern                        ] â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                                                â”‚ â”‚
â”‚  â”‚ â˜… Snarky Intern    â”‚  â”‚  Description:                                  â”‚ â”‚
â”‚  â”‚   Code Expert      â”‚  â”‚  [The classic Senior Intern personality      ] â”‚ â”‚
â”‚  â”‚   Technical Writer â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚   [+ New Prompt]   â”‚  â”‚                                                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  You are "The Senior Intern" - an AI          â”‚ â”‚
â”‚  â”‚   Templates        â”‚  â”‚  assistant with the knowledge of a senior     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  developer but the enthusiasm of a new        â”‚ â”‚
â”‚  â”‚   Default Assistantâ”‚  â”‚  hire. You're technically brilliant but       â”‚ â”‚
â”‚  â”‚   Code Expert      â”‚  â”‚  sometimes make sarcastic observations...     â”‚ â”‚
â”‚  â”‚   Snarky Intern    â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚   Technical Writer â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚   Rubber Duck      â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚   Socratic Tutor   â”‚  â”‚                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                â”‚ â”‚
â”‚                          â”‚                                                â”‚ â”‚
â”‚                          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚                          â”‚  Characters: 847  â”‚  Est. Tokens: ~212        â”‚ â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚                          [Delete]        [Duplicate]    [Save]  [Cancel]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Conversation-Prompt Integration

#### Quick Prompt Selector in Chat Header
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Using: [â˜… Snarky Intern â–¾]                    [Edit Prompts]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          Chat Area                               â”‚
```

- Dropdown shows all user prompts + templates
- Star (â˜…) indicates current default
- Changing prompt affects new messages only
- "Edit Prompts" opens the full editor

### System Prompt Application Logic
1. System prompt is prepended to conversation context
2. Stored with conversation (ConversationEntity.SystemPromptId)
3. Displayed as first message in chat (collapsible, styled differently)
4. Can be changed mid-conversation (affects subsequent messages)

### Files to Create (v0.2.4)
| File | Purpose |
|------|---------|
| `src/SeniorIntern.Desktop/ViewModels/SystemPromptEditorViewModel.cs` | Editor ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/SystemPromptViewModel.cs` | Prompt item ViewModel |
| `src/SeniorIntern.Desktop/Views/SystemPromptEditorWindow.axaml` | Editor dialog |
| `src/SeniorIntern.Desktop/Views/SystemPromptEditorWindow.axaml.cs` | Code-behind |
| `src/SeniorIntern.Desktop/Views/SystemPromptSelector.axaml` | Quick selector control |
| `src/SeniorIntern.Core/Templates/SystemPromptTemplates.cs` | Built-in templates |

### Files to Modify (v0.2.4)
| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Views/ChatView.axaml` | Add prompt selector header |
| `src/SeniorIntern.Desktop/ViewModels/ChatViewModel.cs` | Apply system prompt to context |
| `src/SeniorIntern.Services/LlmService.cs` | Format system prompt in conversation |
| `src/SeniorIntern.Data/SeniorInternDbContext.cs` | Seed built-in templates |

### Testing Strategy (v0.2.4)
- Test prompt CRUD operations
- Test template loading and customization
- Test prompt application to inference
- Test character/token count accuracy
- Test dirty state and unsaved changes warning

---

## v0.2.5: Polish & Integration

### Objective
Final integration, search functionality, export features, settings migration, and comprehensive testing.

### Search Functionality

#### Global Search (Ctrl+K / Cmd+K)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” Search conversations and messages...                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Conversations                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“ API refactoring help                           2 hours  â”‚ â”‚
â”‚  â”‚    "...how to refactor the authentication API..."         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ“ Debug memory leak                              1 day    â”‚ â”‚
â”‚  â”‚    "...tracking down a memory leak in the service..."     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Messages                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ’¬ "The memory leak is likely in your event handlers..."  â”‚ â”‚
â”‚  â”‚    in: Debug memory leak                          1 day    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  [â†‘â†“ Navigate]  [Enter Select]  [Esc Close]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Search Implementation
- Full-text search using SQLite FTS5 extension
- Index: Conversation titles + Message content
- Results: Grouped by conversations then messages
- Highlighting: Matched terms highlighted in preview
- Performance: Debounced input (300ms), pagination

### Export Features

#### Export Formats
| Format | Extension | Content |
|--------|-----------|---------|
| Markdown | .md | Formatted conversation with headers |
| JSON | .json | Full structured data (portable) |
| Plain Text | .txt | Simple text transcript |
| HTML | .html | Styled, printable version |

#### Export Dialog
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Export Conversation                                    [X]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Format:  â—‹ Markdown (.md)                                       â”‚
â”‚           â— JSON (.json)                                         â”‚
â”‚           â—‹ Plain Text (.txt)                                    â”‚
â”‚           â—‹ HTML (.html)                                         â”‚
â”‚                                                                  â”‚
â”‚  Options:                                                        â”‚
â”‚           â˜‘ Include timestamps                                   â”‚
â”‚           â˜‘ Include system prompt                                â”‚
â”‚           â˜ Include token counts                                 â”‚
â”‚                                                                  â”‚
â”‚  Preview:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ {                                                          â”‚ â”‚
â”‚  â”‚   "title": "API refactoring help",                        â”‚ â”‚
â”‚  â”‚   "createdAt": "2025-01-09T10:30:00Z",                    â”‚ â”‚
â”‚  â”‚   "messages": [...]                                        â”‚ â”‚
â”‚  â”‚ }                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚                              [Cancel]  [Export]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Settings Migration

#### Migration from v0.1.0 to v0.2.0
1. **Detect existing settings.json** on startup
2. **Read v0.1.0 format** (flat JSON)
3. **Create database** if not exists
4. **Migrate settings** to new schema
5. **Create default system prompts** and presets
6. **Mark migration complete** (version stamp in DB)
7. **Backup original** settings.json â†’ settings.v1.json.bak

#### Migration Service
```csharp
public interface IMigrationService
{
    Task<MigrationResult> MigrateIfNeededAsync();
    Version GetCurrentVersion();
    bool IsMigrationRequired();
}

public record MigrationResult(
    bool Success,
    Version FromVersion,
    Version ToVersion,
    IReadOnlyList<string> MigrationSteps,
    string? ErrorMessage
);
```

### Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| Ctrl+K / Cmd+K | Global search |
| Ctrl+N / Cmd+N | New conversation |
| Ctrl+E / Cmd+E | Export current conversation |
| Ctrl+, / Cmd+, | Open settings |
| Ctrl+P / Cmd+P | Open system prompt editor |
| Ctrl+Shift+S | Save conversation |
| Escape | Close dialogs/panels |

### Status Bar Enhancements
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model: llama-3.gguf â”‚ Tokens: 234 (12.3 tok/s) â”‚ âœ“ Saved â”‚ T:0.7â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- Model name (clickable â†’ model selector)
- Token count and speed (during generation)
- Save indicator (âœ“ Saved / â—‹ Unsaved)
- Current temperature (clickable â†’ settings panel)

### Files to Create (v0.2.5)
| File | Purpose |
|------|---------|
| `src/SeniorIntern.Services/SearchService.cs` | Full-text search implementation |
| `src/SeniorIntern.Services/ExportService.cs` | Export functionality |
| `src/SeniorIntern.Services/MigrationService.cs` | Settings migration |
| `src/SeniorIntern.Desktop/ViewModels/SearchViewModel.cs` | Search ViewModel |
| `src/SeniorIntern.Desktop/ViewModels/ExportViewModel.cs` | Export ViewModel |
| `src/SeniorIntern.Desktop/Views/SearchDialog.axaml` | Search dialog |
| `src/SeniorIntern.Desktop/Views/ExportDialog.axaml` | Export dialog |
| `src/SeniorIntern.Core/Interfaces/ISearchService.cs` | Search interface |
| `src/SeniorIntern.Core/Interfaces/IExportService.cs` | Export interface |
| `src/SeniorIntern.Core/Interfaces/IMigrationService.cs` | Migration interface |

### Files to Modify (v0.2.5)
| File | Changes |
|------|---------|
| `src/SeniorIntern.Desktop/Views/MainWindow.axaml` | Add keyboard shortcuts, update status bar |
| `src/SeniorIntern.Desktop/App.axaml.cs` | Run migration on startup |
| `src/SeniorIntern.Desktop/Extensions/ServiceCollectionExtensions.cs` | Register new services |

### Testing Strategy (v0.2.5)
- End-to-end tests for complete user flows
- Migration tests from v0.1.0 settings
- Export format validation
- Search ranking accuracy tests
- Performance tests with large conversation histories

---

## Architecture Summary

### Project Structure After v0.2.0

```
SeniorIntern/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ SeniorIntern.Core/
â”‚   â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ Conversation.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ AppSettings.cs (updated)
â”‚   â”‚   â”‚   â””â”€â”€ ModelLoadOptions.cs
â”‚   â”‚   â”œâ”€â”€ Entities/                    [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationEntity.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageEntity.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ SystemPromptEntity.cs
â”‚   â”‚   â”‚   â””â”€â”€ InferencePresetEntity.cs
â”‚   â”‚   â”œâ”€â”€ Interfaces/
â”‚   â”‚   â”‚   â”œâ”€â”€ ILlmService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ IConversationService.cs (updated)
â”‚   â”‚   â”‚   â”œâ”€â”€ ISettingsService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ISearchService.cs       [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ IExportService.cs       [NEW]
â”‚   â”‚   â”‚   â””â”€â”€ IMigrationService.cs    [NEW]
â”‚   â”‚   â”œâ”€â”€ Events/
â”‚   â”‚   â”‚   â””â”€â”€ LlmEvents.cs (updated)
â”‚   â”‚   â”œâ”€â”€ Exceptions/
â”‚   â”‚   â”‚   â””â”€â”€ LlmExceptions.cs
â”‚   â”‚   â””â”€â”€ Templates/                   [NEW]
â”‚   â”‚       â””â”€â”€ SystemPromptTemplates.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ SeniorIntern.Data/               [NEW PROJECT]
â”‚   â”‚   â”œâ”€â”€ SeniorIntern.Data.csproj
â”‚   â”‚   â”œâ”€â”€ SeniorInternDbContext.cs
â”‚   â”‚   â”œâ”€â”€ Configurations/
â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationConfiguration.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageConfiguration.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ SystemPromptConfiguration.cs
â”‚   â”‚   â”‚   â””â”€â”€ InferencePresetConfiguration.cs
â”‚   â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ IConversationRepository.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationRepository.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ISystemPromptRepository.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ SystemPromptRepository.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ IInferencePresetRepository.cs
â”‚   â”‚   â”‚   â””â”€â”€ InferencePresetRepository.cs
â”‚   â”‚   â””â”€â”€ Migrations/
â”‚   â”‚
â”‚   â”œâ”€â”€ SeniorIntern.Services/
â”‚   â”‚   â”œâ”€â”€ LlmService.cs
â”‚   â”‚   â”œâ”€â”€ SettingsService.cs
â”‚   â”‚   â”œâ”€â”€ ConversationService.cs (renamed/replaced)
â”‚   â”‚   â”œâ”€â”€ DatabaseConversationService.cs  [NEW]
â”‚   â”‚   â”œâ”€â”€ SearchService.cs                [NEW]
â”‚   â”‚   â”œâ”€â”€ ExportService.cs                [NEW]
â”‚   â”‚   â””â”€â”€ MigrationService.cs             [NEW]
â”‚   â”‚
â”‚   â””â”€â”€ SeniorIntern.Desktop/
â”‚       â”œâ”€â”€ ViewModels/
â”‚       â”‚   â”œâ”€â”€ ViewModelBase.cs
â”‚       â”‚   â”œâ”€â”€ MainWindowViewModel.cs (updated)
â”‚       â”‚   â”œâ”€â”€ ChatViewModel.cs (updated)
â”‚       â”‚   â”œâ”€â”€ ChatMessageViewModel.cs
â”‚       â”‚   â”œâ”€â”€ ModelSelectorViewModel.cs
â”‚       â”‚   â”œâ”€â”€ ConversationListViewModel.cs     [NEW]
â”‚       â”‚   â”œâ”€â”€ ConversationSummaryViewModel.cs  [NEW]
â”‚       â”‚   â”œâ”€â”€ InferenceSettingsViewModel.cs    [NEW]
â”‚       â”‚   â”œâ”€â”€ InferencePresetViewModel.cs      [NEW]
â”‚       â”‚   â”œâ”€â”€ SystemPromptEditorViewModel.cs   [NEW]
â”‚       â”‚   â”œâ”€â”€ SystemPromptViewModel.cs         [NEW]
â”‚       â”‚   â”œâ”€â”€ SearchViewModel.cs               [NEW]
â”‚       â”‚   â””â”€â”€ ExportViewModel.cs               [NEW]
â”‚       â”œâ”€â”€ Views/
â”‚       â”‚   â”œâ”€â”€ MainWindow.axaml (updated)
â”‚       â”‚   â”œâ”€â”€ ChatView.axaml (updated)
â”‚       â”‚   â”œâ”€â”€ ChatMessageControl.axaml
â”‚       â”‚   â”œâ”€â”€ ModelSelectorView.axaml
â”‚       â”‚   â”œâ”€â”€ ConversationListView.axaml       [NEW]
â”‚       â”‚   â”œâ”€â”€ InferenceSettingsPanel.axaml     [NEW]
â”‚       â”‚   â”œâ”€â”€ SystemPromptEditorWindow.axaml   [NEW]
â”‚       â”‚   â”œâ”€â”€ SystemPromptSelector.axaml       [NEW]
â”‚       â”‚   â”œâ”€â”€ SearchDialog.axaml               [NEW]
â”‚       â”‚   â””â”€â”€ ExportDialog.axaml               [NEW]
â”‚       â”œâ”€â”€ Controls/                            [NEW]
â”‚       â”‚   â”œâ”€â”€ ParameterSlider.axaml
â”‚       â”‚   â””â”€â”€ ParameterSlider.axaml.cs
â”‚       â”œâ”€â”€ Themes/
â”‚       â”‚   â””â”€â”€ Dark.axaml (updated)
â”‚       â””â”€â”€ Extensions/
â”‚           â””â”€â”€ ServiceCollectionExtensions.cs (updated)
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ SeniorIntern.Core.Tests/
    â”œâ”€â”€ SeniorIntern.Services.Tests/
    â””â”€â”€ SeniorIntern.Data.Tests/                 [NEW]
```

### New NuGet Packages (v0.2.0 Total)

| Package | Version | Project | Purpose |
|---------|---------|---------|---------|
| Microsoft.EntityFrameworkCore.Sqlite | 8.0.x | Data | SQLite provider |
| Microsoft.EntityFrameworkCore.Design | 8.0.x | Data | Migrations |
| Microsoft.EntityFrameworkCore.Tools | 8.0.x | Data | CLI tools |

### Dependency Flow

```
SeniorIntern.Core (no dependencies)
       â†‘
SeniorIntern.Data (â†’ Core, EF Core)
       â†‘
SeniorIntern.Services (â†’ Core, Data, LLamaSharp)
       â†‘
SeniorIntern.Desktop (â†’ Core, Services, Avalonia)
```

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| EF Core migration failures | Medium | High | Backup before migrate, rollback scripts |
| Large conversation performance | Medium | Medium | Pagination, lazy loading, indexes |
| SQLite file locking | Low | Medium | Single-writer pattern, connection pooling |
| Settings migration data loss | Low | High | Backup original files, validation |
| UI responsiveness with DB | Medium | Medium | Async operations, loading indicators |

---

## Acceptance Criteria

### v0.2.1
- [ ] SQLite database created on first run
- [ ] EF Core migrations run successfully
- [ ] All entity CRUD operations work
- [ ] Repositories pass unit tests

### v0.2.2
- [ ] Conversations persist across app restarts
- [ ] Conversation list displays in sidebar
- [ ] Can create, load, delete conversations
- [ ] Auto-save works without UI blocking
- [ ] Search finds conversations by title

### v0.2.3
- [ ] Sliders control all four parameters
- [ ] Values persist to settings
- [ ] Presets can be saved and loaded
- [ ] Built-in presets are available
- [ ] Parameter changes affect inference

### v0.2.4
- [ ] System prompt editor opens and closes
- [ ] Can create, edit, delete prompts
- [ ] Templates are available
- [ ] Default prompt is applied to new conversations
- [ ] Prompt selector works in chat header

### v0.2.5
- [ ] Global search finds conversations and messages
- [ ] Export produces valid files in all formats
- [ ] Migration from v0.1.0 succeeds
- [ ] All keyboard shortcuts work
- [ ] Status bar shows all indicators

---

## Timeline Estimate

| Version | Estimated Effort | Key Deliverables |
|---------|------------------|------------------|
| v0.2.1 | 2-3 days | Database layer, entities, repositories |
| v0.2.2 | 3-4 days | Conversation persistence, list UI |
| v0.2.3 | 2-3 days | Parameter sliders, presets |
| v0.2.4 | 2-3 days | System prompt editor, templates |
| v0.2.5 | 2-3 days | Search, export, migration, polish |
| **Total** | **11-16 days** | Complete v0.2.0 |

---

## References

- [Entity Framework Core Documentation](https://learn.microsoft.com/en-us/ef/core/)
- [SQLite FTS5 Extension](https://www.sqlite.org/fts5.html)
- [Avalonia UI Documentation](https://docs.avaloniaui.net/)
- [CommunityToolkit.Mvvm](https://learn.microsoft.com/en-us/dotnet/communitytoolkit/mvvm/)
