# Design Specification: The Senior Intern v0.2.1a "Project Setup"

## Executive Summary

This document provides a detailed implementation specification for v0.2.1a, which creates the `SeniorIntern.Data` project, configures Entity Framework Core with SQLite, and implements cross-platform database path resolution.

This sub-version establishes the foundational data layer infrastructure that enables all subsequent v0.2.x features including conversation persistence, parameter controls, and system prompt management. By setting up the Entity Framework Core project structure and cross-platform path resolution first, subsequent sub-versions can focus purely on domain entities and business logic.

### v0.2.1a Scope

- Create new `SeniorIntern.Data` class library project
- Configure EF Core with SQLite provider
- Implement cross-platform database path resolution
- Update solution file and project references
- Add central package management entries

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| SeniorIntern.Data Project | New class library for data access layer with EF Core SQLite |
| DatabasePathResolver | Cross-platform utility for resolving database and app data paths |
| Project References | Updated solution file and project dependencies |
| Package Management | Central package version entries for EF Core packages |

---

## Feature Overview

```
┌──────────────────────────────────────────────────────────────────┐
│                     v0.2.1a Feature Tree                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  Project Setup                                                    │
│  ├── Data Project Creation                                        │
│  │   ├── SeniorIntern.Data.csproj configuration                   │
│  │   ├── EF Core SQLite package references                        │
│  │   └── Project reference to SeniorIntern.Core                   │
│  │                                                                │
│  ├── Cross-Platform Path Resolution                               │
│  │   ├── Windows: %AppData%/SeniorIntern/                         │
│  │   ├── macOS: ~/Library/Application Support/SeniorIntern/       │
│  │   └── Linux: ~/.config/SeniorIntern/ (XDG compliant)           │
│  │                                                                │
│  └── Solution Integration                                         │
│      ├── Update SeniorIntern.sln                                  │
│      ├── Update SeniorIntern.Services.csproj references           │
│      └── Update SeniorIntern.Desktop.csproj references            │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## Architecture Diagrams

### Layer Interaction (Post v0.2.1a)

```
┌─────────────────────────────────────────────────────────────────┐
│                    SeniorIntern.Desktop                          │
│                    (Presentation Layer)                          │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐        │
│  │  ViewModels   │  │     Views     │  │   Converters  │        │
│  └───────────────┘  └───────────────┘  └───────────────┘        │
└─────────────────────────────┬───────────────────────────────────┘
                              │ Uses
┌─────────────────────────────▼───────────────────────────────────┐
│                    SeniorIntern.Services                         │
│                    (Application Layer)                           │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐        │
│  │  LlmService   │  │SettingsService│  │ConversationSvc│        │
│  └───────────────┘  └───────────────┘  └───────────────┘        │
└─────────────────────────────┬───────────────────────────────────┘
                              │ Uses
┌─────────────────────────────▼───────────────────────────────────┐
│                    SeniorIntern.Data                 [NEW]       │
│                    (Data Access Layer)                           │
│  ┌───────────────┐  ┌───────────────┐                           │
│  │DatabasePath   │  │ (DbContext    │                           │
│  │Resolver       │  │  in v0.2.1c)  │                           │
│  └───────────────┘  └───────────────┘                           │
└─────────────────────────────┬───────────────────────────────────┘
                              │ Uses
┌─────────────────────────────▼───────────────────────────────────┐
│                    SeniorIntern.Core                             │
│                    (Domain Layer)                                │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐        │
│  │   Entities    │  │  Interfaces   │  │    Models     │        │
│  │ (in v0.2.1b)  │  │               │  │               │        │
│  └───────────────┘  └───────────────┘  └───────────────┘        │
└─────────────────────────────────────────────────────────────────┘
```

### Project Dependency Graph

```
┌─────────────────────────────────────────────────────────────────┐
│                  Project Dependency Flow (v0.2.1a)               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────┐                                        │
│  │  SeniorIntern.Desktop │                                        │
│  └──────────┬───────────┘                                        │
│             │ references                                          │
│             ▼                                                     │
│  ┌──────────────────────┐     ┌──────────────────────┐           │
│  │ SeniorIntern.Services │────▶│   SeniorIntern.Data  │  [NEW]    │
│  └──────────┬───────────┘     └──────────┬───────────┘           │
│             │ references                  │ references            │
│             ▼                             ▼                       │
│  ┌──────────────────────────────────────────────────┐            │
│  │              SeniorIntern.Core                    │            │
│  └──────────────────────────────────────────────────┘            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### User Flow: Database Path Resolution

```
┌─────────────────────────────────────────────────────────────────┐
│                User Flow: Application Startup                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────┐      ┌──────────┐      ┌──────────┐               │
│  │   App    │ ──▶  │  Resolve │ ──▶  │  Create  │               │
│  │ Launches │      │   Path   │      │Directory │               │
│  └──────────┘      └──────────┘      └──────────┘               │
│       │                 │                 │                      │
│       ▼                 ▼                 ▼                      │
│  Desktop app      DatabasePath       Creates app                 │
│  initializes      Resolver called    data folder                 │
│                   for platform       if missing                  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Prerequisites

Before implementing v0.2.1a, ensure:

- .NET 8.0 SDK is installed
- Solution builds successfully (`dotnet build SeniorIntern.sln`)
- Existing projects: `SeniorIntern.Core`, `SeniorIntern.Services`, `SeniorIntern.Desktop`

---

## Implementation Details

### New NuGet Packages

| Package | Version | Project | Purpose |
|---------|---------|---------|---------|
| Microsoft.EntityFrameworkCore.Sqlite | 8.0.11 | SeniorIntern.Data | SQLite database provider for EF Core |
| Microsoft.EntityFrameworkCore.Design | 8.0.11 | SeniorIntern.Data | Design-time tools for migrations (private asset) |
| Microsoft.EntityFrameworkCore.Tools | 8.0.11 | SeniorIntern.Data | CLI tools for `dotnet ef` commands |

---

### Task 1: Update Directory.Packages.props

Add Entity Framework Core packages to central package management.

**File:** `Directory.Packages.props`

**Changes:**
Add the following entries inside the `<ItemGroup>` section:

```xml
<!-- Entity Framework Core -->
<PackageVersion Include="Microsoft.EntityFrameworkCore.Sqlite" Version="8.0.11" />
<PackageVersion Include="Microsoft.EntityFrameworkCore.Design" Version="8.0.11" />
<PackageVersion Include="Microsoft.EntityFrameworkCore.Tools" Version="8.0.11" />
```

**Rationale:**
- `Microsoft.EntityFrameworkCore.Sqlite` - SQLite database provider for EF Core
- `Microsoft.EntityFrameworkCore.Design` - Design-time tools for migrations (private asset)
- `Microsoft.EntityFrameworkCore.Tools` - CLI tools for `dotnet ef` commands

---

### Task 2: Create SeniorIntern.Data Project

Create the new class library project for the data access layer.

**Directory Structure:**
```
src/
└── SeniorIntern.Data/
    ├── SeniorIntern.Data.csproj
    └── DatabasePathResolver.cs
```

#### 2.1 Create Project File

**File:** `src/SeniorIntern.Data/SeniorIntern.Data.csproj`

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <LangVersion>12.0</LangVersion>
    <RootNamespace>SeniorIntern.Data</RootNamespace>
    <AssemblyName>SeniorIntern.Data</AssemblyName>
  </PropertyGroup>

  <ItemGroup>
    <!-- Entity Framework Core -->
    <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Design">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>

    <!-- Logging -->
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\SeniorIntern.Core\SeniorIntern.Core.csproj" />
  </ItemGroup>

</Project>
```

**Notes:**
- Package versions are centrally managed via `Directory.Packages.props`
- `Microsoft.EntityFrameworkCore.Design` is marked as private assets (not redistributed)
- References `SeniorIntern.Core` for entity classes (created in v0.2.1b)

---

#### 2.2 Create DatabasePathResolver

**File:** `src/SeniorIntern.Data/DatabasePathResolver.cs`

```csharp
namespace SeniorIntern.Data;

/// <summary>
/// Resolves database file paths based on the current platform.
/// Follows platform conventions for application data storage.
/// </summary>
/// <remarks>
/// <para>Platform-specific paths:</para>
/// <list type="bullet">
///   <item><description>Windows: %AppData%/SeniorIntern/seniorintern.db</description></item>
///   <item><description>macOS: ~/Library/Application Support/SeniorIntern/seniorintern.db</description></item>
///   <item><description>Linux: ~/.config/SeniorIntern/seniorintern.db</description></item>
/// </list>
/// </remarks>
public static class DatabasePathResolver
{
    /// <summary>
    /// Application name used for directory naming.
    /// </summary>
    private const string AppName = "SeniorIntern";

    /// <summary>
    /// Database file name.
    /// </summary>
    private const string DatabaseFileName = "seniorintern.db";

    /// <summary>
    /// Gets the full path to the database file for the current platform.
    /// Creates the parent directory if it does not exist.
    /// </summary>
    /// <returns>The absolute path to the SQLite database file.</returns>
    public static string GetDatabasePath()
    {
        var baseDir = GetApplicationDataDirectory();

        // Ensure directory exists
        if (!Directory.Exists(baseDir))
        {
            Directory.CreateDirectory(baseDir);
        }

        return Path.Combine(baseDir, DatabaseFileName);
    }

    /// <summary>
    /// Gets the application data directory for the current platform.
    /// </summary>
    /// <returns>The platform-appropriate application data directory path.</returns>
    /// <remarks>
    /// <para>This method returns OS-specific paths following each platform's conventions:</para>
    /// <list type="bullet">
    ///   <item><description>Windows: Uses Environment.SpecialFolder.ApplicationData (%AppData%)</description></item>
    ///   <item><description>macOS: Uses ~/Library/Application Support (standard macOS location)</description></item>
    ///   <item><description>Linux/Other: Uses ~/.config (XDG Base Directory specification)</description></item>
    /// </list>
    /// </remarks>
    public static string GetApplicationDataDirectory()
    {
        if (OperatingSystem.IsWindows())
        {
            // Windows: %AppData%/SeniorIntern/
            // Example: C:\Users\username\AppData\Roaming\SeniorIntern\
            var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
            return Path.Combine(appData, AppName);
        }
        else if (OperatingSystem.IsMacOS())
        {
            // macOS: ~/Library/Application Support/SeniorIntern/
            // Example: /Users/username/Library/Application Support/SeniorIntern/
            var home = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
            return Path.Combine(home, "Library", "Application Support", AppName);
        }
        else
        {
            // Linux and others: ~/.config/SeniorIntern/
            // Example: /home/username/.config/SeniorIntern/
            // Follows XDG Base Directory specification
            var xdgConfigHome = Environment.GetEnvironmentVariable("XDG_CONFIG_HOME");
            if (!string.IsNullOrEmpty(xdgConfigHome))
            {
                return Path.Combine(xdgConfigHome, AppName);
            }

            var home = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
            return Path.Combine(home, ".config", AppName);
        }
    }

    /// <summary>
    /// Gets the SQLite connection string for the database.
    /// </summary>
    /// <returns>A SQLite connection string.</returns>
    /// <example>
    /// <code>
    /// var connectionString = DatabasePathResolver.GetConnectionString();
    /// // Returns: "Data Source=/path/to/seniorintern.db"
    /// </code>
    /// </example>
    public static string GetConnectionString()
    {
        var dbPath = GetDatabasePath();
        return $"Data Source={dbPath}";
    }

    /// <summary>
    /// Gets a timestamped backup path for the database.
    /// Used before running migrations to preserve data.
    /// </summary>
    /// <returns>A path for a backup file with timestamp suffix.</returns>
    /// <example>
    /// <code>
    /// var backupPath = DatabasePathResolver.GetBackupPath();
    /// // Returns: "/path/to/seniorintern_backup_20240115_143022.db"
    /// </code>
    /// </example>
    public static string GetBackupPath()
    {
        var dbPath = GetDatabasePath();
        var directory = Path.GetDirectoryName(dbPath)!;
        var timestamp = DateTime.Now.ToString("yyyyMMdd_HHmmss");
        return Path.Combine(directory, $"seniorintern_backup_{timestamp}.db");
    }

    /// <summary>
    /// Checks if the database file exists.
    /// </summary>
    /// <returns>True if the database file exists; otherwise, false.</returns>
    public static bool DatabaseExists()
    {
        return File.Exists(GetDatabasePath());
    }

    /// <summary>
    /// Gets the logs directory for the application.
    /// Creates the directory if it does not exist.
    /// </summary>
    /// <returns>The path to the logs directory.</returns>
    public static string GetLogsDirectory()
    {
        var baseDir = GetApplicationDataDirectory();
        var logsDir = Path.Combine(baseDir, "logs");

        if (!Directory.Exists(logsDir))
        {
            Directory.CreateDirectory(logsDir);
        }

        return logsDir;
    }
}
```

**Key Implementation Details:**

| Method | Purpose |
|--------|---------|
| `GetDatabasePath()` | Returns full path to database, creates directory if needed |
| `GetApplicationDataDirectory()` | Returns platform-specific app data folder |
| `GetConnectionString()` | Returns SQLite connection string for EF Core |
| `GetBackupPath()` | Returns timestamped backup path for migrations |
| `DatabaseExists()` | Helper to check if database has been created |
| `GetLogsDirectory()` | Returns path to logs subdirectory |

**Platform Path Examples:**

| Platform | Application Data Directory | Database Path |
|----------|---------------------------|---------------|
| Windows | `C:\Users\{user}\AppData\Roaming\SeniorIntern\` | `...\SeniorIntern\seniorintern.db` |
| macOS | `/Users/{user}/Library/Application Support/SeniorIntern/` | `.../SeniorIntern/seniorintern.db` |
| Linux | `/home/{user}/.config/SeniorIntern/` | `.../SeniorIntern/seniorintern.db` |

---

### Task 3: Update Solution File

Add the new Data project to the solution.

**File:** `SeniorIntern.sln`

**Command:**
```bash
dotnet sln SeniorIntern.sln add src/SeniorIntern.Data/SeniorIntern.Data.csproj
```

**Manual Edit (if needed):**
Add to the solution file inside the project declarations section:

```
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "SeniorIntern.Data", "src\SeniorIntern.Data\SeniorIntern.Data.csproj", "{GENERATED-GUID}"
EndProject
```

And add build configurations in the `GlobalSection(ProjectConfigurationPlatforms)`:

```
{GENERATED-GUID}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
{GENERATED-GUID}.Debug|Any CPU.Build.0 = Debug|Any CPU
{GENERATED-GUID}.Release|Any CPU.ActiveCfg = Release|Any CPU
{GENERATED-GUID}.Release|Any CPU.Build.0 = Release|Any CPU
```

---

### Task 4: Update Project References

#### 4.1 Update SeniorIntern.Services.csproj

**File:** `src/SeniorIntern.Services/SeniorIntern.Services.csproj`

Add project reference to Data project:

```xml
<ItemGroup>
  <ProjectReference Include="..\SeniorIntern.Core\SeniorIntern.Core.csproj" />
  <ProjectReference Include="..\SeniorIntern.Data\SeniorIntern.Data.csproj" />
</ItemGroup>
```

**Rationale:** Services layer will use repositories for data access.

---

#### 4.2 Update SeniorIntern.Desktop.csproj

**File:** `src/SeniorIntern.Desktop/SeniorIntern.Desktop.csproj`

Add project reference to Data project:

```xml
<ItemGroup>
  <ProjectReference Include="..\SeniorIntern.Core\SeniorIntern.Core.csproj" />
  <ProjectReference Include="..\SeniorIntern.Services\SeniorIntern.Services.csproj" />
  <ProjectReference Include="..\SeniorIntern.Data\SeniorIntern.Data.csproj" />
</ItemGroup>
```

**Rationale:** Desktop app needs direct access to Data layer for DI registration and database initialization.

---

## Logging Specifications

### Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| DatabasePathResolver | Debug | Path resolution details |
| DatabasePathResolver | Information | Directory created for app data |
| DatabasePathResolver | Warning | XDG_CONFIG_HOME not set (Linux) |
| DatabasePathResolver | Error | Directory creation failed |

### Log Message Format

```csharp
// Information - Directory created
_logger.LogInformation("Created application data directory at '{Path}'",
    directoryPath);

// Debug - Path resolution
_logger.LogDebug("Resolved database path for {Platform}: '{Path}'",
    OperatingSystem.IsWindows() ? "Windows" : OperatingSystem.IsMacOS() ? "macOS" : "Linux",
    dbPath);

// Warning - Fallback used
_logger.LogWarning("XDG_CONFIG_HOME not set, using default ~/.config path");

// Error - Failure
_logger.LogError(ex, "Failed to create application data directory at '{Path}'",
    directoryPath);
```

**Note:** DatabasePathResolver is currently implemented as a static class without logging. Logging can be added in future versions if needed by converting to an instance class with ILogger injection.

---

## Unit Testing Requirements

### Test Summary

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| DatabasePathResolver | 8 | Path resolution, directory creation, platform detection |
| **Total** | **8** | |

### Key Test Scenarios

#### DatabasePathResolver Tests

```csharp
[Fact]
public void GetDatabasePath_ReturnsNonEmptyPath()
{
    // Arrange & Act
    var path = DatabasePathResolver.GetDatabasePath();

    // Assert
    Assert.False(string.IsNullOrEmpty(path));
    Assert.EndsWith("seniorintern.db", path);
}

[Fact]
public void GetDatabasePath_CreatesDirectoryIfNotExists()
{
    // Arrange
    var appDataDir = DatabasePathResolver.GetApplicationDataDirectory();
    if (Directory.Exists(appDataDir))
    {
        Directory.Delete(appDataDir, recursive: true);
    }

    // Act
    var path = DatabasePathResolver.GetDatabasePath();

    // Assert
    Assert.True(Directory.Exists(Path.GetDirectoryName(path)));
}

[Fact]
public void GetConnectionString_ReturnsValidSqliteConnectionString()
{
    // Arrange & Act
    var connectionString = DatabasePathResolver.GetConnectionString();

    // Assert
    Assert.StartsWith("Data Source=", connectionString);
    Assert.Contains("seniorintern.db", connectionString);
}

[Fact]
public void GetBackupPath_IncludesTimestamp()
{
    // Arrange & Act
    var backupPath = DatabasePathResolver.GetBackupPath();

    // Assert
    Assert.Contains("seniorintern_backup_", backupPath);
    Assert.EndsWith(".db", backupPath);
}

[Fact]
public void DatabaseExists_ReturnsFalse_WhenDatabaseNotCreated()
{
    // Arrange
    var dbPath = DatabasePathResolver.GetDatabasePath();
    if (File.Exists(dbPath))
    {
        File.Delete(dbPath);
    }

    // Act
    var exists = DatabasePathResolver.DatabaseExists();

    // Assert
    Assert.False(exists);
}

[Fact]
public void GetLogsDirectory_CreatesDirectoryIfNotExists()
{
    // Arrange & Act
    var logsDir = DatabasePathResolver.GetLogsDirectory();

    // Assert
    Assert.True(Directory.Exists(logsDir));
    Assert.EndsWith("logs", logsDir);
}

[Fact]
public void GetApplicationDataDirectory_ReturnsPathContainingAppName()
{
    // Arrange & Act
    var appDataDir = DatabasePathResolver.GetApplicationDataDirectory();

    // Assert
    Assert.Contains("SeniorIntern", appDataDir);
}

[Fact]
public void GetApplicationDataDirectory_ReturnsAbsolutePath()
{
    // Arrange & Act
    var appDataDir = DatabasePathResolver.GetApplicationDataDirectory();

    // Assert
    Assert.True(Path.IsPathRooted(appDataDir));
}
```

---

## Use Cases

### UC-001: Database Path Resolution on Application Startup

| Attribute | Value |
|-----------|-------|
| **Actor** | System (Application) |
| **Precondition** | Application is starting for the first time or after clean install |
| **Trigger** | Application initialization |
| **Success Scenario** | Platform-appropriate database path is resolved and directory is created |
| **Failure Scenarios** | Directory creation fails due to permissions → throw UnauthorizedAccessException |
| **Postcondition** | Database directory exists and path is available for DbContext configuration |

#### Flow
1. Application starts initialization
2. System calls `DatabasePathResolver.GetDatabasePath()`
3. System detects current platform (Windows/macOS/Linux)
4. System constructs platform-appropriate path
5. System checks if directory exists
6. If directory doesn't exist, system creates it
7. System returns full database path

---

## Deliverable Checklist

### Domain Layer (SeniorIntern.Core)
- [ ] No changes in v0.2.1a (entities added in v0.2.1b)

### Data Layer (SeniorIntern.Data)
- [x] SeniorIntern.Data.csproj - Project file with EF Core packages
- [x] DatabasePathResolver.cs - Cross-platform path resolution

### Application Layer (SeniorIntern.Services)
- [x] Updated project reference to SeniorIntern.Data

### Presentation Layer (SeniorIntern.Desktop)
- [x] Updated project reference to SeniorIntern.Data

### Configuration
- [x] Directory.Packages.props - EF Core package versions
- [x] SeniorIntern.sln - Data project added

### Tests
- [ ] SeniorIntern.Data.Tests - DatabasePathResolver tests

### Documentation
- [x] This design specification (v0.2.1a-project-setup.md)

---

## Files Summary

### Files to Create (2)

| File | Purpose | Lines (approx) |
|------|---------|----------------|
| `src/SeniorIntern.Data/SeniorIntern.Data.csproj` | Project file with EF Core packages | 25 |
| `src/SeniorIntern.Data/DatabasePathResolver.cs` | Cross-platform path resolution | 120 |

### Files to Modify (4)

| File | Changes |
|------|---------|
| `Directory.Packages.props` | Add 3 EF Core package versions |
| `SeniorIntern.sln` | Add Data project reference |
| `src/SeniorIntern.Services/SeniorIntern.Services.csproj` | Add Data project reference |
| `src/SeniorIntern.Desktop/SeniorIntern.Desktop.csproj` | Add Data project reference |

---

## Verification Steps

### Step 1: Verify Project Creation

```bash
# Create the project directory
mkdir -p src/SeniorIntern.Data

# Verify project file exists after creation
ls src/SeniorIntern.Data/SeniorIntern.Data.csproj
```

### Step 2: Verify Package Restore

```bash
# Restore packages for new project
dotnet restore src/SeniorIntern.Data

# Expected output: packages restored successfully
```

### Step 3: Verify Project Builds

```bash
# Build the Data project
dotnet build src/SeniorIntern.Data

# Expected output: Build succeeded
```

### Step 4: Verify Solution Builds

```bash
# Build entire solution
dotnet build SeniorIntern.sln

# Expected output: All projects build successfully
```

### Step 5: Verify Path Resolution (Manual Test)

Create a temporary test to verify path resolution:

```csharp
// Temporary test in Program.cs or a unit test
Console.WriteLine($"Database path: {DatabasePathResolver.GetDatabasePath()}");
Console.WriteLine($"App data dir: {DatabasePathResolver.GetApplicationDataDirectory()}");
Console.WriteLine($"Connection string: {DatabasePathResolver.GetConnectionString()}");
Console.WriteLine($"Database exists: {DatabasePathResolver.DatabaseExists()}");
```

**Expected Output (macOS example):**
```
Database path: /Users/username/Library/Application Support/SeniorIntern/seniorintern.db
App data dir: /Users/username/Library/Application Support/SeniorIntern
Connection string: Data Source=/Users/username/Library/Application Support/SeniorIntern/seniorintern.db
Database exists: False
```

### Step 6: Verify EF Core Tools

```bash
# Install EF Core tools globally (if not already installed)
dotnet tool install --global dotnet-ef

# Verify EF Core is accessible in the project
cd src/SeniorIntern.Data
dotnet ef --version

# Expected output: Entity Framework Core .NET Command-line Tools 8.0.x
```

---

## Acceptance Criteria

### Functional Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| AC-1 | Data project exists and is valid | `dotnet build src/SeniorIntern.Data` succeeds |
| AC-2 | Solution includes Data project | `dotnet sln list` shows SeniorIntern.Data |
| AC-3 | EF Core packages are referenced | Package restore includes EntityFrameworkCore.Sqlite |
| AC-4 | Project references are correct | Solution builds without reference errors |
| AC-5 | DatabasePathResolver compiles | No compilation errors in DatabasePathResolver.cs |
| AC-6 | Path resolution returns valid paths | GetDatabasePath() returns non-null, non-empty path |
| AC-7 | Directory creation works | GetDatabasePath() creates parent directory |
| AC-8 | Platform detection works | Correct path format on Windows/macOS/Linux |

### Quality Criteria

- [x] All code includes XML documentation comments
- [x] No compiler warnings
- [x] Code follows established patterns
- [x] Cross-platform compatibility verified

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Package restore fails | Low | Medium | Verify central package version entries match |
| Project reference not found | Low | Medium | Verify relative paths in .csproj files |
| Directory permission denied | Medium | Medium | Use platform-appropriate locations; document fallback |
| Path too long (Windows) | Low | Low | Use shorter app name; path is well under 260 chars |

---

## Error Handling

### Common Issues and Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| Package restore fails | Missing central package version | Add package to Directory.Packages.props |
| Project reference not found | Wrong relative path | Verify path in .csproj file |
| Directory permission denied | App data folder restricted | Use different folder or request permissions |
| Path too long (Windows) | Path exceeds 260 chars | Use shorter app name or enable long paths |

### DatabasePathResolver Error Handling

The `GetDatabasePath()` method handles:
- Missing directories → Creates them automatically
- Non-existent parent paths → Creates full path hierarchy

Potential exceptions:
- `UnauthorizedAccessException` → User lacks write permission
- `PathTooLongException` → Path exceeds system limit
- `IOException` → Disk full or other I/O error

---

## Future Considerations

| Item | Target Version | Rationale for Deferral |
|------|----------------|------------------------|
| Logging injection to DatabasePathResolver | v0.2.5 or later | Keep v0.2.1a focused on project setup; static class is simpler |
| Database encryption | v0.5.0+ | Security feature not in current roadmap |
| Custom database path configuration | v0.3.0+ | User settings system not yet implemented |

---

## Timeline Estimate

| Version | Estimated Effort | Key Deliverables |
|---------|------------------|------------------|
| v0.2.1a | 0.5 days | Data project, DatabasePathResolver, project references |

---

## Architecture Summary

### Project Structure After v0.2.1a

```
SeniorIntern/
├── src/
│   ├── SeniorIntern.Core/
│   │   ├── Models/
│   │   │   ├── ChatMessage.cs
│   │   │   ├── Conversation.cs
│   │   │   ├── AppSettings.cs
│   │   │   └── ModelLoadOptions.cs
│   │   ├── Interfaces/
│   │   │   ├── IConversationService.cs
│   │   │   ├── ILlmService.cs
│   │   │   └── ISettingsService.cs
│   │   ├── Events/
│   │   └── Exceptions/
│   │
│   ├── SeniorIntern.Data/                          [NEW PROJECT]
│   │   ├── SeniorIntern.Data.csproj                [NEW]
│   │   └── DatabasePathResolver.cs                 [NEW]
│   │
│   ├── SeniorIntern.Services/
│   │   └── SeniorIntern.Services.csproj            (updated - reference to Data)
│   │
│   └── SeniorIntern.Desktop/
│       └── SeniorIntern.Desktop.csproj             (updated - reference to Data)
│
├── tests/
│   └── SeniorIntern.Data.Tests/                    [NEW - for unit tests]
│
├── Directory.Packages.props                        (updated - EF Core packages)
└── SeniorIntern.sln                                (updated - includes Data project)
```

### New NuGet Packages (v0.2.1a)

| Package | Version | Project | Purpose |
|---------|---------|---------|---------|
| Microsoft.EntityFrameworkCore.Sqlite | 8.0.11 | SeniorIntern.Data | SQLite provider |
| Microsoft.EntityFrameworkCore.Design | 8.0.11 | SeniorIntern.Data | Migrations tooling |
| Microsoft.EntityFrameworkCore.Tools | 8.0.11 | SeniorIntern.Data | CLI tools |

### Dependency Flow

```
SeniorIntern.Core (no dependencies)
       ↑
SeniorIntern.Data (→ Core, EF Core)
       ↑
SeniorIntern.Services (→ Core, Data, LLamaSharp)
       ↑
SeniorIntern.Desktop (→ Core, Services, Data, Avalonia)
```

---

## Next Steps

After completing v0.2.1a, proceed to:

**v0.2.1b: Entity Classes**
- Create entity classes in `SeniorIntern.Core/Entities/`
- Define relationships and data annotations
- Create MessageRole enum

The Data project created in v0.2.1a will reference these entities from the Core project.

---

## Appendix: Commands Quick Reference

```bash
# Create project directory
mkdir -p src/SeniorIntern.Data

# Add project to solution
dotnet sln SeniorIntern.sln add src/SeniorIntern.Data/SeniorIntern.Data.csproj

# Restore and build
dotnet restore
dotnet build

# Verify EF Core tools
dotnet ef --version
```

---

## References

- [Entity Framework Core Documentation](https://learn.microsoft.com/en-us/ef/core/)
- [SQLite EF Core Provider](https://learn.microsoft.com/en-us/ef/core/providers/sqlite/)
- [XDG Base Directory Specification](https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html)
- [.NET OperatingSystem Class](https://learn.microsoft.com/en-us/dotnet/api/system.operatingsystem)
