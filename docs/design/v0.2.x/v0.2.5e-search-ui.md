# Design Specification: The Senior Intern v0.2.5e "Search UI"

## Executive Summary

This document provides a detailed implementation specification for v0.2.5e, which creates the search dialog UI with full keyboard navigation support. The `SearchDialog` provides a spotlight-style search experience with debounced queries, filter tabs, grouped results, and keyboard shortcuts for navigation.

### v0.2.5e Scope (from v0.2.5 Design Document)

- Create `SearchViewModel` with debounced search
- Create `SearchDialog.axaml` with spotlight-style UI
- Implement filter tabs (All, Conversations, Messages)
- Group results by type with icons
- Keyboard navigation (Up/Down, Enter, Escape)
- Status bar with result count and timing
- Integration with MainWindow (Ctrl+K)

### Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| SearchViewModel | ViewModel with debounce and navigation |
| SearchDialog | Spotlight-style search window |
| Keyboard Support | Full keyboard navigation |
| Result Templates | Conversation and message templates |
| Integration | MainWindow Ctrl+K shortcut |

---

## Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     v0.2.5e Feature Tree                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  SearchViewModel                                                  â”‚
â”‚  â”œâ”€â”€ Properties                                                   â”‚
â”‚  â”‚   â”œâ”€â”€ Query (string) - triggers debounced search              â”‚
â”‚  â”‚   â”œâ”€â”€ IsSearching (bool)                                       â”‚
â”‚  â”‚   â”œâ”€â”€ SearchStatus (string) - "Found 15 results in 23ms"      â”‚
â”‚  â”‚   â”œâ”€â”€ SelectedResult (SearchResult?)                           â”‚
â”‚  â”‚   â”œâ”€â”€ FilterType (SearchResultType?) - null = all             â”‚
â”‚  â”‚   â”œâ”€â”€ ConversationResults (ObservableCollection)               â”‚
â”‚  â”‚   â””â”€â”€ MessageResults (ObservableCollection)                    â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Commands                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ SelectResultCommand(result) â†’ navigate + close          â”‚
â”‚  â”‚   â”œâ”€â”€ SetFilterCommand(type?) â†’ re-search                     â”‚
â”‚  â”‚   â”œâ”€â”€ CloseCommand â†’ fires CloseRequested                     â”‚
â”‚  â”‚   â”œâ”€â”€ NavigateUpCommand â†’ previous result                     â”‚
â”‚  â”‚   â””â”€â”€ NavigateDownCommand â†’ next result                       â”‚
â”‚  â”‚                                                                â”‚
â”‚  â”œâ”€â”€ Events                                                       â”‚
â”‚  â”‚   â”œâ”€â”€ NavigateToConversation(Guid)                             â”‚
â”‚  â”‚   â””â”€â”€ CloseRequested()                                         â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â”€ Internals                                                    â”‚
â”‚      â”œâ”€â”€ _debounceTimer (300ms)                                   â”‚
â”‚      â”œâ”€â”€ _searchCts (cancellation)                                â”‚
â”‚      â””â”€â”€ ExecuteSearchAsync()                                     â”‚
â”‚                                                                   â”‚
â”‚  SearchDialog (600x500, borderless)                               â”‚
â”‚  â”œâ”€â”€ Search Input (autofocus, watermark)                          â”‚
â”‚  â”œâ”€â”€ Filter Tabs (All | Conversations | Messages)                 â”‚
â”‚  â”œâ”€â”€ Results Area                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ Conversations Section (ğŸ“ icon)                          â”‚
â”‚  â”‚   â”œâ”€â”€ Messages Section (ğŸ’¬ icon)                               â”‚
â”‚  â”‚   â””â”€â”€ Empty State ("No results found")                         â”‚
â”‚  â””â”€â”€ Status Bar (count, timing, keyboard hints)                   â”‚
â”‚                                                                   â”‚
â”‚  Keyboard Bindings                                                â”‚
â”‚  â”œâ”€â”€ Escape â†’ Close                                               â”‚
â”‚  â”œâ”€â”€ Up â†’ NavigateUp                                              â”‚
â”‚  â”œâ”€â”€ Down â†’ NavigateDown                                          â”‚
â”‚  â””â”€â”€ Enter â†’ SelectResult                                         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Diagrams

### Search Flow with Debounce

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Search Flow with Debounce                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User types "data"                                               â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OnQueryChanged("data")                                    â”‚    â”‚
â”‚  â”‚   _debounceTimer.Stop()                                   â”‚    â”‚
â”‚  â”‚   _debounceTimer.Start() [300ms]                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                                   â”‚
â”‚  User types "base" (now "database")                              â”‚
â”‚              â”‚                                                   â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ OnQueryChanged("database")                                â”‚    â”‚
â”‚  â”‚   _debounceTimer.Stop()    â† Reset timer                  â”‚    â”‚
â”‚  â”‚   _debounceTimer.Start() [300ms]                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”‚ 300ms passes (user stops typing)                  â”‚
â”‚              â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Timer.Elapsed â†’ ExecuteSearchAsync()                      â”‚    â”‚
â”‚  â”‚   1. Cancel previous search (_searchCts)                  â”‚    â”‚
â”‚  â”‚   2. IsSearching = true                                   â”‚    â”‚
â”‚  â”‚   3. SearchStatus = "Searching..."                        â”‚    â”‚
â”‚  â”‚   4. Call ISearchService.SearchAsync(query)               â”‚    â”‚
â”‚  â”‚   5. Update ConversationResults, MessageResults           â”‚    â”‚
â”‚  â”‚   6. SearchStatus = "Found 12 results in 18ms"            â”‚    â”‚
â”‚  â”‚   7. IsSearching = false                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dialog Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SearchDialog Layout (600x500)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”  [Search conversations and messages...            ]    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â—‹ All    â—‹ Conversations    â—‹ Messages                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Conversations                                               â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ“ Database Migration Discussion          Jan 10    â”‚   â”‚  â”‚
â”‚  â”‚ â”‚    ...discussing the database schema changes...       â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ“ Data Validation Patterns                Jan 8     â”‚   â”‚  â”‚
â”‚  â”‚ â”‚    ...validating user input before...                 â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚ Messages                                                    â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ’¬ ...use a relational database for this...           â”‚   â”‚  â”‚
â”‚  â”‚ â”‚    in: Database Discussion                Jan 10     â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Found 3 results in 18ms     â†‘â†“ Navigate  Enter Select  Esc â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Directory Structure

```
src/SeniorIntern.Desktop/
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ SearchViewModel.cs                            (NEW)
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ SearchDialog.axaml                            (NEW)
â”‚   â””â”€â”€ SearchDialog.axaml.cs                         (NEW)
â””â”€â”€ App.axaml.cs                                      (UPDATE - Ctrl+K binding)
```

---

## Implementation Details

### Task 1: Create SearchViewModel

**File:** `src/SeniorIntern.Desktop/ViewModels/SearchViewModel.cs`

```csharp
namespace SeniorIntern.Desktop.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using SeniorIntern.Core.Interfaces;
using SeniorIntern.Core.Models;
using System.Collections.ObjectModel;
using System.Timers;

public partial class SearchViewModel : ViewModelBase, IDisposable
{
    private readonly ISearchService _searchService;
    private readonly IConversationService _conversationService;
    private CancellationTokenSource? _searchCts;
    private readonly Timer _debounceTimer;

    [ObservableProperty] private string _query = string.Empty;
    [ObservableProperty] private bool _isSearching;
    [ObservableProperty] private string _searchStatus = string.Empty;
    [ObservableProperty] private SearchResult? _selectedResult;
    [ObservableProperty] private SearchResultType? _filterType;

    public ObservableCollection<SearchResult> ConversationResults { get; } = [];
    public ObservableCollection<SearchResult> MessageResults { get; } = [];

    public event EventHandler<Guid>? NavigateToConversation;
    public event EventHandler? CloseRequested;

    public SearchViewModel(ISearchService searchService, IConversationService conversationService)
    {
        _searchService = searchService;
        _conversationService = conversationService;

        _debounceTimer = new Timer(300) { AutoReset = false };
        _debounceTimer.Elapsed += async (s, e) => await ExecuteSearchAsync();
    }

    partial void OnQueryChanged(string value)
    {
        _debounceTimer.Stop();

        if (string.IsNullOrWhiteSpace(value))
        {
            ConversationResults.Clear();
            MessageResults.Clear();
            SearchStatus = string.Empty;
            return;
        }

        _debounceTimer.Start();
    }

    private async Task ExecuteSearchAsync()
    {
        _searchCts?.Cancel();
        _searchCts = new CancellationTokenSource();

        try
        {
            IsSearching = true;
            SearchStatus = "Searching...";

            var results = await _searchService.SearchAsync(
                new SearchQuery { Text = Query, FilterType = FilterType, MaxResults = 50 },
                _searchCts.Token);

            await Avalonia.Threading.Dispatcher.UIThread.InvokeAsync(() =>
            {
                ConversationResults.Clear();
                MessageResults.Clear();

                foreach (var result in results.Conversations)
                    ConversationResults.Add(result);

                foreach (var result in results.Messages)
                    MessageResults.Add(result);

                SearchStatus = $"Found {results.TotalCount} results in {results.SearchDuration.TotalMilliseconds:F0}ms";
            });
        }
        catch (OperationCanceledException) { /* Expected */ }
        catch (Exception ex) { SearchStatus = $"Error: {ex.Message}"; }
        finally { IsSearching = false; }
    }

    [RelayCommand]
    private void SelectResult(SearchResult? result)
    {
        if (result is null) return;

        var conversationId = result.Type == SearchResultType.Conversation
            ? result.Id
            : result.ConversationId!.Value;

        NavigateToConversation?.Invoke(this, conversationId);
        CloseRequested?.Invoke(this, EventArgs.Empty);
    }

    [RelayCommand]
    private void SetFilter(SearchResultType? type)
    {
        FilterType = type;
        if (!string.IsNullOrWhiteSpace(Query))
        {
            _debounceTimer.Stop();
            _debounceTimer.Start();
        }
    }

    [RelayCommand]
    private void Close() => CloseRequested?.Invoke(this, EventArgs.Empty);

    [RelayCommand]
    private void NavigateUp()
    {
        var allResults = ConversationResults.Concat(MessageResults).ToList();
        if (allResults.Count == 0) return;

        var currentIndex = SelectedResult is null ? 0 : allResults.IndexOf(SelectedResult);
        SelectedResult = allResults[Math.Max(0, currentIndex - 1)];
    }

    [RelayCommand]
    private void NavigateDown()
    {
        var allResults = ConversationResults.Concat(MessageResults).ToList();
        if (allResults.Count == 0) return;

        var currentIndex = SelectedResult is null ? -1 : allResults.IndexOf(SelectedResult);
        SelectedResult = allResults[Math.Min(allResults.Count - 1, currentIndex + 1)];
    }

    public void Dispose() => _debounceTimer.Dispose();
}
```

---

### Task 2: Create SearchDialog.axaml

**File:** `src/SeniorIntern.Desktop/Views/SearchDialog.axaml`

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SeniorIntern.Desktop.ViewModels"
        xmlns:models="using:SeniorIntern.Core.Models"
        x:Class="SeniorIntern.Desktop.Views.SearchDialog"
        x:DataType="vm:SearchViewModel"
        Title="Search"
        Width="600" Height="500"
        WindowStartupLocation="CenterOwner"
        CanResize="False" ShowInTaskbar="False"
        SystemDecorations="BorderOnly"
        Background="{DynamicResource SystemChromeMediumColor}">

    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding CloseCommand}" />
        <KeyBinding Gesture="Up" Command="{Binding NavigateUpCommand}" />
        <KeyBinding Gesture="Down" Command="{Binding NavigateDownCommand}" />
        <KeyBinding Gesture="Enter" Command="{Binding SelectResultCommand}"
                    CommandParameter="{Binding SelectedResult}" />
    </Window.KeyBindings>

    <Border BorderBrush="{DynamicResource AccentColor}" BorderThickness="1" CornerRadius="8">
        <Grid RowDefinitions="Auto,Auto,*,Auto">

            <!-- Search Input -->
            <Border Grid.Row="0" Background="{DynamicResource SidebarBackgroundColor}" Padding="16">
                <Grid ColumnDefinitions="Auto,*">
                    <PathIcon Grid.Column="0" Data="{StaticResource SearchIcon}"
                              Foreground="{DynamicResource AccentColor}"
                              Width="20" Height="20" Margin="0,0,12,0" />
                    <TextBox Grid.Column="1" x:Name="SearchInput"
                             Text="{Binding Query, Mode=TwoWay}"
                             Watermark="Search conversations and messages..."
                             FontSize="16" BorderThickness="0" Background="Transparent" />
                </Grid>
            </Border>

            <!-- Filter Tabs -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="16,8" Spacing="8">
                <RadioButton Content="All" GroupName="SearchFilter"
                             IsChecked="{Binding FilterType, Converter={x:Static ObjectConverters.IsNull}}"
                             Command="{Binding SetFilterCommand}" CommandParameter="{x:Null}" />
                <RadioButton Content="Conversations" GroupName="SearchFilter"
                             Command="{Binding SetFilterCommand}">
                    <RadioButton.CommandParameter>
                        <x:Static Member="models:SearchResultType.Conversation" />
                    </RadioButton.CommandParameter>
                </RadioButton>
                <RadioButton Content="Messages" GroupName="SearchFilter"
                             Command="{Binding SetFilterCommand}">
                    <RadioButton.CommandParameter>
                        <x:Static Member="models:SearchResultType.Message" />
                    </RadioButton.CommandParameter>
                </RadioButton>
            </StackPanel>

            <!-- Results -->
            <ScrollViewer Grid.Row="2" Padding="8">
                <StackPanel Spacing="16">
                    <!-- Conversation Results -->
                    <StackPanel IsVisible="{Binding ConversationResults.Count}">
                        <TextBlock Text="Conversations" FontWeight="SemiBold" Margin="8,0,0,8" />
                        <ItemsControl ItemsSource="{Binding ConversationResults}">
                            <!-- Conversation item template -->
                        </ItemsControl>
                    </StackPanel>

                    <!-- Message Results -->
                    <StackPanel IsVisible="{Binding MessageResults.Count}">
                        <TextBlock Text="Messages" FontWeight="SemiBold" Margin="8,0,0,8" />
                        <ItemsControl ItemsSource="{Binding MessageResults}">
                            <!-- Message item template -->
                        </ItemsControl>
                    </StackPanel>

                    <!-- Empty State -->
                    <TextBlock Text="No results found" HorizontalAlignment="Center" Margin="0,40"
                               IsVisible="{Binding !ConversationResults.Count}" />
                </StackPanel>
            </ScrollViewer>

            <!-- Status Bar -->
            <Border Grid.Row="3" Background="{DynamicResource SidebarBackgroundColor}" Padding="16,8">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0" Text="{Binding SearchStatus}" />
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                        <TextBlock Text="â†‘â†“ Navigate" Opacity="0.6" />
                        <TextBlock Text="Enter Select" Opacity="0.6" />
                        <TextBlock Text="Esc Close" Opacity="0.6" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
```

---

### Task 3: Create SearchDialog.axaml.cs

**File:** `src/SeniorIntern.Desktop/Views/SearchDialog.axaml.cs`

```csharp
namespace SeniorIntern.Desktop.Views;

using Avalonia.Controls;
using SeniorIntern.Desktop.ViewModels;

public partial class SearchDialog : Window
{
    public SearchDialog()
    {
        InitializeComponent();
    }

    public SearchDialog(SearchViewModel viewModel) : this()
    {
        DataContext = viewModel;
        viewModel.CloseRequested += (s, e) => Close();
    }

    protected override void OnOpened(EventArgs e)
    {
        base.OnOpened(e);
        this.FindControl<TextBox>("SearchInput")?.Focus();
    }
}
```

---

### Task 4: Add MainWindow Integration

**File:** `src/SeniorIntern.Desktop/ViewModels/MainWindowViewModel.cs` (addition)

```csharp
[RelayCommand]
private async Task OpenSearchAsync()
{
    var viewModel = new SearchViewModel(_searchService, _conversationService);
    viewModel.NavigateToConversation += async (s, id) =>
    {
        await _conversationService.LoadConversationAsync(id);
    };

    var dialog = new SearchDialog(viewModel);
    await dialog.ShowDialog(GetMainWindow());
}
```

**Add keyboard binding in MainWindow.axaml:**

```xml
<Window.KeyBindings>
    <KeyBinding Gesture="Ctrl+K" Command="{Binding OpenSearchCommand}" />
</Window.KeyBindings>
```

---

## Unit Testing Requirements

| Component | Test Count | Focus Areas |
|-----------|------------|-------------|
| Query debounce | 3 | Timer reset, empty clears |
| ExecuteSearchAsync | 3 | Success, cancellation, error |
| Navigation | 4 | Up, Down, bounds, empty |
| SelectResult | 2 | Conversation, Message |
| SetFilter | 2 | Triggers re-search |
| **Total** | **14** | |

### Key Test Scenarios

```csharp
[Fact]
public void OnQueryChanged_EmptyQuery_ClearsResults()
{
    var vm = CreateViewModel();
    vm.ConversationResults.Add(new SearchResult { ... });
    
    vm.Query = "";
    
    Assert.Empty(vm.ConversationResults);
    Assert.Empty(vm.SearchStatus);
}

[Fact]
public async Task ExecuteSearchAsync_PopulatesResults()
{
    var mockService = CreateMockSearchService(resultCount: 5);
    var vm = new SearchViewModel(mockService, _conversationService);
    
    vm.Query = "test";
    await Task.Delay(350); // Wait for debounce
    
    Assert.Equal(5, vm.ConversationResults.Count + vm.MessageResults.Count);
    Assert.Contains("Found 5 results", vm.SearchStatus);
}

[Fact]
public void NavigateDown_SelectsFirstResult_WhenNoneSelected()
{
    var vm = CreateViewModelWithResults(3);
    Assert.Null(vm.SelectedResult);
    
    vm.NavigateDownCommand.Execute(null);
    
    Assert.Equal(vm.ConversationResults[0], vm.SelectedResult);
}

[Fact]
public void NavigateUp_AtFirstResult_StaysAtFirst()
{
    var vm = CreateViewModelWithResults(3);
    vm.SelectedResult = vm.ConversationResults[0];
    
    vm.NavigateUpCommand.Execute(null);
    
    Assert.Equal(vm.ConversationResults[0], vm.SelectedResult);
}

[Fact]
public void SelectResult_Message_NavigatesToConversation()
{
    var vm = CreateViewModel();
    var conversationId = Guid.NewGuid();
    Guid? navigatedId = null;
    vm.NavigateToConversation += (s, id) => navigatedId = id;
    
    vm.SelectResultCommand.Execute(new SearchResult 
    { 
        Type = SearchResultType.Message,
        ConversationId = conversationId
    });
    
    Assert.Equal(conversationId, navigatedId);
}
```

---

## Files Summary

### Files to Create (3)

| File | Lines (approx) |
|------|----------------|
| `ViewModels/SearchViewModel.cs` | 130 |
| `Views/SearchDialog.axaml` | 150 |
| `Views/SearchDialog.axaml.cs` | 30 |

### Files to Modify (2)

| File | Changes |
|------|---------|
| `ViewModels/MainWindowViewModel.cs` | Add OpenSearchCommand |
| `Views/MainWindow.axaml` | Add Ctrl+K binding |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | Ctrl+K opens SearchDialog from MainWindow |
| AC-2 | Search input has focus on open |
| AC-3 | Typing triggers search after 300ms debounce |
| AC-4 | Filter tabs filter results by type |
| AC-5 | Results grouped by Conversations and Messages |
| AC-6 | Up/Down arrow navigates results |
| AC-7 | Enter selects result and navigates |
| AC-8 | Escape closes dialog |
| AC-9 | Status bar shows result count and timing |
| AC-10 | Empty state shown when no results |

---

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| 300ms debounce | Balance responsiveness vs. API calls |
| Spotlight-style dialog | Familiar, focused UX |
| Grouping by type | Clear organization |
| Borderless window | Modern, focused appearance |
| Keyboard hints in status | Discoverability |

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.2.5e | 1 day |
