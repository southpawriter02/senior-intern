# Design Specification: AIntern v0.7.2c "Search Models & Options"

## Overview

**Version**: v0.7.2c
**Parent**: v0.7.2 Vector Storage
**Focus**: Define the models for vector search operations, including query options, filters, and result formatting

### Purpose

Define comprehensive models for vector similarity search:
1. Create `VectorSearchOptions` model for configuring searches
2. Create `ChunkSearchResult` model for search results
3. Create `IndexStatistics` model for index monitoring
4. Create `VectorStoreStatistics` model for overall store health
5. Define `VectorSearchAlgorithm` enum for search strategies

### Dependencies

**From v0.7.2a (Vector Store Interface)**:
- `IVectorStore` interface (uses these models)
- `StoredChunk` model (embedded in ChunkSearchResult)

**From v0.7.2b (Vector Index Models)**:
- `VectorIndex` model (referenced in statistics)

**From v0.7.1d (Text Chunk Models)**:
- `ChunkType` enum (used in filters)
- `SymbolType` enum (used in filters)

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      v0.7.2c Search Models & Options                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Search Configuration:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  VectorSearchOptions                                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Result Limits                                                       â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ TopK: int                 â† Max results (default: 10)          â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ MinScore: float           â† Similarity threshold (0.5)         â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Filters                                                             â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ FilePatterns: string[]    â† Glob patterns for files            â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Languages: string[]       â† Filter by language                 â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ChunkTypes: ChunkType[]   â† Filter by chunk type               â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ SymbolTypes: SymbolType[] â† Filter by symbol type              â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ SymbolNames: string[]     â† Filter by symbol name              â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Output Options                                                      â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ IncludeContent: bool      â† Include chunk content (true)       â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ IncludeEmbeddings: bool   â† Include vectors (false)            â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Deduplication                                                       â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ DeduplicateOverlapping    â† Remove overlapping chunks          â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ DeduplicationThreshold    â† Overlap threshold (0.5)            â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Context Expansion                                                   â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ExpandContext: bool       â† Expand context around match        â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ContextLinesAbove: int    â† Lines above (5)                    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ ContextLinesBelow: int    â† Lines below (5)                    â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Algorithm Selection                                                 â”‚ â”‚
â”‚  â”‚      â”œâ”€â”€ Algorithm: enum           â† Auto, Linear, IVF                  â”‚ â”‚
â”‚  â”‚      â””â”€â”€ IvfProbes: int            â† IVF probe count (10)               â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  Search Results:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  ChunkSearchResult                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Identifiers                                                         â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ChunkId: string           â† Chunk identifier                   â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ IndexId: string           â† Source index                       â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Similarity                                                          â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Score: float              â† 0.0-1.0 (higher = more similar)    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ Distance: float           â† Lower = more similar               â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Rank: int                 â† Position in results (1-based)      â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Content                                                             â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ Chunk: StoredChunk        â† Full chunk data                    â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Expanded Context                                                    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ExpandedContext: string?  â† Additional lines                   â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ ExpandedStartLine: int?   â† Context start                      â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ ExpandedEndLine: int?     â† Context end                        â”‚ â”‚
â”‚  â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Utilities                                                           â”‚ â”‚
â”‚  â”‚      â”œâ”€â”€ ScorePercentage           â† "95.5%"                            â”‚ â”‚
â”‚  â”‚      â””â”€â”€ FormatReference()         â† "MyClass (file.cs:10-25)"          â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  Statistics:                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  IndexStatistics                   VectorStoreStatistics                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ IndexId, IndexName            â”œâ”€â”€ TotalIndexes, ActiveIndexes       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ TotalFiles, TotalChunks       â”œâ”€â”€ TotalFiles, TotalChunks           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ TotalFileSizeBytes            â”œâ”€â”€ TotalDatabaseSizeBytes            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ VectorDataSizeBytes           â”œâ”€â”€ IndexStats[]                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ MetadataSizeBytes             â””â”€â”€ CalculatedAt                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ AverageTokensPerChunk                                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ FilesByLanguage{}                                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ChunksByType{}                                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ChunksBySymbolType{}                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ FilesWithErrors, SkippedFiles                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ EmbeddingModel, EmbeddingDimension                                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€ CalculatedAt, LastModified                                         â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Search Options Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vector Search Pipeline                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Query Flow:                                                                 â”‚
â”‚                                                                              â”‚
â”‚  User Query                                                                  â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Embed Query     â”‚â”€â”€â”€â”€â–¶â”‚ VectorSearchOptions                           â”‚  â”‚
â”‚  â”‚ (via Embedding  â”‚     â”‚ â”œâ”€â”€ TopK = 10                                 â”‚  â”‚
â”‚  â”‚  Service)       â”‚     â”‚ â”œâ”€â”€ MinScore = 0.6                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”œâ”€â”€ ChunkTypes = [Code, TypeDefinition]       â”‚  â”‚
â”‚                          â”‚ â”œâ”€â”€ Languages = ["csharp"]                    â”‚  â”‚
â”‚                          â”‚ â””â”€â”€ DeduplicateOverlapping = true             â”‚  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                   â”‚
â”‚                                          â–¼                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                          â”‚ IVectorStore.SearchAsync()                    â”‚  â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                          â”‚ 1. Select algorithm (Auto â†’ Linear/IVF)       â”‚  â”‚
â”‚                          â”‚ 2. Execute vector similarity query            â”‚  â”‚
â”‚                          â”‚ 3. Apply filters (language, type, pattern)    â”‚  â”‚
â”‚                          â”‚ 4. Deduplicate overlapping results            â”‚  â”‚
â”‚                          â”‚ 5. Expand context if requested                â”‚  â”‚
â”‚                          â”‚ 6. Rank and trim to TopK                      â”‚  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚                                   â”‚
â”‚                                          â–¼                                   â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                          â”‚ IReadOnlyList<ChunkSearchResult>              â”‚  â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                          â”‚ Result 1: Score=0.95, Rank=1                  â”‚  â”‚
â”‚                          â”‚   Chunk: MyClass.DoWork() @ file.cs:15-45     â”‚  â”‚
â”‚                          â”‚   ExpandedContext: lines 10-50                â”‚  â”‚
â”‚                          â”‚                                               â”‚  â”‚
â”‚                          â”‚ Result 2: Score=0.89, Rank=2                  â”‚  â”‚
â”‚                          â”‚   Chunk: Helper.Process() @ util.cs:101-120   â”‚  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Search Algorithm Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Algorithm Selection (Auto Mode)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  VectorSearchAlgorithm.Auto                                                  â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Index Size Check                                                        â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  ChunkCount < 10,000?                                                   â”‚ â”‚
â”‚  â”‚       â”‚                                                                  â”‚ â”‚
â”‚  â”‚       â”œâ”€â”€ YES â”€â”€â–¶ VectorSearchAlgorithm.Linear                          â”‚ â”‚
â”‚  â”‚       â”‚           â”œâ”€â”€ Exhaustive comparison                              â”‚ â”‚
â”‚  â”‚       â”‚           â”œâ”€â”€ 100% recall accuracy                               â”‚ â”‚
â”‚  â”‚       â”‚           â””â”€â”€ O(n) complexity                                    â”‚ â”‚
â”‚  â”‚       â”‚                                                                  â”‚ â”‚
â”‚  â”‚       â””â”€â”€ NO â”€â”€â”€â–¶ VectorSearchAlgorithm.IVF                             â”‚ â”‚
â”‚  â”‚                   â”œâ”€â”€ Inverted File Index                                â”‚ â”‚
â”‚  â”‚                   â”œâ”€â”€ Approximate nearest neighbors                      â”‚ â”‚
â”‚  â”‚                   â”œâ”€â”€ IvfProbes controls accuracy/speed                  â”‚ â”‚
â”‚  â”‚                   â””â”€â”€ O(sqrt(n)) complexity                              â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  IVF Probes Guide:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Probes â”‚ Recall â”‚ Speed â”‚ Use Case                                     â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  1      â”‚ ~50%   â”‚ Fast  â”‚ Quick exploratory search                     â”‚ â”‚
â”‚  â”‚  5      â”‚ ~80%   â”‚ Fast  â”‚ General purpose                              â”‚ â”‚
â”‚  â”‚  10     â”‚ ~90%   â”‚ Med   â”‚ Default, good balance                        â”‚ â”‚
â”‚  â”‚  20     â”‚ ~95%   â”‚ Slow  â”‚ High accuracy needed                         â”‚ â”‚
â”‚  â”‚  50+    â”‚ ~99%   â”‚ Slow  â”‚ Near-exhaustive                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Specifications

### 1. VectorSearchOptions.cs

**Location**: `src/SeniorIntern.Core/Models/VectorSearchOptions.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System.Collections.Generic;

/// <summary>
/// Options for vector similarity search.
/// </summary>
/// <remarks>
/// <para>
/// Configures how the vector store performs similarity search:
/// <list type="bullet">
///   <item>Result limits (TopK, MinScore)</item>
///   <item>Filters (file patterns, languages, types)</item>
///   <item>Output options (content, embeddings)</item>
///   <item>Post-processing (deduplication, context expansion)</item>
///   <item>Algorithm selection (Auto, Linear, IVF)</item>
/// </list>
/// </para>
/// <para>
/// Use the static factory properties <see cref="DefaultCodeSearch"/> and
/// <see cref="DocumentationSearch"/> for common configurations.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var options = new VectorSearchOptions
/// {
///     TopK = 20,
///     MinScore = 0.7f,
///     Languages = new[] { "csharp", "typescript" },
///     ChunkTypes = new[] { ChunkType.Code },
///     ExpandContext = true,
///     ContextLinesAbove = 10
/// };
/// 
/// var results = await vectorStore.SearchAsync(indexId, queryEmbedding, options);
/// </code>
/// </example>
public sealed class VectorSearchOptions
{
    #region Result Limits

    /// <summary>
    /// Maximum number of results to return.
    /// </summary>
    /// <remarks>
    /// Default: 10. Higher values return more results but may impact performance.
    /// Results are ranked by similarity score.
    /// </remarks>
    public int TopK { get; init; } = 10;

    /// <summary>
    /// Minimum similarity score (0.0 to 1.0).
    /// </summary>
    /// <remarks>
    /// <para>
    /// Results below this threshold are excluded. Default: 0.5.
    /// </para>
    /// <para>
    /// Score interpretation:
    /// <list type="bullet">
    ///   <item>0.9+ - Very high similarity (near duplicate)</item>
    ///   <item>0.7-0.9 - High similarity (same topic)</item>
    ///   <item>0.5-0.7 - Moderate similarity (related)</item>
    ///   <item>&lt;0.5 - Low similarity (likely unrelated)</item>
    /// </list>
    /// </para>
    /// </remarks>
    public float MinScore { get; init; } = 0.5f;

    #endregion

    #region Filters

    /// <summary>
    /// Filter results to specific file patterns (glob syntax).
    /// </summary>
    /// <remarks>
    /// Examples: "**/*.cs", "src/**/*.ts", "Controllers/*.cs".
    /// Null means no file filtering.
    /// </remarks>
    public IReadOnlyList<string>? FilePatterns { get; init; }

    /// <summary>
    /// Filter results to specific languages.
    /// </summary>
    /// <remarks>
    /// Examples: "csharp", "typescript", "python".
    /// Uses the language detected during indexing.
    /// </remarks>
    public IReadOnlyList<string>? Languages { get; init; }

    /// <summary>
    /// Filter results to specific chunk types.
    /// </summary>
    /// <remarks>
    /// Examples: [ChunkType.Code, ChunkType.TypeDefinition].
    /// Null means all chunk types.
    /// </remarks>
    public IReadOnlyList<ChunkType>? ChunkTypes { get; init; }

    /// <summary>
    /// Filter results to specific symbol types.
    /// </summary>
    /// <remarks>
    /// Examples: [SymbolType.Class, SymbolType.Method].
    /// Only applies to code chunks with symbol information.
    /// </remarks>
    public IReadOnlyList<SymbolType>? SymbolTypes { get; init; }

    /// <summary>
    /// Filter to chunks containing specific symbol names.
    /// </summary>
    /// <remarks>
    /// Case-insensitive partial match.
    /// Example: ["Controller", "Service"] matches "UserController", "AuthService".
    /// </remarks>
    public IReadOnlyList<string>? SymbolNames { get; init; }

    #endregion

    #region Output Options

    /// <summary>
    /// Whether to include full chunk content in results.
    /// </summary>
    /// <remarks>
    /// Default: true. Set to false for metadata-only queries (faster).
    /// </remarks>
    public bool IncludeContent { get; init; } = true;

    /// <summary>
    /// Whether to include embedding vectors in results.
    /// </summary>
    /// <remarks>
    /// Default: false. Embeddings are large and rarely needed in results.
    /// Enable only for re-ranking or analysis.
    /// </remarks>
    public bool IncludeEmbeddings { get; init; } = false;

    #endregion

    #region Deduplication

    /// <summary>
    /// Whether to deduplicate overlapping chunks from results.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Default: true. When multiple chunks from the same file overlap,
    /// only the highest-scoring chunk is kept.
    /// </para>
    /// <para>
    /// This prevents returning redundant content when chunks have overlap.
    /// </para>
    /// </remarks>
    public bool DeduplicateOverlapping { get; init; } = true;

    /// <summary>
    /// Overlap threshold for deduplication (0.0 to 1.0).
    /// </summary>
    /// <remarks>
    /// Higher values require more overlap to deduplicate.
    /// Default: 0.5 (50% line overlap triggers deduplication).
    /// </remarks>
    public float DeduplicationThreshold { get; init; } = 0.5f;

    #endregion

    #region Context Expansion

    /// <summary>
    /// Whether to expand context around matched chunks.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Default: false. When true, additional lines are read from the source
    /// file to provide more context around the matched chunk.
    /// </para>
    /// <para>
    /// Context expansion requires file access and may impact performance.
    /// </para>
    /// </remarks>
    public bool ExpandContext { get; init; } = false;

    /// <summary>
    /// Number of lines to expand above the match.
    /// </summary>
    /// <remarks>
    /// Only used when <see cref="ExpandContext"/> is true.
    /// Default: 5.
    /// </remarks>
    public int ContextLinesAbove { get; init; } = 5;

    /// <summary>
    /// Number of lines to expand below the match.
    /// </summary>
    /// <remarks>
    /// Only used when <see cref="ExpandContext"/> is true.
    /// Default: 5.
    /// </remarks>
    public int ContextLinesBelow { get; init; } = 5;

    #endregion

    #region Algorithm Selection

    /// <summary>
    /// Search algorithm to use.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Default: Auto. The system selects the best algorithm based on index size.
    /// </para>
    /// <para>
    /// Force a specific algorithm for testing or special requirements.
    /// </para>
    /// </remarks>
    public VectorSearchAlgorithm Algorithm { get; init; } = VectorSearchAlgorithm.Auto;

    /// <summary>
    /// Number of probes for IVF index (higher = more accurate but slower).
    /// </summary>
    /// <remarks>
    /// <para>
    /// Only used when Algorithm is IVF or Auto selects IVF.
    /// Default: 10.
    /// </para>
    /// <para>
    /// Probe count affects the accuracy/speed tradeoff.
    /// More probes = higher recall but slower search.
    /// </para>
    /// </remarks>
    public int IvfProbes { get; init; } = 10;

    #endregion

    #region Factory Methods

    /// <summary>
    /// Creates default options for semantic code search.
    /// </summary>
    /// <remarks>
    /// Optimized for finding code: methods, classes, functions.
    /// Higher minimum score, code chunk types only, context expansion enabled.
    /// </remarks>
    public static VectorSearchOptions DefaultCodeSearch => new()
    {
        TopK = 10,
        MinScore = 0.6f,
        ChunkTypes = [ChunkType.Code, ChunkType.TypeDefinition],
        DeduplicateOverlapping = true,
        ExpandContext = true,
        ContextLinesAbove = 3,
        ContextLinesBelow = 3
    };

    /// <summary>
    /// Creates options optimized for finding documentation.
    /// </summary>
    /// <remarks>
    /// Lower minimum score (docs often match loosely), documentation chunk types.
    /// </remarks>
    public static VectorSearchOptions DocumentationSearch => new()
    {
        TopK = 5,
        MinScore = 0.5f,
        ChunkTypes = [ChunkType.Documentation, ChunkType.Comment, ChunkType.Markdown],
        DeduplicateOverlapping = true
    };

    /// <summary>
    /// Creates options for finding all content types.
    /// </summary>
    public static VectorSearchOptions AllContent => new()
    {
        TopK = 20,
        MinScore = 0.4f,
        DeduplicateOverlapping = true
    };

    /// <summary>
    /// Creates options for high-precision search.
    /// </summary>
    public static VectorSearchOptions HighPrecision => new()
    {
        TopK = 5,
        MinScore = 0.8f,
        DeduplicateOverlapping = true,
        Algorithm = VectorSearchAlgorithm.Linear // Exhaustive for accuracy
    };

    #endregion

    #region Computed Properties

    /// <summary>
    /// Whether any filters are active.
    /// </summary>
    public bool HasFilters =>
        FilePatterns?.Count > 0 ||
        Languages?.Count > 0 ||
        ChunkTypes?.Count > 0 ||
        SymbolTypes?.Count > 0 ||
        SymbolNames?.Count > 0;

    /// <summary>
    /// Total context lines (above + below).
    /// </summary>
    public int TotalContextLines => ContextLinesAbove + ContextLinesBelow;

    #endregion
}

/// <summary>
/// Vector search algorithm to use.
/// </summary>
public enum VectorSearchAlgorithm
{
    /// <summary>
    /// Automatically select based on index size.
    /// </summary>
    /// <remarks>
    /// Uses Linear for small indexes (&lt;10K chunks), IVF for larger.
    /// </remarks>
    Auto,

    /// <summary>
    /// Exhaustive linear scan (most accurate, slowest).
    /// </summary>
    /// <remarks>
    /// Compares query against every vector. 100% recall.
    /// Best for small indexes or when accuracy is critical.
    /// </remarks>
    Linear,

    /// <summary>
    /// Inverted File Index (good balance of speed/accuracy).
    /// </summary>
    /// <remarks>
    /// Approximate nearest neighbors using clustering.
    /// Configurable recall via IvfProbes.
    /// </remarks>
    IVF
}
```

### 2. ChunkSearchResult.cs

**Location**: `src/SeniorIntern.Core/Models/ChunkSearchResult.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;

/// <summary>
/// A chunk returned from vector similarity search.
/// </summary>
/// <remarks>
/// <para>
/// Contains the matched chunk along with similarity metrics and optional
/// expanded context. Results are typically returned in a list ranked by
/// <see cref="Score"/> (descending).
/// </para>
/// <para>
/// Use <see cref="FormatReference"/> for human-readable location strings
/// and <see cref="ScorePercentage"/> for display.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// foreach (var result in searchResults)
/// {
///     Console.WriteLine($"#{result.Rank}: {result.FormatReference()}");
///     Console.WriteLine($"  Similarity: {result.ScorePercentage}");
///     Console.WriteLine($"  Content: {result.Chunk.Content.Substring(0, 100)}...");
/// }
/// </code>
/// </example>
public sealed class ChunkSearchResult
{
    #region Identifiers

    /// <summary>
    /// Unique identifier of the chunk.
    /// </summary>
    public required string ChunkId { get; init; }

    /// <summary>
    /// ID of the index containing this chunk.
    /// </summary>
    /// <remarks>
    /// Useful when searching across multiple indexes via SearchMultipleAsync.
    /// </remarks>
    public required string IndexId { get; init; }

    #endregion

    #region Similarity Metrics

    /// <summary>
    /// Similarity score (0.0 to 1.0, higher is more similar).
    /// </summary>
    /// <remarks>
    /// <para>
    /// Represents the cosine similarity between query and chunk embeddings.
    /// </para>
    /// <para>
    /// Score interpretation:
    /// <list type="bullet">
    ///   <item>0.9+ - Near duplicate or exact match</item>
    ///   <item>0.7-0.9 - Highly relevant</item>
    ///   <item>0.5-0.7 - Moderately relevant</item>
    ///   <item>&lt;0.5 - Weak match</item>
    /// </list>
    /// </para>
    /// </remarks>
    public float Score { get; init; }

    /// <summary>
    /// Distance from query vector (lower is more similar).
    /// </summary>
    /// <remarks>
    /// Euclidean distance. Inverse relationship to Score.
    /// Provided for compatibility with distance-based algorithms.
    /// </remarks>
    public float Distance { get; init; }

    /// <summary>
    /// Rank position in the result set (1-based).
    /// </summary>
    /// <remarks>
    /// 1 = highest scored result.
    /// </remarks>
    public int Rank { get; init; }

    #endregion

    #region Content

    /// <summary>
    /// The matched chunk data.
    /// </summary>
    /// <remarks>
    /// Contains full chunk metadata and optionally the content.
    /// Content may be null if IncludeContent was false in search options.
    /// </remarks>
    public required StoredChunk Chunk { get; init; }

    #endregion

    #region Expanded Context

    /// <summary>
    /// Expanded context around the chunk (if requested).
    /// </summary>
    /// <remarks>
    /// Contains additional lines from the source file for context.
    /// Only populated when ExpandContext=true in search options.
    /// </remarks>
    public string? ExpandedContext { get; init; }

    /// <summary>
    /// Start line of expanded context.
    /// </summary>
    public int? ExpandedStartLine { get; init; }

    /// <summary>
    /// End line of expanded context.
    /// </summary>
    public int? ExpandedEndLine { get; init; }

    #endregion

    #region Computed Properties

    /// <summary>
    /// Converts score to a human-readable percentage.
    /// </summary>
    /// <example>"95.5%"</example>
    public string ScorePercentage => $"{Score * 100:F1}%";

    /// <summary>
    /// Whether this result has expanded context.
    /// </summary>
    public bool HasExpandedContext => !string.IsNullOrEmpty(ExpandedContext);

    /// <summary>
    /// Convenience accessor for chunk content.
    /// </summary>
    public string Content => Chunk.Content;

    /// <summary>
    /// Convenience accessor for file path.
    /// </summary>
    public string FilePath => Chunk.FilePath;

    #endregion

    #region Utility Methods

    /// <summary>
    /// Creates a formatted reference string for display.
    /// </summary>
    /// <returns>A string like "MyClass.Method (Controllers/User.cs:15-45)"</returns>
    /// <example>
    /// <code>
    /// // With symbol:  "ProcessOrder (Services/OrderService.cs:120-180)"
    /// // Without:      "Controllers/UserController.cs:45-60"
    /// </code>
    /// </example>
    public string FormatReference()
    {
        var location = $"{Chunk.FilePath}:{Chunk.StartLine}";
        if (Chunk.EndLine > Chunk.StartLine)
            location += $"-{Chunk.EndLine}";

        if (!string.IsNullOrEmpty(Chunk.SymbolName))
            return $"{Chunk.SymbolName} ({location})";

        return location;
    }

    /// <summary>
    /// Creates a formatted string for the score badge.
    /// </summary>
    public string FormatScoreBadge()
    {
        return Score switch
        {
            >= 0.9f => $"ğŸŸ¢ {ScorePercentage}",
            >= 0.7f => $"ğŸŸ¡ {ScorePercentage}",
            >= 0.5f => $"ğŸŸ  {ScorePercentage}",
            _ => $"ğŸ”´ {ScorePercentage}"
        };
    }

    /// <summary>
    /// Gets a short preview of the content.
    /// </summary>
    /// <param name="maxLength">Maximum preview length.</param>
    public string GetContentPreview(int maxLength = 100)
    {
        if (string.IsNullOrEmpty(Chunk.Content))
            return string.Empty;

        if (Chunk.Content.Length <= maxLength)
            return Chunk.Content;

        return Chunk.Content[..maxLength] + "...";
    }

    #endregion
}
```

### 3. IndexStatistics.cs

**Location**: `src/SeniorIntern.Core/Models/IndexStatistics.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;
using System.Collections.Generic;

/// <summary>
/// Statistics for a single vector index.
/// </summary>
/// <remarks>
/// <para>
/// Provides detailed metrics about an index including:
/// <list type="bullet">
///   <item>File and chunk counts</item>
///   <item>Storage sizes (files, vectors, metadata)</item>
///   <item>Breakdown by language, chunk type, symbol type</item>
///   <item>Error and skip counts</item>
/// </list>
/// </para>
/// <para>
/// Statistics are calculated on-demand and cached.
/// The <see cref="CalculatedAt"/> timestamp indicates freshness.
/// </para>
/// </remarks>
public sealed class IndexStatistics
{
    #region Identifiers

    /// <summary>
    /// ID of the index.
    /// </summary>
    public required string IndexId { get; init; }

    /// <summary>
    /// Name of the index.
    /// </summary>
    public required string IndexName { get; init; }

    #endregion

    #region Counts

    /// <summary>
    /// Total number of indexed files.
    /// </summary>
    public int TotalFiles { get; init; }

    /// <summary>
    /// Total number of stored chunks.
    /// </summary>
    public int TotalChunks { get; init; }

    /// <summary>
    /// Number of files with errors.
    /// </summary>
    public int FilesWithErrors { get; init; }

    /// <summary>
    /// Number of skipped files.
    /// </summary>
    /// <remarks>
    /// Files skipped due to size limits, exclusion patterns, or binary detection.
    /// </remarks>
    public int SkippedFiles { get; init; }

    #endregion

    #region Storage Sizes

    /// <summary>
    /// Total size of indexed files in bytes.
    /// </summary>
    public long TotalFileSizeBytes { get; init; }

    /// <summary>
    /// Size of the vector data in bytes.
    /// </summary>
    /// <remarks>
    /// Calculated as: TotalChunks Ã— EmbeddingDimension Ã— sizeof(float)
    /// </remarks>
    public long VectorDataSizeBytes { get; init; }

    /// <summary>
    /// Size of metadata in bytes.
    /// </summary>
    /// <remarks>
    /// Includes chunk metadata, file records, and index configuration.
    /// </remarks>
    public long MetadataSizeBytes { get; init; }

    /// <summary>
    /// Total database size in bytes.
    /// </summary>
    public long TotalDatabaseSizeBytes => VectorDataSizeBytes + MetadataSizeBytes;

    #endregion

    #region Averages

    /// <summary>
    /// Average chunks per file.
    /// </summary>
    public double AverageChunksPerFile => TotalFiles > 0
        ? (double)TotalChunks / TotalFiles
        : 0;

    /// <summary>
    /// Average tokens per chunk.
    /// </summary>
    public double AverageTokensPerChunk { get; init; }

    #endregion

    #region Breakdowns

    /// <summary>
    /// File count by programming language.
    /// </summary>
    /// <example>{ "csharp": 150, "typescript": 75, "markdown": 25 }</example>
    public IReadOnlyDictionary<string, int> FilesByLanguage { get; init; } =
        new Dictionary<string, int>();

    /// <summary>
    /// Chunk count by type.
    /// </summary>
    public IReadOnlyDictionary<ChunkType, int> ChunksByType { get; init; } =
        new Dictionary<ChunkType, int>();

    /// <summary>
    /// Chunk count by symbol type.
    /// </summary>
    /// <remarks>
    /// Only counts chunks that have symbol information.
    /// </remarks>
    public IReadOnlyDictionary<SymbolType, int> ChunksBySymbolType { get; init; } =
        new Dictionary<SymbolType, int>();

    #endregion

    #region Timestamps

    /// <summary>
    /// When statistics were calculated.
    /// </summary>
    public DateTime CalculatedAt { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// When the index was last modified.
    /// </summary>
    public DateTime LastModified { get; init; }

    #endregion

    #region Embedding Info

    /// <summary>
    /// Embedding model used.
    /// </summary>
    public required string EmbeddingModel { get; init; }

    /// <summary>
    /// Embedding dimension.
    /// </summary>
    public int EmbeddingDimension { get; init; }

    #endregion

    #region Formatted Properties

    /// <summary>
    /// Formats total file size for display.
    /// </summary>
    public string FormattedFileSize => FormatBytes(TotalFileSizeBytes);

    /// <summary>
    /// Formats database size for display.
    /// </summary>
    public string FormattedDatabaseSize => FormatBytes(TotalDatabaseSizeBytes);

    /// <summary>
    /// Formats vector data size for display.
    /// </summary>
    public string FormattedVectorSize => FormatBytes(VectorDataSizeBytes);

    /// <summary>
    /// Formats metadata size for display.
    /// </summary>
    public string FormattedMetadataSize => FormatBytes(MetadataSizeBytes);

    /// <summary>
    /// Storage efficiency ratio (file size / database size).
    /// </summary>
    /// <remarks>
    /// Higher ratio means more efficient storage.
    /// Typical values: 0.5-2.0.
    /// </remarks>
    public double StorageEfficiency => TotalDatabaseSizeBytes > 0
        ? (double)TotalFileSizeBytes / TotalDatabaseSizeBytes
        : 0;

    #endregion

    #region Health Indicators

    /// <summary>
    /// Percentage of files indexed successfully.
    /// </summary>
    public double SuccessRate => TotalFiles > 0
        ? (double)(TotalFiles - FilesWithErrors) / TotalFiles * 100
        : 100;

    /// <summary>
    /// Whether the index appears healthy.
    /// </summary>
    public bool IsHealthy => FilesWithErrors == 0 || SuccessRate >= 95;

    #endregion

    #region Helper Methods

    private static string FormatBytes(long bytes)
    {
        string[] suffixes = ["B", "KB", "MB", "GB"];
        int i = 0;
        double size = bytes;
        while (size >= 1024 && i < suffixes.Length - 1)
        {
            size /= 1024;
            i++;
        }
        return $"{size:F2} {suffixes[i]}";
    }

    #endregion
}
```

### 4. VectorStoreStatistics.cs

**Location**: `src/SeniorIntern.Core/Models/VectorStoreStatistics.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;
using System.Collections.Generic;
using System.Linq;

/// <summary>
/// Aggregate statistics for the entire vector store.
/// </summary>
/// <remarks>
/// Provides an overview of all indexes in the store.
/// Use <see cref="IndexStats"/> for per-index details.
/// </remarks>
public sealed class VectorStoreStatistics
{
    #region Index Counts

    /// <summary>
    /// Total number of indexes.
    /// </summary>
    public int TotalIndexes { get; init; }

    /// <summary>
    /// Number of active indexes.
    /// </summary>
    public int ActiveIndexes { get; init; }

    /// <summary>
    /// Number of indexes currently building or updating.
    /// </summary>
    public int ProcessingIndexes => TotalIndexes - ActiveIndexes;

    #endregion

    #region Aggregate Counts

    /// <summary>
    /// Total files across all indexes.
    /// </summary>
    public int TotalFiles { get; init; }

    /// <summary>
    /// Total chunks across all indexes.
    /// </summary>
    public int TotalChunks { get; init; }

    /// <summary>
    /// Total database size in bytes.
    /// </summary>
    public long TotalDatabaseSizeBytes { get; init; }

    #endregion

    #region Per-Index Stats

    /// <summary>
    /// Statistics per index.
    /// </summary>
    public IReadOnlyList<IndexStatistics> IndexStats { get; init; } = [];

    #endregion

    #region Timestamp

    /// <summary>
    /// When statistics were calculated.
    /// </summary>
    public DateTime CalculatedAt { get; init; } = DateTime.UtcNow;

    #endregion

    #region Computed Properties

    /// <summary>
    /// Average files per index.
    /// </summary>
    public double AverageFilesPerIndex => TotalIndexes > 0
        ? (double)TotalFiles / TotalIndexes
        : 0;

    /// <summary>
    /// Average chunks per index.
    /// </summary>
    public double AverageChunksPerIndex => TotalIndexes > 0
        ? (double)TotalChunks / TotalIndexes
        : 0;

    /// <summary>
    /// Formatted database size for display.
    /// </summary>
    public string FormattedDatabaseSize => FormatBytes(TotalDatabaseSizeBytes);

    /// <summary>
    /// Whether all indexes are healthy.
    /// </summary>
    public bool AllHealthy => IndexStats.All(s => s.IsHealthy);

    /// <summary>
    /// Number of healthy indexes.
    /// </summary>
    public int HealthyIndexCount => IndexStats.Count(s => s.IsHealthy);

    /// <summary>
    /// Largest index by chunk count.
    /// </summary>
    public IndexStatistics? LargestIndex => IndexStats
        .OrderByDescending(s => s.TotalChunks)
        .FirstOrDefault();

    #endregion

    #region Helper Methods

    private static string FormatBytes(long bytes)
    {
        string[] suffixes = ["B", "KB", "MB", "GB"];
        int i = 0;
        double size = bytes;
        while (size >= 1024 && i < suffixes.Length - 1)
        {
            size /= 1024;
            i++;
        }
        return $"{size:F2} {suffixes[i]}";
    }

    #endregion

    #region Factory Methods

    /// <summary>
    /// Creates empty statistics (no indexes).
    /// </summary>
    public static VectorStoreStatistics Empty => new();

    /// <summary>
    /// Creates statistics from a list of index statistics.
    /// </summary>
    public static VectorStoreStatistics FromIndexes(IEnumerable<IndexStatistics> indexes)
    {
        var list = indexes.ToList();
        return new VectorStoreStatistics
        {
            TotalIndexes = list.Count,
            ActiveIndexes = list.Count, // Assume all active
            TotalFiles = list.Sum(s => s.TotalFiles),
            TotalChunks = list.Sum(s => s.TotalChunks),
            TotalDatabaseSizeBytes = list.Sum(s => s.TotalDatabaseSizeBytes),
            IndexStats = list
        };
    }

    #endregion
}
```

---

## Unit Test Plan

| Test | Description |
|------|-------------|
| `VectorSearchOptions_DefaultValues_AreCorrect` | Verify defaults |
| `VectorSearchOptions_DefaultCodeSearch_HasCodeTypes` | Factory preset |
| `VectorSearchOptions_DocumentationSearch_HasDocTypes` | Factory preset |
| `VectorSearchOptions_HasFilters_ReturnsTrueWhenFiltered` | Filter detection |
| `ChunkSearchResult_Score_RangeValidation` | 0.0-1.0 range |
| `ChunkSearchResult_ScorePercentage_FormatsCorrectly` | "95.5%" format |
| `ChunkSearchResult_FormatReference_WithSymbol` | "MyClass (file:10)" |
| `ChunkSearchResult_FormatReference_WithoutSymbol` | "file:10-20" |
| `ChunkSearchResult_FormatScoreBadge_ColorsCorrectly` | Emoji badges |
| `ChunkSearchResult_GetContentPreview_TruncatesLong` | Preview generation |
| `IndexStatistics_AverageChunksPerFile_CalculatesCorrectly` | Division |
| `IndexStatistics_TotalDatabaseSizeBytes_SumsCorrectly` | Computed property |
| `IndexStatistics_FormattedFileSize_FormatsCorrectly` | Byte formatting |
| `IndexStatistics_SuccessRate_CalculatesCorrectly` | Percentage |
| `VectorStoreStatistics_FromIndexes_AggregatesCorrectly` | Factory |
| `VectorStoreStatistics_AllHealthy_ChecksAllIndexes` | Health check |

---

## File Summary

| File | Location | Purpose | Lines |
|------|----------|---------|-------|
| `VectorSearchOptions.cs` | `Core/Models/` | Search configuration | ~250 |
| `ChunkSearchResult.cs` | `Core/Models/` | Search result model | ~150 |
| `IndexStatistics.cs` | `Core/Models/` | Index statistics | ~170 |
| `VectorStoreStatistics.cs` | `Core/Models/` | Store statistics | ~120 |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | `VectorSearchOptions` has sensible defaults |
| AC-2 | Factory presets (`DefaultCodeSearch`, `DocumentationSearch`) work |
| AC-3 | `ChunkSearchResult` formats references correctly |
| AC-4 | `ChunkSearchResult.ScorePercentage` formats as "X.X%" |
| AC-5 | `IndexStatistics` calculates computed properties correctly |
| AC-6 | `IndexStatistics.FormatBytes` formats KB/MB/GB correctly |
| AC-7 | `VectorStoreStatistics.FromIndexes` aggregates correctly |
| AC-8 | All enums have XML documentation |

---

## Changelog Entry

```markdown
## v0.7.2c - Search Models & Options

### Added
- `VectorSearchOptions` model (`Core/Models/`)
  - Result limits: TopK, MinScore
  - Filters: FilePatterns, Languages, ChunkTypes, SymbolTypes, SymbolNames
  - Output: IncludeContent, IncludeEmbeddings
  - Deduplication: DeduplicateOverlapping, DeduplicationThreshold
  - Context: ExpandContext, ContextLinesAbove, ContextLinesBelow
  - Algorithm: Algorithm, IvfProbes
  - Factory presets: DefaultCodeSearch, DocumentationSearch, AllContent, HighPrecision
- `VectorSearchAlgorithm` enum
  - Auto, Linear, IVF
- `ChunkSearchResult` model (`Core/Models/`)
  - Identifiers: ChunkId, IndexId
  - Similarity: Score, Distance, Rank
  - Content: Chunk (StoredChunk)
  - Context: ExpandedContext, ExpandedStartLine, ExpandedEndLine
  - Utilities: ScorePercentage, FormatReference(), FormatScoreBadge()
- `IndexStatistics` model (`Core/Models/`)
  - Counts: TotalFiles, TotalChunks, FilesWithErrors, SkippedFiles
  - Sizes: TotalFileSizeBytes, VectorDataSizeBytes, MetadataSizeBytes
  - Breakdowns: FilesByLanguage, ChunksByType, ChunksBySymbolType
  - Health: SuccessRate, IsHealthy
- `VectorStoreStatistics` model (`Core/Models/`)
  - Aggregates: TotalIndexes, ActiveIndexes, TotalFiles, TotalChunks
  - Per-index: IndexStats
  - Factory: Empty, FromIndexes()
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.7.2c | 0.5 day |
