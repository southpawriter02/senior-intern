# Design Specification: AIntern v0.7.3b "Indexing Models & Options"

## Overview

**Version**: v0.7.3b
**Parent**: v0.7.3 Indexing Pipeline
**Focus**: Define all models, options, progress tracking, and result types for indexing operations

### Purpose

This sub-version defines the complete data model layer for the indexing pipeline:
1. `IndexingOptions` - Configuration for indexing operations
2. `IndexingProgress` - Real-time progress tracking with phase information
3. `IndexingResult` - Results of completed indexing operations
4. `IndexingJob` - Job tracking for background processing
5. `IndexSyncResult` - Results of synchronization operations
6. `IndexingError` - Error capture during indexing
7. Supporting enums: `IndexingPhase`, `IndexingStatus`, `IndexingJobType`, `IndexingJobStatus`, `IndexingErrorType`

### Dependencies

**From v0.7.1 (Embedding Foundation)**:
- `ChunkingOptions` model (v0.7.1d) - embedded in `IndexingOptions`

**From v0.7.2 (Vector Storage)**:
- `VectorIndexSettings` model (v0.7.2b) - conversion methods

**From v0.7.3a (Indexing Service Interface)**:
- `IIndexingService` uses all models defined here
- `IIndexingJobQueue` uses `IndexingJob`
- Event args reference these models

---

## Architecture

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                     v0.7.3b Indexing Models & Options                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  src/SeniorIntern.Core/Models/                                               │
│  ┌──────────────────────────────────────────────────────────────────────────┐│
│  │                                                                          ││
│  │  Configuration                                                           ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexingOptions                                                   │  ││
│  │  │  ├── Identity: IndexName, EmbeddingModelPath                       │  ││
│  │  │  ├── Chunking: ChunkingOptions                                     │  ││
│  │  │  ├── File Filters: IncludePatterns, ExcludePatterns               │  ││
│  │  │  ├── Size Limits: MaxFileSizeKb, MinFileSizeBytes                 │  ││
│  │  │  ├── Processing: ParallelProcessing, EmbeddingBatchSize           │  ││
│  │  │  ├── Behavior: ForceReindex, RespectGitignore, ContinueOnError    │  ││
│  │  │  ├── File Watching: EnableFileWatching, FileWatchDebounceMs       │  ││
│  │  │  └── Static: DefaultIncludePatterns, DefaultExcludePatterns       │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  │  Progress & Results                                                      ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexingProgress                                                  │  ││
│  │  │  ├── Phase: IndexingPhase                                          │  ││
│  │  │  ├── File Counts: TotalFiles, ProcessedFiles, SkippedFiles        │  ││
│  │  │  ├── Chunk Counts: TotalChunks, ProcessedChunks                   │  ││
│  │  │  ├── Current: CurrentFile, Message                                 │  ││
│  │  │  ├── Metrics: PercentComplete, Elapsed, EstimatedRemaining        │  ││
│  │  │  ├── Rates: FilesPerSecond, ChunksPerSecond                       │  ││
│  │  │  ├── Size: BytesProcessed, TotalBytes                             │  ││
│  │  │  └── Controls: CanPause, CanCancel                                │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexingResult                                                    │  ││
│  │  │  ├── Status: Success, WasCancelled, ErrorMessage                  │  ││
│  │  │  ├── Identity: IndexId                                             │  ││
│  │  │  ├── File Stats: FilesIndexed, FilesSkipped, FilesErrored         │  ││
│  │  │  ├── Chunk Stats: ChunksCreated, ChunksRemoved                    │  ││
│  │  │  ├── Size: BytesProcessed                                          │  ││
│  │  │  ├── Timing: Duration, StartedAt, CompletedAt                     │  ││
│  │  │  ├── Errors: IReadOnlyList<IndexingError>                         │  ││
│  │  │  └── Computed: FilesPerSecond, ChunksPerSecond                    │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexSyncResult                                                   │  ││
│  │  │  ├── Status: Success                                               │  ││
│  │  │  ├── Changes: FilesAdded, FilesUpdated, FilesRemoved              │  ││
│  │  │  ├── Unchanged: FilesUnchanged                                     │  ││
│  │  │  ├── Chunks: ChunksDelta                                           │  ││
│  │  │  ├── Timing: Duration                                              │  ││
│  │  │  └── Errors: IReadOnlyList<IndexingError>                         │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  │  Job Management                                                          ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexingJob                                                       │  ││
│  │  │  ├── Identity: Id, Type, IndexId                                   │  ││
│  │  │  ├── Target: WorkspacePath, Options                                │  ││
│  │  │  ├── Status: Status, Priority                                      │  ││
│  │  │  ├── Timing: CreatedAt, StartedAt, CompletedAt                    │  ││
│  │  │  ├── State: Progress, Result, ErrorMessage                        │  ││
│  │  │  ├── Retry: RetryCount, MaxRetries                                 │  ││
│  │  │  └── Computed: RunningTime, QueueTime, CanRetry                   │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  │  Error Handling                                                          ││
│  │  ┌────────────────────────────────────────────────────────────────────┐  ││
│  │  │  IndexingError                                                     │  ││
│  │  │  ├── Context: FilePath, Type, OccurredAt                          │  ││
│  │  │  ├── Details: Message, ExceptionType, StackTrace                  │  ││
│  │  │  └── Factory: FromException(filePath, ex)                         │  ││
│  │  └────────────────────────────────────────────────────────────────────┘  ││
│  │                                                                          ││
│  └──────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  Enumerations                                                                │
│  ┌──────────────────────────────────────────────────────────────────────────┐│
│  │  IndexingPhase       → Initializing, Scanning, Analyzing, Chunking,     ││
│  │                        Embedding, Storing, Finalizing, Complete,        ││
│  │                        Cancelled, Paused, Error                         ││
│  │                                                                          ││
│  │  IndexingStatus      → Idle, Scanning, Indexing, Paused, Cancelling,   ││
│  │                        Error                                            ││
│  │                                                                          ││
│  │  IndexingJobType     → FullIndex, IncrementalUpdate, PartialIndex,     ││
│  │                        Sync, FileWatchUpdate                           ││
│  │                                                                          ││
│  │  IndexingJobStatus   → Queued, Running, Paused, Completed, Failed,     ││
│  │                        Cancelled                                        ││
│  │                                                                          ││
│  │  IndexingErrorType   → Unknown, FileRead, FileNotFound, PermissionDenied,││
│  │                        Parsing, Encoding, Chunking, Embedding, Storage, ││
│  │                        OutOfMemory, Timeout                             ││
│  └──────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Model Relationships

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        Model Relationship Diagram                             │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────┐                                                         │
│  │ IndexingOptions │◄────────────────────────────────────────────────────┐   │
│  │                 │                                                     │   │
│  │ ┌─────────────┐ │                                                     │   │
│  │ │ChunkingOpts │ │  ┌─────────────────────────────────────────────────┐│   │
│  │ │ (v0.7.1d)   │ │  │                   IndexingJob                   ││   │
│  │ └─────────────┘ │  │                                                 ││   │
│  └─────────────────┘  │  Id ───────────────────────────────────────┐    ││   │
│          │            │  Type: IndexingJobType                     │    ││   │
│          │            │  WorkspacePath ────────────────────────────┼─┐  ││   │
│          └───────────▶│  Options ◄─────────────────────────────────┘ │  ││   │
│                       │  Status: IndexingJobStatus                   │  ││   │
│                       │  Progress ───────────────────────────────────┼──┼┐│  │
│                       │  Result ─────────────────────────────────────┼──┼┼┐ │
│                       └─────────────────────────────────────────────┘│  │││ │
│                                                                      │  │││ │
│  ┌───────────────────────────────────────────────────────────────────┘  │││ │
│  │                                                                      │││ │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │││ │
│  │  │                    IndexingProgress                             │◄┘││ │
│  │  │                                                                 │  ││ │
│  │  │  Phase: IndexingPhase                                           │  ││ │
│  │  │  TotalFiles, ProcessedFiles, SkippedFiles, FailedFiles         │  ││ │
│  │  │  TotalChunks, ProcessedChunks                                   │  ││ │
│  │  │  CurrentFile, Message                                           │  ││ │
│  │  │  PercentComplete, Elapsed, EstimatedRemaining                   │  ││ │
│  │  │  FilesPerSecond, ChunksPerSecond                                │  ││ │
│  │  │  BytesProcessed, TotalBytes                                     │  ││ │
│  │  └─────────────────────────────────────────────────────────────────┘  ││ │
│                                                                          ││ │
│  ┌───────────────────────────────────────────────────────────────────────┘│ │
│  │                                                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │ │
│  │  │                    IndexingResult                               │◄──┘ │
│  │  │                                                                 │     │
│  │  │  Success, WasCancelled                                          │     │
│  │  │  IndexId                                                        │     │
│  │  │  FilesIndexed, FilesSkipped, FilesErrored                      │     │
│  │  │  ChunksCreated, ChunksRemoved                                   │     │
│  │  │  BytesProcessed, Duration                                       │     │
│  │  │  Errors ──────────────────────────────────────────────────────┐ │     │
│  │  └───────────────────────────────────────────────────────────────┼─┘     │
│  │                                                                  │       │
│  │  ┌───────────────────────────────────────────────────────────────▼─────┐ │
│  │  │                    IndexingError                                    │ │
│  │  │                                                                     │ │
│  │  │  FilePath                                                           │ │
│  │  │  Message                                                            │ │
│  │  │  Type: IndexingErrorType                                            │ │
│  │  │  ExceptionType, StackTrace                                          │ │
│  │  │  OccurredAt                                                         │ │
│  │  └─────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Files to Create

| File | Purpose |
|------|---------|
| `src/SeniorIntern.Core/Models/IndexingOptions.cs` | Configuration options for indexing |
| `src/SeniorIntern.Core/Models/IndexingProgress.cs` | Progress tracking with phases |
| `src/SeniorIntern.Core/Models/IndexingResult.cs` | Indexing operation results |
| `src/SeniorIntern.Core/Models/IndexingJob.cs` | Background job tracking |
| `src/SeniorIntern.Core/Models/IndexingEnums.cs` | All indexing-related enums |

---

## Detailed Specifications

### 1. IndexingOptions.cs

**Location**: `src/SeniorIntern.Core/Models/IndexingOptions.cs`

```csharp
using System;
using System.Collections.Generic;

namespace SeniorIntern.Core.Models;

/// <summary>
/// Configuration options for indexing operations.
/// </summary>
/// <remarks>
/// <para>
/// IndexingOptions controls all aspects of the indexing pipeline:
/// <list type="bullet">
///   <item>Which files to include/exclude via glob patterns</item>
///   <item>How files are chunked for embedding</item>
///   <item>Processing parallelism and batch sizes</item>
///   <item>Error handling behavior</item>
///   <item>File watching configuration</item>
/// </list>
/// </para>
/// <para>
/// Use <see cref="QuickIndex"/> or <see cref="ThoroughIndex"/> static properties
/// for common presets, or create custom options for specific needs.
/// </para>
/// </remarks>
public sealed class IndexingOptions
{
    #region Index Identity

    /// <summary>
    /// Human-readable name for the index.
    /// </summary>
    /// <remarks>
    /// Displayed in UI and used for identification. Defaults to "Default".
    /// </remarks>
    public string IndexName { get; init; } = "Default";

    /// <summary>
    /// Path to the embedding model to use.
    /// If empty, uses the currently loaded model.
    /// </summary>
    public string? EmbeddingModelPath { get; init; }

    #endregion

    #region Chunking Configuration

    /// <summary>
    /// Configuration for text chunking.
    /// </summary>
    /// <remarks>
    /// Controls chunk sizes, overlap, and semantic chunking behavior.
    /// See <see cref="ChunkingOptions"/> for details.
    /// </remarks>
    public ChunkingOptions ChunkingOptions { get; init; } = new();

    #endregion

    #region File Filtering

    /// <summary>
    /// Glob patterns for files to include.
    /// </summary>
    /// <remarks>
    /// Files must match at least one include pattern to be indexed.
    /// Uses ** for recursive directory matching.
    /// </remarks>
    public IReadOnlyList<string> IncludePatterns { get; init; } = DefaultIncludePatterns;

    /// <summary>
    /// Glob patterns for files to exclude.
    /// </summary>
    /// <remarks>
    /// Exclusions take precedence over inclusions.
    /// Commonly used to skip build outputs and dependencies.
    /// </remarks>
    public IReadOnlyList<string> ExcludePatterns { get; init; } = DefaultExcludePatterns;

    /// <summary>
    /// Maximum file size to index in kilobytes.
    /// Files larger than this are skipped.
    /// </summary>
    public int MaxFileSizeKb { get; init; } = 1024;

    /// <summary>
    /// Minimum file size to index in bytes.
    /// Very small files are often not useful for search.
    /// </summary>
    public int MinFileSizeBytes { get; init; } = 10;

    #endregion

    #region Processing Configuration

    /// <summary>
    /// Number of parallel file processing tasks.
    /// </summary>
    /// <remarks>
    /// Higher values speed up indexing but use more memory.
    /// Default of 4 balances speed and resource usage.
    /// </remarks>
    public int ParallelProcessing { get; init; } = 4;

    /// <summary>
    /// Batch size for embedding generation.
    /// </summary>
    /// <remarks>
    /// Larger batches are more efficient but use more GPU memory.
    /// Reduce if experiencing out-of-memory errors.
    /// </remarks>
    public int EmbeddingBatchSize { get; init; } = 32;

    #endregion

    #region Behavior Flags

    /// <summary>
    /// Whether to force re-index all files, ignoring change detection.
    /// </summary>
    public bool ForceReindex { get; init; } = false;

    /// <summary>
    /// Whether to respect .gitignore rules when scanning.
    /// </summary>
    public bool RespectGitignore { get; init; } = true;

    /// <summary>
    /// Whether to index hidden files (starting with .).
    /// </summary>
    public bool IndexHiddenFiles { get; init; } = false;

    /// <summary>
    /// Whether to follow symbolic links.
    /// </summary>
    public bool FollowSymlinks { get; init; } = false;

    /// <summary>
    /// Maximum directory depth to traverse (-1 for unlimited).
    /// </summary>
    public int MaxDepth { get; init; } = -1;

    #endregion

    #region Error Handling

    /// <summary>
    /// Whether to continue on errors instead of stopping.
    /// </summary>
    public bool ContinueOnError { get; init; } = true;

    /// <summary>
    /// Maximum number of errors before stopping (0 for unlimited).
    /// </summary>
    public int MaxErrors { get; init; } = 100;

    #endregion

    #region Job Priority

    /// <summary>
    /// Priority for the indexing job (higher = more important).
    /// </summary>
    public int Priority { get; init; } = 0;

    #endregion

    #region File Watching

    /// <summary>
    /// Whether to enable file watching after indexing completes.
    /// </summary>
    public bool EnableFileWatching { get; init; } = true;

    /// <summary>
    /// Delay in milliseconds before file watching triggers re-indexing.
    /// </summary>
    public int FileWatchDebounceMs { get; init; } = 2000;

    #endregion

    #region Default Patterns

    /// <summary>
    /// Default include patterns for source code files.
    /// </summary>
    public static readonly IReadOnlyList<string> DefaultIncludePatterns = new[]
    {
        // .NET
        "**/*.cs", "**/*.fs", "**/*.vb", "**/*.csproj", "**/*.fsproj", "**/*.sln",
        // Web/JavaScript
        "**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.vue", "**/*.svelte",
        "**/*.html", "**/*.css", "**/*.scss", "**/*.less", "**/*.sass",
        // Python
        "**/*.py", "**/*.pyi", "**/*.pyx", "**/*.pxd",
        // JVM
        "**/*.java", "**/*.kt", "**/*.scala", "**/*.groovy", "**/*.gradle",
        // Systems
        "**/*.go", "**/*.rs", "**/*.cpp", "**/*.c", "**/*.h", "**/*.hpp", "**/*.cc",
        // Other languages
        "**/*.swift", "**/*.rb", "**/*.php", "**/*.lua", "**/*.r", "**/*.R",
        // Config/Docs
        "**/*.md", "**/*.json", "**/*.yaml", "**/*.yml", "**/*.xml", "**/*.toml",
        "**/*.ini", "**/*.cfg", "**/*.conf",
        // Shell
        "**/*.sh", "**/*.bash", "**/*.zsh", "**/*.ps1", "**/*.bat", "**/*.cmd"
    };

    /// <summary>
    /// Default exclude patterns for build artifacts and dependencies.
    /// </summary>
    public static readonly IReadOnlyList<string> DefaultExcludePatterns = new[]
    {
        // Build outputs
        "**/node_modules/**", "**/bin/**", "**/obj/**", "**/dist/**", "**/build/**",
        "**/target/**", "**/out/**", "**/.next/**", "**/.nuxt/**", "**/coverage/**",
        // Package managers
        "**/packages/**", "**/vendor/**", "**/.npm/**", "**/.yarn/**",
        // Version control
        "**/.git/**", "**/.svn/**", "**/.hg/**",
        // IDE
        "**/.vs/**", "**/.idea/**", "**/.vscode/**", "**/*.suo", "**/*.user",
        // Generated
        "**/*.min.js", "**/*.min.css", "**/*.map", "**/*.d.ts", "**/*.generated.*",
        // Lock files
        "**/*.lock", "**/package-lock.json", "**/yarn.lock", "**/pnpm-lock.yaml",
        // Temporary
        "**/tmp/**", "**/temp/**", "**/.cache/**", "**/__pycache__/**",
        // Logs
        "**/logs/**", "**/*.log",
        // Secrets
        "**/.env", "**/.env.*", "**/secrets.*", "**/credentials.*"
    };

    #endregion

    #region Presets

    /// <summary>
    /// Preset for quick indexing (smaller chunks, higher parallelism).
    /// </summary>
    public static IndexingOptions QuickIndex => new()
    {
        ParallelProcessing = 8,
        EmbeddingBatchSize = 64,
        ChunkingOptions = new ChunkingOptions
        {
            TargetChunkSize = 256,
            ChunkOverlap = 32
        }
    };

    /// <summary>
    /// Preset for thorough indexing (larger chunks, higher quality).
    /// </summary>
    public static IndexingOptions ThoroughIndex => new()
    {
        ParallelProcessing = 2,
        EmbeddingBatchSize = 16,
        ChunkingOptions = new ChunkingOptions
        {
            TargetChunkSize = 512,
            ChunkOverlap = 128,
            IncludeLineNumbers = true
        }
    };

    #endregion
}
```

### 2. IndexingProgress.cs

**Location**: `src/SeniorIntern.Core/Models/IndexingProgress.cs`

```csharp
using System;

namespace SeniorIntern.Core.Models;

/// <summary>
/// Progress information for indexing operations.
/// </summary>
/// <remarks>
/// <para>
/// Provides comprehensive progress tracking including:
/// <list type="bullet">
///   <item>Current phase of the operation</item>
///   <item>File and chunk processing counts</item>
///   <item>Processing rates and time estimates</item>
///   <item>Control state (pausable, cancellable)</item>
/// </list>
/// </para>
/// <para>
/// Progress is reported periodically via <see cref="IProgress{IndexingProgress}"/>
/// and through the <see cref="IIndexingService.ProgressUpdated"/> event.
/// </para>
/// </remarks>
public sealed class IndexingProgress
{
    #region Phase Information

    /// <summary>
    /// Current phase of the indexing operation.
    /// </summary>
    public IndexingPhase Phase { get; init; }

    #endregion

    #region File Counts

    /// <summary>
    /// Total number of files to process.
    /// </summary>
    public int TotalFiles { get; init; }

    /// <summary>
    /// Number of files processed so far.
    /// </summary>
    public int ProcessedFiles { get; init; }

    /// <summary>
    /// Number of files skipped (unchanged or filtered).
    /// </summary>
    public int SkippedFiles { get; init; }

    /// <summary>
    /// Number of files that failed to process.
    /// </summary>
    public int FailedFiles { get; init; }

    #endregion

    #region Chunk Counts

    /// <summary>
    /// Total number of chunks created so far.
    /// </summary>
    public int TotalChunks { get; init; }

    /// <summary>
    /// Number of chunks processed (embedded and stored).
    /// </summary>
    public int ProcessedChunks { get; init; }

    #endregion

    #region Current State

    /// <summary>
    /// Current file being processed.
    /// </summary>
    public string? CurrentFile { get; init; }

    /// <summary>
    /// Human-readable status message.
    /// </summary>
    public string? Message { get; init; }

    #endregion

    #region Metrics

    /// <summary>
    /// Overall completion percentage (0-100).
    /// </summary>
    public double PercentComplete { get; init; }

    /// <summary>
    /// Time elapsed since indexing started.
    /// </summary>
    public TimeSpan Elapsed { get; init; }

    /// <summary>
    /// Estimated time remaining (if calculable).
    /// </summary>
    public TimeSpan? EstimatedRemaining { get; init; }

    #endregion

    #region Processing Rates

    /// <summary>
    /// Processing rate in files per second.
    /// </summary>
    public double FilesPerSecond { get; init; }

    /// <summary>
    /// Processing rate in chunks per second.
    /// </summary>
    public double ChunksPerSecond { get; init; }

    #endregion

    #region Size Information

    /// <summary>
    /// Bytes processed so far.
    /// </summary>
    public long BytesProcessed { get; init; }

    /// <summary>
    /// Total bytes to process (if known).
    /// </summary>
    public long TotalBytes { get; init; }

    #endregion

    #region Control State

    /// <summary>
    /// Whether the operation can be paused.
    /// </summary>
    public bool CanPause { get; init; } = true;

    /// <summary>
    /// Whether the operation can be cancelled.
    /// </summary>
    public bool CanCancel { get; init; } = true;

    #endregion

    #region Factory Methods

    /// <summary>
    /// Create progress for the scanning phase.
    /// </summary>
    public static IndexingProgress Scanning(string? message = null) => new()
    {
        Phase = IndexingPhase.Scanning,
        Message = message ?? "Scanning workspace for files..."
    };

    /// <summary>
    /// Create progress for the analyzing phase.
    /// </summary>
    public static IndexingProgress Analyzing(int totalFiles, string? message = null) => new()
    {
        Phase = IndexingPhase.Analyzing,
        TotalFiles = totalFiles,
        Message = message ?? "Analyzing files for changes..."
    };

    /// <summary>
    /// Create progress for completion.
    /// </summary>
    public static IndexingProgress Complete(int files, int chunks, TimeSpan elapsed) => new()
    {
        Phase = IndexingPhase.Complete,
        TotalFiles = files,
        ProcessedFiles = files,
        TotalChunks = chunks,
        ProcessedChunks = chunks,
        PercentComplete = 100,
        Elapsed = elapsed,
        Message = $"Indexed {files} files with {chunks} chunks"
    };

    /// <summary>
    /// Create progress for cancellation.
    /// </summary>
    public static IndexingProgress Cancelled(int processedFiles, int processedChunks) => new()
    {
        Phase = IndexingPhase.Cancelled,
        ProcessedFiles = processedFiles,
        ProcessedChunks = processedChunks,
        Message = "Indexing cancelled by user"
    };

    #endregion
}

/// <summary>
/// Phases of the indexing operation.
/// </summary>
public enum IndexingPhase
{
    /// <summary>Initializing the indexing operation.</summary>
    Initializing,

    /// <summary>Scanning filesystem for files to index.</summary>
    Scanning,

    /// <summary>Analyzing files to determine which need indexing.</summary>
    Analyzing,

    /// <summary>Reading and chunking file contents.</summary>
    Chunking,

    /// <summary>Generating embeddings for chunks.</summary>
    Embedding,

    /// <summary>Storing embeddings in vector database.</summary>
    Storing,

    /// <summary>Finalizing the index (cleanup, statistics).</summary>
    Finalizing,

    /// <summary>Indexing completed successfully.</summary>
    Complete,

    /// <summary>Indexing was cancelled by user.</summary>
    Cancelled,

    /// <summary>Indexing paused by user.</summary>
    Paused,

    /// <summary>Indexing failed with an error.</summary>
    Error
}
```

### 3. IndexingResult.cs

**Location**: `src/SeniorIntern.Core/Models/IndexingResult.cs`

```csharp
using System;
using System.Collections.Generic;

namespace SeniorIntern.Core.Models;

/// <summary>
/// Result of an indexing operation.
/// </summary>
/// <remarks>
/// Contains comprehensive statistics about the completed indexing operation
/// including success/failure status, file/chunk counts, timing, and any errors.
/// </remarks>
public sealed class IndexingResult
{
    #region Status

    /// <summary>
    /// Whether the operation completed successfully.
    /// </summary>
    public bool Success { get; init; }

    /// <summary>
    /// Whether the operation was cancelled.
    /// </summary>
    public bool WasCancelled { get; init; }

    /// <summary>
    /// Top-level error message if the operation failed.
    /// </summary>
    public string? ErrorMessage { get; init; }

    #endregion

    #region Identity

    /// <summary>
    /// ID of the index that was created or updated.
    /// </summary>
    public string IndexId { get; init; } = string.Empty;

    #endregion

    #region File Statistics

    /// <summary>
    /// Number of files successfully indexed.
    /// </summary>
    public int FilesIndexed { get; init; }

    /// <summary>
    /// Number of files skipped (unchanged or filtered).
    /// </summary>
    public int FilesSkipped { get; init; }

    /// <summary>
    /// Number of files that failed to index.
    /// </summary>
    public int FilesErrored { get; init; }

    #endregion

    #region Chunk Statistics

    /// <summary>
    /// Total number of chunks created.
    /// </summary>
    public int ChunksCreated { get; init; }

    /// <summary>
    /// Total number of chunks removed (for re-indexing).
    /// </summary>
    public int ChunksRemoved { get; init; }

    #endregion

    #region Size and Timing

    /// <summary>
    /// Total bytes processed.
    /// </summary>
    public long BytesProcessed { get; init; }

    /// <summary>
    /// Total duration of the operation.
    /// </summary>
    public TimeSpan Duration { get; init; }

    /// <summary>
    /// When the operation started.
    /// </summary>
    public DateTime StartedAt { get; init; }

    /// <summary>
    /// When the operation completed.
    /// </summary>
    public DateTime CompletedAt { get; init; }

    #endregion

    #region Errors

    /// <summary>
    /// List of errors that occurred during indexing.
    /// </summary>
    public IReadOnlyList<IndexingError> Errors { get; init; } = [];

    #endregion

    #region Computed Properties

    /// <summary>
    /// Files per second processing rate.
    /// </summary>
    public double FilesPerSecond => Duration.TotalSeconds > 0
        ? FilesIndexed / Duration.TotalSeconds
        : 0;

    /// <summary>
    /// Chunks per second processing rate.
    /// </summary>
    public double ChunksPerSecond => Duration.TotalSeconds > 0
        ? ChunksCreated / Duration.TotalSeconds
        : 0;

    /// <summary>
    /// Megabytes per second processing rate.
    /// </summary>
    public double MegabytesPerSecond => Duration.TotalSeconds > 0
        ? (BytesProcessed / 1024.0 / 1024.0) / Duration.TotalSeconds
        : 0;

    #endregion

    #region Factory Methods

    /// <summary>
    /// Create a successful result.
    /// </summary>
    public static IndexingResult Successful(
        string indexId,
        int filesIndexed,
        int chunksCreated,
        TimeSpan duration) => new()
    {
        Success = true,
        IndexId = indexId,
        FilesIndexed = filesIndexed,
        ChunksCreated = chunksCreated,
        Duration = duration,
        StartedAt = DateTime.UtcNow - duration,
        CompletedAt = DateTime.UtcNow
    };

    /// <summary>
    /// Create a failed result.
    /// </summary>
    public static IndexingResult Failed(
        string errorMessage,
        TimeSpan duration,
        IReadOnlyList<IndexingError>? errors = null) => new()
    {
        Success = false,
        ErrorMessage = errorMessage,
        Duration = duration,
        Errors = errors ?? [],
        CompletedAt = DateTime.UtcNow
    };

    /// <summary>
    /// Create a cancelled result.
    /// </summary>
    public static IndexingResult Cancelled(
        int filesIndexed,
        int chunksCreated,
        TimeSpan duration) => new()
    {
        Success = false,
        WasCancelled = true,
        FilesIndexed = filesIndexed,
        ChunksCreated = chunksCreated,
        Duration = duration,
        ErrorMessage = "Indexing was cancelled",
        CompletedAt = DateTime.UtcNow
    };

    #endregion
}

/// <summary>
/// Result of a sync operation.
/// </summary>
public sealed class IndexSyncResult
{
    /// <summary>Whether the sync completed successfully.</summary>
    public bool Success { get; init; }

    /// <summary>Number of new files added.</summary>
    public int FilesAdded { get; init; }

    /// <summary>Number of files updated.</summary>
    public int FilesUpdated { get; init; }

    /// <summary>Number of files removed.</summary>
    public int FilesRemoved { get; init; }

    /// <summary>Number of files unchanged.</summary>
    public int FilesUnchanged { get; init; }

    /// <summary>Net change in chunk count.</summary>
    public int ChunksDelta { get; init; }

    /// <summary>Duration of the sync operation.</summary>
    public TimeSpan Duration { get; init; }

    /// <summary>List of errors that occurred.</summary>
    public IReadOnlyList<IndexingError> Errors { get; init; } = [];

    /// <summary>Total files processed (added + updated + removed).</summary>
    public int TotalChanged => FilesAdded + FilesUpdated + FilesRemoved;
}

/// <summary>
/// Error that occurred during indexing.
/// </summary>
public sealed class IndexingError
{
    /// <summary>Path to the file that caused the error.</summary>
    public required string FilePath { get; init; }

    /// <summary>Error message.</summary>
    public required string Message { get; init; }

    /// <summary>Type of error.</summary>
    public IndexingErrorType Type { get; init; }

    /// <summary>Exception type name if available.</summary>
    public string? ExceptionType { get; init; }

    /// <summary>Stack trace if available.</summary>
    public string? StackTrace { get; init; }

    /// <summary>When the error occurred.</summary>
    public DateTime OccurredAt { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// Create an IndexingError from an exception.
    /// </summary>
    public static IndexingError FromException(string filePath, Exception ex) => new()
    {
        FilePath = filePath,
        Message = ex.Message,
        Type = ClassifyException(ex),
        ExceptionType = ex.GetType().Name,
        StackTrace = ex.StackTrace
    };

    private static IndexingErrorType ClassifyException(Exception ex) => ex switch
    {
        System.IO.IOException => IndexingErrorType.FileRead,
        System.IO.FileNotFoundException => IndexingErrorType.FileNotFound,
        System.IO.DirectoryNotFoundException => IndexingErrorType.FileNotFound,
        UnauthorizedAccessException => IndexingErrorType.PermissionDenied,
        System.Text.Json.JsonException => IndexingErrorType.Parsing,
        System.Text.DecoderFallbackException => IndexingErrorType.Encoding,
        OutOfMemoryException => IndexingErrorType.OutOfMemory,
        TimeoutException => IndexingErrorType.Timeout,
        OperationCanceledException => IndexingErrorType.Timeout,
        _ => IndexingErrorType.Unknown
    };
}

/// <summary>
/// Types of indexing errors.
/// </summary>
public enum IndexingErrorType
{
    /// <summary>Unknown error type.</summary>
    Unknown,

    /// <summary>Error reading file contents.</summary>
    FileRead,

    /// <summary>File not found.</summary>
    FileNotFound,

    /// <summary>Permission denied accessing file.</summary>
    PermissionDenied,

    /// <summary>Error parsing file contents.</summary>
    Parsing,

    /// <summary>Error with file encoding.</summary>
    Encoding,

    /// <summary>Error during chunking.</summary>
    Chunking,

    /// <summary>Error generating embeddings.</summary>
    Embedding,

    /// <summary>Error storing in vector database.</summary>
    Storage,

    /// <summary>Ran out of memory.</summary>
    OutOfMemory,

    /// <summary>Operation timed out.</summary>
    Timeout
}
```

### 4. IndexingJob.cs

**Location**: `src/SeniorIntern.Core/Models/IndexingJob.cs`

```csharp
using System;

namespace SeniorIntern.Core.Models;

/// <summary>
/// Represents a queued or active indexing job.
/// </summary>
/// <remarks>
/// <para>
/// IndexingJob tracks the lifecycle of a background indexing operation:
/// <list type="bullet">
///   <item>Queued: Waiting to be processed</item>
///   <item>Running: Currently being processed</item>
///   <item>Paused: Temporarily suspended</item>
///   <item>Completed/Failed/Cancelled: Terminal states</item>
/// </list>
/// </para>
/// <para>
/// Jobs can be queried via <see cref="IIndexingService.GetJob"/> and
/// cancelled via <see cref="IIndexingService.CancelJob"/>.
/// </para>
/// </remarks>
public sealed class IndexingJob
{
    #region Identity

    /// <summary>
    /// Unique identifier for this job.
    /// </summary>
    public string Id { get; init; } = Guid.NewGuid().ToString();

    /// <summary>
    /// Type of indexing operation.
    /// </summary>
    public IndexingJobType Type { get; init; }

    /// <summary>
    /// ID of the target index (for updates, null for new indexes).
    /// </summary>
    public string? IndexId { get; init; }

    #endregion

    #region Target

    /// <summary>
    /// Path to the workspace being indexed.
    /// </summary>
    public required string WorkspacePath { get; init; }

    /// <summary>
    /// Indexing options for this job.
    /// </summary>
    public required IndexingOptions Options { get; init; }

    #endregion

    #region Status

    /// <summary>
    /// Current status of the job.
    /// </summary>
    public IndexingJobStatus Status { get; set; } = IndexingJobStatus.Queued;

    /// <summary>
    /// Priority of the job (higher = more important).
    /// </summary>
    public int Priority { get; init; }

    #endregion

    #region Timing

    /// <summary>
    /// When the job was created.
    /// </summary>
    public DateTime CreatedAt { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// When the job started processing.
    /// </summary>
    public DateTime? StartedAt { get; set; }

    /// <summary>
    /// When the job completed.
    /// </summary>
    public DateTime? CompletedAt { get; set; }

    #endregion

    #region State

    /// <summary>
    /// Current progress of the job.
    /// </summary>
    public IndexingProgress? Progress { get; set; }

    /// <summary>
    /// Result of the job (when completed).
    /// </summary>
    public IndexingResult? Result { get; set; }

    /// <summary>
    /// Error message if job failed.
    /// </summary>
    public string? ErrorMessage { get; set; }

    #endregion

    #region Retry Configuration

    /// <summary>
    /// Number of retry attempts made.
    /// </summary>
    public int RetryCount { get; set; }

    /// <summary>
    /// Maximum retry attempts allowed.
    /// </summary>
    public int MaxRetries { get; init; } = 3;

    #endregion

    #region Computed Properties

    /// <summary>
    /// How long the job has been running.
    /// </summary>
    public TimeSpan? RunningTime => StartedAt.HasValue
        ? (CompletedAt ?? DateTime.UtcNow) - StartedAt.Value
        : null;

    /// <summary>
    /// How long the job waited in queue before starting.
    /// </summary>
    public TimeSpan? QueueTime => StartedAt.HasValue
        ? StartedAt.Value - CreatedAt
        : null;

    /// <summary>
    /// Whether the job can be retried.
    /// </summary>
    public bool CanRetry => RetryCount < MaxRetries &&
        (Status == IndexingJobStatus.Failed || Status == IndexingJobStatus.Cancelled);

    /// <summary>
    /// Whether the job is in a terminal state.
    /// </summary>
    public bool IsComplete => Status is IndexingJobStatus.Completed
        or IndexingJobStatus.Failed
        or IndexingJobStatus.Cancelled;

    #endregion
}

/// <summary>
/// Types of indexing jobs.
/// </summary>
public enum IndexingJobType
{
    /// <summary>Full workspace indexing.</summary>
    FullIndex,

    /// <summary>Incremental update of existing index.</summary>
    IncrementalUpdate,

    /// <summary>Index specific files only.</summary>
    PartialIndex,

    /// <summary>Sync with filesystem (add/update/remove).</summary>
    Sync,

    /// <summary>Re-index triggered by file watcher.</summary>
    FileWatchUpdate
}

/// <summary>
/// Status of an indexing job.
/// </summary>
public enum IndexingJobStatus
{
    /// <summary>Job is waiting in queue.</summary>
    Queued,

    /// <summary>Job is currently running.</summary>
    Running,

    /// <summary>Job is paused.</summary>
    Paused,

    /// <summary>Job completed successfully.</summary>
    Completed,

    /// <summary>Job failed with errors.</summary>
    Failed,

    /// <summary>Job was cancelled.</summary>
    Cancelled
}
```

### 5. IndexingEnums.cs

**Location**: `src/SeniorIntern.Core/Models/IndexingEnums.cs`

```csharp
namespace SeniorIntern.Core.Models;

/// <summary>
/// Overall status of the indexing service.
/// </summary>
/// <remarks>
/// Represents the current operational state of <see cref="IIndexingService"/>.
/// Used for UI display and service coordination.
/// </remarks>
public enum IndexingStatus
{
    /// <summary>No indexing operation in progress.</summary>
    Idle,

    /// <summary>Scanning workspace for files.</summary>
    Scanning,

    /// <summary>Actively indexing files.</summary>
    Indexing,

    /// <summary>Indexing is paused.</summary>
    Paused,

    /// <summary>Cancellation in progress.</summary>
    Cancelling,

    /// <summary>Service is in an error state.</summary>
    Error
}
```

---

## Unit Testing Requirements

| Model | Test Count | Focus Areas |
|-------|------------|-------------|
| `IndexingOptions` | 12-15 | Default values, presets, pattern validation |
| `IndexingProgress` | 10-12 | Factory methods, computed properties |
| `IndexingResult` | 12-15 | Factory methods, computed rates |
| `IndexSyncResult` | 5-7 | TotalChanged calculation |
| `IndexingError` | 8-10 | FromException classification |
| `IndexingJob` | 10-12 | Status transitions, computed properties |
| Enums | 5-8 | Value coverage, serialization |

**Total: ~62-79 tests**

---

## Acceptance Criteria

### Functional Requirements
- [ ] `IndexingOptions` provides all configuration needed for indexing
- [ ] `IndexingProgress` tracks all phases with accurate metrics
- [ ] `IndexingResult` captures complete operation statistics
- [ ] `IndexingJob` tracks full job lifecycle
- [ ] `IndexingError` properly classifies exception types
- [ ] All enums cover required states
- [ ] Factory methods create valid instances

### Quality Requirements
- [ ] All models are immutable where appropriate (init-only properties)
- [ ] All public members have XML documentation
- [ ] Default patterns cover common programming languages
- [ ] Computed properties handle edge cases (division by zero)

---

## Future Considerations

Items explicitly deferred to later sub-versions:
- **v0.7.3c**: `IndexingService` implementation using these models
- **v0.7.3g**: `IndexingJobQueue` implementation
- **v0.7.3i**: Progress tracking integration and event args
