# Design Specification: AIntern v0.7.2b "Vector Index Models"

## Overview

**Version**: v0.7.2b
**Parent**: v0.7.2 Vector Storage
**Focus**: Define the models for vector indexes, including configuration, status tracking, and settings

### Purpose

Define comprehensive models for vector index management:
1. Create `VectorIndex` model to represent a workspace index
2. Create `VectorIndexSettings` model for index configuration
3. Create `IndexedFile` model for file tracking
4. Create `FileChangeSet` model for change detection
5. Define `IndexStatus` and `FileIndexStatus` enums

### Dependencies

**From v0.7.2a (Vector Store Interface)**:
- `IVectorStore` interface (uses these models)

**From v0.7.1d (Text Chunk Models)**:
- `ChunkingOptions` model (embedded in VectorIndexSettings)

---

## Architecture

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                       v0.7.2b Vector Index Models                             │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Core Model Hierarchy:                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  VectorIndex (one per workspace)                                        │ │
│  │  ├── Id: string                    ← GUID identifier                    │ │
│  │  ├── Name: string                  ← Human-readable name                │ │
│  │  ├── WorkspacePath: string         ← Absolute path to workspace         │ │
│  │  ├── EmbeddingModel: string        ← Model name/path                    │ │
│  │  ├── EmbeddingDimension: int       ← Vector dimension (384, 768, etc.)  │ │
│  │  ├── Status: IndexStatus           ← Current state                      │ │
│  │  ├── Settings: VectorIndexSettings ← Configuration                      │ │
│  │  ├── Timestamps                                                          │ │
│  │  │   ├── CreatedAt                                                       │ │
│  │  │   ├── UpdatedAt                                                       │ │
│  │  │   ├── LastFullIndexAt                                                 │ │
│  │  │   └── LastIncrementalUpdateAt                                         │ │
│  │  ├── Counts                                                              │ │
│  │  │   ├── ChunkCount                                                      │ │
│  │  │   ├── FileCount                                                       │ │
│  │  │   └── TotalFileSizeBytes                                              │ │
│  │  └── Metadata                                                            │ │
│  │      ├── SchemaVersion                                                   │ │
│  │      ├── Description                                                     │ │
│  │      └── LastError                                                       │ │
│  │                                                                          │ │
│  │      ↓ Contains many                                                     │ │
│  │                                                                          │ │
│  │  IndexedFile (one per source file)                                      │ │
│  │  ├── Id: string                    ← GUID identifier                    │ │
│  │  ├── IndexId: string               ← Parent index reference             │ │
│  │  ├── FilePath: string              ← Relative path in workspace         │ │
│  │  ├── FileHash: string              ← SHA-256 for change detection       │ │
│  │  ├── Status: FileIndexStatus       ← Indexing state                     │ │
│  │  ├── File Info                                                           │ │
│  │  │   ├── FileSize, LineCount                                            │ │
│  │  │   ├── Language, Encoding                                              │ │
│  │  │   └── LastModified                                                    │ │
│  │  └── Indexing Stats                                                      │ │
│  │      ├── IndexedAt, ChunkCount                                           │ │
│  │      ├── IndexingDurationMs                                              │ │
│  │      └── ErrorMessage                                                    │ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Configuration:                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  VectorIndexSettings                                                     │ │
│  │  ├── ChunkingOptions               ← From v0.7.1d                       │ │
│  │  ├── File Filtering                                                      │ │
│  │  │   ├── IncludePatterns[]         ← Glob patterns to include           │ │
│  │  │   ├── ExcludePatterns[]         ← Glob patterns to exclude           │ │
│  │  │   ├── MaxFileSizeKb             ← Skip large files                   │ │
│  │  │   ├── MinFileSizeBytes          ← Skip tiny files                    │ │
│  │  │   └── RespectGitignore          ← Honor .gitignore                   │ │
│  │  ├── Traversal Options                                                   │ │
│  │  │   ├── IndexHiddenFiles          ← Include dotfiles                   │ │
│  │  │   ├── FollowSymlinks            ← Follow symbolic links              │ │
│  │  │   └── MaxDepth                  ← Directory depth limit              │ │
│  │  └── Performance                                                         │ │
│  │      ├── AutoReindex               ← Watch for changes                  │ │
│  │      ├── AutoReindexDelayMs        ← Debounce delay                     │ │
│  │      ├── ParallelProcessing        ← Thread count                       │ │
│  │      └── CustomLanguageMappings    ← Extension→Language                 │ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Change Detection:                                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                          │ │
│  │  FileChangeSet                                                           │ │
│  │  ├── AddedFiles[]                  ← New files to index                 │ │
│  │  ├── ModifiedFiles[]               ← Changed files to re-index          │ │
│  │  ├── DeletedFiles[]                ← Removed files to clean up          │ │
│  │  ├── UnchangedFiles[]              ← No action needed                   │ │
│  │  ├── HasChanges                    ← Boolean check                      │ │
│  │  └── TotalChanges                  ← Count of work needed               │ │
│  │                                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Enum Definitions

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                            Status Enumerations                                │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  IndexStatus (for VectorIndex)                                               │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  Value       │ Description                                              │ │
│  │  ────────────│─────────────────────────────────────────────────────────│ │
│  │  Active      │ Index ready for queries                                  │ │
│  │  Building    │ Initial index creation in progress                       │ │
│  │  Updating    │ Incremental update in progress                           │ │
│  │  Paused      │ Indexing paused by user                                  │ │
│  │  Error       │ Indexing failed, see LastError                           │ │
│  │  Deleting    │ Index marked for deletion                                │ │
│  │  NeedsRebuild│ Schema migration required                                │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  FileIndexStatus (for IndexedFile)                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  Value       │ Description                                              │ │
│  │  ────────────│─────────────────────────────────────────────────────────│ │
│  │  Pending     │ File queued for indexing                                 │ │
│  │  Indexing    │ Currently being processed                                │ │
│  │  Indexed     │ Successfully indexed                                     │ │
│  │  Skipped     │ Excluded by filters or too large                         │ │
│  │  Error       │ Indexing failed for this file                            │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## File Specifications

### 1. VectorIndex.cs

**Location**: `src/SeniorIntern.Core/Models/VectorIndex.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;

/// <summary>
/// Represents a vector index for a workspace.
/// </summary>
/// <remarks>
/// <para>
/// A VectorIndex is the primary unit of organization for vector storage.
/// Each workspace (folder) can have at most one index containing embeddings
/// for all indexed files.
/// </para>
/// <para>
/// The index stores:
/// <list type="bullet">
///   <item>Configuration settings (file patterns, chunking options)</item>
///   <item>References to indexed files</item>
///   <item>Chunk embeddings for similarity search</item>
/// </list>
/// </para>
/// <para>
/// Lifecycle: Created → Building → Active ↔ Updating → Deleting
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var index = await vectorStore.CreateIndexAsync(
///     "/path/to/project",
///     "My Project",
///     384, // embedding dimension
///     new VectorIndexSettings
///     {
///         MaxFileSizeKb = 512,
///         RespectGitignore = true
///     });
/// </code>
/// </example>
public sealed class VectorIndex
{
    #region Identifiers

    /// <summary>
    /// Unique identifier for this index.
    /// </summary>
    /// <remarks>
    /// Generated as a GUID string when the index is created.
    /// Used as the primary key in the database.
    /// </remarks>
    public string Id { get; init; } = Guid.NewGuid().ToString();

    /// <summary>
    /// Human-readable name for the index.
    /// </summary>
    /// <remarks>
    /// Displayed in the UI. Can be changed after creation.
    /// </remarks>
    public required string Name { get; init; }

    /// <summary>
    /// Absolute path to the indexed workspace.
    /// </summary>
    /// <remarks>
    /// This is the root directory from which files are indexed.
    /// Cannot be changed after creation.
    /// </remarks>
    public required string WorkspacePath { get; init; }

    #endregion

    #region Timestamps

    /// <summary>
    /// When the index was created.
    /// </summary>
    public DateTime CreatedAt { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// When the index was last updated (metadata or chunks).
    /// </summary>
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    /// <summary>
    /// When the last full index operation completed.
    /// </summary>
    /// <remarks>
    /// Null if the index has never completed a full build.
    /// </remarks>
    public DateTime? LastFullIndexAt { get; set; }

    /// <summary>
    /// When the last incremental update completed.
    /// </summary>
    public DateTime? LastIncrementalUpdateAt { get; set; }

    #endregion

    #region Embedding Configuration

    /// <summary>
    /// Name or path of the embedding model used.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Stored to detect if the model changes, which would require re-indexing.
    /// </para>
    /// <para>
    /// Common values:
    /// <list type="bullet">
    ///   <item>"all-MiniLM-L6-v2" (384 dimensions)</item>
    ///   <item>"bge-base-en-v1.5" (768 dimensions)</item>
    ///   <item>"nomic-embed-text" (768 dimensions)</item>
    /// </list>
    /// </para>
    /// </remarks>
    public required string EmbeddingModel { get; init; }

    /// <summary>
    /// Dimension of stored embedding vectors.
    /// </summary>
    /// <remarks>
    /// Must match the embedding model's output dimension.
    /// Cannot be changed after creation.
    /// Common values: 384, 768, 1024, 1536.
    /// </remarks>
    public required int EmbeddingDimension { get; init; }

    #endregion

    #region Statistics

    /// <summary>
    /// Number of chunks stored in the index.
    /// </summary>
    public int ChunkCount { get; set; }

    /// <summary>
    /// Number of files indexed.
    /// </summary>
    public int FileCount { get; set; }

    /// <summary>
    /// Total size of indexed files in bytes.
    /// </summary>
    public long TotalFileSizeBytes { get; set; }

    #endregion

    #region Status

    /// <summary>
    /// Current status of the index.
    /// </summary>
    public IndexStatus Status { get; set; } = IndexStatus.Active;

    /// <summary>
    /// Last error message if status is Error.
    /// </summary>
    public string? LastError { get; set; }

    #endregion

    #region Configuration

    /// <summary>
    /// Index configuration settings.
    /// </summary>
    /// <remarks>
    /// Settings are serialized as JSON in the database.
    /// Changes to settings may trigger re-indexing.
    /// </remarks>
    public VectorIndexSettings Settings { get; init; } = new();

    /// <summary>
    /// Version number for schema migrations.
    /// </summary>
    /// <remarks>
    /// Incremented when the index schema changes.
    /// Used to detect when NeedsRebuild status is required.
    /// </remarks>
    public int SchemaVersion { get; init; } = 1;

    /// <summary>
    /// Optional description or notes.
    /// </summary>
    public string? Description { get; set; }

    #endregion

    #region Computed Properties

    /// <summary>
    /// Whether the index is ready for queries.
    /// </summary>
    public bool IsQueryable => Status == IndexStatus.Active;

    /// <summary>
    /// Whether the index is currently processing.
    /// </summary>
    public bool IsProcessing => Status is IndexStatus.Building or IndexStatus.Updating;

    /// <summary>
    /// Average chunks per file.
    /// </summary>
    public double AverageChunksPerFile => FileCount > 0 ? (double)ChunkCount / FileCount : 0;

    /// <summary>
    /// Formatted total file size (e.g., "1.5 MB").
    /// </summary>
    public string FormattedTotalSize => FormatBytes(TotalFileSizeBytes);

    #endregion

    #region Helper Methods

    private static string FormatBytes(long bytes)
    {
        const long kb = 1024;
        const long mb = kb * 1024;
        const long gb = mb * 1024;

        return bytes switch
        {
            >= gb => $"{bytes / (double)gb:F2} GB",
            >= mb => $"{bytes / (double)mb:F2} MB",
            >= kb => $"{bytes / (double)kb:F2} KB",
            _ => $"{bytes} B"
        };
    }

    #endregion
}

/// <summary>
/// Status of a vector index.
/// </summary>
public enum IndexStatus
{
    /// <summary>
    /// Index is active and ready for queries.
    /// </summary>
    Active,

    /// <summary>
    /// Index is being created or rebuilt.
    /// </summary>
    Building,

    /// <summary>
    /// Index is being updated incrementally.
    /// </summary>
    Updating,

    /// <summary>
    /// Indexing is paused by user request.
    /// </summary>
    Paused,

    /// <summary>
    /// Index encountered an error.
    /// </summary>
    /// <remarks>
    /// Check <see cref="VectorIndex.LastError"/> for details.
    /// </remarks>
    Error,

    /// <summary>
    /// Index is marked for deletion.
    /// </summary>
    Deleting,

    /// <summary>
    /// Index needs rebuilding (e.g., schema migration, model change).
    /// </summary>
    NeedsRebuild
}
```

### 2. VectorIndexSettings.cs

**Location**: `src/SeniorIntern.Core/Models/VectorIndexSettings.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;
using System.Collections.Generic;

/// <summary>
/// Configuration settings for a vector index.
/// </summary>
/// <remarks>
/// <para>
/// These settings control how files are discovered, filtered, and processed
/// during indexing. They are stored with the index and applied during both
/// initial indexing and incremental updates.
/// </para>
/// <para>
/// Changes to settings may require re-indexing:
/// <list type="bullet">
///   <item>IncludePatterns/ExcludePatterns: New files may need indexing</item>
///   <item>ChunkingOptions: All files need re-chunking</item>
///   <item>MaxFileSizeKb: Large files may now be included/excluded</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var settings = new VectorIndexSettings
/// {
///     IncludePatterns = new[] { "**/*.cs", "**/*.md" },
///     ExcludePatterns = new[] { "**/bin/**", "**/obj/**" },
///     MaxFileSizeKb = 512,
///     RespectGitignore = true,
///     ParallelProcessing = Environment.ProcessorCount
/// };
/// </code>
/// </example>
public sealed class VectorIndexSettings
{
    #region Chunking

    /// <summary>
    /// Chunking configuration for text processing.
    /// </summary>
    /// <remarks>
    /// Controls how source files are split into chunks for embedding.
    /// See <see cref="ChunkingOptions"/> for detailed settings.
    /// </remarks>
    public ChunkingOptions ChunkingOptions { get; init; } = new();

    #endregion

    #region File Filtering

    /// <summary>
    /// Glob patterns for files to include.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Default includes common source code file types.
    /// Patterns are relative to the workspace root.
    /// </para>
    /// <para>
    /// Examples:
    /// <list type="bullet">
    ///   <item>"**/*.cs" - All C# files</item>
    ///   <item>"src/**/*.ts" - TypeScript files in src/</item>
    ///   <item>"*.md" - Markdown files in root only</item>
    /// </list>
    /// </para>
    /// </remarks>
    public IReadOnlyList<string> IncludePatterns { get; init; } = new[]
    {
        // .NET
        "**/*.cs", "**/*.fs", "**/*.vb", "**/*.csproj", "**/*.fsproj",
        // Web
        "**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx", "**/*.vue", "**/*.svelte",
        "**/*.html", "**/*.css", "**/*.scss", "**/*.less",
        // Python
        "**/*.py", "**/*.pyi", "**/*.pyx",
        // JVM
        "**/*.java", "**/*.kt", "**/*.scala", "**/*.groovy",
        // Systems
        "**/*.go", "**/*.rs", "**/*.cpp", "**/*.c", "**/*.h", "**/*.hpp",
        // Other
        "**/*.swift", "**/*.rb", "**/*.php", "**/*.lua",
        // Config/Docs
        "**/*.md", "**/*.json", "**/*.yaml", "**/*.yml", "**/*.xml", "**/*.toml"
    };

    /// <summary>
    /// Glob patterns for files/directories to exclude.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Applied after include patterns. Excludes take precedence.
    /// Default excludes common build outputs and dependencies.
    /// </para>
    /// </remarks>
    public IReadOnlyList<string> ExcludePatterns { get; init; } = new[]
    {
        // Build outputs
        "**/node_modules/**", "**/bin/**", "**/obj/**", "**/dist/**", "**/build/**",
        "**/target/**", "**/out/**", "**/.next/**", "**/.nuxt/**",
        // Package managers
        "**/packages/**", "**/vendor/**", "**/.npm/**", "**/.yarn/**",
        // Version control
        "**/.git/**", "**/.svn/**", "**/.hg/**",
        // IDE
        "**/.vs/**", "**/.idea/**", "**/.vscode/**",
        // Minified/generated
        "**/*.min.js", "**/*.min.css", "**/*.map", "**/*.d.ts",
        // Large files
        "**/*.lock", "**/package-lock.json", "**/yarn.lock",
        // Temporary
        "**/tmp/**", "**/temp/**", "**/.cache/**"
    };

    /// <summary>
    /// Maximum file size to index in kilobytes.
    /// </summary>
    /// <remarks>
    /// Files larger than this are skipped. Set to 0 for no limit.
    /// Default: 1024 KB (1 MB).
    /// </remarks>
    public int MaxFileSizeKb { get; init; } = 1024;

    /// <summary>
    /// Minimum file size to index in bytes.
    /// </summary>
    /// <remarks>
    /// Very small files (empty or near-empty) are often not useful for search.
    /// Default: 10 bytes.
    /// </remarks>
    public int MinFileSizeBytes { get; init; } = 10;

    #endregion

    #region Traversal Options

    /// <summary>
    /// Whether to index hidden files (starting with .).
    /// </summary>
    /// <remarks>
    /// Default: false. Hidden files are often configuration that's not useful for code search.
    /// </remarks>
    public bool IndexHiddenFiles { get; init; } = false;

    /// <summary>
    /// Whether to respect .gitignore rules.
    /// </summary>
    /// <remarks>
    /// When true, files matched by .gitignore are excluded from indexing.
    /// This applies in addition to ExcludePatterns.
    /// Default: true.
    /// </remarks>
    public bool RespectGitignore { get; init; } = true;

    /// <summary>
    /// Whether to follow symbolic links.
    /// </summary>
    /// <remarks>
    /// Default: false. Following symlinks can cause infinite loops or duplicate content.
    /// </remarks>
    public bool FollowSymlinks { get; init; } = false;

    /// <summary>
    /// Maximum directory depth to traverse (-1 for unlimited).
    /// </summary>
    /// <remarks>
    /// 0 = only files in root, 1 = root + one level, etc.
    /// Default: -1 (unlimited).
    /// </remarks>
    public int MaxDepth { get; init; } = -1;

    #endregion

    #region Auto-Reindexing

    /// <summary>
    /// Whether to automatically re-index when files change.
    /// </summary>
    /// <remarks>
    /// When true, file system watchers detect changes and trigger incremental updates.
    /// Default: true.
    /// </remarks>
    public bool AutoReindex { get; init; } = true;

    /// <summary>
    /// Delay in milliseconds before re-indexing after file changes.
    /// </summary>
    /// <remarks>
    /// Helps batch rapid file changes (e.g., during compilation).
    /// Default: 5000 ms (5 seconds).
    /// </remarks>
    public int AutoReindexDelayMs { get; init; } = 5000;

    #endregion

    #region Performance

    /// <summary>
    /// Number of parallel file processing threads.
    /// </summary>
    /// <remarks>
    /// Higher values speed up indexing on multi-core systems.
    /// Default: 4.
    /// </remarks>
    public int ParallelProcessing { get; init; } = 4;

    /// <summary>
    /// Custom file extension to language mappings.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Overrides the default language detection for specific extensions.
    /// </para>
    /// <para>
    /// Example: { ".prisma": "graphql", ".hbs": "handlebars" }
    /// </para>
    /// </remarks>
    public IReadOnlyDictionary<string, string>? CustomLanguageMappings { get; init; }

    #endregion

    #region Computed Properties

    /// <summary>
    /// Maximum file size in bytes.
    /// </summary>
    public long MaxFileSizeBytes => MaxFileSizeKb * 1024L;

    #endregion
}
```

### 3. IndexedFile.cs

**Location**: `src/SeniorIntern.Core/Models/IndexedFile.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System;

/// <summary>
/// Tracks a file that has been indexed.
/// </summary>
/// <remarks>
/// <para>
/// Each file in a workspace has a corresponding IndexedFile record that stores:
/// <list type="bullet">
///   <item>File metadata (path, size, modification time)</item>
///   <item>Content hash for change detection</item>
///   <item>Indexing statistics (chunk count, duration)</item>
///   <item>Status and error information</item>
/// </list>
/// </para>
/// <para>
/// The FileHash is used to detect file changes during incremental indexing.
/// When a file's hash differs from the stored hash, the file is re-indexed.
/// </para>
/// </remarks>
public sealed class IndexedFile
{
    #region Identifiers

    /// <summary>
    /// Unique identifier for this file record.
    /// </summary>
    public string Id { get; init; } = Guid.NewGuid().ToString();

    /// <summary>
    /// ID of the index containing this file.
    /// </summary>
    public required string IndexId { get; init; }

    /// <summary>
    /// Relative path to the file within the workspace.
    /// </summary>
    /// <remarks>
    /// Uses forward slashes as path separator, regardless of platform.
    /// </remarks>
    public required string FilePath { get; init; }

    #endregion

    #region Content

    /// <summary>
    /// Hash of the file contents for change detection.
    /// </summary>
    /// <remarks>
    /// Uses SHA-256 by default. Format: lowercase hex string (64 characters).
    /// </remarks>
    public required string FileHash { get; init; }

    /// <summary>
    /// Size of the file in bytes.
    /// </summary>
    public long FileSize { get; init; }

    /// <summary>
    /// Line count in the file.
    /// </summary>
    public int LineCount { get; init; }

    /// <summary>
    /// File encoding (UTF-8, ASCII, etc.).
    /// </summary>
    public string? Encoding { get; init; }

    #endregion

    #region Metadata

    /// <summary>
    /// Last modification time of the file.
    /// </summary>
    public DateTime LastModified { get; init; }

    /// <summary>
    /// Detected programming language.
    /// </summary>
    public string? Language { get; init; }

    #endregion

    #region Indexing Status

    /// <summary>
    /// When this file was indexed.
    /// </summary>
    public DateTime IndexedAt { get; init; } = DateTime.UtcNow;

    /// <summary>
    /// Number of chunks created from this file.
    /// </summary>
    public int ChunkCount { get; set; }

    /// <summary>
    /// Indexing status for this file.
    /// </summary>
    public FileIndexStatus Status { get; set; } = FileIndexStatus.Indexed;

    /// <summary>
    /// Error message if indexing failed.
    /// </summary>
    public string? ErrorMessage { get; set; }

    /// <summary>
    /// Time taken to index this file in milliseconds.
    /// </summary>
    public int IndexingDurationMs { get; init; }

    #endregion

    #region Computed Properties

    /// <summary>
    /// Whether the file was successfully indexed.
    /// </summary>
    public bool IsIndexed => Status == FileIndexStatus.Indexed;

    /// <summary>
    /// Whether the file had an error.
    /// </summary>
    public bool HasError => Status == FileIndexStatus.Error;

    /// <summary>
    /// File extension (lowercase, with dot).
    /// </summary>
    public string Extension => System.IO.Path.GetExtension(FilePath).ToLowerInvariant();

    /// <summary>
    /// File name without path.
    /// </summary>
    public string FileName => System.IO.Path.GetFileName(FilePath);

    /// <summary>
    /// Formatted file size (e.g., "1.5 KB").
    /// </summary>
    public string FormattedSize => FormatBytes(FileSize);

    #endregion

    #region Helper Methods

    private static string FormatBytes(long bytes)
    {
        const long kb = 1024;
        const long mb = kb * 1024;

        return bytes switch
        {
            >= mb => $"{bytes / (double)mb:F2} MB",
            >= kb => $"{bytes / (double)kb:F2} KB",
            _ => $"{bytes} B"
        };
    }

    #endregion
}

/// <summary>
/// Status of file indexing.
/// </summary>
public enum FileIndexStatus
{
    /// <summary>
    /// File is pending indexing.
    /// </summary>
    Pending,

    /// <summary>
    /// File is currently being indexed.
    /// </summary>
    Indexing,

    /// <summary>
    /// File was successfully indexed.
    /// </summary>
    Indexed,

    /// <summary>
    /// File was skipped (too large, excluded by pattern, binary, etc.).
    /// </summary>
    Skipped,

    /// <summary>
    /// Indexing failed with an error.
    /// </summary>
    /// <remarks>
    /// Check <see cref="IndexedFile.ErrorMessage"/> for details.
    /// </remarks>
    Error
}
```

### 4. FileChangeSet.cs

**Location**: `src/SeniorIntern.Core/Models/FileChangeSet.cs`

```csharp
namespace SeniorIntern.Core.Models;

using System.Collections.Generic;
using System.Linq;

/// <summary>
/// Set of file changes detected for incremental indexing.
/// </summary>
/// <remarks>
/// <para>
/// Created by comparing current workspace files against stored IndexedFile records.
/// Used to determine which files need (re-)indexing during incremental updates.
/// </para>
/// <para>
/// Change detection uses file content hashes (SHA-256) rather than timestamps
/// for reliable change detection even when files are copied or restored.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var changes = await vectorStore.DetectFileChangesAsync(indexId, currentFileHashes);
/// if (changes.HasChanges)
/// {
///     await vectorStore.RemoveChunksForFilesAsync(indexId, changes.DeletedFiles);
///     await vectorStore.RemoveChunksForFilesAsync(indexId, changes.ModifiedFiles);
///     // Re-index modified and added files...
/// }
/// </code>
/// </example>
public sealed class FileChangeSet
{
    #region File Lists

    /// <summary>
    /// Files that are new and need to be indexed.
    /// </summary>
    /// <remarks>
    /// Files that exist in the workspace but have no IndexedFile record.
    /// </remarks>
    public IReadOnlyList<string> AddedFiles { get; init; } = [];

    /// <summary>
    /// Files that have been modified and need re-indexing.
    /// </summary>
    /// <remarks>
    /// Files where the current content hash differs from the stored hash.
    /// Existing chunks should be removed before re-indexing.
    /// </remarks>
    public IReadOnlyList<string> ModifiedFiles { get; init; } = [];

    /// <summary>
    /// Files that have been deleted and should be removed from the index.
    /// </summary>
    /// <remarks>
    /// Files that have IndexedFile records but no longer exist in the workspace.
    /// </remarks>
    public IReadOnlyList<string> DeletedFiles { get; init; } = [];

    /// <summary>
    /// Files that are unchanged.
    /// </summary>
    /// <remarks>
    /// Files where the current hash matches the stored hash.
    /// No action needed for these files.
    /// </remarks>
    public IReadOnlyList<string> UnchangedFiles { get; init; } = [];

    #endregion

    #region Computed Properties

    /// <summary>
    /// Whether there are any changes.
    /// </summary>
    public bool HasChanges =>
        AddedFiles.Count > 0 ||
        ModifiedFiles.Count > 0 ||
        DeletedFiles.Count > 0;

    /// <summary>
    /// Total number of files that need processing.
    /// </summary>
    public int TotalChanges =>
        AddedFiles.Count +
        ModifiedFiles.Count +
        DeletedFiles.Count;

    /// <summary>
    /// All files that need (re-)indexing.
    /// </summary>
    public IEnumerable<string> FilesToIndex =>
        AddedFiles.Concat(ModifiedFiles);

    /// <summary>
    /// Number of files needing re-indexing (new + modified).
    /// </summary>
    public int FilesToIndexCount =>
        AddedFiles.Count + ModifiedFiles.Count;

    #endregion

    #region Factory Methods

    /// <summary>
    /// Create an empty change set (no changes).
    /// </summary>
    public static FileChangeSet Empty => new();

    /// <summary>
    /// Create a change set from categorized file lists.
    /// </summary>
    public static FileChangeSet Create(
        IEnumerable<string> added,
        IEnumerable<string> modified,
        IEnumerable<string> deleted,
        IEnumerable<string> unchanged)
    {
        return new FileChangeSet
        {
            AddedFiles = added.ToList(),
            ModifiedFiles = modified.ToList(),
            DeletedFiles = deleted.ToList(),
            UnchangedFiles = unchanged.ToList()
        };
    }

    #endregion

    #region Summary

    /// <summary>
    /// Get a summary string for logging.
    /// </summary>
    public string GetSummary()
    {
        if (!HasChanges)
            return "No changes detected";

        var parts = new List<string>();
        if (AddedFiles.Count > 0)
            parts.Add($"{AddedFiles.Count} added");
        if (ModifiedFiles.Count > 0)
            parts.Add($"{ModifiedFiles.Count} modified");
        if (DeletedFiles.Count > 0)
            parts.Add($"{DeletedFiles.Count} deleted");

        return string.Join(", ", parts);
    }

    #endregion
}
```

---

## Default File Patterns

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        Default Include/Exclude Patterns                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Include Patterns (by category):                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  Category    │ Patterns                                                 │ │
│  │  ────────────│──────────────────────────────────────────────────────── │ │
│  │  .NET        │ **/*.cs, **/*.fs, **/*.vb, **/*.csproj, **/*.fsproj     │ │
│  │  Web         │ **/*.ts, **/*.tsx, **/*.js, **/*.jsx,                   │ │
│  │              │ **/*.vue, **/*.svelte, **/*.html, **/*.css              │ │
│  │  Python      │ **/*.py, **/*.pyi, **/*.pyx                             │ │
│  │  JVM         │ **/*.java, **/*.kt, **/*.scala, **/*.groovy             │ │
│  │  Systems     │ **/*.go, **/*.rs, **/*.cpp, **/*.c, **/*.h              │ │
│  │  Other       │ **/*.swift, **/*.rb, **/*.php, **/*.lua                 │ │
│  │  Config/Docs │ **/*.md, **/*.json, **/*.yaml, **/*.xml                 │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Exclude Patterns (by category):                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │  Category        │ Patterns                                             │ │
│  │  ────────────────│────────────────────────────────────────────────────  │ │
│  │  Build Outputs   │ **/node_modules/**, **/bin/**, **/obj/**,            │ │
│  │                  │ **/dist/**, **/build/**, **/target/**                │ │
│  │  Package Mgrs    │ **/packages/**, **/vendor/**, **/.npm/**             │ │
│  │  Version Control │ **/.git/**, **/.svn/**, **/.hg/**                    │ │
│  │  IDE             │ **/.vs/**, **/.idea/**, **/.vscode/**                │ │
│  │  Generated       │ **/*.min.js, **/*.min.css, **/*.map, **/*.d.ts      │ │
│  │  Lock Files      │ **/*.lock, **/package-lock.json, **/yarn.lock       │ │
│  │  Temporary       │ **/tmp/**, **/temp/**, **/.cache/**                  │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## Unit Test Plan

| Test | Description |
|------|-------------|
| `VectorIndex_Id_GeneratesGuid` | ID generation |
| `VectorIndex_IsQueryable_ActiveStatus_ReturnsTrue` | Computed property |
| `VectorIndex_IsProcessing_BuildingStatus_ReturnsTrue` | Computed property |
| `VectorIndex_FormattedTotalSize_FormatsCorrectly` | Byte formatting |
| `VectorIndexSettings_DefaultIncludePatterns_ContainsCommonTypes` | Defaults |
| `VectorIndexSettings_DefaultExcludePatterns_ContainsNodeModules` | Defaults |
| `VectorIndexSettings_MaxFileSizeBytes_ConvertsFromKb` | Conversion |
| `IndexedFile_IsIndexed_IndexedStatus_ReturnsTrue` | Status check |
| `IndexedFile_HasError_ErrorStatus_ReturnsTrue` | Status check |
| `IndexedFile_Extension_ReturnsLowercase` | Normalization |
| `FileChangeSet_HasChanges_WithAddedFiles_ReturnsTrue` | Change detection |
| `FileChangeSet_HasChanges_Empty_ReturnsFalse` | Empty set |
| `FileChangeSet_TotalChanges_SumsCorrectly` | Count calculation |
| `FileChangeSet_FilesToIndex_CombinesAddedAndModified` | File enumeration |
| `FileChangeSet_GetSummary_FormatsCorrectly` | Summary string |

---

## File Summary

| File | Location | Purpose | Lines |
|------|----------|---------|-------|
| `VectorIndex.cs` | `Core/Models/` | Index model + IndexStatus enum | ~200 |
| `VectorIndexSettings.cs` | `Core/Models/` | Index configuration | ~180 |
| `IndexedFile.cs` | `Core/Models/` | File tracking + FileIndexStatus enum | ~150 |
| `FileChangeSet.cs` | `Core/Models/` | Change detection model | ~120 |

---

## Acceptance Criteria

| ID | Criterion |
|----|-----------|
| AC-1 | `VectorIndex` contains all required properties |
| AC-2 | `IndexStatus` enum covers all states |
| AC-3 | `VectorIndexSettings` has sensible defaults |
| AC-4 | Default include/exclude patterns cover common cases |
| AC-5 | `IndexedFile` tracks file hash for change detection |
| AC-6 | `FileIndexStatus` enum covers all states |
| AC-7 | `FileChangeSet` correctly categorizes file changes |
| AC-8 | Computed properties work correctly |
| AC-9 | Helper methods format bytes correctly |

---

## Changelog Entry

```markdown
## v0.7.2b - Vector Index Models

### Added
- `VectorIndex` model (`Core/Models/`)
  - Properties: Id, Name, WorkspacePath, EmbeddingModel, EmbeddingDimension
  - Timestamps: CreatedAt, UpdatedAt, LastFullIndexAt, LastIncrementalUpdateAt
  - Statistics: ChunkCount, FileCount, TotalFileSizeBytes
  - Status: Status (enum), LastError
  - Configuration: Settings, SchemaVersion, Description
  - Computed: IsQueryable, IsProcessing, AverageChunksPerFile, FormattedTotalSize
- `IndexStatus` enum
  - Active, Building, Updating, Paused, Error, Deleting, NeedsRebuild
- `VectorIndexSettings` model (`Core/Models/`)
  - ChunkingOptions reference
  - File filtering: Include/ExcludePatterns, MaxFileSizeKb, MinFileSizeBytes
  - Traversal: IndexHiddenFiles, RespectGitignore, FollowSymlinks, MaxDepth
  - Performance: AutoReindex, AutoReindexDelayMs, ParallelProcessing
  - Extensibility: CustomLanguageMappings
- `IndexedFile` model (`Core/Models/`)
  - Identifiers: Id, IndexId, FilePath
  - Content: FileHash (SHA-256), FileSize, LineCount, Encoding
  - Metadata: LastModified, Language
  - Status: IndexedAt, ChunkCount, Status, ErrorMessage, IndexingDurationMs
- `FileIndexStatus` enum
  - Pending, Indexing, Indexed, Skipped, Error
- `FileChangeSet` model (`Core/Models/`)
  - AddedFiles, ModifiedFiles, DeletedFiles, UnchangedFiles
  - Computed: HasChanges, TotalChanges, FilesToIndex, FilesToIndexCount
  - Factory: Empty, Create()
  - Utility: GetSummary()

### Default Patterns
- 40+ include patterns for common source code types
- 20+ exclude patterns for build outputs and dependencies
```

---

## Timeline Estimate

| Version | Estimated Effort |
|---------|------------------|
| v0.7.2b | 0.5 day |
