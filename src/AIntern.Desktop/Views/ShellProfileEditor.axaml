<!--
    ShellProfileEditor.axaml - Shell Profile Editor Dialog

    Version: v0.5.5g
    Created: 2026-01-19

    This window provides a modal dialog for creating and editing shell profiles:
    - Profile name field with required validation
    - Shell path field with Browse and Detect buttons
    - Shell type dropdown (auto-detected from path)
    - Version display (async detected)
    - Arguments field
    - Working directory with Browse button
    - Environment variables multiline editor (KEY=VALUE format)
    - Login shell checkbox
    - ConPTY checkbox (Windows only)
    - Cancel/Save buttons with validation state

    Keyboard Shortcuts:
    - Escape: Cancel and close

    Bound to: ShellProfileEditorViewModel (v0.5.5g)
-->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AIntern.Desktop.ViewModels"
        mc:Ignorable="d" d:DesignWidth="520" d:DesignHeight="640"
        x:Class="AIntern.Desktop.Views.ShellProfileEditor"
        x:DataType="vm:ShellProfileEditorViewModel"
        Title="{Binding WindowTitle}"
        Width="520"
        Height="640"
        MinWidth="400"
        MinHeight="500"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        CanResize="True"
        Background="{DynamicResource WindowBackground}">

    <!-- ================================================================== -->
    <!-- Window Styles - Form field styling                                  -->
    <!-- ================================================================== -->
    <Window.Styles>
        <!-- Field Label - Consistent label styling for form fields -->
        <Style Selector="TextBlock.field-label">
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondary}" />
            <Setter Property="Margin" Value="0,0,0,6" />
        </Style>

        <!-- Required Indicator - Red asterisk for required fields -->
        <Style Selector="TextBlock.required">
            <Setter Property="Foreground" Value="{DynamicResource ErrorBrush}" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>

        <!-- Error Text - Validation error display -->
        <Style Selector="TextBlock.error-text">
            <Setter Property="Foreground" Value="{DynamicResource ErrorBrush}" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Margin" Value="0,4,0,0" />
        </Style>

        <!-- Hint Text - Helper text below inputs -->
        <Style Selector="TextBlock.hint-text">
            <Setter Property="Foreground" Value="{DynamicResource TextMuted}" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Margin" Value="0,4,0,0" />
        </Style>

        <!-- Version Text - Shell version display -->
        <Style Selector="TextBlock.version-text">
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
            <Setter Property="FontSize" Value="11" />
        </Style>

        <!-- Field Group - Consistent spacing between form sections -->
        <Style Selector="StackPanel.field-group">
            <Setter Property="Margin" Value="0,0,0,20" />
        </Style>

        <!-- TextBox with error state -->
        <Style Selector="TextBox.has-error">
            <Setter Property="BorderBrush" Value="{DynamicResource ErrorBrush}" />
        </Style>
    </Window.Styles>

    <!-- ================================================================== -->
    <!-- Main Layout Grid                                                    -->
    <!-- ================================================================== -->
    <Grid RowDefinitions="*, Auto">

        <!-- ============================================================ -->
        <!-- Scrollable Form Content (Row 0)                               -->
        <!-- ============================================================ -->
        <ScrollViewer Grid.Row="0"
                      Padding="24,24,24,0"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel>

                <!-- ==================== PROFILE NAME ==================== -->
                <StackPanel Classes="field-group">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="field-label" Text="Profile Name" />
                        <TextBlock Classes="required" Text=" *" />
                    </StackPanel>
                    <TextBox Text="{Binding ProfileName}"
                             Watermark="e.g., My Development Shell"
                             MaxLength="100"
                             Classes.has-error="{Binding NameError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                    <TextBlock Classes="error-text"
                               Text="{Binding NameError}"
                               IsVisible="{Binding NameError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                </StackPanel>

                <!-- ==================== SHELL PATH ==================== -->
                <StackPanel Classes="field-group">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="field-label" Text="Shell Path" />
                        <TextBlock Classes="required" Text=" *" />
                    </StackPanel>

                    <!-- Path input with buttons -->
                    <Grid ColumnDefinitions="*, Auto, Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding ShellPath}"
                                 Watermark="/bin/bash or C:\Windows\System32\cmd.exe"
                                 Classes.has-error="{Binding PathError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        <Button Grid.Column="1"
                                Content="Detect"
                                Command="{Binding DetectFromPathCommand}"
                                ToolTip.Tip="Find shell executable in PATH"
                                Margin="8,0,0,0"
                                Padding="12,6" />
                        <Button Grid.Column="2"
                                Content="Browse..."
                                Command="{Binding BrowseShellPathCommand}"
                                CommandParameter="{Binding $parent[Window]}"
                                Margin="8,0,0,0"
                                Padding="12,6" />
                    </Grid>

                    <!-- Error message -->
                    <TextBlock Classes="error-text"
                               Text="{Binding PathError}"
                               IsVisible="{Binding PathError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                    <!-- Version display -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,4,0,0"
                                IsVisible="{Binding DetectedVersion, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Classes="hint-text" Text="Version: " />
                        <TextBlock Classes="version-text" Text="{Binding DetectedVersion}" />
                    </StackPanel>

                    <!-- Version loading indicator -->
                    <StackPanel Orientation="Horizontal"
                                Margin="0,4,0,0"
                                IsVisible="{Binding IsDetectingVersion}">
                        <ProgressBar IsIndeterminate="True"
                                     Width="12" Height="12"
                                     Margin="0,0,6,0" />
                        <TextBlock Classes="hint-text" Text="Detecting version..." />
                    </StackPanel>
                </StackPanel>

                <!-- ==================== SHELL TYPE ==================== -->
                <StackPanel Classes="field-group">
                    <TextBlock Classes="field-label" Text="Shell Type" />
                    <ComboBox ItemsSource="{Binding ShellTypes}"
                              SelectedItem="{Binding ShellType}"
                              HorizontalAlignment="Stretch" />
                    <TextBlock Classes="hint-text"
                               Text="Auto-detected from shell path. Override if incorrect." />
                </StackPanel>

                <!-- ==================== ARGUMENTS ==================== -->
                <StackPanel Classes="field-group">
                    <TextBlock Classes="field-label" Text="Arguments" />
                    <TextBox Text="{Binding Arguments}"
                             Watermark="-l --norc" />
                    <TextBlock Classes="hint-text"
                               Text="Command line arguments passed to the shell on startup" />
                </StackPanel>

                <!-- ==================== WORKING DIRECTORY ==================== -->
                <StackPanel Classes="field-group">
                    <TextBlock Classes="field-label" Text="Working Directory" />
                    <Grid ColumnDefinitions="*, Auto, Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding WorkingDirectory}"
                                 Watermark="Leave empty to use workspace directory" />
                        <Button Grid.Column="1"
                                Command="{Binding ClearWorkingDirectoryCommand}"
                                ToolTip.Tip="Clear"
                                Margin="8,0,0,0"
                                Padding="8,6"
                                IsVisible="{Binding WorkingDirectory, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <PathIcon Data="{StaticResource CloseIcon}" Width="12" Height="12" />
                        </Button>
                        <Button Grid.Column="2"
                                Content="Browse..."
                                Command="{Binding BrowseWorkingDirectoryCommand}"
                                CommandParameter="{Binding $parent[Window]}"
                                Margin="8,0,0,0"
                                Padding="12,6" />
                    </Grid>
                </StackPanel>

                <!-- ==================== ENVIRONMENT VARIABLES ==================== -->
                <StackPanel Classes="field-group">
                    <Grid ColumnDefinitions="*, Auto">
                        <TextBlock Grid.Column="0" Classes="field-label" Text="Environment Variables" />
                        <Button Grid.Column="1"
                                Command="{Binding AddEnvironmentVariableCommand}"
                                Padding="8,4"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <PathIcon Data="{StaticResource AddIcon}" Width="10" Height="10" />
                                <TextBlock Text="Add" FontSize="11" />
                            </StackPanel>
                        </Button>
                    </Grid>
                    <TextBox Text="{Binding EnvironmentVariables}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="100"
                             Watermark="KEY=value&#x0a;ANOTHER_KEY=another_value"
                             FontFamily="Cascadia Mono, Consolas, monospace"
                             FontSize="12" />
                    <TextBlock Classes="hint-text"
                               Text="One variable per line in KEY=value format. Added to the shell environment." />
                </StackPanel>

                <!-- ==================== OPTIONS ==================== -->
                <StackPanel Classes="field-group">
                    <TextBlock Classes="field-label" Text="Options" />

                    <!-- Login Shell -->
                    <CheckBox IsChecked="{Binding IsLoginShell}"
                              Margin="0,4,0,0">
                        <StackPanel>
                            <TextBlock Text="Run as login shell" />
                            <TextBlock Classes="hint-text"
                                       Text="Executes shell profile scripts (.bash_profile, .zprofile, etc.)"
                                       Margin="0" />
                        </StackPanel>
                    </CheckBox>

                    <!-- ConPTY (Windows only) -->
                    <CheckBox IsChecked="{Binding UseConPty}"
                              IsVisible="{Binding IsWindows}"
                              Margin="0,12,0,0">
                        <StackPanel>
                            <TextBlock Text="Use ConPTY" />
                            <TextBlock Classes="hint-text"
                                       Text="Windows pseudo-console for better terminal emulation"
                                       Margin="0" />
                        </StackPanel>
                    </CheckBox>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- ============================================================ -->
        <!-- Dialog Action Bar (Row 1)                                     -->
        <!-- ============================================================ -->
        <Border Grid.Row="1"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Background="{DynamicResource SurfaceBrush}"
                Padding="24,16">
            <Grid ColumnDefinitions="Auto, *, Auto">

                <!-- Cancel Button (left) -->
                <Button Grid.Column="0"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        MinWidth="80"
                        Padding="16,8" />

                <!-- Validation Status (center) -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            IsVisible="{Binding !IsValid}">
                    <PathIcon Data="{StaticResource WarningIcon}"
                              Width="14" Height="14"
                              Foreground="{DynamicResource WarningBrush}" />
                    <TextBlock Text="Fix validation errors to save"
                               FontSize="12"
                               Foreground="{DynamicResource TextMuted}"
                               Margin="6,0,0,0" />
                </StackPanel>

                <!-- Save Button (right) -->
                <Button Grid.Column="2"
                        Content="Save Profile"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding IsValid}"
                        Classes="accent"
                        MinWidth="100"
                        Padding="16,8" />

            </Grid>
        </Border>

    </Grid>

</Window>
