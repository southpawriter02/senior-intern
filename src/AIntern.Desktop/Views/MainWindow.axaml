<!--
    MainWindow.axaml - Main Application Window

    Version: v0.2.3e

    Layout:
    - SplitView with collapsible sidebar pane
    - Sidebar contains: ModelSelectorView + InferenceSettingsPanel + ConversationListView
    - Content area contains: ChatView
    - Status bar at bottom with model info, preset indicator, and token statistics

    Keyboard Shortcuts:
    - Ctrl+N: Create new conversation
    - Ctrl+S: Save current conversation
    - Ctrl+B: Toggle sidebar visibility
    - Ctrl+F: Focus search box
-->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AIntern.Desktop.ViewModels"
        xmlns:views="using:AIntern.Desktop.Views"
        x:Class="AIntern.Desktop.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="The Senior Intern"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        Background="{DynamicResource WindowBackground}">

    <!--
        Keyboard Bindings for Global Commands
        These shortcuts are available regardless of focus state.
    -->
    <Window.KeyBindings>
        <!-- Ctrl+N: Create new conversation -->
        <KeyBinding Gesture="Ctrl+N" Command="{Binding NewConversationCommand}" />
        <!-- Ctrl+S: Save current conversation (v0.2.2e) -->
        <KeyBinding Gesture="Ctrl+S" Command="{Binding ChatViewModel.SaveCommand}" />
        <!-- Ctrl+B: Toggle sidebar visibility -->
        <KeyBinding Gesture="Ctrl+B" Command="{Binding ToggleSidebarCommand}" />
        <!-- Ctrl+F: Focus search box in conversation list -->
        <KeyBinding Gesture="Ctrl+F" Command="{Binding FocusSearchCommand}" />
    </Window.KeyBindings>

    <Grid RowDefinitions="*, Auto">
        <!--
            Main Content Area using SplitView

            SplitView provides:
            - Built-in pane open/close behavior
            - Smooth animations (when enabled)
            - Proper focus management

            DisplayMode="Inline" means:
            - Pane pushes content when open
            - No overlay behavior
            - Consistent with desktop app conventions
        -->
        <SplitView Grid.Row="0"
                   IsPaneOpen="{Binding IsSidebarVisible}"
                   DisplayMode="Inline"
                   OpenPaneLength="{Binding SidebarWidth}"
                   CompactPaneLength="0"
                   PanePlacement="Left">

            <!--
                Sidebar Pane
                Contains model selector at top and conversation list below.
            -->
            <SplitView.Pane>
                <Border Background="{DynamicResource SidebarBackground}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,0,1,0">
                    <Grid RowDefinitions="Auto, Auto, *">
                        <!--
                            Model Selector
                            Allows user to select and load GGUF model files.
                        -->
                        <views:ModelSelectorView Grid.Row="0"
                                                 DataContext="{Binding ModelSelectorViewModel}" />

                        <!--
                            Inference Settings Panel (v0.2.3e)
                            Provides parameter sliders and preset management.
                            Collapsible to save sidebar space when not actively tuning.
                        -->
                        <views:InferenceSettingsPanel Grid.Row="1"
                                                       DataContext="{Binding InferenceSettingsViewModel}" />

                        <!--
                            Conversation List
                            Shows conversation history grouped by date.
                            Provides search, rename, delete, and pin functionality.
                        -->
                        <views:ConversationListView Grid.Row="2"
                                                    DataContext="{Binding ConversationListViewModel}" />
                    </Grid>
                </Border>
            </SplitView.Pane>

            <!--
                Main Content Area
                Contains the chat view and sidebar toggle button when sidebar is hidden.
            -->
            <SplitView.Content>
                <Grid>
                    <!--
                        Chat View
                        Main chat interface with message display and input area.
                    -->
                    <views:ChatView DataContext="{Binding ChatViewModel}" />

                    <!--
                        Sidebar Toggle Button
                        Only visible when sidebar is hidden.
                        Allows user to restore sidebar visibility.
                    -->
                    <Button HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Margin="8"
                            Command="{Binding ToggleSidebarCommand}"
                            IsVisible="{Binding !IsSidebarVisible}"
                            Classes="IconButton"
                            ToolTip.Tip="Show Sidebar (Ctrl+B)">
                        <PathIcon Data="{StaticResource MenuIcon}"
                                  Width="16" Height="16" />
                    </Button>
                </Grid>
            </SplitView.Content>
        </SplitView>

        <!--
            Status Bar
            Shows model state, preset info, token statistics, and generation progress.
        -->
        <Border Grid.Row="1"
                Background="{DynamicResource StatusBarBackground}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid ColumnDefinitions="*, Auto, Auto, Auto, Auto, Auto">
                <!--
                    Status Message
                    Shows "No model loaded" or "Model: {name}"
                -->
                <TextBlock Text="{Binding StatusMessage}"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextSecondary}" />

                <!--
                    Preset Indicator (v0.2.3e)
                    Shows "Preset: {name}" with the active preset name
                -->
                <TextBlock Grid.Column="1"
                           Text="{Binding InferenceSettingsViewModel.SelectedPreset.Name, StringFormat='Preset: {0}', FallbackValue='Preset: None'}"
                           FontSize="11"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextMuted}"
                           Margin="16,0,0,0" />

                <!--
                    Temperature Indicator (v0.2.3e)
                    Shows "T:0.70" for quick reference to temperature setting
                -->
                <TextBlock Grid.Column="2"
                           Text="{Binding InferenceSettingsViewModel.Temperature, StringFormat='T:{0:F2}'}"
                           FontSize="11"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextMuted}"
                           Margin="16,0,0,0" />

                <!--
                    Save Status Indicator
                    Shows "Saving...", "Saved", or "Save failed"
                -->
                <TextBlock Grid.Column="3"
                           Text="{Binding ChatViewModel.SaveStatus}"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextMuted}"
                           Margin="16,0"
                           IsVisible="{Binding ChatViewModel.SaveStatus, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!--
                    Token Statistics
                    Shows "Tokens: X (Y.Y tok/s)" during generation
                -->
                <TextBlock Grid.Column="4"
                           Text="{Binding TokenInfo}"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextMuted}"
                           Margin="16,0" />

                <!--
                    Progress Indicator
                    Indeterminate progress bar shown during generation
                -->
                <ProgressBar Grid.Column="5"
                             IsVisible="{Binding ChatViewModel.IsGenerating}"
                             IsIndeterminate="True"
                             Width="80"
                             Height="4" />
            </Grid>
        </Border>
    </Grid>

</Window>
